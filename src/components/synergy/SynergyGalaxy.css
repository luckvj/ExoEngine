.synergy-galaxy-container {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    background: #000000;
    /* Pure Black for maximum contrast */
    overflow: hidden;
    z-index: 0;
    pointer-events: auto;
}

.synergy-galaxy-canvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    /* Canvas renders vault items (stars) - should be BEHIND DOM nodes */
}

.synergy-galaxy-vignette {
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at center, transparent 30%, rgba(0, 0, 0, 0.8) 100%);
    pointer-events: none;
    z-index: 10;
    transition: opacity 0.5s ease;
}

.is-isolating .synergy-galaxy-vignette {
    opacity: 0.4;
    /* Stronger vignette effect during isolation */
}

.synergy-galaxy-stars {
    position: absolute;
    inset: -100%;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    image-rendering: high-quality;
    background-image:
        radial-gradient(1.5px 1.5px at 20px 30px, #ceae33, rgba(206, 174, 51, 0)),
        radial-gradient(1.5px 1.5px at 140px 170px, #7df9ff, rgba(125, 249, 255, 0)),
        radial-gradient(2px 2px at 50px 160px, #a850f2, rgba(168, 80, 242, 0)),
        radial-gradient(2px 2px at 190px 40px, #bf84ff, rgba(191, 132, 255, 0)),
        radial-gradient(1px 1px at 290px 240px, #ceae33, rgba(206, 174, 51, 0));
    background-size: 350px 350px;
    opacity: 0.45;
    /* Tripled opacity for pop */
    pointer-events: none;
    transform: translateZ(-800px);
}

.synergy-galaxy-stage {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 1px;
    height: 1px;
    transform-style: preserve-3d;
    will-change: transform;
    z-index: 5;
    /* Stage contains DOM nodes. Z-ordering now handled via manual projection zIndex */
}

.galaxy-node {
    position: absolute;
    width: 84px;
    height: 84px;
    margin-top: -42px;
    margin-left: -42px;
    transform-style: preserve-3d;
    will-change: transform, opacity;
    /* HITBOX FIX: Disable interactions on the square container to avoid "invisible box" clicks */
    pointer-events: none;
    /* Smooth transition for synergy hover dimming */
    transition: opacity 0.2s ease-out;
}

.galaxy-node__icon-wrap {
    position: relative;
    width: 100%;
    height: 100%;
    background: rgba(30, 30, 45, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: visible;
    /* Allow status icons and watermarks to bleed out */
    z-index: 2;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
    /* INTERACTION RESTORATION: Only the visible icon/stats part receives clicks */
    pointer-events: auto;
    cursor: pointer;
}

.galaxy-node--masterwork .galaxy-node__icon-wrap {
    border: 3px solid #ceae33 !important;
    animation: galaxy-masterwork-glow 3s infinite ease-in-out;
}

@keyframes galaxy-masterwork-glow {

    0%,
    100% {
        box-shadow: inset 0 0 5px rgba(206, 174, 51, 0.4), 0 0 5px rgba(206, 174, 51, 0.3);
    }

    50% {
        box-shadow: inset 0 0 15px rgba(206, 174, 51, 0.6), 0 0 15px rgba(206, 174, 51, 0.5);
    }
}

.galaxy-node--subclass .galaxy-node__icon-wrap {
    transform: rotate(45deg);
    border-radius: 50%;
    /* Changed from 4px to 50% to show full circle instead of diamond */
    overflow: visible;
    /* Changed from hidden to visible to prevent prismatic edges from being cut off */
    border: none !important;
    /* Override base border for subclass */
    background: transparent !important;
    /* Remove the dark background box completely */
    backdrop-filter: none !important;
    box-shadow: none !important;
}

/* DEFENSIVE FIX: Ensure no background leaks on hover for subclasses */
.galaxy-node--subclass:hover,
.galaxy-node--subclass:hover .galaxy-node__icon-wrap {
    background: transparent !important;
    box-shadow: none !important;
    border: none !important;
}

.galaxy-node__icon {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.galaxy-node--subclass .galaxy-node__icon {
    transform: rotate(-45deg) scale(1.0);
    /* Reduced scale from 1.4 to 1.0 since we're showing full circle now */
    border-radius: 50%;
    /* Ensure the icon itself is circular */
}

.galaxy-node__watermark {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 5;
    pointer-events: none;
    object-fit: contain;
    object-position: top left;
}

.galaxy-node__watermark--featured {
    width: 33%;
    top: -2px;
    left: -2px;
}

.galaxy-node__watermark--legacy {
    opacity: 0.8;
}

.galaxy-node__power {
    position: absolute;
    bottom: 2px;
    right: 2px;
    background: rgba(0, 0, 0, 0.85);
    padding: 1px 4px;
    z-index: 6;
    display: flex;
    align-items: center;
    gap: 3px;
    border-radius: 1px;
    backdrop-filter: blur(2px);
}

.galaxy-node__damage-icon {
    width: 10px;
    height: 10px;
    object-fit: contain;
}

.galaxy-node__power-value {
    font-size: 11px;
    font-weight: 700;
    color: #f5f5f5;
    font-family: monospace;
}

.galaxy-node__tier-stars {
    position: absolute;
    left: 2px;
    top: -2px;
    z-index: 6;
    transform: scale(0.85);
    transform-origin: left top;
}

.galaxy-node__craft-status {
    position: absolute;
    bottom: 0;
    left: 0;
    display: flex;
    align-items: flex-end;
    gap: 0;
    z-index: 6;
    pointer-events: none;
    line-height: 0;
}

.galaxy-node__crafted-icon,
.galaxy-node__enhanced-icon {
    width: 200px;
    height: 200px;
    object-fit: contain;
    /* Deep vibrant red with pulsating glow */
    filter:
        saturate(5) contrast(3) brightness(0.9) hue-rotate(350deg) drop-shadow(0 0 4px rgba(220, 20, 20, 0.6)) drop-shadow(0 0 12px rgba(220, 20, 20, 0.2));
    mix-blend-mode: multiply;
    animation: node-red-glow-pulse 2s ease-in-out infinite;
    transform: translate(-5%, 32%);
    /* Slight over-bleed for the "corner" look */
}

@keyframes node-red-glow-pulse {

    0%,
    100% {
        filter: saturate(5) contrast(3) brightness(0.9) hue-rotate(350deg) drop-shadow(0 0 4px rgba(220, 20, 20, 0.6)) drop-shadow(0 0 8px rgba(220, 20, 20, 0.4));
    }

    50% {
        filter: saturate(5) contrast(3) brightness(0.9) hue-rotate(350deg) drop-shadow(0 0 6px rgba(220, 20, 20, 0.8)) drop-shadow(0 0 12px rgba(220, 20, 20, 0.6));
    }
}

/* User Request: Lower the icon for non-masterwork items */
.galaxy-node:not(.galaxy-node--masterwork) .galaxy-node__crafted-icon,
.galaxy-node:not(.galaxy-node--masterwork) .galaxy-node__enhanced-icon {
    transform: translate(-8%, 38%);
}

/* Rarity Colors */
.node-tier--exotic .galaxy-node__icon-wrap {
    background-color: rgba(206, 174, 51, 0.2);
}

.node-tier--legendary .galaxy-node__icon-wrap {
    background-color: rgba(82, 47, 101, 0.2);
}

.node-tier--rare .galaxy-node__icon-wrap {
    background-color: rgba(80, 118, 163, 0.2);
}

.galaxy-node--empty .galaxy-node__icon-wrap {
    background: rgba(10, 10, 15, 0.4);
    border: 1px dashed rgba(255, 255, 255, 0.05);
}

.galaxy-node--empty-mark {
    width: 20%;
    height: 20%;
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 50%;
}

.galaxy-node--equipped .galaxy-node__icon-wrap {
    border: 2px solid var(--element-color, #fff);
    box-shadow: 0 0 15px var(--element-color, #fff);
}

/* Element Glow */
.galaxy-node__glow {
    position: absolute;
    inset: -15px;
    background: radial-gradient(circle, var(--element-color, #fff) 0%, transparent 70%);
    opacity: 0.3;
    pointer-events: none;
    z-index: 1;
    animation: node-pulse 3s ease-in-out infinite;
    /* VISUAL FIX: Ensure the glow gradient is clipped to a circle to avoid square background artifacts */
    border-radius: 50%;
}

/* Intense Subclass Aura */
.galaxy-node--subclass .galaxy-node__glow {
    inset: -15px;
    opacity: 0.9;
    /* Even higher base to compensate for losing the white core */
    /* Strict element color gradient - distinct, colorful star */
    background: radial-gradient(circle, var(--element-color, #fff) 0%, var(--element-color, #fff) 40%, rgba(0, 0, 0, 0) 70%);
    filter: blur(12px);
    animation: subclass-aura-pulse 3s ease-in-out infinite;
    border-radius: 50%;
    mix-blend-mode: screen;
}

@keyframes subclass-aura-pulse {

    0%,
    100% {
        transform: scale(0.95);
        opacity: 0.7;
    }

    50% {
        transform: scale(1.15);
        opacity: 1;
        /* Full brightness at peak */
    }
}

/* Performance Optimizations based on LOD */
.node-lod--1 .galaxy-node__icon-wrap {
    backdrop-filter: none !important;
    background: rgba(30, 30, 45, 0.9);
}

/* Keep details visible on LOD 1 but slightly smaller for performance */
.node-lod--1 .galaxy-node__power {
    transform: scale(0.9);
}

.node-lod--1 .galaxy-node__tier-stars {
    transform: scale(0.75);
}

.node-lod--1 .galaxy-node__watermark {
    opacity: 0.8;
}

.node-lod--1 .galaxy-node__craft-status {
    transform: scale(0.85);
}

.galaxy-node__stardust {
    width: 24px;
    height: 24px;
    background: var(--element-color, #fff);
    border-radius: 50%;
    opacity: 0.8;
    box-shadow: 0 0 12px var(--element-color, #fff);
    filter: blur(1px);
    will-change: transform;
}

.node-lod--2 {
    pointer-events: none;
    /* Distant stars shouldn't block mouse */
}

.node-lod--1 .galaxy-node__glow {
    opacity: 0.2;
    inset: -10px;
}

.node-lod--2 .galaxy-node__glow {
    opacity: 0.4;
    inset: -8px;
    animation: node-pulse 3s ease-in-out infinite;
}

.galaxy-node--equipped .galaxy-node__glow {
    opacity: 0.6;
    inset: -30px;
}

/* Dim non-synced nodes even more in isolation */
.synergy-galaxy-container.is-isolating .synergy-galaxy-stage .galaxy-node:not(.is-synced):not(.galaxy-node--focused) {
    opacity: 0.02 !important;
}

.synergy-galaxy-stars,
.synergy-galaxy-canvas {
    transition: opacity 0.5s ease;
}

.galaxy-node--masterwork .galaxy-node__glow {
    background: radial-gradient(circle, #ceae33 0%, transparent 70%);
    opacity: 0.5;
    animation: galaxy-masterwork-glow-outer 3s infinite ease-in-out;
}

@keyframes galaxy-masterwork-glow-outer {

    0%,
    100% {
        opacity: 0.3;
        transform: scale(1);
    }

    50% {
        opacity: 0.6;
        transform: scale(1.15);
    }
}

/* Background Nebula density */
.synergy-galaxy-stars::after {
    content: '';
    position: absolute;
    inset: 0;
    background:
        radial-gradient(circle at 30% 20%, rgba(77, 136, 255, 0.04) 0%, transparent 50%),
        radial-gradient(circle at 70% 80%, rgba(191, 132, 255, 0.04) 0%, transparent 50%),
        radial-gradient(circle at 80% 30%, rgba(255, 144, 0, 0.03) 0%, transparent 60%),
        radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.01) 0%, transparent 80%);
    pointer-events: none;
    z-index: -1;
}

/* Element Colors */
.element--solar {
    --element-color: #ff9000;
}

.element--arc {
    --element-color: #7df9ff;
}

.element--void {
    --element-color: #bf84ff;
}

.element--stasis {
    --element-color: #4d88ff;
}

.element--strand {
    --element-color: #4aff9b;
}

.element--prismatic {
    --element-color: #ff8df6;
}

@keyframes node-pulse {

    0%,
    100% {
        transform: scale(1);
        opacity: 0.3;
    }

    50% {
        transform: scale(1.2);
        opacity: 0.5;
    }
}

/* 3D Depth Shading */
.galaxy-node {
    filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.5));
}

.synergy-galaxy-svg {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 2000px;
    height: 2000px;
    margin-top: -1000px;
    margin-left: -1000px;
    pointer-events: none;
    overflow: visible;
    transform-style: preserve-3d;
}

.synergy-galaxy-hud-layer {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    pointer-events: none;
    z-index: 1000;
    /* Above the 3D stage */
}

.synergy-galaxy-hud-layer .galaxy-node {
    pointer-events: none;
    /* CRITICAL: Container remains non-interactive, only children (icon-wrap) capture events */
}

.synergy-galaxy-ui {
    position: absolute;
    bottom: 60px;
    left: 40px;
    z-index: 100;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.synergy-galaxy-header {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
    pointer-events: auto;
}

.synergy-galaxy-debug {
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    font-size: 10px;
    color: #4aff9b;
    /* Strand green for debug */
    opacity: 0.8;
    background: rgba(0, 0, 0, 0.4);
    padding: 2px 6px;
    border-radius: 2px;
    letter-spacing: 1px;
}

.synergy-galaxy-title-container {
    display: flex;
    align-items: center;
    gap: 16px;
}

.synergy-galaxy-title {
    font-size: 24px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 4px;
    color: #cccccc;
    margin-bottom: 0;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
}

.synergy-galaxy-reload-btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.6);
    width: 38px;
    height: 38px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(4px);
    padding: 0;
    position: relative;
    overflow: visible;
}

.synergy-galaxy-reload-icon {
    width: 24px;
    height: 24px;
    object-fit: contain;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.synergy-galaxy-reload-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
}

.synergy-galaxy-reload-btn:hover .synergy-galaxy-reload-icon {
    transform: rotate(180deg);
}

.synergy-galaxy-reload-btn:active .synergy-galaxy-reload-icon {
    transform: rotate(360deg) scale(0.9);
}

.synergy-galaxy-reload-btn.is-loading .synergy-galaxy-reload-icon {
    animation: reload-spin 1s linear infinite;
}

.synergy-galaxy-stale-warning {
    position: absolute;
    top: -4px;
    right: -4px;
    width: 16px;
    height: 16px;
    background: #000;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #ff4444;
    box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
    animation: stale-warning-pulse 2s infinite;
}

.synergy-galaxy-stale-warning svg {
    width: 10px;
    height: 10px;
}

@keyframes stale-warning-pulse {

    0%,
    100% {
        transform: scale(1);
        box-shadow: 0 0 5px rgba(255, 68, 68, 0.5);
    }

    50% {
        transform: scale(1.2);
        box-shadow: 0 0 15px rgba(255, 68, 68, 0.8);
    }
}

@keyframes reload-spin {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

.synergy-galaxy-reload-btn svg {
    width: 18px;
    height: 18px;
    transition: transform 0.5s ease;
}

.synergy-galaxy-reload-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
}

.synergy-galaxy-reload-btn:hover svg {
    transform: rotate(90deg);
}

.synergy-galaxy-reload-btn:active svg {
    transform: rotate(180deg) scale(0.9);
}

/* Optional: Add a spinning state when profileLoader.loading is true */
.synergy-galaxy-reload-btn.is-loading svg {
    animation: reload-spin 1s linear infinite;
}

@keyframes reload-spin {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

.synergy-galaxy-reset-btn {
    background: rgba(255, 255, 255, 0.05);
    border: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.8);
    padding: 6px 16px;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.2s ease;
    backdrop-filter: blur(4px);
}

.synergy-galaxy-reset-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border-bottom-color: #fff;
    box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
}

.synergy-galaxy-reset-btn:active {
    transform: scale(0.95);
}

.synergy-galaxy-hint {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: rgba(255, 255, 255, 0.4);
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
    justify-content: center;
}

/* Synergy Trigger Button */
.synergy-trigger-btn {
    background: linear-gradient(135deg, rgba(206, 174, 51, 0.2), rgba(168, 85, 247, 0.2));
    border: 1px solid rgba(206, 174, 51, 0.5);
    border-radius: 6px;
    color: #ceae33;
    padding: 8px 16px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.25s ease;
    backdrop-filter: blur(8px);
    animation: synergy-pulse 2s ease-in-out infinite;
}

.synergy-trigger-btn:hover {
    background: linear-gradient(135deg, rgba(206, 174, 51, 0.3), rgba(168, 85, 247, 0.3));
    border-color: #ceae33;
    color: #fff;
    box-shadow: 0 0 20px rgba(206, 174, 51, 0.3);
    transform: scale(1.05);
}

.synergy-trigger-btn:active {
    transform: scale(0.98);
}

.synergy-trigger-btn--close {
    background: linear-gradient(135deg, rgba(255, 100, 100, 0.2), rgba(255, 50, 50, 0.1));
    border-color: rgba(255, 100, 100, 0.5);
    color: #ff6b6b;
    animation: none;
}

.synergy-trigger-btn--close:hover {
    background: linear-gradient(135deg, rgba(255, 100, 100, 0.3), rgba(255, 50, 50, 0.2));
    border-color: #ff6b6b;
    color: #fff;
    box-shadow: 0 0 20px rgba(255, 100, 100, 0.3);
}

@keyframes synergy-pulse {

    0%,
    100% {
        box-shadow: 0 0 8px rgba(206, 174, 51, 0.2);
    }

    50% {
        box-shadow: 0 0 16px rgba(206, 174, 51, 0.4);
    }
}

.synergy-blackout {
    position: fixed;
    inset: 0;
    background: #000;
    z-index: 2000000000;
    /* Higher than stars, nodes but below SynergyWeb menu */
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.synergy-blackout--active {
    opacity: 1;
    pointer-events: auto;
    /* Block interactions with galaxy below */
}

/* NUCLEAR VISIBILITY FIX: Strictly hide all galaxy content when blackout is active */
.synergy-galaxy-container.is-blackout-mode .synergy-galaxy-stage,
.synergy-galaxy-container.is-blackout-mode .synergy-galaxy-canvas,
.synergy-galaxy-container.is-blackout-mode .synergy-galaxy-stars,
.synergy-galaxy-container.is-blackout-mode .synergy-galaxy-vignette,
.synergy-galaxy-container.is-blackout-mode .galaxy-node {
    display: none !important;
}

/* ==========================================================================
   TRANSMAT EFFECTS
   ========================================================================== */

/* 
   Note: All Transmat Effect animations and themes are now centralized in 
   src/styles/TransmatEffect.css to ensure consistency across the app.
   SynergyGalaxy just applies the classes (.transmat-equip, .transmat-equip-fail, etc.)
*/