<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  RewriteRule ^index\.html$ - [L]
  
  # DO NOT rewrite actual files or PHP scripts
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule ^.*$ - [NC,L]
  
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.html [L]
</IfModule>

# Security Hardening for ExoEngineâ„¢ (IONOS/Apache)
<IfModule mod_headers.c>
  # 1. Content Security Policy - Comprehensive protection
  Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' https://www.bungie.net https://*.bungie.net https://exoengine.online data: blob:; connect-src 'self' https://www.bungie.net https://*.bungie.net https://exoengine.online https://corsproxy.io https://api.destinyitemmanager.com https://dim.gg https://database-clarity.github.io; frame-ancestors 'none'; base-uri 'self'; form-action 'self' https://www.bungie.net; upgrade-insecure-requests;"
  Header set X-Frame-Options "DENY"
  
  # 2. Prevent MIME sniffing
  Header set X-Content-Type-Options "nosniff"
  
  # 3. Privacy & Referrer protection
  Header set Referrer-Policy "strict-origin-when-cross-origin"
  
  # 4. Permissions Policy (restrict powerful features)
  Header set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), bluetooth=(), magnetometer=(), gyroscope=()"
  
  # 5. XSS Protection for older browsers
  Header set X-XSS-Protection "1; mode=block"
  
  # 6. Strict Transport Security (HTTPS only)
  Header set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

  # 7. Cache Control for assets (performance + security)
  <FilesMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|otf)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
  
  # 8. No cache for HTML (always get fresh content)
  <FilesMatch "\.(html|htm)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </FilesMatch>
</IfModule>

# Disable directory browsing
Options -Indexes

# Block access to sensitive files
<FilesMatch "(\.(env|git|gitignore|htaccess|htpasswd)|package\.json|tsconfig\.json)$">
  Require all denied
</FilesMatch>
