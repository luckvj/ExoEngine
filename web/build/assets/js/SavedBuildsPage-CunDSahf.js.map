{"version":3,"file":"SavedBuildsPage-CunDSahf.js","sources":["../../../../src/services/csv.service.ts","../../../../src/pages/SavedBuildsPage.tsx"],"sourcesContent":["import Papa from 'papaparse';\r\nimport { errorLog } from '../utils/logger';\r\nimport { manifestService } from './bungie/manifest.service';\r\nimport { type BuildTemplate, GuardianClass, ItemSlot } from '../types';\r\n\r\nexport interface CSVLoadoutRow {\r\n    'NAME': string;\r\n    'CLASS': string;\r\n    'SUBCLASS': string;\r\n    'SUPER': string;\r\n    'GRENADE': string;\r\n    'MELEE': string;\r\n    'CLASS ABILITY': string;\r\n    'ASPECT 1': string;\r\n    'ASPECT 2': string;\r\n    'FRAGMENT 1': string;\r\n    'FRAGMENT 2': string;\r\n    'FRAGMENT 3': string;\r\n    'FRAGMENT 4': string;\r\n    'FRAGMENT 5': string;\r\n    'KINETIC WEAPON': string;\r\n    'ENERGY WEAPON': string;\r\n    'POWER WEAPON': string;\r\n    'HELMET': string;\r\n    'ARMS': string;\r\n    'CHEST': string;\r\n    'LEGS': string;\r\n    'CLASS ITEM': string;\r\n    'HELMET MODS': string;\r\n    'ARMS MODS': string;\r\n    'CHEST MODS': string;\r\n    'LEGS MODS': string;\r\n    'CLASS ITEM MODS': string;\r\n}\r\n\r\nexport const csvService = {\r\n    /**\r\n     * Export builds to a Plain English CSV\r\n     */\r\n    exportBuilds: (builds: { name: string; template: BuildTemplate }[]): string => {\r\n        const rows: CSVLoadoutRow[] = builds.map(b => {\r\n            const { template } = b;\r\n            const subConfig = template.subclassConfig;\r\n\r\n            const n = (hash: number) => hash ? manifestService.getName(hash) || 'Unknown' : '';\r\n\r\n            // Group Armor Mods\r\n            const armorMods = template.armorMods || [];\r\n            const modsBySlot: Record<string, string[]> = {\r\n                'Helmet': [],\r\n                'Arms': [],\r\n                'Chest': [],\r\n                'Legs': [],\r\n                'Class Item': []\r\n            };\r\n\r\n            armorMods.forEach(modHash => {\r\n                const def = manifestService.getItem(modHash);\r\n                if (!def) return;\r\n                const name = def.name;\r\n                const type = def.itemTypeDisplayName?.toLowerCase() || '';\r\n\r\n                if (type.includes('helmet')) modsBySlot['Helmet'].push(name);\r\n                else if (type.includes('gauntlets') || type.includes('arms')) modsBySlot['Arms'].push(name);\r\n                else if (type.includes('chest')) modsBySlot['Chest'].push(name);\r\n                else if (type.includes('leg')) modsBySlot['Legs'].push(name);\r\n                else if (type.includes('class')) modsBySlot['Class Item'].push(name);\r\n                else if (type.includes('general')) modsBySlot['Helmet'].push(name);\r\n            });\r\n\r\n            // Helper to get item for slot (checking both Legendaries and Exotics)\r\n            const getWeapon = (bucketHash: number, slot: ItemSlot) => {\r\n                // Check Exotic first\r\n                if (template.exoticWeapon && template.exoticWeapon.slot === slot) {\r\n                    return template.exoticWeapon.name;\r\n                }\r\n                // Check Legendaries\r\n                const item = template.items?.find(i => {\r\n                    const def = manifestService.getItem(i.hash);\r\n                    return def?.bucketTypeHash === bucketHash;\r\n                });\r\n                return item ? n(item.hash) : '';\r\n            };\r\n\r\n            const getArmor = (subType: number, slot: ItemSlot) => {\r\n                // Check Exotic first\r\n                if (template.exoticArmor && template.exoticArmor.slot === slot) {\r\n                    return template.exoticArmor.name;\r\n                }\r\n                // Check Legendaries\r\n                const item = template.items?.find(i => {\r\n                    const def = manifestService.getItem(i.hash);\r\n                    return def?.itemSubType === subType;\r\n                });\r\n                return item ? n(item.hash) : '';\r\n            };\r\n\r\n            return {\r\n                'NAME': b.name,\r\n                'CLASS': manifestService.getClassName(template.guardianClass),\r\n                'SUBCLASS': n(subConfig?.subclassHash || 0),\r\n                'SUPER': n(subConfig?.superHash || 0),\r\n                'GRENADE': n(subConfig?.grenadeHash || 0),\r\n                'MELEE': n(subConfig?.meleeHash || 0),\r\n                'CLASS ABILITY': n(subConfig?.classAbilityHash || 0),\r\n                'ASPECT 1': subConfig?.aspects?.[0] ? n(subConfig.aspects[0]) : '',\r\n                'ASPECT 2': subConfig?.aspects?.[1] ? n(subConfig.aspects[1]) : '',\r\n                'FRAGMENT 1': subConfig?.fragments?.[0] ? n(subConfig.fragments[0]) : '',\r\n                'FRAGMENT 2': subConfig?.fragments?.[1] ? n(subConfig.fragments[1]) : '',\r\n                'FRAGMENT 3': subConfig?.fragments?.[2] ? n(subConfig.fragments[2]) : '',\r\n                'FRAGMENT 4': subConfig?.fragments?.[3] ? n(subConfig.fragments[3]) : '',\r\n                'FRAGMENT 5': subConfig?.fragments?.[4] ? n(subConfig.fragments[4]) : '',\r\n\r\n                'KINETIC WEAPON': getWeapon(1498876634, ItemSlot.Kinetic),\r\n                'ENERGY WEAPON': getWeapon(2465295065, ItemSlot.Energy),\r\n                'POWER WEAPON': getWeapon(953998645, ItemSlot.Power),\r\n\r\n                'HELMET': getArmor(26, ItemSlot.Helmet),\r\n                'ARMS': getArmor(27, ItemSlot.Arms),\r\n                'CHEST': getArmor(28, ItemSlot.Chest),\r\n                'LEGS': getArmor(29, ItemSlot.Legs),\r\n                'CLASS ITEM': getArmor(30, ItemSlot.ClassItem),\r\n\r\n                'HELMET MODS': modsBySlot['Helmet'].join(', '),\r\n                'ARMS MODS': modsBySlot['Arms'].join(', '),\r\n                'CHEST MODS': modsBySlot['Chest'].join(', '),\r\n                'LEGS MODS': modsBySlot['Legs'].join(', '),\r\n                'CLASS ITEM MODS': modsBySlot['Class Item'].join(', '),\r\n            };\r\n        });\r\n\r\n        return Papa.unparse(rows);\r\n    },\r\n\r\n    /**\r\n     * Import builds from CSV\r\n     */\r\n    importBuilds: async (csvText: string): Promise<BuildTemplate[]> => {\r\n        return new Promise((resolve, reject) => {\r\n            Papa.parse(csvText, {\r\n                header: true,\r\n                skipEmptyLines: true,\r\n                complete: (results) => {\r\n                    const rows = results.data as CSVLoadoutRow[];\r\n                    const templates: BuildTemplate[] = [];\r\n\r\n                    for (const row of rows) {\r\n                        try {\r\n                            const t = convertRowToTemplate(row);\r\n                            if (t) templates.push(t);\r\n                        } catch (e) {\r\n                            errorLog('CSV', 'Failed to parse row:', row, e);\r\n                        }\r\n                    }\r\n                    resolve(templates);\r\n                },\r\n                error: (error: any) => reject(error)\r\n            });\r\n        });\r\n    }\r\n};\r\n\r\nfunction convertRowToTemplate(row: CSVLoadoutRow): BuildTemplate | null {\r\n    // 1. Determine Class\r\n    const classMap: Record<string, GuardianClass> = {\r\n        'Titan': GuardianClass.Titan,\r\n        'Hunter': GuardianClass.Hunter,\r\n        'Warlock': GuardianClass.Warlock\r\n    };\r\n    const guardianClass = classMap[row['CLASS']] ?? GuardianClass.Titan;\r\n\r\n    // 2. Subclass\r\n    const subclassHash = findItemHash(row['SUBCLASS'], guardianClass);\r\n    if (!subclassHash) return null;\r\n\r\n    // 3. Subclass Config\r\n    const superHash = findItemHash(row['SUPER']);\r\n    const grenadeHash = findItemHash(row['GRENADE']);\r\n    const meleeHash = findItemHash(row['MELEE']);\r\n    const classAbilityHash = findItemHash(row['CLASS ABILITY']);\r\n\r\n    const aspects: number[] = [];\r\n    if (row['ASPECT 1']) aspects.push(findItemHash(row['ASPECT 1']));\r\n    if (row['ASPECT 2']) aspects.push(findItemHash(row['ASPECT 2']));\r\n\r\n    const fragments: number[] = [];\r\n    ['FRAGMENT 1', 'FRAGMENT 2', 'FRAGMENT 3', 'FRAGMENT 4', 'FRAGMENT 5'].forEach(k => {\r\n        const name = row[k as keyof typeof row];\r\n        if (name) fragments.push(findItemHash(name));\r\n    });\r\n\r\n    const subclassConfig = {\r\n        subclassHash,\r\n        superHash,\r\n        grenadeHash,\r\n        meleeHash,\r\n        classAbilityHash,\r\n        aspects: aspects.filter(h => h > 0),\r\n        fragments: fragments.filter(h => h > 0)\r\n    };\r\n\r\n    // 4. Weapons & Armor\r\n    const items: { hash: number; name: string }[] = [];\r\n    let exoticWeapon: BuildTemplate['exoticWeapon'] = { hash: 0, name: 'Unknown', slot: ItemSlot.Kinetic };\r\n    let exoticArmor: BuildTemplate['exoticArmor'] = { hash: 0, name: 'Unknown', slot: ItemSlot.Helmet };\r\n\r\n    const gearMap = [\r\n        { name: row['KINETIC WEAPON'], bucket: 1498876634 },\r\n        { name: row['ENERGY WEAPON'], bucket: 2465295065 },\r\n        { name: row['POWER WEAPON'], bucket: 953998645 },\r\n        { name: row['HELMET'], bucket: 3448274439 },\r\n        { name: row['ARMS'], bucket: 3551918588 },\r\n        { name: row['CHEST'], bucket: 14239492 },\r\n        { name: row['LEGS'], bucket: 20886954 },\r\n        { name: row['CLASS ITEM'], bucket: 1585787867 }\r\n    ];\r\n\r\n    gearMap.forEach(gear => {\r\n        if (!gear.name) return;\r\n        const hash = findItemHash(gear.name);\r\n        if (!hash) return;\r\n\r\n        const def = manifestService.getItem(hash);\r\n        if (def?.tierType === 6) { // Exotic\r\n            if (def.itemType === 3) { // Weapon\r\n                // Determine slot\r\n                let slot: ItemSlot = ItemSlot.Energy;\r\n                if (def.bucketTypeHash === 1498876634) slot = ItemSlot.Kinetic;\r\n                if (def.bucketTypeHash === 2465295065) slot = ItemSlot.Energy;\r\n                if (def.bucketTypeHash === 953998645) slot = ItemSlot.Power;\r\n                exoticWeapon = { hash, name: def.name, slot };\r\n            } else if (def.itemType === 2) { // Armor\r\n                const sMap: Record<number, ItemSlot> = {\r\n                    3448274439: ItemSlot.Helmet,\r\n                    3551918588: ItemSlot.Arms,\r\n                    14239492: ItemSlot.Chest,\r\n                    20886954: ItemSlot.Legs\r\n                };\r\n                const slot = sMap[def.bucketTypeHash || 0] ?? ItemSlot.Helmet;\r\n                exoticArmor = { hash, name: def.name, slot };\r\n            }\r\n        } else {\r\n            items.push({ hash, name: def?.name || gear.name });\r\n        }\r\n    });\r\n\r\n    // 5. Mods\r\n    const armorMods: number[] = [];\r\n    const modCols = ['HELMET MODS', 'ARMS MODS', 'CHEST MODS', 'LEGS MODS', 'CLASS ITEM MODS'];\r\n    modCols.forEach(col => {\r\n        const val = row[col as keyof typeof row];\r\n        if (val) {\r\n            const names = val.split(',').map((s: string) => s.trim()).filter((s: string) => s.length > 0);\r\n            names.forEach((n: string) => {\r\n                const h = findItemHash(n);\r\n                if (h) armorMods.push(h);\r\n            });\r\n        }\r\n    });\r\n\r\n    // 6. Element (Derive from Subclass)\r\n    const def = manifestService.getItem(subclassHash);\r\n    const el = def?.defaultDamageTypeHash ? manifestService.getDamageType(def.defaultDamageTypeHash)?.name.toLowerCase() : 'void';\r\n\r\n    return {\r\n        id: `imported-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n        name: row['NAME'] || 'Imported Build',\r\n        element: el as any,\r\n        guardianClass,\r\n        exoticWeapon,\r\n        exoticArmor,\r\n        subclassConfig,\r\n        armorMods,\r\n        artifactPerks: [],\r\n        items,\r\n        playstyle: 'Imported from CSV',\r\n        difficulty: 'intermediate'\r\n    };\r\n}\r\n\r\nfunction findItemHash(name: string, classType?: number): number {\r\n    if (!name) return 0;\r\n\r\n    // 1. Search Manifest (Exact)\r\n    // Using searchItems but prioritizing exact match\r\n    const results = manifestService.searchItems(name, { limit: 10, classType });\r\n    if (results.length > 0) {\r\n        // Prefer exact match (case insensitive)\r\n        const exact = results.find(i => i.name.toLowerCase() === name.toLowerCase());\r\n        return exact ? exact.hash : results[0].hash;\r\n    }\r\n\r\n    return 0;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useSavedBuildsStore, useProfileStore, useAuthStore } from '../store';\r\nimport { buildService } from '../services/build.service';\r\nimport { GlassCard } from '../components/common/GlassCard';\r\nimport { useToast } from '../components/common/Toast';\r\nimport { manifestService } from '../services/bungie/manifest.service';\r\nimport { loadoutLinkService, convertBuildToLoadoutShareData } from '../services/bungie/loadout-link.service';\r\nimport { csvService } from '../services/csv.service';\r\nimport { errorLog } from '../utils/logger';\r\nimport { ConfirmationModal } from '../components/common/ConfirmationModal';\r\nimport type { BuildTemplate } from '../types';\r\nimport './SavedBuildsPage.css';\r\n\r\nexport function SavedBuildsPage() {\r\n    const navigate = useNavigate();\r\n    const { builds, isLoading } = useSavedBuildsStore();\r\n    const { selectedCharacterId } = useProfileStore();\r\n    const { isAuthenticated } = useAuthStore();\r\n    const { success, error: showError } = useToast();\r\n    const [equippingId, setEquippingId] = useState<string | null>(null);\r\n    const [lastEquippedBuild, setLastEquippedBuild] = useState<any | null>(null);\r\n    const [showSnapshotUI, setShowSnapshotUI] = useState(false);\r\n    const [deleteConfirmId, setDeleteConfirmId] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        buildService.loadSavedBuilds();\r\n    }, []);\r\n\r\n    const handleEquip = async (build: any) => {\r\n        if (!selectedCharacterId) {\r\n            showError(\"Please select a character in the header first.\");\r\n            return;\r\n        }\r\n\r\n        setEquippingId(build.id);\r\n        try {\r\n            const result = await buildService.equip(build.template, selectedCharacterId);\r\n            if (result.success) {\r\n                success(`Equipped ${build.name}!`);\r\n                setLastEquippedBuild(build);\r\n                setShowSnapshotUI(true);\r\n\r\n                // After successful equip, navigate back to Orbit (agent-wake)\r\n                // This gives a premium \"operation complete\" feel\r\n                setTimeout(() => {\r\n                    navigate('/agent-wake');\r\n                }, 1500);\r\n            } else {\r\n                showError(result.error || \"Failed to equip build.\");\r\n            }\r\n        } catch (e) {\r\n            errorLog('SavedBuildsPage', 'Equip error:', e);\r\n            showError(\"Equip failed due to an error.\");\r\n        } finally {\r\n            setEquippingId(null);\r\n        }\r\n    };\r\n\r\n    const [isEquippingSnapshot, setIsEquippingSnapshot] = useState(false);\r\n\r\n    const handleSnapshot = async (index: number) => {\r\n        if (!selectedCharacterId) return;\r\n        setIsEquippingSnapshot(true);\r\n        try {\r\n            // Wait for Bungie server consistency\r\n            await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n            const successResult = await buildService.snapshotToInGameSlot(selectedCharacterId, index);\r\n            if (successResult) {\r\n                setShowSnapshotUI(false);\r\n                success(`Saved to In-Game Loadout Slot ${index + 1}!`);\r\n            } else {\r\n                showError(\"Failed to save loadout. Are you in an activity?\");\r\n            }\r\n        } catch (e) {\r\n            showError(\"Snapshot failed.\");\r\n        } finally {\r\n            setIsEquippingSnapshot(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = (id: string) => {\r\n        setDeleteConfirmId(id);\r\n    };\r\n\r\n    const confirmDelete = async () => {\r\n        if (deleteConfirmId) {\r\n            await buildService.deleteBuild(deleteConfirmId);\r\n            success(\"Build deleted.\");\r\n            setDeleteConfirmId(null);\r\n        }\r\n    };\r\n\r\n    const handleShareExo = async (buildTemplate: BuildTemplate) => {\r\n        const shareData = convertBuildToLoadoutShareData(buildTemplate);\r\n        const link = await loadoutLinkService.generateExoEngineLink(shareData);\r\n        navigator.clipboard.writeText(link);\r\n        success(\"ExoEngine Link copied to clipboard!\");\r\n    };\r\n\r\n    const handleShareDIM = (buildTemplate: BuildTemplate) => {\r\n        const shareData = convertBuildToLoadoutShareData(buildTemplate);\r\n        const link = loadoutLinkService.generateDIMCompatibleLink(shareData);\r\n        navigator.clipboard.writeText(link);\r\n        success(\"DIM Link copied to clipboard!\");\r\n    };\r\n\r\n    const handleExportCSV = () => {\r\n        if (builds.length === 0) {\r\n            showError(\"No builds to export.\");\r\n            return;\r\n        }\r\n\r\n        // Convert to format expected by csvService\r\n        const buildsToExport = builds.map(b => ({ name: b.name, template: b.template }));\r\n        const csv = csvService.exportBuilds(buildsToExport);\r\n\r\n        // Download\r\n        const blob = new Blob([csv], { type: 'text/csv' });\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = `exo-loadouts-${new Date().toISOString().slice(0, 10)}.csv`;\r\n        a.click();\r\n\r\n        success(`Exported ${builds.length} builds to CSV.`);\r\n    };\r\n\r\n    const handleImportCSV = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = async (event) => {\r\n            const text = event.target?.result as string;\r\n            if (text) {\r\n                try {\r\n                    const templates = await csvService.importBuilds(text);\r\n                    if (templates.length === 0) {\r\n                        showError(\"No valid builds found in CSV.\");\r\n                        return;\r\n                    }\r\n\r\n                    // Save imported builds\r\n                    let addedCount = 0;\r\n                    for (const t of templates) {\r\n                        // Avoid exact duplicates? For now just add.\r\n                        await buildService.saveBuild(t, t.name);\r\n                        addedCount++;\r\n                    }\r\n\r\n                    success(`Successfully imported ${addedCount} builds!`);\r\n                    // Refresh listing\r\n                    buildService.loadSavedBuilds();\r\n                } catch (err) {\r\n                    errorLog('SavedBuildsPage', 'Export error:', err);\r\n                    showError(\"Failed to parse CSV.\");\r\n                }\r\n            }\r\n        };\r\n        reader.readAsText(file);\r\n        // Reset input\r\n        e.target.value = '';\r\n    };\r\n\r\n    const handleImportDIM = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = async (event) => {\r\n            const text = event.target?.result as string;\r\n            if (text) {\r\n                try {\r\n                    const json = JSON.parse(text);\r\n                    const shareDataList = loadoutLinkService.importDIMJson(json);\r\n\r\n                    if (shareDataList.length === 0) {\r\n                        showError(\"No valid DIM loadouts found in this file.\");\r\n                        return;\r\n                    }\r\n\r\n                    let addedCount = 0;\r\n                    for (const data of shareDataList) {\r\n                        const template = loadoutLinkService.convertToBuildTemplate(data);\r\n                        await buildService.saveBuild(template, data.name || 'Imported DIM Build');\r\n                        addedCount++;\r\n                    }\r\n\r\n                    success(`Successfully imported ${addedCount} DIM builds!`);\r\n                    buildService.loadSavedBuilds();\r\n                } catch (err) {\r\n                    errorLog('SavedBuildsPage', 'DIM Import error:', err);\r\n                    showError(\"Failed to parse DIM JSON.\");\r\n                }\r\n            }\r\n        };\r\n        reader.readAsText(file);\r\n        e.target.value = '';\r\n    };\r\n\r\n    if (!isAuthenticated) {\r\n        return (\r\n            <div className=\"saved-builds-page\">\r\n                <div className=\"empty-state\">\r\n                    <h2>Login Required</h2>\r\n                    <p>You need to sign in with Bungie.net to see and manage your saved builds.</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"saved-builds-page\">\r\n            <header className=\"page-header\">\r\n                <button\r\n                    className=\"btn btn-primary\"\r\n                    onClick={() => navigate('/generator')}\r\n                    style={{ marginBottom: 'var(--space-md)' }}\r\n                >\r\n                    Generate Build\r\n                </button>\r\n                <h1>Saved Builds</h1>\r\n                <p style={{ color: '#ffffff' }}>Your collection of custom and saved combat configurations ({builds.length})</p>\r\n                <div className=\"header-actions\">\r\n                    <button className=\"btn btn-outline btn-sm\" onClick={handleExportCSV}>\r\n                        Export CSV\r\n                    </button>\r\n                    <label className=\"btn btn-outline btn-sm\">\r\n                        Import CSV\r\n                        <input\r\n                            id=\"import-csv-input\"\r\n                            name=\"import-csv-input\"\r\n                            type=\"file\"\r\n                            accept=\".csv\"\r\n                            style={{ display: 'none' }}\r\n                            onChange={handleImportCSV}\r\n                        />\r\n                    </label>\r\n                    <label className=\"btn btn-outline btn-sm\">\r\n                        Import DIM JSON\r\n                        <input\r\n                            id=\"import-dim-input\"\r\n                            name=\"import-dim-input\"\r\n                            type=\"file\"\r\n                            accept=\".json\"\r\n                            style={{ display: 'none' }}\r\n                            onChange={handleImportDIM}\r\n                        />\r\n                    </label>\r\n                </div>\r\n            </header>\r\n\r\n            {showSnapshotUI && (\r\n                <div className=\"snapshot-notice glass-panel\" style={{ marginBottom: 'var(--space-xl)' }}>\r\n                    <div className=\"snapshot-notice__content\">\r\n                        <h3>Build Initialized: {lastEquippedBuild?.name}</h3>\r\n                        <p>Gear & Subclass mapped. Snapshot to an in-game slot to save this configuration:</p>\r\n                        <div className=\"snapshot-slots\">\r\n                            {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].map(i => (\r\n                                <button\r\n                                    key={i}\r\n                                    className=\"btn btn-sm btn-ghost\"\r\n                                    onClick={() => handleSnapshot(i)}\r\n                                    disabled={isEquippingSnapshot}\r\n                                >\r\n                                    Slot {i + 1}\r\n                                </button>\r\n                            ))}\r\n                            <button className=\"btn btn-sm btn-text\" onClick={() => setShowSnapshotUI(false)}>Dismiss</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {isLoading ? (\r\n                <div className=\"loading-state\">\r\n                    <div className=\"spinner\" />\r\n                    <p>Accessing vault...</p>\r\n                </div>\r\n            ) : builds.length === 0 ? (\r\n                <div className=\"empty-state\">\r\n                    <h2>No Builds Saved Yet</h2>\r\n                    <p>Press <span className=\"key-cap\">D</span> while viewing an ExoEngine build to save it here.</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"builds-grid\">\r\n                    {builds.map((build) => {\r\n                        const PRISMATIC_HASHES = [2946726027, 2603483315, 3170703816, 3893112950];\r\n                        const isPrismatic = PRISMATIC_HASHES.includes(build.template.subclassConfig?.subclassHash || 0);\r\n                        const displayElement = isPrismatic ? 'prismatic' : build.template.element;\r\n\r\n                        return (\r\n                            <GlassCard key={build.id} element={displayElement} className=\"saved-build-card\">\r\n                                <div className=\"saved-build-card__header\">\r\n                                    <h3>{build.name}</h3>\r\n                                    <span className={`badge badge-${String(displayElement).toLowerCase()}`}>\r\n                                        {String(displayElement).charAt(0).toUpperCase() + String(displayElement).slice(1)}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                <div className=\"saved-build-card__items\">\r\n                                    {/* Exotics Row */}\r\n                                    <div className=\"items-row\" style={{ marginBottom: '0.5rem' }}>\r\n                                        {build.template.exoticWeapon && <BuildItemIcon hash={build.template.exoticWeapon.hash} label=\"Exotic Weapon\" />}\r\n                                        {build.template.exoticArmor && <BuildItemIcon hash={build.template.exoticArmor.hash} label=\"Exotic Armor\" />}\r\n                                    </div>\r\n\r\n                                    {/* Super & Aspects Row */}\r\n                                                                        <div className=\"items-row\" style={{ marginBottom: '0.5rem' }}>\r\n                                                                            <BuildItemIcon hash={build.template.subclassConfig?.superHash || 0} label=\"Super\" />\r\n                                                                            {build.template.subclassConfig?.aspects?.map((h: number, i: number) => (\r\n                                                                                <BuildItemIcon key={h} hash={h} label={`Aspect ${i + 1}`} />  \r\n                                                                            ))}\r\n                                                                        </div>\r\n                                    \r\n                                                                        {/* Abilities Row */}\r\n                                                                        <div className=\"items-row\" style={{ marginBottom: '0.5rem' }}>        \r\n                                                                            <BuildItemIcon hash={build.template.subclassConfig?.grenadeHash || 0} label=\"Grenade\" />\r\n                                                                            <BuildItemIcon hash={build.template.subclassConfig?.meleeHash || 0} label=\"Melee\" />\r\n                                                                            <BuildItemIcon hash={build.template.subclassConfig?.classAbilityHash || 0} label=\"Class Ability\" />\r\n                                                                        </div>\r\n                                    \r\n                                                                        {/* Fragments Row */}\r\n                                                                        {(build.template.subclassConfig?.fragments?.length || 0) > 0 && (\r\n                                                                            <div className=\"items-row fragments-row\">\r\n                                                                                {(build.template.subclassConfig?.fragments || []).map((h: number, i: number) => (\r\n                                                                                    <BuildItemIcon key={h} hash={h} label={`Fragment ${i + 1}`} />\r\n                                                                                ))}\r\n                                                                            </div>\r\n                                                                        )}\r\n                                    {/* Armor Mods Row */}\r\n                                    {build.template.armorMods && build.template.armorMods.length > 0 && (\r\n                                        <div className=\"items-row mods-row\" style={{ marginTop: '0.5rem', paddingTop: '0.5rem', borderTop: '1px solid rgba(255,255,255,0.1)' }}>\r\n                                            <span style={{ fontSize: '0.65rem', color: 'rgba(255,255,255,0.5)', marginRight: '0.5rem' }}>MODS</span>\r\n                                            {build.template.armorMods.slice(0, 6).map((h: number, i: number) => (\r\n                                                <BuildItemIcon key={`${h}-${i}`} hash={h} label={`Mod ${i + 1}`} />\r\n                                            ))}\r\n                                            {build.template.armorMods.length > 6 && (\r\n                                                <span style={{ fontSize: '0.65rem', color: 'rgba(255,255,255,0.4)' }}>+{build.template.armorMods.length - 6}</span>\r\n                                            )}\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {/* Stats Row */}\r\n                                    {build.template.stats && (\r\n                                        <div className=\"saved-build-card__stats\" style={{ marginTop: '0.5rem', display: 'flex', justifyContent: 'space-between', padding: '0.5rem', background: 'rgba(0,0,0,0.2)', borderRadius: '4px' }}>\r\n                                            <StatMini value={build.template.stats.resilience} label=\"Health\" icon=\"resilience\" />\r\n                                            <StatMini value={build.template.stats.recovery} label=\"Recovery\" icon=\"recovery\" />\r\n                                            <StatMini value={build.template.stats.discipline} label=\"Grenade\" icon=\"discipline\" />\r\n                                            <StatMini value={build.template.stats.strength} label=\"Melee\" icon=\"strength\" />\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div className=\"saved-build-card__footer\">\r\n                                    <div className=\"footer-actions-row\">\r\n                                        <button\r\n                                            className=\"btn btn-primary btn-sm\"\r\n                                            onClick={() => handleEquip(build)}\r\n                                            disabled={equippingId === build.id}\r\n                                        >\r\n                                            {equippingId === build.id ? 'Equipping...' : 'Equip'}\r\n                                        </button>\r\n                                        <button\r\n                                            className=\"btn btn-ghost btn-sm text-red\"\r\n                                            onClick={() => handleDelete(build.id)}\r\n                                        >\r\n                                            Delete\r\n                                        </button>\r\n                                    </div>\r\n                                    <div className=\"footer-links-row\" style={{ marginTop: '0.5rem', display: 'flex', gap: '0.5rem' }}>\r\n                                        <button className=\"btn btn-xs btn-outline\" onClick={() => handleShareExo(build.template)} title=\"Copy Exo Link\">\r\n                                            Exo\r\n                                        </button>\r\n                                        <button className=\"btn btn-xs btn-outline\" onClick={() => handleShareDIM(build.template)} title=\"Copy to DIM Link\">\r\n                                            DIM\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </GlassCard>\r\n                        );\r\n                    })}\r\n                </div>\r\n            )}\r\n\r\n            <ConfirmationModal\r\n                isOpen={!!deleteConfirmId}\r\n                title=\"DELETE BUILD?\"\r\n                message=\"Are you sure you want to delete this recorded build? This action cannot be undone.\"\r\n                confirmText=\"Delete\"\r\n                cancelText=\"Keep\"\r\n                onConfirm={confirmDelete}\r\n                onCancel={() => setDeleteConfirmId(null)}\r\n                type=\"danger\"\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SavedBuildsPage;\r\n\r\nfunction BuildItemIcon({ hash, label }: { hash: number; label: string }) {\r\n    const [icon, setIcon] = useState<string | null>(null);\r\n    const [tooltip, setTooltip] = useState<string>(label);\r\n\r\n    useEffect(() => {\r\n        if (hash) {\r\n            const url = manifestService.getIcon(hash);\r\n            if (url) setIcon(url);\r\n\r\n            const def = manifestService.getFullDefinition(hash);\r\n            if (def) {\r\n                const name = def.name || 'Unknown';\r\n                const desc = def.description || '';\r\n                setTooltip(desc ? `${name}\\n${desc}` : name);\r\n            }\r\n        }\r\n    }, [hash]);\r\n\r\n    if (!hash || !icon) return <div className=\"item-icon-placeholder\" title={label}>?</div>;\r\n\r\n    return (\r\n        <div className=\"item-icon-wrapper\" title={tooltip}>\r\n            <img src={icon} alt={label} />\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction StatMini({ value, label, icon }: { value: number; label: string; icon: string }) {\r\n    const tier = Math.floor(value / 10);\r\n    return (\r\n        <div className=\"stat-mini\" title={`${label}: ${value}`}>\r\n            <span className={`stat-mini__icon stat-icon-${icon}`} />\r\n            <span className=\"stat-mini__value\">T{tier}</span>\r\n        </div>\r\n    );\r\n}\r\n"],"names":["csvService","builds","rows","b","template","subConfig","hash","manifestService","armorMods","modsBySlot","modHash","def","name","type","getWeapon","bucketHash","slot","item","i","getArmor","subType","ItemSlot","Papa","csvText","resolve","reject","results","templates","row","t","convertRowToTemplate","e","errorLog","error","guardianClass","GuardianClass","subclassHash","findItemHash","superHash","grenadeHash","meleeHash","classAbilityHash","aspects","fragments","k","subclassConfig","h","items","exoticWeapon","exoticArmor","gear","col","val","s","n","el","classType","exact","SavedBuildsPage","navigate","useNavigate","isLoading","useSavedBuildsStore","selectedCharacterId","useProfileStore","isAuthenticated","useAuthStore","success","showError","useToast","equippingId","setEquippingId","useState","lastEquippedBuild","setLastEquippedBuild","showSnapshotUI","setShowSnapshotUI","deleteConfirmId","setDeleteConfirmId","useEffect","buildService","handleEquip","build","result","isEquippingSnapshot","setIsEquippingSnapshot","handleSnapshot","index","handleDelete","id","confirmDelete","handleShareExo","buildTemplate","shareData","convertBuildToLoadoutShareData","link","loadoutLinkService","handleShareDIM","handleExportCSV","buildsToExport","csv","blob","url","a","handleImportCSV","file","reader","event","text","addedCount","err","handleImportDIM","json","shareDataList","data","jsxs","jsx","displayElement","GlassCard","BuildItemIcon","StatMini","ConfirmationModal","label","icon","setIcon","tooltip","setTooltip","desc","value","tier"],"mappings":"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"}