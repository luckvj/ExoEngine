import{j as S}from"./markdown-DyKRzreE.js";import{R as Us,r as I,a as Ut}from"./react-vendor-BrsWO7iZ.js";import{R as Xs}from"./builder-KXRIEMV5.js";import{p as Ys}from"./utils-Cl4ySqJD.js";const xr="modulepreload",Br=function(o){return"/"+o},Ua={},Ia=function(e,t,a){let r=Promise.resolve();if(t&&t.length>0){let l=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),n=c?.nonce||c?.getAttribute("nonce");r=l(t.map(d=>{if(d=Br(d),d in Ua)return;Ua[d]=!0;const h=d.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":xr,h||(f.as="script"),f.crossOrigin="",f.href=d,n&&f.setAttribute("nonce",n),document.head.appendChild(f),h)return new Promise((E,p)=>{f.addEventListener("load",E),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(c){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=c,window.dispatchEvent(n),!n.defaultPrevented)throw c}return r.then(c=>{for(const n of c||[])n.status==="rejected"&&i(n.reason);return e().catch(i)})},Wa=o=>{let e;const t=new Set,a=(d,h)=>{const m=typeof d=="function"?d(e):d;if(!Object.is(m,e)){const f=e;e=h??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(E=>E(e,f))}},r=()=>e,n={setState:a,getState:r,getInitialState:()=>l,subscribe:d=>(t.add(d),()=>t.delete(d))},l=e=o(a,r,n);return n},Ur=(o=>o?Wa(o):Wa),Wr=o=>o;function Kr(o,e=Wr){const t=Us.useSyncExternalStore(o.subscribe,Us.useCallback(()=>e(o.getState()),[o,e]),Us.useCallback(()=>e(o.getInitialState()),[o,e]));return Us.useDebugValue(t),t}const Ka=o=>{const e=Ur(o),t=a=>Kr(e,a);return Object.assign(t,e),t},Qt=(o=>o?Ka(o):Ka);function Os(){return new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}function re(o,...e){localStorage.getItem("_dbg")==="1"&&console.log(`[DEBUG][${o}][${Os()}]`,...e)}function Ee(o,...e){console.log(`[INFO][${o}][${Os()}]`,...e)}function je(o,...e){console.warn(`[WARN][${o}][${Os()}]`,...e)}function de(o,...e){console.error(`[ERROR][${o}][${Os()}]`,...e)}function cr(o,...e){console.log(`[SUCCESS][${o}][${Os()}]`,...e)}function lr(o){console.group(`[GROUP] ${o}`)}function ur(){console.groupEnd()}function dr(o,e){console.log(`[TABLE][${o}]`),console.table(e)}function mr(o){return{debug:(...e)=>re(o,...e),info:(...e)=>Ee(o,...e),warn:(...e)=>je(o,...e),error:(...e)=>de(o,...e),success:(...e)=>cr(o,...e),table:e=>dr(o,e),group:e=>lr(`[${o}] ${e}`),groupEnd:()=>ur()}}const ai=Object.freeze(Object.defineProperty({__proto__:null,createLogger:mr,debugLog:re,errorLog:de,infoLog:Ee,logGroup:lr,logGroupEnd:ur,logTable:dr,successLog:cr,warnLog:je},Symbol.toStringTag,{value:"Module"}));function Na(o){return new Promise((e,t)=>{o.oncomplete=o.onsuccess=()=>e(o.result),o.onabort=o.onerror=()=>t(o.error)})}function jr(o,e){let t;const a=()=>{if(t)return t;const r=indexedDB.open(o);return r.onupgradeneeded=()=>r.result.createObjectStore(e),t=Na(r),t.then(i=>{i.onclose=()=>t=void 0},()=>{}),t};return(r,i)=>a().then(c=>i(c.transaction(e,r).objectStore(e)))}let fa;function fr(){return fa||(fa=jr("keyval-store","keyval")),fa}function hr(o,e=fr()){return e("readonly",t=>Na(t.get(o)))}function ja(o,e,t=fr()){return t("readwrite",a=>(a.put(e,o),Na(a.transaction)))}const G={Void:"void",Solar:"solar",Arc:"arc",Stasis:"stasis",Strand:"strand",Prismatic:"prismatic",Kinetic:"kinetic",Neutral:"neutral"},X={BaseGame:"base",Forsaken:"forsaken",Shadowkeep:"shadowkeep",BeyondLight:"beyond-light",WitchQueen:"witch-queen",Lightfall:"lightfall",FinalShape:"final-shape",Anniversary30th:"anniversary-30th",Renegade:"renegade",EdgeOfFate:"edge-of-fate"},Y={Titan:0,Hunter:1,Warlock:2},Z={Kinetic:0,Energy:1,Power:2,Helmet:3,Arms:4,Chest:5,Legs:6,ClassItem:7},Q={Beginner:"beginner",Intermediate:"intermediate",Advanced:"advanced"},qr="cfada238bccc49dca0c61b18c276e466",Vr="51502",ge={apiKey:qr,clientId:Vr,redirectUri:typeof window<"u"?`${window.location.origin}/auth/callback`:"https://exoengine.online/auth/callback",apiBase:"https://www.bungie.net/Platform",authorizationUrl:"https://www.bungie.net/en/OAuth/Authorize",tokenUrl:"/token.php",dimProxyUrl:"/dim-proxy.php",bungieNetOrigin:"https://www.bungie.net",endpoints:{manifest:"/Destiny2/Manifest/",linkedProfiles:o=>`/Destiny2/-1/Profile/${o}/LinkedProfiles/`,profile:(o,e)=>`/Destiny2/${o}/Profile/${e}/`,character:(o,e,t)=>`/Destiny2/${o}/Profile/${e}/Character/${t}/`,transferItem:"/Destiny2/Actions/Items/TransferItem/",equipItem:"/Destiny2/Actions/Items/EquipItem/",equipItems:"/Destiny2/Actions/Items/EquipItems/",pullFromPostmaster:"/Destiny2/Actions/Items/PullFromPostmaster/",snapshotLoadout:"/Destiny2/Actions/Loadouts/SnapshotLoadout/",insertSocketPlugFree:"/Destiny2/Actions/Items/InsertSocketPlugFree/",setLockState:"/Destiny2/Actions/Items/SetLockState/"},components:{Profiles:100,VendorReceipts:101,ProfileInventories:102,ProfileCurrencies:103,ProfileProgression:104,PlatformSilver:105,Characters:200,CharacterInventories:201,CharacterProgressions:202,CharacterRenderData:203,CharacterActivities:204,CharacterEquipment:205,ItemInstances:300,ItemObjectives:301,ItemPerks:302,ItemRenderData:303,ItemStats:304,ItemSockets:305,ItemTalentGrids:306,ItemCommonData:307,ItemPlugStates:308,ItemPlugObjectives:309,ItemReusablePlugs:310,Vendors:400,VendorCategories:401,VendorSales:402,Kiosks:500,CurrencyLookups:600,PresentationNodes:700,Collectibles:800,Records:900,Transitory:1e3,Metrics:1100,StringVariables:1200,Craftables:1300,CharacterLoadouts:206},standardProfileComponents:[100,102,200,201,202,205,300,304,305,310,103,203,1100,1400,1401],isConfigured(){return!!(this.apiKey&&this.clientId)},getComponentsQuery(o){return`components=${o.join(",")}`}},q={KINETIC_WEAPONS:1498876634,ENERGY_WEAPONS:2465295065,POWER_WEAPONS:953998645,HELMET:3448274439,GAUNTLETS:3551918588,CHEST_ARMOR:14239492,LEG_ARMOR:20886954,CLASS_ARMOR:1585787867,GHOST:4023194814,VEHICLE:2025709351,SHIPS:284967655,SUBCLASS:3284755031,VAULT:138197802,GENERAL:138197802,CONSUMABLES:1469714392,MODIFICATIONS:3313201758,EMBLEM:4274335291,EMOTES:3054419239,FINISHERS:3683254069,SEASONAL_ARTIFACT:1506418338,POSTMASTER:215593132},$r={KINETIC:3373582085,ARC:2303842570,SOLAR:1847020140,VOID:3454344768,STASIS:151347233,STRAND:3949783978,PRISMATIC:3373582059},ms={MOBILITY:2996146975,RESILIENCE:392767087,RECOVERY:1943323491,DISCIPLINE:1735777505,INTELLECT:144602215,STRENGTH:4244567218},be={SUPER:457473665,ASPECTS:2047681910,ASPECTS_IKORA:2140934067,ASPECTS_STRANGER:3400923910,ASPECTS_NEOMUNA:764703411,FRAGMENTS:271461480,FRAGMENTS_IKORA:1313488945,FRAGMENTS_STRANGER:2819965312,FRAGMENTS_NEOMUNA:193371309,ABILITIES:309722977,ABILITIES_IKORA:3218807805,TRANSCENDENCE:1905270138,WEAPON_PERKS:4241085061,WEAPON_MODS:2685412949,ARMOR_MODS:590099826},ha="AES-GCM",Yr=256,zr=12,Jr=16,Xr=1e5;class Zr{encryptionKey=null;async initialize(){if(!this.encryptionKey)try{const e=await this.generateKeyMaterial(),t=await this.getOrCreateSalt();this.encryptionKey=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:Xr,hash:"SHA-256"},e,{name:ha,length:Yr},!1,["encrypt","decrypt"])}catch(e){throw de("TokenEncryption","Init failed:",e),new Error("Failed to initialize token encryption")}}async encrypt(e){if(await this.initialize(),!this.encryptionKey)throw new Error("Encryption key not initialized");try{const t=crypto.getRandomValues(new Uint8Array(zr)),r=new TextEncoder().encode(e),i=await crypto.subtle.encrypt({name:ha,iv:t},this.encryptionKey,r),c=await this.getOrCreateSalt();return{ciphertext:this.arrayBufferToBase64(i),iv:this.arrayBufferToBase64(t),salt:this.arrayBufferToBase64(c)}}catch(t){throw de("TokenEncryption","Encrypt failed:",t),new Error("Failed to encrypt data")}}async decrypt(e){if(await this.initialize(),!this.encryptionKey)throw new Error("Encryption key not initialized");try{const t=this.base64ToArrayBuffer(e.ciphertext),a=this.base64ToArrayBuffer(e.iv),r=await crypto.subtle.decrypt({name:ha,iv:a},this.encryptionKey,t);return new TextDecoder().decode(r)}catch(t){throw de("TokenEncryption","Decrypt failed:",t),new Error("Failed to decrypt data")}}async generateKeyMaterial(){const e=this.collectDeviceEntropy();return crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"])}collectDeviceEntropy(){const t=[navigator.userAgent,navigator.language,navigator.hardwareConcurrency?.toString()||"",screen.width?.toString()||"",screen.height?.toString()||"",screen.colorDepth?.toString()||"",new Date().getTimezoneOffset().toString(),navigator.platform,navigator.maxTouchPoints?.toString()||"0"].join("|");return new TextEncoder().encode(t)}async getOrCreateSalt(){const e="exo_encryption_salt";try{const a=localStorage.getItem(e);if(a)return this.base64ToArrayBuffer(a)}catch{}const t=crypto.getRandomValues(new Uint8Array(Jr));try{localStorage.setItem(e,this.arrayBufferToBase64(t))}catch{je("TokenEncryption","Salt persist failed")}return t}arrayBufferToBase64(e){const t=e instanceof Uint8Array?e:new Uint8Array(e);let a="";for(let r=0;r<t.byteLength;r++)a+=String.fromCharCode(t[r]);return btoa(a)}base64ToArrayBuffer(e){const t=atob(e),a=new Uint8Array(t.length);for(let r=0;r<t.length;r++)a[r]=t.charCodeAt(r);return a}clearKey(){this.encryptionKey=null}}const gs=new Zr,qa="exoengine",Qr=3,en=[{name:"manifest",keyPath:"tableName"},{name:"manifestMeta",keyPath:"key"},{name:"auth",keyPath:"key"},{name:"savedBuilds",keyPath:"id",indexes:[{name:"by-class",keyPath:"template.guardianClass"},{name:"by-element",keyPath:"template.element"},{name:"by-created",keyPath:"createdAt"}]},{name:"settings",keyPath:"key"},{name:"cache",keyPath:"key"},{name:"clarity_descriptions",keyPath:"key"},{name:"clarity_version",keyPath:"key"}];class tn{db=null;initPromise=null;async init(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const a=indexedDB.open(qa,Qr);a.onerror=()=>{de("IndexedDB","Failed to open database:",a.error),t(a.error)},a.onblocked=()=>{je("IndexedDB","Database upgrade blocked! Close other tabs to permit upgrade.")},a.onsuccess=()=>{this.db=a.result;const r=Array.from(this.db.objectStoreNames);re("IndexedDB",`Database v${this.db.version} opened successfully. Stores:`,r),e()},a.onupgradeneeded=r=>{const i=r.target.result,c=r.oldVersion,n=r.newVersion;Ee("IndexedDB",`Upgrading database from v${c} to v${n}`);for(const l of en)if(!i.objectStoreNames.contains(l.name)){const d=i.createObjectStore(l.name,{keyPath:l.keyPath});if(l.indexes)for(const h of l.indexes)d.createIndex(h.name,h.keyPath,h.options)}}}),this.initPromise)}async getDB(){if(await this.init(),!this.db)throw new Error("Database not initialized");return this.db}async get(e,t){const a=await this.getDB();return new Promise((r,i)=>{const l=a.transaction(e,"readonly").objectStore(e).get(t);l.onerror=()=>i(l.error),l.onsuccess=()=>r(l.result)})}async set(e,t){const a=await this.getDB();return new Promise((r,i)=>{const c=a.transaction(e,"readwrite");c.objectStore(e).put(t),c.oncomplete=()=>r(),c.onerror=()=>i(c.error)})}async delete(e,t){const a=await this.getDB();return new Promise((r,i)=>{const l=a.transaction(e,"readwrite").objectStore(e).delete(t);l.onerror=()=>i(l.error),l.onsuccess=()=>r()})}async getAll(e){const t=await this.getDB();return new Promise((a,r)=>{const n=t.transaction(e,"readonly").objectStore(e).getAll();n.onerror=()=>r(n.error),n.onsuccess=()=>a(n.result)})}async clear(e){const t=await this.getDB();return new Promise((a,r)=>{const n=t.transaction(e,"readwrite").objectStore(e).clear();n.onerror=()=>r(n.error),n.onsuccess=()=>a()})}async getAllByIndex(e,t,a){const r=await this.getDB();return new Promise((i,c)=>{const h=r.transaction(e,"readonly").objectStore(e).index(t).getAll(a);h.onerror=()=>c(h.error),h.onsuccess=()=>i(h.result)})}async getManifestTable(e){return(await this.get("manifest",e))?.data}async setManifestTable(e,t){await this.set("manifest",{tableName:e,data:t})}async getManifestVersion(){return(await this.get("manifestMeta","version"))?.version}async setManifestVersion(e){await this.set("manifestMeta",{key:"version",version:e,updatedAt:Date.now()})}async clearManifest(){await this.clear("manifest"),await this.clear("manifestMeta")}async getAuthTokens(){const e=await this.get("auth","tokens");if(e){if(e.accessToken&&e.refreshToken){Ee("IndexedDB","ðŸ” Migrating plaintext tokens to encrypted format");try{return await this.setAuthTokens({accessToken:e.accessToken,refreshToken:e.refreshToken,expiresAt:e.expiresAt,membershipId:e.membershipId}),{accessToken:e.accessToken,refreshToken:e.refreshToken,expiresAt:e.expiresAt,membershipId:e.membershipId}}catch(t){de("IndexedDB","Failed to migrate tokens:",t),await this.clearAuth();return}}if(e.encryptedAccessToken&&e.encryptedRefreshToken)try{const t=JSON.parse(e.encryptedAccessToken),a=JSON.parse(e.encryptedRefreshToken),r=await gs.decrypt(t),i=await gs.decrypt(a);return{accessToken:r,refreshToken:i,expiresAt:e.expiresAt,membershipId:e.membershipId}}catch(t){de("IndexedDB","Failed to decrypt tokens:",t),await this.clearAuth();return}je("IndexedDB","âš ï¸ Unknown token format, clearing auth"),await this.clearAuth()}}async setAuthTokens(e){try{const t=await gs.encrypt(e.accessToken),a=await gs.encrypt(e.refreshToken);await this.set("auth",{key:"tokens",encryptedAccessToken:JSON.stringify(t),encryptedRefreshToken:JSON.stringify(a),expiresAt:e.expiresAt,membershipId:e.membershipId})}catch(t){throw de("IndexedDB","Failed to encrypt tokens:",t),new Error("Failed to store authentication tokens securely")}}async clearAuth(){await this.clear("auth"),gs.clearKey()}async saveOAuthState(e){await this.set("auth",{key:"oauth_state",value:e,createdAt:Date.now()})}async getOAuthState(){const e=await this.get("auth","oauth_state");if(!e?.value)return;const t=600*1e3;if(e.createdAt&&Date.now()-e.createdAt>t){await this.delete("auth","oauth_state");return}return e.value}async getSavedBuilds(){return this.getAll("savedBuilds")}async setSavedBuild(e){await this.set("savedBuilds",e)}async deleteSavedBuild(e){await this.delete("savedBuilds",e)}async getClarityVersion(){return(await this.get("clarity_version","current"))?.value}async setClarityVersion(e){await this.set("clarity_version",{key:"current",value:e})}async getClarityDescriptions(){return(await this.get("clarity_descriptions","all"))?.data}async setClarityDescriptions(e){await this.set("clarity_descriptions",{key:"all",data:e})}async getSetting(e){return(await this.get("settings",e))?.value}async setSetting(e,t){await this.set("settings",{key:e,value:t})}async getCached(e){const t=await this.get("cache",e);if(t){if(t.expiresAt<Date.now()){await this.delete("cache",e);return}return t.value}}async setCached(e,t,a){await this.set("cache",{key:e,value:t,expiresAt:Date.now()+a})}async estimateSize(){if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate();return{usage:e.usage||0,quota:e.quota||0}}return{usage:0,quota:0}}async clearProfileCache(){await this.clear("cache")}async clearAll(){const e=await this.getDB(),t=Array.from(e.objectStoreNames);for(const a of t)await this.clear(a)}async close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}async deleteDatabase(){return await this.close(),new Promise((e,t)=>{const a=indexedDB.deleteDatabase(qa);a.onerror=()=>t(a.error),a.onsuccess=()=>{Ee("IndexedDB","Database deleted successfully"),e()}})}}const xe=new tn;typeof window<"u"&&window.addEventListener("freeze",()=>{xe.close().catch(o=>de("IndexedDB","Failed to close database:",o))});const sn=Object.freeze(Object.defineProperty({__proto__:null,db:xe},Symbol.toStringTag,{value:"Module"})),_e={Success:1,AccessTokenHasExpired:99,WebAuthRequired:1618,WebAuthModuleAsyncFailed:1619,AuthorizationRecordRevoked:1627,AuthorizationRecordExpired:1628,AuthorizationCodeStale:1629,AuthorizationCodeInvalid:1630,ThrottleLimitExceededMinutes:31,ThrottleLimitExceededMomentarily:32,ThrottleLimitExceededSeconds:33,DestinyThrottledByGameServer:1672,PerApplicationThrottleExceeded:51,PerApplicationAnonymousThrottleExceeded:52,PerApplicationAuthenticatedThrottleExceeded:53,PerUserThrottleExceeded:54,DestinyNoRoomInDestination:1622,DestinyItemNotFound:1623,DestinyUniquenessViolation:1648,DestinyItemUnequippable:1642,DestinyCannotPerformActionOnEquippedItem:1641,DestinyItemAlreadyEquipped:1640,ActionOnlyInGame:1663,DestinySocketActionNotAllowed:1678,DestinyCannotPerformActionAtThisLocation:1618,DestinyCharacterNotInTower:1634,SystemDisabled:5,DestinyUnexpectedError:1},Sr=new Set([_e.AccessTokenHasExpired,_e.WebAuthRequired,_e.WebAuthModuleAsyncFailed,_e.AuthorizationRecordRevoked,_e.AuthorizationRecordExpired,_e.AuthorizationCodeStale,_e.AuthorizationCodeInvalid]),pr=new Set([_e.ThrottleLimitExceededMinutes,_e.ThrottleLimitExceededMomentarily,_e.ThrottleLimitExceededSeconds,_e.DestinyThrottledByGameServer,_e.PerApplicationThrottleExceeded,_e.PerApplicationAnonymousThrottleExceeded,_e.PerApplicationAuthenticatedThrottleExceeded,_e.PerUserThrottleExceeded]);class an{lastPromise=Promise.resolve();lastRequestTimeByEndpoint=new Map;lastGlobalRequestTime=0;depth=0;intervals={TransferItem:100,EquipItem:100,EquipItems:100,PullFromPostmaster:100,InsertSocketPlug:500,InsertSocketPlugFree:500,SnapshotLoadout:1e3,SetLockState:100,default:50};getInterval(e){for(const[t,a]of Object.entries(this.intervals))if(e.includes(t))return a;return this.intervals.default}async add(e,t){this.depth++;const a=async()=>{let i;if(typeof navigator<"u"&&"wakeLock"in navigator)try{i=await navigator.wakeLock.request("screen")}catch{}try{const c=Date.now(),n=Object.keys(this.intervals).find(p=>t.includes(p))||"default",l=this.lastRequestTimeByEndpoint.get(n)||0,d=Math.max(0,50-(c-this.lastGlobalRequestTime)),h=Math.max(0,this.getInterval(t)-(c-l)),m=Math.max(d,h);m>0&&await new Promise(p=>setTimeout(p,m));const f=await e(),E=Date.now();return this.lastGlobalRequestTime=E,this.lastRequestTimeByEndpoint.set(n,E),f}finally{this.depth--,i&&await i.release()}},r=this.lastPromise.then(a,a);return this.lastPromise=r,r}getQueueDepth(){return this.depth}}class rn{isRefreshing=!1;refreshPromise=null;limiter=new an;onMaintenance=null;timesThrottled=0;lastThrottleTime=0;MAX_BACKOFF_MS=300*1e3;THROTTLE_HEAL_INTERVAL=3e4;async getHeaders(e){const t={"X-API-Key":ge.apiKey,"Content-Type":"application/json"};if(e){const a=await xe.getAuthTokens();if(a)if(a.expiresAt<Date.now()+6e4){if(await this.refreshAccessToken()){const i=await xe.getAuthTokens();i&&(t.Authorization=`Bearer ${i.accessToken}`)}t.Authorization=`Bearer ${a.accessToken}`}else t.Authorization=`Bearer ${a.accessToken}`}return t}async applyThrottleBackoff(){if(Date.now()-this.lastThrottleTime>this.THROTTLE_HEAL_INTERVAL&&this.timesThrottled>0&&(this.timesThrottled=Math.max(0,this.timesThrottled-1)),this.timesThrottled>0){const t=Math.min(this.MAX_BACKOFF_MS,Math.pow(2,this.timesThrottled)*500);await new Promise(a=>setTimeout(a,t))}}async request(e,t={}){const{method:a="GET",body:r,requiresAuth:i=!1,skipRetry:c=!1}=t;return this.limiter.add(async()=>{let n=0;const l=c||t._skipRetryInternal;for(;;){await this.applyThrottleBackoff();const d=`${ge.apiBase}${e}`,h=await this.getHeaders(i);a==="POST"?Ee("API",`â†’ ${a} ${e}`):re("API",`â†’ ${a} ${e}`);const m=setTimeout(()=>{Ht.getState().addToast({type:"warning",message:"Bungie API is slow. ExoEngine is still waiting for a response...",duration:1e4})},15e3);try{const f=await fetch(d,{method:a,headers:h,body:r?JSON.stringify(r):void 0,credentials:"omit"});clearTimeout(m);const E=e.includes("TransferItem")||e.includes("InsertSocketPlug")||e.includes("EquipItem");if(f.status>=502&&f.status<=526&&!l&&n<3){const R=1e3*Math.pow(2,n);je("API",`Transient network error (${f.status}) at ${e}. Retrying in ${R}ms...`,{retryCount:n}),await new Promise(A=>setTimeout(A,R)),n++;continue}if(f.status===500&&!E&&!l&&n<2){const R=1e3*Math.pow(2,n);je("API",`Server error (500) at ${e}. Retrying in ${R}ms...`,{retryCount:n}),await new Promise(A=>setTimeout(A,R)),n++;continue}if(f.status===429){const R=parseInt(f.headers.get("Retry-After")||"5",10);if(Ee("API",`Rate limited (429). Retrying after ${R}s...`),this.timesThrottled++,this.lastThrottleTime=Date.now(),await new Promise(A=>setTimeout(A,R*1e3)),l)throw new Error("Rate limited and skipRetry is set");continue}let p;try{p=await f.json()}catch(R){if(f.status>=500){const A=new Wt("Bungie server error",-1,"HttpError",e,f.status);throw E&&(A.isPotentialSuccess=!0),A}throw R}if(p.ErrorCode!==_e.Success){if((p.ErrorCode===_e.DestinyUnexpectedError||p.ErrorCode===_e.DestinyThrottledByGameServer)&&!l&&n<3){const _=1e3*Math.pow(2,n);je("API",`Transient Bungie error (${p.ErrorCode}) at ${e}. Retrying in ${_}ms...`,{retryCount:n}),await new Promise(T=>setTimeout(T,_)),n++;continue}if((f.status===500||p.ErrorCode===_e.DestinyItemNotFound?re:de)("API","Full error response:",{endpoint:e,errorCode:p.ErrorCode,errorStatus:p.ErrorStatus,message:p.Message,messageData:p.MessageData,throttleSeconds:p.ThrottleSeconds}),pr.has(p.ErrorCode)){this.timesThrottled++,this.lastThrottleTime=Date.now();const _=p.ThrottleSeconds>0?p.ThrottleSeconds*1e3:5e3;if(je("API",`Bungie throttle (${p.ErrorCode}). Waiting ${_}ms...`),await new Promise(T=>setTimeout(T,_)),l)throw new Wt(p.Message,p.ErrorCode,p.ErrorStatus,e,f.status);continue}if(p.ErrorCode===_e.SystemDisabled){const{isMaintenance:_}=Qs.getState();throw _||(je("API","Bungie API Maintenance Detected (SystemDisabled)"),this.onMaintenance&&this.onMaintenance(!0)),new Wt(p.Message,p.ErrorCode,p.ErrorStatus,e,f.status)}if(Sr.has(p.ErrorCode)&&!l&&i&&await this.refreshAccessToken()){t._skipRetryInternal=!0;continue}if(p.ErrorCode===1671||p.ErrorCode===1679)return p.Response;throw p.ErrorCode===_e.DestinyUniquenessViolation?de("API","Uniqueness violation: Multiple exotics in equip request"):p.ErrorCode===_e.DestinyNoRoomInDestination&&je("API","No room in destination bucket"),new Wt(p.Message||"Unknown Bungie API error",p.ErrorCode,p.ErrorStatus,e)}return this.timesThrottled>0&&(this.timesThrottled=Math.floor(this.timesThrottled/2)),p.Response}catch(f){if(f instanceof Wt)throw f;if(f instanceof TypeError&&!l&&n<2){je("API","Network failure, retrying...",{endpoint:e,retryCount:n}),await new Promise(E=>setTimeout(E,1e3)),n++;continue}throw new Wt(f instanceof Error?f.message:"Request failed",-1,"NetworkError",e)}}},e)}async get(e,t=!1,a=5){return this.request(e,{method:"GET",requiresAuth:t,priority:a})}async post(e,t,a=!1,r=5){return this.request(e,{method:"POST",body:t,requiresAuth:a,priority:r})}async getAuthorizationUrl(){const e=crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);Ee("Auth","Generating OAuth state",{state:e,origin:window.location.origin});try{await xe.saveOAuthState(e);const a=await xe.getOAuthState();a===e?Ee("Auth","OAuth state successfully persisted to DB",{state:e}):je("Auth","OAuth state verification failed! Data was not found after save.",{expected:e,actual:a})}catch(a){de("Auth","Failed to save OAuth state to DB!",a)}const t=new URLSearchParams({client_id:ge.clientId,response_type:"code",redirect_uri:ge.redirectUri,state:e,access_type:"offline"});return`${ge.authorizationUrl}?${t.toString()}`}async exchangeCode(e){const t=new URLSearchParams({grant_type:"authorization_code",code:e,client_id:ge.clientId,redirect_uri:ge.redirectUri}),a=await fetch(ge.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-API-Key":ge.apiKey},body:t.toString()});if(!a.ok){const c=await a.text();throw new Wt(`Failed to exchange code: ${c}`,0,"AuthError","token")}const r=await a.json();r.refresh_token||je("API","Initial auth did not include refresh_token - sessions will be short-lived");const i={accessToken:r.access_token,refreshToken:r.refresh_token||"",expiresIn:r.expires_in,membershipId:r.membership_id};return await xe.setAuthTokens({accessToken:i.accessToken,refreshToken:i.refreshToken,expiresAt:Date.now()+i.expiresIn*1e3,membershipId:i.membershipId}),i}async refreshAccessToken(){if(this.isRefreshing)return this.refreshPromise||Promise.resolve(!1);this.isRefreshing=!0,this.refreshPromise=this.doRefreshToken();try{return await this.refreshPromise}finally{this.isRefreshing=!1,this.refreshPromise=null}}async doRefreshToken(){const e=await xe.getAuthTokens();if(!e?.refreshToken)return de("API","No refresh token available - User must re-authenticate"),await this.triggerAuthFailure(),!1;try{const t=new URLSearchParams({grant_type:"refresh_token",refresh_token:e.refreshToken,client_id:ge.clientId,redirect_uri:ge.redirectUri}),a=await fetch(ge.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-API-Key":ge.apiKey},body:t.toString()});if(!a.ok){let n=null;try{n=await a.json()}catch{}if(n?.error==="server_error"){const l=n.error_description;if(l==="SystemDisabled")throw je("API","Bungie API maintenance detected. Preserving tokens."),new Error("Bungie API is under maintenance");if(["RefreshTokenNotYetValid","AccessTokenHasExpired","AuthorizationCodeInvalid","AuthorizationRecordExpired","AuthorizationRecordRevoked","AuthorizationCodeStale"].includes(l))return de("API",`Fatal refresh error: ${l}. Clearing auth.`),await this.triggerAuthFailure(),!1}if(a.status===401||a.status===403)return de("API","Refresh token rejected (401/403). Clearing auth."),await this.triggerAuthFailure(),!1;if(a.status>=500)throw je("API",`Bungie server error during refresh (${a.status}). Preserving tokens.`),new Error(`Bungie API transient error: ${a.status}`);return de("API","Token refresh failed with status:",a.status),a.status>=400&&a.status<500&&await this.triggerAuthFailure(),!1}const r=await a.json(),i=await xe.getAuthTokens(),c=r.refresh_token||i?.refreshToken;return c||de("API","No refresh token available after refresh. Auth will fail."),await xe.setAuthTokens({accessToken:r.access_token,refreshToken:c||"",expiresAt:Date.now()+r.expires_in*1e3,membershipId:r.membership_id}),!0}catch(t){if(t instanceof TypeError)throw je("API","Network error during token refresh. Preserving tokens for retry.",t),t;if(de("API","Token refresh error:",t),t instanceof Error&&t.message.includes("maintenance"))throw t;return await this.triggerAuthFailure(),!1}}setMaintenanceHandler(e){this.onMaintenance=e}onAuthFailure=null;setAuthFailureHandler(e){this.onAuthFailure=e}async triggerAuthFailure(){je("API","Triggering global auth failure handler"),await xe.clearAuth(),this.onAuthFailure&&this.onAuthFailure()}async isAuthenticated(){const e=await xe.getAuthTokens();return e?e.expiresAt<Date.now()?this.refreshAccessToken():!0:!1}async logout(){await xe.clearAuth(),this.timesThrottled=0}async getMembershipId(){return(await xe.getAuthTokens())?.membershipId||null}getThrottleState(){return{level:this.timesThrottled,queueDepth:this.limiter.getQueueDepth()}}async getUserApplicationData(){return{}}async setUserApplicationData(e){return!0}}class Wt extends Error{errorCode;errorStatus;endpoint;httpStatus;isPotentialSuccess=!1;constructor(e,t,a,r="",i=0){let c=e;t===_e.ActionOnlyInGame||t===_e.DestinyCannotPerformActionAtThisLocation||t===_e.DestinyCharacterNotInTower?c="This action requires you to be logged into Destiny 2 and in Orbit or a Social Space. If you're in an activity or offline, please return to Orbit to continue.":t===_e.DestinyNoRoomInDestination?c="Not enough room in the destination bucket. Try moving some items aside first.":t===_e.DestinyUniquenessViolation?c="You can only equip one piece of exotic armor and one exotic weapon at a time.":t===_e.ThrottleLimitExceededSeconds?c="You're moving items too fast! Bungie is slowing us down. Waiting a few seconds...":t===_e.SystemDisabled&&(c="Bungie's servers are currently undergoing maintenance. Most API features are temporarily unavailable."),super(c),this.errorCode=t,this.errorStatus=a,this.endpoint=r,this.httpStatus=i,this.name="BungieApiError",re("API",`Bungie Error [${t}] at ${r}: ${e}`)}isNoRoomError(){return this.errorCode===_e.DestinyNoRoomInDestination}isAuthError(){return Sr.has(this.errorCode)}isThrottleError(){return pr.has(this.errorCode)||this.errorCode===-1}isNetworkError(){return this.errorStatus==="NetworkError"}}const lt=new rn,Qs=Qt(o=>({isAuthenticated:!1,isLoading:!0,isMaintenance:!1,tokens:null,membership:null,setAuthenticated:e=>o({isAuthenticated:e}),setLoading:e=>o({isLoading:e}),setMaintenance:e=>o({isMaintenance:e}),setTokens:e=>o({tokens:e}),setMembership:e=>o({membership:e}),logout:async(e=!1)=>{if(await lt.logout(),e){const{db:t}=await Ia(async()=>{const{db:a}=await Promise.resolve().then(()=>sn);return{db:a}},void 0);await t.deleteDatabase(),localStorage.clear(),sessionStorage.clear()}j.getState().clear(),o({isAuthenticated:!1,tokens:null,membership:null,isMaintenance:!1}),window.location.href="/"}})),Zs={ACCEPTED:"ACCEPTED",SKIPPED_IDENTICAL:"SKIPPED_IDENTICAL",DISCARDED_STALE:"DISCARDED_STALE"},j=Qt((o,e)=>({characters:[],selectedCharacterId:localStorage.getItem("exo_selected_character"),characterInventories:{},characterEquipment:{},vaultInventory:[],itemInstances:{},artifact:null,characterProgressions:null,isLoading:!0,isEquipping:!1,lastUpdated:null,responseMintedTimestamp:null,currentGuardianRank:0,commendationScore:0,commendationNodeScores:{},commendationNodePercentages:{},lifetimeScore:0,activeSeasonRank:0,artifactLevel:0,artifactXP:{current:0,total:1},powerBonusXP:{current:0,total:1},commendationsSent:0,commendationsReceived:0,detectedSynergies:null,activeTransfers:new Set,inFlightTargets:new Map,successfulTransfers:new Set,failedTransfers:new Set,profilePlugSets:null,characterPlugSets:null,virtualLoadouts:(()=>{try{const t=localStorage.getItem("exo_virtual_loadouts");return t?JSON.parse(t):{}}catch{return{}}})(),setCharacters:t=>{const a=e().selectedCharacterId;if(o({characters:t}),!(a&&t.some(r=>r.characterId===a))&&t.length>0){const r=t[0].characterId;o({selectedCharacterId:r}),localStorage.setItem("exo_selected_character",r)}},setSelectedCharacter:t=>{o({selectedCharacterId:t}),t?localStorage.setItem("exo_selected_character",t):localStorage.removeItem("exo_selected_character")},setDetectedSynergies:t=>o({detectedSynergies:t}),setInventories:t=>{const a=e(),r=t.responseMintedTimestamp,i=a.responseMintedTimestamp;if(r&&i&&new Date(r).getTime()<=new Date(i).getTime())return Zs.DISCARDED_STALE;const c=new Set(a.activeTransfers),n=new Map(a.inFlightTargets),l=(f,E,p)=>{const A=[...f.filter(_=>{const T=_.itemInstanceId;return T&&c.has(T)?n.get(T)===E:!0})];for(const[_,T]of n.entries())if(T===E)if(A.findIndex(C=>C.itemInstanceId===_)!==-1)c.delete(_),n.delete(_);else{const C=p.find(D=>D.itemInstanceId===_);C&&A.push(C)}return A},d={};Object.keys(t.characterInventories||{}).forEach(f=>{d[f]=l(t.characterInventories[f],f,a.characterInventories[f]||[])});const h={};Object.keys(t.characterEquipment||{}).forEach(f=>{h[f]=l(t.characterEquipment[f],f,a.characterEquipment[f]||[])});const m=l(t.vaultInventory,"vault",a.vaultInventory);return o({...t,characterInventories:d,characterEquipment:h,vaultInventory:m,activeTransfers:c,inFlightTargets:n,responseMintedTimestamp:t.responseMintedTimestamp||a.responseMintedTimestamp,profilePlugSets:t.profilePlugSets||a.profilePlugSets,characterPlugSets:t.characterPlugSets||a.characterPlugSets,lastUpdated:Date.now()}),Zs.ACCEPTED},setLoading:t=>o({isLoading:t}),setEquipping:t=>o({isEquipping:t}),updateItemInstance:(t,a)=>o(r=>({itemInstances:{...r.itemInstances,[t]:{...r.itemInstances[t],...a}},lastUpdated:Date.now()})),updateItemSocket:(t,a,r,i,c)=>o(n=>{const l=n.itemInstances[t];if(!l||!l.sockets)return n;const d=[...l.sockets],h=d.findIndex(m=>m.socketIndex===a);return h!==-1?d[h]={...d[h],plugHash:r,isEnabled:!0,plugName:i||d[h].plugName,plugIcon:c||d[h].plugIcon}:a<d.length&&(d[a]={...d[a],plugHash:r,isEnabled:!0,plugName:i||d[a].plugName,plugIcon:c||d[a].plugIcon}),{itemInstances:{...n.itemInstances,[t]:{...l,sockets:d}},lastUpdated:Date.now()}}),addActiveTransfer:(t,a)=>{const r=new Set(e().activeTransfers),i=new Map(e().inFlightTargets);r.add(t),a&&i.set(t,a),o({activeTransfers:r,inFlightTargets:i,lastUpdated:Date.now()})},removeActiveTransfer:(t,a=!1,r=!1)=>{const i=new Set(e().activeTransfers),c=new Map(e().inFlightTargets),n=new Set(e().successfulTransfers),l=new Set(e().failedTransfers);a?(n.add(t),l.delete(t)):r&&(l.add(t),i.delete(t),c.delete(t)),o({activeTransfers:i,inFlightTargets:c,successfulTransfers:n,failedTransfers:l,lastUpdated:Date.now()})},clearSuccessfulTransfer:t=>o(a=>{const r=new Set(a.successfulTransfers);return r.delete(t),{successfulTransfers:r}}),clearFailedTransfer:t=>o(a=>{const r=new Set(a.failedTransfers);return r.delete(t),{failedTransfers:r}}),getSelectedCharacter:()=>{const t=e();return t.characters.find(a=>a.characterId===t.selectedCharacterId)},getAllInventory:()=>{const t=e();return[...t.vaultInventory,...Object.values(t.characterInventories).flat(),...Object.values(t.characterEquipment).flat()]},saveVirtualLoadout:t=>{const a={...e().virtualLoadouts,[t.id]:t};localStorage.setItem("exo_virtual_loadouts",JSON.stringify(a)),o({virtualLoadouts:a})},deleteVirtualLoadout:t=>{const a={...e().virtualLoadouts};delete a[t],localStorage.setItem("exo_virtual_loadouts",JSON.stringify(a)),o({virtualLoadouts:a})},clear:()=>{localStorage.removeItem("exo_selected_character"),o({characters:[],selectedCharacterId:null,characterInventories:{},characterEquipment:{},vaultInventory:[],itemInstances:{},artifact:null,characterProgressions:null,isLoading:!1,isEquipping:!1,lastUpdated:null,responseMintedTimestamp:null,activeTransfers:new Set,inFlightTargets:new Map,successfulTransfers:new Set,failedTransfers:new Set,detectedSynergies:null,profilePlugSets:null,characterPlugSets:null})},hydrateFromCache:async()=>{try{const t=await hr("exo_profile_cache");if(t)return o({...t,isLoading:!1}),!0}catch(t){je("ProfileStore","Failed to hydrate cache",t)}return!1}})),Ss=Qt(o=>({currentTab:"galaxy",sidebarOpen:!1,builderView:"character",builderSubView:null,hideGlobalUI:!1,transmatEffect:"none",introComplete:!0,globalTransmat:"none",selectedSubclass:null,setTab:e=>o({currentTab:e}),setSidebarOpen:e=>o({sidebarOpen:e}),setBuilderView:(e,t=null)=>o({builderView:e,builderSubView:t}),setHideGlobalUI:e=>o({hideGlobalUI:e}),triggerGlobalTransmat:e=>{o({transmatEffect:e,globalTransmat:e}),setTimeout(()=>o({transmatEffect:"none",globalTransmat:"none"}),2500)},setIntroComplete:e=>o({introComplete:e}),setSelectedSubclass:e=>o({selectedSubclass:e})})),Oa=Qt(o=>({isLoaded:!1,isLoading:!1,loadingProgress:0,error:null,lastUpdated:null,setLoaded:e=>o({isLoaded:e,lastUpdated:Date.now()}),setLoading:e=>o({isLoading:e}),setProgress:e=>o({loadingProgress:e}),setError:e=>o({error:e})})),Ns=Qt((o,e)=>({performanceMode:"high",maxSynergies:10,organizedGalaxy:!1,randomVaultSeed:Math.random(),customCursor:!0,viewMode:"all",deviceMode:"pc",imageSize:84,ownedExpansions:[],isExpansionOwned:t=>e().ownedExpansions.includes(t),ghostFarming:!1,showFps:!1,immersiveMode:!0,setPerformanceMode:t=>o({performanceMode:t}),setMaxSynergies:t=>o({maxSynergies:t}),setOrganizedGalaxy:t=>o({organizedGalaxy:t}),toggleOrganizedGalaxy:()=>o(t=>({organizedGalaxy:!t.organizedGalaxy})),rotateVaultSeed:()=>o({randomVaultSeed:Math.random()}),toggleCustomCursor:()=>o(t=>({customCursor:!t.customCursor})),setViewMode:t=>o({viewMode:t}),setDeviceMode:t=>o({deviceMode:t}),setImageSize:t=>o({imageSize:t}),setOwnedExpansions:t=>o({ownedExpansions:t}),toggleGhostFarming:()=>o(t=>({ghostFarming:!t.ghostFarming})),toggleShowFps:()=>o(t=>({showFps:!t.showFps})),toggleImmersiveMode:()=>o(t=>({immersiveMode:!t.immersiveMode}))})),Ht=Qt(o=>({toasts:[],addToast:e=>{const t=Math.random().toString(36).substring(2,9),a={...e,id:t,timestamp:Date.now()};o(r=>({toasts:[...r.toasts,a]})),setTimeout(()=>{o(r=>({toasts:r.toasts.filter(i=>i.id!==t)}))},e.duration||5e3)},removeToast:e=>o(t=>({toasts:t.toasts.filter(a=>a.id!==e)}))})),nn=Qt(o=>({builds:[],isLoading:!1,error:null,loadBuilds:async()=>{o({isLoading:!0});try{const e=await hr("exo_saved_builds")||[];o({builds:e,isLoading:!1})}catch{o({error:"Failed to load builds",isLoading:!1})}},addBuild:async e=>{o(t=>{const a=[...t.builds,e];return ja("exo_saved_builds",a),{builds:a}})},removeBuild:async e=>{o(t=>{const a=t.builds.filter(r=>r.id!==e);return ja("exo_saved_builds",a),{builds:a}})},setLoading:e=>o({isLoading:e}),setBuilds:e=>o({builds:e})})),on=Qt(o=>({isSpinning:!1,currentBuild:null,lockedSlots:{},setSpinning:e=>o({isSpinning:e}),setCurrentBuild:e=>o({currentBuild:e}),toggleLock:e=>o(t=>({lockedSlots:{...t.lockedSlots,[e]:!t.lockedSlots[e]}}))})),Va=Object.freeze(Object.defineProperty({__proto__:null,SetInventoriesResult:Zs,useAuthStore:Qs,useGeneratorStore:on,useManifestStore:Oa,useProfileStore:j,useSavedBuildsStore:nn,useSettingsStore:Ns,useToastStore:Ht,useUIStore:Ss},Symbol.toStringTag,{value:"Module"})),Er="https://database-clarity.github.io/",cn=`${Er}Live-Clarity-Database/descriptions/dim.json`,ln=`${Er}Live-Clarity-Database/versions.json`;class un{descriptions=null;isLoaded=!1;async load(){if(this.isLoaded)return!0;try{const a=(await(await fetch(ln)).json()).descriptions,r=await xe.getClarityVersion();let i=await xe.getClarityDescriptions();return!i||r!==a?(Ee("Clarity",`Update required: ${a} (Cached: ${r||"None"})`),i=await(await fetch(cn)).json(),await xe.setClarityDescriptions(i),await xe.setClarityVersion(a)):re("Clarity",`Loading from cache (Version: ${r})`),this.descriptions=i,this.isLoaded=!0,!0}catch(e){return de("Clarity","Failed to load community descriptions",e),!1}}getDescription(e){return this.descriptions&&this.descriptions[e]?.description||null}getRichData(e){return this.descriptions&&this.descriptions[e]||null}}const dn=new un,Sa={"6b6b779a1f11c8282b99596b42b9c5f6":"Renegades",fe76c7c25ce4af443213efc3444005b4:"The Final Shape","9e46a74b0cc6c2d1b098f98ecbe1b99":"Lightfall","2dd9659f80282b0f4a8e63a342468f7":"The Witch Queen",e2254050d53c54fbbe2e9a2636a0fb4:"Beyond Light",871790403:"Shadowkeep","12ee68f23":"Forsaken",df01f93f77341fe742d4a5202ed7268:"Season of the Wish","22247f7149a468e2289fba8d6c1b3f6":"Season of the Witch",292435532:"Season of the Deep",342240502:"Season of Defiance",ac0090886cfa2b6389fba8d6c1b3f6:"Episode: Echoes","90886cfa2b63":"Episode: Revenant",renegade:"Renegades Update"};function mn(o){if(!o)return;const e=o.split("/").pop()?.split(".")[0];if(e){if(Sa[e])return Sa[e];for(const[t,a]of Object.entries(Sa))if(e.includes(t)||t.includes(e))return a}}function zs(o){return o===void 0?!1:o<20}const Ft=mr("Manifest"),Ws={17096506:3178805705,89619507:3178805705,449318888:485622768,503025963:485622768,511888814:2611060930,1003391927:485622768,1047932517:2611060930,1203306857:3178805705,1351987111:3178805705,1443166262:485622768,1685137410:3178805705,1734844650:3178805705,1955548646:485622768,2110100341:3178805705,"2415768376":3178805705,"2474293653":485622768,"2687811401":2611060930,"2694576561":2611060930,"3118061004":2611060930,"3487253372":485622768,"3598649636":485622768,"4029987901":2611060930,"4268030601":485622768,"3497407670":3178805705};function $a(o){if(o===485622768)return 1;if(o===2611060930)return 2;if(o===3178805705)return 3}const ns=["DestinyInventoryItemDefinition","DestinyInventoryBucketDefinition","DestinyStatDefinition","DestinyClassDefinition","DestinyDamageTypeDefinition","DestinySandboxPerkDefinition","DestinySocketTypeDefinition","DestinySocketCategoryDefinition","DestinyPlugSetDefinition","DestinyLoadoutNameDefinition","DestinyLoadoutColorDefinition","DestinyLoadoutIconDefinition","DestinyActivityModifierDefinition","DestinyActivityDefinition","DestinyBreakerTypeDefinition","DestinyGuardianRankDefinition","DestinyGuardianRankConstantsDefinition","DestinyEquipmentSetDefinition","DestinySocialCommendationNodeDefinition","DestinySocialCommendationDefinition","DestinyRecordDefinition","DestinyPresentationNodeDefinition"],Ya={3956119552:2,3538316507:3,3673640204:4,641408223:6,2552562702:7,1281712906:2,1197336009:3,3366817658:4,826897697:6,2480042224:7,1308084083:2,1662395848:3,3202031457:4,1960796738:6,2200902275:7,1800170884:8},za={3373582085:1,2303181850:2,1847026933:3,3454344768:4,151347233:6,3949783978:7,1800170884:8};class fn{manifestData={};discoveredAbilities={};searchCache={};isLoading=!1;loadPromise=null;async checkForUpdate(){try{const e=await lt.get(ge.endpoints.manifest),t=await xe.getManifestVersion();let a=!t||t!==e.version;if(a||Ee("Manifest",`Cache check: Version ${t} matches Bungie. Checking tables...`),!a){const r=e.jsonWorldComponentContentPaths.en;for(const i of ns){if(!r[i])continue;if(!await xe.getManifestTable(i)){Ee("Manifest",`Forcing update: Table ${i} is missing from cache.`),a=!0;break}}}return a&&t===e.version?Ee("Manifest",`Manifest version matches (${t||"None"}), but required tables are missing from cache.`):a?Ee("Manifest",`Manifest update required: ${e.version} (Current: ${t||"None"})`):re("Manifest",`Manifest is up to date (${t})`),{needsUpdate:a,version:e.version}}catch(e){return Ft.error("Failed to check manifest version:",e),{needsUpdate:!0,version:""}}}async load(e){if(this.loadPromise)return this.loadPromise;this.loadPromise=this.doLoad(e);try{await this.loadPromise}finally{this.loadPromise=null}}async doLoad(e){if(!this.isLoading){this.isLoading=!0;try{const{needsUpdate:t,version:a}=await this.checkForUpdate();t?(Ft.info("Downloading new manifest version:",a),await this.downloadManifest(e)):(Ft.info("Loading manifest from cache"),await this.loadFromCache(e)),dn.load()}finally{this.isLoading=!1}}}async createManifestDatabase(){await xe.clearManifest()}async downloadManifest(e){return navigator.locks?navigator.locks.request("manifest_download",async()=>{const{needsUpdate:t}=await this.checkForUpdate();if(!t){Ft.info("Manifest already updated by another tab."),await this.loadFromCache(e);return}return this.doDownloadManifest(e)}):this.doDownloadManifest(e)}async doDownloadManifest(e){const t=await lt.get(ge.endpoints.manifest),a=t.jsonWorldComponentContentPaths.en;let r=0;const i=ns.length,c=ns.map(async(n,l)=>{const d=a[n];if(!d)return;const h=[`?v=${t.version.replace(/[^a-zA-Z0-9]/g,"")}`,`?cb=${Math.random().toString(36).substring(7)}`,`?retry=${Date.now()}`];let m=null,f=null;for(const p of h)try{const R=`${ge.bungieNetOrigin}${d}${p}`,A=await fetch(R);if(!A.ok)throw new Error(`Failed to download ${n} (Status: ${A.status})`);if(f=await A.json(),f&&typeof f=="object")break}catch(R){m=R,Ft.warn(`Manifest retry for ${n} using ${p}...`)}if(!f)throw m||new Error(`Failed to download ${n} after all retries.`);f=this.trimTable(n,f),await xe.setManifestTable(n,f),this.manifestData[n]=f,r++;const E=r/i*100;e?.(n,E),Ft.info(`Downloading manifest tables (${r}/${i}): ${n} (${Object.keys(f).length} entries)`)});try{await Promise.all(c),await xe.setManifestVersion(t.version),e?.("Complete",100),Ft.success(`Manifest download complete: ${i} tables loaded`),this.discoverSubclassComponents()}catch(n){throw Ft.error("Failed to download all manifest tables:",n),n}}trimTable(e,t){return t}async loadFromCache(e){const t=ns.length,a=await lt.get(ge.endpoints.manifest);for(let r=0;r<ns.length;r++){const i=ns[r];e?.(i,r/t*100);let c=await xe.getManifestTable(i);if(!c){Ft.warn(`Table ${i} missing from cache, fetching...`);const n=a.jsonWorldComponentContentPaths.en[i];n&&(c=await lt.get(n,!1),await xe.setManifestTable(i,c))}c&&(this.manifestData[i]=c)}e?.("Complete",100),this.discoverSubclassComponents()}discoverSubclassComponents(){const e=this.manifestData.DestinyInventoryItemDefinition;if(!e)return;this.discoveredAbilities={0:{},1:{},2:{},3:{}},this.searchCache={};const t={supers:"SUPER",super:"SUPER",class_abilities:"CLASS_ABILITIES",class_ability:"CLASS_ABILITIES",melee:"MELEE",grenades:"GRENADES",grenade:"GRENADES",movement:"JUMP",jump:"JUMP",aspects:"ASPECTS",aspect:"ASPECTS",stasis_aspects:"ASPECTS",fragments:"FRAGMENTS",fragment:"FRAGMENTS",whisper:"FRAGMENTS",stasis_fragments:"FRAGMENTS",prismatic_aspects:"ASPECTS",prismatic_fragments:"PRISMATIC_FRAGMENTS",prismatic:"PRISMATIC_FRAGMENTS"};for(const a of Object.values(e)){if(!a.displayProperties?.name||a.displayProperties.name==="Unknown"||!a.displayProperties.icon||a.displayProperties.name==="Attributes"||a.itemSubType===21||a.displayProperties.name.includes("Ornament")||a.itemType===2||a.itemType===3)continue;const r=a.displayProperties.name.toLowerCase(),i=(a.itemTypeDisplayName||"").toLowerCase();if(r.includes("catalyst")||i.includes("catalyst")||r.includes("masterwork")||i.includes("masterwork")||r.includes("empty")||r.includes("socket")||r.includes("unfocused")||r.includes("placeholder")||a.hash===3696633656)continue;const c=a.plug?.plugCategoryIdentifier?.toLowerCase()||"";let n;for(const[f,E]of Object.entries(t))if(new RegExp(`(^|[._])${f}([._]|$)`,"i").test(c)){n=E;break}a.displayProperties.name.startsWith("Facet of")&&(n="PRISMATIC_FRAGMENTS");const l=(a.itemTypeDisplayName||"").toLowerCase();if(n||(/\bsuper\b/.test(l)?n="SUPER":/\baspect\b/.test(l)?n="ASPECTS":/\bfragment\b/.test(l)?n="FRAGMENTS":/\bgrenade\b/.test(l)?l.includes("launcher")||(n="GRENADES"):/\bmelee\b/.test(l)?n="MELEE":l.includes("class ability")?n="CLASS_ABILITIES":(l.includes("jump")||l.includes("glide")||l.includes("lift"))&&(n="JUMP")),!n)continue;const d=a.classType??3;let h=a.defaultDamageType||0;if(h>100&&(h=za[h]||0),h===0&&a.plug?.plugCategoryHash){const f=Ya[a.plug.plugCategoryHash];f!==void 0&&(h=f)}(c.includes("prismatic")||n==="PRISMATIC_FRAGMENTS"||a.displayProperties.name.startsWith("Facet of")||(a.itemTypeDisplayName||"").toLowerCase().includes("prismatic"))&&(h=8,n==="FRAGMENTS"&&(n="PRISMATIC_FRAGMENTS")),this.discoveredAbilities[d]||(this.discoveredAbilities[d]={}),this.discoveredAbilities[d][h]||(this.discoveredAbilities[d][h]={}),this.discoveredAbilities[d][h][n]||(this.discoveredAbilities[d][h][n]=[]),this.discoveredAbilities[d][h][n].push(a.hash)}Ft.info("Subclass component discovery complete.")}getDiscoveredAbilities(e,t){return this.discoveredAbilities[e]&&this.discoveredAbilities[e][t]||{}}getAllSubclassComponents(){const e=[];for(const[a,r]of Object.entries(this.discoveredAbilities))for(const[i,c]of Object.entries(r))for(const[n,l]of Object.entries(c))l.forEach(d=>{const h=this.getItem(d);h&&e.push({name:h.displayProperties.name,hash:h.hash,icon:h.displayProperties.icon,category:n,classType:Number(a),damageType:Number(i)})});const t=this.manifestData.DestinyInventoryItemDefinition;if(t){for(const[a,r]of Object.entries(t))if(r.itemType===16&&r.displayProperties?.name&&r.displayProperties.icon){const i=r.displayProperties.name.toLowerCase();if(i.includes("unfocused")||i.includes("empty")||i.includes("socket")||i.includes("catalyst"))continue;e.push({name:r.displayProperties.name,hash:Number(a),icon:r.displayProperties.icon,category:"SUBCLASS",classType:r.classType??3,damageType:r.defaultDamageType&&r.defaultDamageType>100?za[r.defaultDamageType]||0:r.defaultDamageType||0})}}return e.sort((a,r)=>a.damageType!==r.damageType?a.damageType-r.damageType:a.classType!==r.classType?a.classType-r.classType:a.name.localeCompare(r.name))}getItem(e){const t=this.manifestData.DestinyInventoryItemDefinition;if(!t)return;let a=t[String(e)];if(!a){const r=Number(e)|0;a=t[String(r)]}if(a)return this.transformItemDefinition(a)}getIcon(e){const t=this.getItem(e);if(t?.displayProperties?.icon)return t.displayProperties.icon;const a=this.manifestData.DestinySandboxPerkDefinition;if(a){const i=String(e),c=a[i];if(c?.displayProperties?.icon)return c.displayProperties.icon;const n=Number(e)|0,l=a[String(n)];if(l?.displayProperties?.icon)return l.displayProperties.icon}const r=this.getRecord(e);if(r?.icon)return r.icon}getRecord(e){const t=this.manifestData.DestinyRecordDefinition;if(!t)return;let a=t[String(e)];if(!a){const r=Number(e)|0;a=t[String(r)]}if(a?.displayProperties)return{name:a.displayProperties.name,description:a.displayProperties.description,icon:a.displayProperties.icon,completionInfo:a.completionInfo}}searchRecordByName(e,t=!1){const a=this.manifestData.DestinyRecordDefinition;if(!a)return;const r=e.toLowerCase();let i;for(const[c,n]of Object.entries(a)){if(!n?.displayProperties?.name)continue;const l=n.displayProperties.name.toLowerCase(),d=!!n.displayProperties.icon;if(t){if(l===r){if(d)return{name:n.displayProperties.name,icon:n.displayProperties.icon,hash:Number(c)};i||(i={name:n.displayProperties.name,icon:void 0,hash:Number(c)})}}else l.includes(r)&&d&&(!i||!i.icon)&&(i={name:n.displayProperties.name,icon:n.displayProperties.icon,hash:Number(c)})}return i}getPresentationNode(e){const t=this.manifestData.DestinyPresentationNodeDefinition;if(!t)return;let a=t[String(e)];if(!a){const r=Number(e)|0;a=t[String(r)]}if(a?.displayProperties)return{name:a.displayProperties.name,description:a.displayProperties.description,icon:a.displayProperties.icon,originalIcon:a.originalIcon,rootViewIcon:a.rootViewIcon}}searchPresentationNodes(e){const t=this.manifestData.DestinyPresentationNodeDefinition;if(!t)return[];const a=[],r=e.toLowerCase();for(const[i,c]of Object.entries(t)){const n=c?.displayProperties?.name||"",l=c?.displayProperties?.description||"";(n.toLowerCase().includes(r)||l.toLowerCase().includes(r))&&a.push({hash:Number(i),name:n,icon:c.displayProperties?.icon,rootViewIcon:c.rootViewIcon,originalIcon:c.originalIcon,description:l})}return a.sort((i,c)=>i.rootViewIcon&&!c.rootViewIcon?-1:!i.rootViewIcon&&c.rootViewIcon?1:i.icon&&!c.icon?-1:!i.icon&&c.icon?1:i.name.localeCompare(c.name))}searchPresentationNodeByName(e,t=!1){const a=this.manifestData.DestinyPresentationNodeDefinition;if(!a)return;const r=e.toLowerCase();let i;for(const[c,n]of Object.entries(a)){if(!n?.displayProperties?.name||n.displayProperties.name==="")continue;const l=n.displayProperties.name.toLowerCase(),d=!!n.displayProperties.icon||!!n.originalIcon,h=n.displayProperties.icon||n.originalIcon;if(t){if(l===r){if(d)return{name:n.displayProperties.name,icon:h,hash:Number(c)};i||(i={name:n.displayProperties.name,icon:void 0,hash:Number(c)})}}else l.includes(r)&&d&&(!i||l.startsWith(r)&&!i.name.toLowerCase().startsWith(r))&&(i={name:n.displayProperties.name,icon:h,hash:Number(c)})}return i}getActivity(e){const t=this.manifestData.DestinyActivityDefinition;if(!t)return;let a=t[String(e)];if(!a){const r=Number(e)|0;a=t[String(r)]}if(a?.displayProperties)return{name:a.displayProperties.name||"",description:a.displayProperties.description,icon:a.displayProperties.icon,pgcrImage:a.pgcrImage}}getEquipmentSet(e){const t=this.manifestData.DestinyEquipmentSetDefinition;if(!t)return;let a=t[String(e)];if(!a){const r=Number(e)|0;a=t[String(r)]}return a}getBucket(e){const t=this.manifestData.DestinyInventoryBucketDefinition;if(!t)return;let a=t[String(e)];if(!a){const r=Number(e)|0;a=t[String(r)]}if(a?.displayProperties)return{name:a.displayProperties.name||"",description:a.displayProperties.description,icon:a.displayProperties.icon}}getStat(e){const t=this.manifestData.DestinyStatDefinition;if(!t)return;let a=t[String(e)];if(!a){const r=Number(e)|0;a=t[String(r)]}if(a?.displayProperties)return{hash:a.hash,name:a.displayProperties.name||"",description:a.displayProperties.description,icon:a.displayProperties.icon}}searchStatByName(e){const t=this.manifestData.DestinyStatDefinition;if(!t)return;const a=e.toLowerCase();for(const[r,i]of Object.entries(t))if(i?.displayProperties?.name?.toLowerCase()===a)return{name:i.displayProperties.name,hash:Number(r),icon:i.displayProperties.icon,description:i.displayProperties.description}}searchItemByName(e,t=!1){const a=this.manifestData.DestinyInventoryItemDefinition;if(!a)return;const r=e.toLowerCase();for(const i of Object.values(a)){const c=i.displayProperties?.name?.toLowerCase();if(c){if(t){if(c===r)return this.transformItemDefinition(i)}else if(c.includes(r))return this.transformItemDefinition(i)}}}getActivityModifier(e){const t=this.manifestData.DestinyActivityModifierDefinition;if(!t)return;let a=t[String(e)];if(!a){const i=Number(e)|0;a=t[String(i)]}if(!a?.displayProperties)return;let r=a.breakerType;if(!r&&Ws[String(e)]&&(r=$a(Ws[String(e)])),!r){const i=Number(e)|0;Ws[String(i)]&&(r=$a(Ws[String(i)]))}return{name:a.displayProperties.name||"",description:a.displayProperties.description,icon:a.displayProperties.icon,breakerType:r}}getBreakerType(e){const t={1:{name:"Barrier",icon:"/common/destiny2_content/icons/2ee146c19b93b88d2c7857005fc9a8c3.png"},2:{name:"Overload",icon:"/common/destiny2_content/icons/f5b9dd270a544afaf2b9a726b1296501.png"},3:{name:"Unstoppable",icon:"/common/destiny2_content/icons/26bcfa0cf4e27a3dd15f690f7c4ba5a5.png"}},a=Number(e);if(t[a])return t[a];const r=this.manifestData.DestinyBreakerTypeDefinition;if(!r)return;const i=r[String(e)];if(i?.displayProperties)return{name:i.displayProperties.name||"",icon:i.displayProperties.icon};for(const c of Object.values(r))if(c?.enumValue===a)return{name:c.displayProperties?.name||"",icon:c.displayProperties?.icon}}getChampionIcon(e){const t={barrier:1,overload:2,unstoppable:3};return this.getBreakerType(t[e])?.icon}getGuardianRankIcon(e){const t=this.manifestData.DestinyGuardianRankDefinition,a=this.manifestData.DestinyGuardianRankConstantsDefinition;if(!t)return;const r=Object.values(t).find(n=>n.rankNumber===e);if(!r)return;const i=a?Object.values(a)[0]:null;let c;if(i?.iconBackgrounds){const n=i.iconBackgrounds;e>=7?c=n.backgroundFilledBlueGradientBorderedImagePath:c=n.backgroundPlateBlackAlphaImagePath}return{background:r.iconBackgroundPath?`${ge.bungieNetOrigin}${r.iconBackgroundPath}`:void 0,foreground:r.iconForegroundPath?`${ge.bungieNetOrigin}${r.iconForegroundPath}`:void 0,icon:r.displayProperties?.icon?`${ge.bungieNetOrigin}${r.displayProperties.icon}`:void 0,plate:c?`${ge.bungieNetOrigin}${c}`:void 0}}getClassIcon(e){const a={0:"Titan",1:"Hunter",2:"Warlock"}[e];if(a){const c=this.searchPresentationNodeByName(a,!0);if(c?.icon)return c.icon}const r=this.manifestData.DestinyClassDefinition;return r?Object.values(r).find(c=>c.classType===e)?.displayProperties?.icon:void 0}getDamageTypeIcon(e){const t={kinetic:3373582085,solar:1847026933,arc:2303181850,void:3454344768,stasis:151347233,strand:3949783978,prismatic:1800170884},a=this.manifestData.DestinyDamageTypeDefinition;if(!a)return;const r=t[e.toLowerCase()];if(!r)return;let i=a[String(r)];if(!i){const c=Number(r)|0;i=a[String(c)]}if(i?.displayProperties?.icon)return i.displayProperties.icon}getCommendationNode(e){const t=this.manifestData.DestinySocialCommendationNodeDefinition;if(!t)return;let a=t[String(e)];if(!a){const r=Number(e)|0;a=t[String(r)]}if(a)return{hash:a.hash,name:a.displayProperties?.name||"",icon:a.displayProperties?.icon?`${ge.bungieNetOrigin}${a.displayProperties.icon}`:void 0,color:a.color?`rgb(${a.color.red}, ${a.color.green}, ${a.color.blue})`:void 0}}getCommendation(e){const t=this.manifestData.DestinySocialCommendationDefinition;if(!t)return;let a=t[String(e)];if(!a){const r=Number(e)|0;a=t[String(r)]}if(a)return{name:a.displayProperties?.name||"",description:a.displayProperties?.description||"",icon:a.displayProperties?.icon?`${ge.bungieNetOrigin}${a.displayProperties.icon}`:void 0}}getGuardianRankName(e){const t=this.manifestData.DestinyGuardianRankDefinition;return t?Object.values(t).find(r=>r.rank===e)?.displayProperties?.name:void 0}searchActivities(e,t=10){const a=this.manifestData.DestinyActivityDefinition;if(!a)return[];const r=n=>n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g,"").trim(),i=r(e),c=[];for(const n of Object.values(a)){if(!n?.displayProperties?.name)continue;if(r(n.displayProperties.name).includes(i)&&(c.push(n),c.length>=t))break}return c}getName(e){const t=this.getItem(e);if(t?.displayProperties.name)return t.displayProperties.name;const a=this.getPerk(e);if(a?.name)return a.name}getFullDefinition(e){const t=this.getItem(e);if(t){const c=[],n=this.manifestData.DestinyInventoryItemDefinition?.[String(e)];n?.stats?.stats&&Object.values(n.stats.stats).forEach(h=>{const m=this.getStat(h.statHash);m&&c.push({name:m.name,value:h.value})}),n?.investmentStats&&c.length===0&&n.investmentStats.forEach(h=>{const m=this.getStat(h.statTypeHash);m&&h.value!==0&&c.push({name:m.name,value:h.value>0?`+${h.value}`:`${h.value}`})});let l=t.displayProperties.description,d;if(n?.sockets?.socketEntries&&t.inventory?.tierType===6){for(const h of n.sockets.socketEntries)if(h.singleInitialItemHash){const m=this.manifestData.DestinyInventoryItemDefinition?.[String(h.singleInitialItemHash)];if(m&&m.displayProperties?.description&&(m.itemTypeDisplayName==="Intrinsic"||m.itemTypeDisplayName==="Trait"||m.plug?.plugCategoryIdentifier?.includes("intrinsic"))&&m.displayProperties.description.length>20){l=m.displayProperties.description,d=m.displayProperties.name;break}}}if(!l&&n?.perks?.length)for(const h of n.perks){const m=this.getPerk(h.perkHash);if(m?.description&&m.description.length>20){l=m.description,d=m.name;break}}return(!l||l.length<20)&&(l=t.displayProperties.description||n?.flavorText),{name:t.displayProperties.name,type:t.inventory?.tierTypeName||"Item",description:l,flavorText:n?.flavorText,perkName:d,icon:t.displayProperties.icon||t.screenshot,stats:c,element:t.defaultDamageType&&this.getDamageType(t.defaultDamageType)?.name||void 0}}const a=this.getActivity(e);if(a)return{name:a.name,type:"Activity",description:a.description,icon:a.pgcrImage||a.icon};const r=this.getActivityModifier(e);if(r)return{name:r.name,type:"Modifier",description:r.description,icon:r.icon,breakerType:r.breakerType};const i=this.getPerk(e);if(i)return{name:i.name,type:"Ability/Perk",description:i.description,icon:i.icon}}transformItemDefinition(e){let t=e.defaultDamageType;if(e.plug?.plugCategoryHash){const a=Ya[e.plug.plugCategoryHash];a!==void 0&&(t=a)}return e.inventory?.tierType===6&&e.equippingBlock?.uniqueLabel,{...e,hash:e.hash,displayProperties:{name:e.displayProperties?.name||"Unknown",description:e.displayProperties?.description||"",icon:e.displayProperties?.icon?`${ge.bungieNetOrigin}${e.displayProperties.icon}`:"",hasIcon:!!e.displayProperties?.icon},screenshot:e.screenshot?`${ge.bungieNetOrigin}${e.screenshot}`:void 0,itemType:e.itemType,itemSubType:e.itemSubType,classType:e.classType,equippable:e.equippable||!1,defaultDamageType:t,defaultDamageTypeHash:e.defaultDamageTypeHash,tierType:e.inventory?.tierType,isExotic:e.inventory?.tierType===6,itemTypeDisplayName:e.itemTypeDisplayName,itemTypeAndTierDisplayName:e.itemTypeAndTierDisplayName,sockets:e.sockets,itemCategoryHashes:e.itemCategoryHashes,plug:e.plug,inventory:e.inventory?{tierType:e.inventory.tierType||0,tierTypeName:e.inventory.tierTypeName||"",bucketTypeHash:e.inventory.bucketTypeHash||0,recoveryBucketTypeHash:e.inventory.recoveryBucketTypeHash||0,maxStackSize:e.inventory.maxStackSize||1,isInstanceItem:e.inventory.isInstanceItem||!1,nonTransferrable:e.inventory.nonTransferrable||!1,equippingLabel:e.equippingBlock?.uniqueLabel,equippable:e.inventory.equippable||!1}:void 0,equippingBlock:e.equippingBlock,stats:e.stats?{disablePrimaryStatDisplay:!!e.stats.disablePrimaryStatDisplay,statGroupHash:e.stats.statGroupHash||0,stats:e.stats.stats||{},hasAndDisplayHashes:e.stats.hasAndDisplayHashes||[]}:void 0,iconWatermark:e.iconWatermark||e.quality?.displayVersionWatermarkIcons?.[0],secondarySpecial:e.secondarySpecial?`${ge.bungieNetOrigin}${e.secondarySpecial}`:void 0,secondaryOverlay:e.secondaryOverlay?`${ge.bungieNetOrigin}${e.secondaryOverlay}`:void 0,secondaryIcon:e.secondaryIcon?`${ge.bungieNetOrigin}${e.secondaryIcon}`:void 0,seasonLabel:mn(e.iconWatermark||e.quality?.displayVersionWatermarkIcons?.[0]||""),iconWatermarkShelved:e.iconWatermarkShelved||void 0,quality:e.quality?{currentVersion:e.quality.currentVersion||0,displayVersionWatermarkIcons:e.quality.displayVersionWatermarkIcons||[]}:void 0}}getItems(e){return e.map(t=>this.getItem(t)).filter(t=>t!==void 0)}searchItemsByType(e,t){const a=`type_${e}_tier_${t}`;if(this.searchCache[a])return this.searchCache[a];const r=this.manifestData.DestinyInventoryItemDefinition;if(!r)return[];const i=[];for(const[c,n]of Object.entries(r))n.itemType===e&&n.inventory?.tierType===t&&n.displayProperties?.name&&i.push({name:n.displayProperties.name,description:n.displayProperties.description||"",hash:Number(c),icon:n.displayProperties.icon,classType:n.classType??3,bucketHash:n.inventory?.bucketTypeHash||0,damageType:n.defaultDamageType||0,itemSubType:n.itemSubType||0});return this.searchCache[a]=i,i}searchItems(e,t){const a=this.manifestData.DestinyInventoryItemDefinition;if(!a)return[];const r=[],i=l=>l.toLowerCase().replace(/['â€™.,!-\s]/g,""),c=i(e);for(const l of Object.values(a)){if(t?.tierType!==void 0&&l.inventory?.tierType!==t.tierType||t?.classType!==void 0&&l.classType!==t.classType||t?.itemType!==void 0&&l.itemType!==t.itemType)continue;const d=l.displayProperties?.name;if(!d)continue;const h=i(d);let m=-1;if(h.includes(c))m=0+(h.length-c.length)*.01;else if(t?.fuzzy&&Math.abs(h.length-c.length)<=3){const f=this.levenshtein(c,h);f<=2&&(m=f)}m!==-1&&r.push({item:this.transformItemDefinition(l),score:m})}r.sort((l,d)=>l.score-d.score);const n=t?.limit??10;return r.slice(0,n).map(l=>l.item)}levenshtein(e,t){if(e.length===0)return t.length;if(t.length===0)return e.length;const a=[];for(let r=0;r<=t.length;r++)a[r]=[r];for(let r=0;r<=e.length;r++)a[0][r]=r;for(let r=1;r<=t.length;r++)for(let i=1;i<=e.length;i++)t.charAt(r-1)===e.charAt(i-1)?a[r][i]=a[r-1][i-1]:a[r][i]=Math.min(a[r-1][i-1]+1,Math.min(a[r][i-1]+1,a[r-1][i]+1));return a[t.length][e.length]}getExoticArmor(e){const t=this.manifestData.DestinyInventoryItemDefinition;return t?Object.values(t).filter(a=>!(a.inventory?.tierType!==6||a.itemType!==2||e!==void 0&&a.classType!==e||!a.displayProperties?.icon)).map(a=>this.transformItemDefinition(a)):[]}getExoticWeapons(){const e=this.manifestData.DestinyInventoryItemDefinition;return e?Object.values(e).filter(t=>!(t.inventory?.tierType!==6||t.itemType!==3||!t.displayProperties?.icon)).map(t=>this.transformItemDefinition(t)):[]}getPerk(e){const t=this.manifestData.DestinySandboxPerkDefinition;if(!t)return;const a=t[String(e)];if(a)return{hash:a.hash,name:a.displayProperties.name,description:a.displayProperties.description,icon:a.displayProperties.icon?`${ge.bungieNetOrigin}${a.displayProperties.icon}`:""}}searchPerks(e,t=5){const a=this.manifestData.DestinySandboxPerkDefinition;if(!a)return[];const r=n=>n.toLowerCase().replace(/['â€™.,!-\s]/g,""),i=r(e),c=[];for(const n of Object.values(a)){if(!n?.displayProperties?.name)continue;const l=r(n.displayProperties.name);l.includes(i)&&c.push({name:n.displayProperties.name,description:n.displayProperties.description||"",hash:n.hash,icon:n.displayProperties.icon,score:l.length-i.length})}return c.sort((n,l)=>n.score-l.score).slice(0,t).map(({score:n,...l})=>l)}searchLegendaryWeapons(e,t=5){const a=this.manifestData.DestinyInventoryItemDefinition;if(!a)return[];const r=n=>n.toLowerCase().replace(/['â€™.,!-\s]/g,""),i=r(e),c=[];for(const n of Object.values(a))if(n.itemType===3&&n.inventory?.tierType===5){if(!n.displayProperties?.name)continue;const l=r(n.displayProperties.name);l.includes(i)&&c.push({name:n.displayProperties.name,hash:n.hash,icon:n.displayProperties.icon?`${ge.bungieNetOrigin}${n.displayProperties.icon}`:void 0,score:l.length-i.length})}return c.sort((n,l)=>n.score-l.score).slice(0,t).map(({score:n,...l})=>l)}getDamageType(e){const t=this.manifestData.DestinyDamageTypeDefinition;if(t){for(const a of Object.values(t))if(a.enumValue===e)return{name:a.displayProperties.name}}}getClassName(e){const t=this.manifestData.DestinyClassDefinition;if(!t)return"Unknown";for(const a of Object.values(t))if(a.classType===e)return a.displayProperties.name;return"Unknown"}getPlugSet(e){const t=this.manifestData.DestinyPlugSetDefinition;if(!t)return[];const a=t[String(e)];return a?.reusablePlugItems?a.reusablePlugItems.map(r=>{const i=this.getRawDefinition("DestinyInventoryItemDefinition",r.plugItemHash);return!i||i.itemType===10||i.itemType===26?null:{name:i.displayProperties?.name||"Unknown Perk",description:i.displayProperties?.description||"",hash:i.hash,icon:i.displayProperties?.icon?`${ge.bungieNetOrigin}${i.displayProperties.icon}`:void 0}}).filter(r=>r!==null&&r.name!=="Empty").filter((r,i,c)=>i===c.findIndex(n=>n?.hash===r?.hash)):[]}getPerkPool(e){const t=this.getRawDefinition("DestinyInventoryItemDefinition",e);if(!t?.sockets?.socketEntries)return[];const a=[],i=t.sockets.socketCategories?.find(c=>c.socketCategoryHash===4241085061)?.socketIndexes||[];return t.sockets.socketEntries.forEach((c,n)=>{if(i.length>0&&!i.includes(n))return;const l=c.randomizedPlugSetHash||c.reusablePlugSetHash;if(l){const d=this.getPlugSet(l);d.length>0&&a.push({column:n,perks:d})}}),a}isLoaded(){return ns.every(e=>this.manifestData[e]!==void 0)}async clearCache(){await xe.clearManifest(),this.manifestData={},this.searchCache={}}getDefinition(e,t){return this.manifestData[e]?.[String(t)]}getRawDefinition(e,t){return this.getDefinition(e,t)}getAspectCapacity(e){const t=this.getRawDefinition("DestinyInventoryItemDefinition",e);return t?.plug?.energyCapacity?.capacityValue??t?.energy?.capacityValue??0}getDefaultLoadoutIdentifiers(){const e=this.manifestData.DestinyLoadoutNameDefinition,t=this.manifestData.DestinyLoadoutColorDefinition,a=this.manifestData.DestinyLoadoutIconDefinition;if(!e||!t||!a)return null;const r=l=>Object.values(l).filter(h=>!h.redacted).sort((h,m)=>(h.index??0)-(m.index??0))[0]?.hash??null,i=r(e),c=r(t),n=r(a);return i===null||c===null||n===null?null:{nameHash:i,colorHash:c,iconHash:n}}getItemCount(){const e=this.manifestData.DestinyInventoryItemDefinition;return e?Object.keys(e).length:0}getDebugInfo(){const e=this.manifestData.DestinyInventoryItemDefinition;if(!e)return"No items loaded";const t="4019651319",a="-275315977";let r=`Items: ${Object.keys(e).length}
`;e[t]?r+=`FOUND Unsigned: ${e[t].displayProperties?.name}
`:r+=`MISSING Unsigned (${t})
`,e[a]?r+=`FOUND Signed: ${e[a].displayProperties?.name}
`:r+=`MISSING Signed (${a})
`;let i="";for(const c in e){const n=e[c];if(n?.displayProperties?.name==="Ace of Spades"){i=c;const l=JSON.stringify(n).substring(0,100);r+=`Found via SEARCH. Key: ${c} 
Def Start: ${l}...`;break}}return i||(r+="Could not find 'Ace of Spades' by name scan."),r}}const P=new fn;class hn{async applyArmorMods(e,t,a,r){const i=(await Ia(async()=>{const{useProfileStore:d}=await Promise.resolve().then(()=>Va);return{useProfileStore:d}},void 0)).useProfileStore.getState(),c=(i.characterEquipment?.[e]||[]).filter(d=>[q.HELMET,q.GAUNTLETS,q.CHEST_ARMOR,q.LEG_ARMOR,q.CLASS_ARMOR].includes(d.bucketHash));if(c.length===0)return;const n=await Promise.all(c.map(async d=>({item:d,instance:i.itemInstances[d.itemInstanceId],sockets:await ve.getItemSockets(d.itemInstanceId)}))),{assignments:l}=this.fitMods(t,n.filter(d=>d.sockets&&d.instance));for(let d=0;d<l.length;d++){const h=l[d];if(n.find(p=>p.item.itemInstanceId===h.itemInstanceId)?.sockets.sockets.find(p=>p.socketIndex===h.socketIndex)?.plugHash===h.modHash)continue;if(a(`Mod ${d+1}/${l.length}`,90+d/l.length*10),(await pt.insertSocketPlugFree(h.itemInstanceId,h.modHash,h.socketIndex,e,r)).stop){Ee("Transfer","Stopping armor mod application due to location restriction");break}await new Promise(p=>setTimeout(p,500))}}async applySubclassConfiguration(e,t,a,r,i){if(!t||!e.itemInstanceId)return;r("Configuring Subclass...",85);const n=(await Ia(async()=>{const{useProfileStore:C}=await Promise.resolve().then(()=>Va);return{useProfileStore:C}},void 0)).useProfileStore.getState().getAllInventory().find(C=>C.itemInstanceId===e.itemInstanceId);if(!n||!n.itemInstanceId)return;const l=P.getRawDefinition("DestinyInventoryItemDefinition",n.itemHash);if(!l?.sockets?.socketCategories||!l.sockets.socketEntries)return;const d=await ve.getItemSockets(n.itemInstanceId);if(!d)return;const h={},m=2855639344,f=C=>{let D=0;return C.forEach(F=>{const K=P.getRawDefinition("DestinyInventoryItemDefinition",F)?.investmentStats?.find(v=>v.statTypeHash===m);K&&(D+=K.value)}),D},E=C=>{const D=l.sockets.socketEntries[C];return D?.singleInitialItemHash&&D.singleInitialItemHash!==0?D.singleInitialItemHash:D?.reusablePlugSetHash&&P.getRawDefinition("DestinyPlugSetDefinition",D.reusablePlugSetHash)?.reusablePlugItems?.[0]?.plugItemHash||0},p=C=>C.flatMap(D=>{const F=l.sockets.socketCategories.find(ne=>ne.socketCategoryHash===D);return F?F.socketIndexes:[]}).sort((D,F)=>D-F),R=(C,D)=>{const F=[...D],ne=[];d.sockets&&(C.forEach(K=>{const W=d.sockets[K]?.plugHash,g=F.indexOf(W||0);g!==-1?F.splice(g,1):ne.push({index:K,currentHash:W})}),ne.forEach((K,v)=>{if(v<F.length)K.currentHash!==F[v]&&(h[K.index]=F[v]);else{const W=E(K.index);W&&K.currentHash!==W&&(h[K.index]=W)}}))},A=p([be.SUPER,be.ABILITIES,be.ABILITIES_IKORA]);[{hash:t.superHash,name:"supers"},{hash:t.classAbilityHash,name:"class_abilities"},{hash:t.meleeHash,name:"melee"},{hash:t.grenadeHash,name:"grenades"},{hash:t.jumpHash||t.movementHash,name:"movement"}].forEach((C,D)=>{let F=C.hash;const ne=A.find(K=>{if(h[K])return!1;const v=l.sockets.socketEntries[K],W=P.getRawDefinition("DestinySocketTypeDefinition",v?.socketTypeHash);if(F){const g=P.getRawDefinition("DestinyInventoryItemDefinition",F);return W?.plugWhitelist?.some($=>$.categoryHash===g?.plug?.plugCategoryHash)}return D>0});if(ne!==void 0){if(F||(F=E(ne)),d.sockets[ne]?.plugHash===F)return;F&&(h[ne]=F)}});const T=p([be.ASPECTS,be.ASPECTS_IKORA,be.ASPECTS_STRANGER,be.ASPECTS_NEOMUNA]);t.aspects&&T.length>0&&R(T,t.aspects);const H=p([be.FRAGMENTS,be.FRAGMENTS_IKORA,be.FRAGMENTS_STRANGER,be.FRAGMENTS_NEOMUNA]);if(H.length>0){let C=t.aspects;if(!C||C.length===0){const ne=p([be.ASPECTS,be.ASPECTS_IKORA,be.ASPECTS_STRANGER,be.ASPECTS_NEOMUNA]);d?.sockets&&(C=ne.map(K=>d.sockets[K]?.plugHash).filter(Boolean))}const D=f(C||[]),F=(t.fragments||[]).slice(0,D);R(H.slice(0,D),F)}if(Object.keys(h).length>0){const C=Object.keys(h).map(Number).sort((D,F)=>D-F);for(const D of C){if((await pt.insertSocketPlugFree(e.itemInstanceId,h[D],D,a,i)).stop){Ee("Transfer","Stopping subclass configuration due to location restriction");break}await new Promise(ne=>setTimeout(ne,500))}}}getModEnergyCost(e){return P.getRawDefinition("DestinyInventoryItemDefinition",e)?.plug?.energyCost?.energyCost||0}canModFit(e,t,a){const r=P.getRawDefinition("DestinyInventoryItemDefinition",e),i=P.getRawDefinition("DestinyInventoryItemDefinition",t);if(!r||!i||!i.itemCategoryHashes?.includes(59)&&i.itemType!==19)return!1;const n=r.sockets?.socketEntries?.[a];if(!n)return!1;const l=n.socketTypeHash;if(P.getRawDefinition("DestinySocketTypeDefinition",l)?.plugWhitelist?.some(E=>i.plug?.plugCategoryHash===E.categoryHash))return!0;const m=i.plug?.plugCategoryHash;return{136154068:q.HELMET,3190852654:q.GAUNTLETS,1599818818:q.CHEST_ARMOR,2595058479:q.LEG_ARMOR,4148197177:q.CLASS_ARMOR}[m]===r.inventory?.bucketTypeHash}fitMods(e,t){const a=[],r=[...e],i=[...t].sort((c,n)=>{const l=c.instance.energy?.energyCapacity||0;return(n.instance.energy?.energyCapacity||0)-l});for(const c of e){const n=this.getModEnergyCost(c);let l=-1,d=-1;for(let h=0;h<i.length;h++){const{item:m,instance:f,sockets:E}=i[h],p=(f.energy?.energyCapacity||0)-(f.energy?.energyUsed||0);if(f?.energy&&p>=n){const R=E?.sockets?.findIndex(A=>A.isEnabled&&!a.some(_=>_.itemInstanceId===m.itemInstanceId&&_.socketIndex===A.socketIndex));if(R!==void 0&&R!==-1){l=h,d=R;break}}}if(l!==-1){const h=i[l];a.push({itemInstanceId:h.item.itemInstanceId,socketIndex:h.sockets.sockets[d].socketIndex,modHash:c}),h.instance.energy&&(h.instance.energy.energyUsed+=n);const m=r.indexOf(c);m!==-1&&r.splice(m,1)}}return{assignments:a,unassigned:r}}isEnergyValid(e,t){const a=e.energy?.energyUsed||0,r=e.energy?.energyCapacity||0,i=t.reduce((c,n)=>c+this.getModEnergyCost(n),0);return a+i<=r}suggestMods(e,t){const a=[];a.push(3832366019);const i={void:3467460423,solar:2319885414,arc:1834163303,stasis:2921714558,strand:3112965625,prismatic:3112965625}[e.toLowerCase()];return i&&(a.push(i),t==="advanced"&&a.push(i)),a.push(877723168),a.push(1755737153),a.push(40751621),a.push(4188291233),a}}const Ja=new hn,ys=[];function Sn(o){const e=ys.length?ys.at(-1):Promise.resolve(),t=async()=>{let r;if("wakeLock"in navigator)try{r=await navigator.wakeLock.request("screen")}catch(i){Ee("wakelock","Could not acquire screen wake lock",i)}try{return await o()}finally{await r?.release()}},a=e.then(t,t).then(r=>(ys.shift(),r),r=>{throw ys.shift(),r});return ys.push(a),a}const pa=new Set([q.KINETIC_WEAPONS,q.ENERGY_WEAPONS,q.POWER_WEAPONS,q.HELMET,q.GAUNTLETS,q.CHEST_ARMOR,q.LEG_ARMOR,q.CLASS_ARMOR,q.GHOST,q.SUBCLASS]),pn={[q.KINETIC_WEAPONS]:10,[q.ENERGY_WEAPONS]:10,[q.POWER_WEAPONS]:10,[q.HELMET]:10,[q.GAUNTLETS]:10,[q.CHEST_ARMOR]:10,[q.LEG_ARMOR]:10,[q.CLASS_ARMOR]:10,[q.GHOST]:10,[q.SUBCLASS]:10,[q.CONSUMABLES]:50,[q.MODIFICATIONS]:50},En=1e3,Xa={1334959255:2328211300,2958378809:2932390016,1751782730:3168997075,3635991036:2240888816,3105935002:2550323932,3481861797:3941205951,3225959819:2453351420,3382391785:2842471112,3887892656:2849050827};function Zt(o=[],e=5,t){return{bucketsFullOnCurrentStore:new Set,bucketsFullInVault:new Set,bucketsFullOnOtherStores:new Map,involvedItems:new Set(o),excludedItems:new Set,aborted:!1,errors:[],retryCount:0,maxRetries:e,startTime:Date.now(),ultimateTargetChar:t,reservations:{}}}class An{async transferItem(e,t,a,r,i=1,c,n){n?.silent||Ee("Transfer","TransferItem Request",{itemInstanceId:e,toVault:a,characterId:r});const{addActiveTransfer:l}=j.getState(),{addToast:d}=Ht.getState(),h=a?"vault":r;l(e,h);const m=await ve.getPrimaryMembership();if(!m)return{success:!1,error:"No membership",request:{itemId:e,itemHash:t,toCharacter:h,action:"transfer"}};let f=j.getState(),E=f.getAllInventory().find(H=>H.itemInstanceId===e);if(!E&&(re("Transfer",`transferItem: Item ${e} not found in local store. Re-fetching profile for consistency...`),await Ve.loadProfile(!0),f=j.getState(),E=f.getAllInventory().find(H=>H.itemInstanceId===e),!E))return de("Transfer",`transferItem: Item ${e} still not found after profile refresh.`),{success:!1,error:"ItemNotFound",request:{itemId:e,itemHash:t,toCharacter:h,action:"transfer"}};const p=a?r:"vault",A=(p==="vault"?f.vaultInventory:f.characterInventories[p]||[]).filter(H=>H.itemHash===E.itemHash).length>1,_=E.lockable&&A?(E.state&1)===1:void 0,T=(E.state&1)===1;if(c&&a&&c.bucketsFullInVault.has(this.getNativeBucketHash(E)))return{success:!1,error:"Vault full",request:{itemId:e,itemHash:t,toCharacter:"vault",action:"transfer"}};if(!a&&!n?.skipSpaceCheck){const H=f.characters.find(C=>C.characterId===r);if(H){const C=this.getNativeBucketHash(E);if(this.getSpaceInBucket(C,r,f,c)<=0){if(Ee("Transfer",`Destination ${r} full for ${C}. Making space...`),!await this.ensureCanMoveToStore(E,H,1,c||Zt([e])))return{success:!1,error:"NoSpace",request:{itemId:e,itemHash:t,toCharacter:r,action:"transfer"}};f=j.getState()}}}try{ve.updateLocalStore({instanceId:e,sourceId:a?r:"vault",targetId:a?"vault":r,isEquip:!1});const H=E.bucketHash===q.POSTMASTER?ge.endpoints.pullFromPostmaster:ge.endpoints.transferItem;if(await lt.post(H,{itemReferenceHash:t,stackSize:i,transferToVault:a,itemId:e,characterId:r,membershipType:m.membershipType},!0),_!==void 0)(async()=>{const C=a?f.characters[0].characterId:r;Ee("Transfer",`Resetting lock status of ${E?.itemHash} to ${_} to work around Bungie.net lock state bug`),await this.setItemLockState(e,C,_)})();else if(T){const C=a?f.characters[0].characterId:r;await this.setItemLockState(e,C,!0)}if(!n?.silent){const C=P.getItem(t);d({type:"success",message:`${C?.displayProperties?.name||"Item"} moved`,duration:2e3})}return{success:!0,request:{itemId:e,itemHash:t,toCharacter:h,action:"transfer"}}}catch(H){if((H?.httpStatus===500||H?.httpStatus===504||H?.errorCode===1601)&&!n?.silent&&(!c||c.retryCount<3)){const F=H?.errorCode===1601?2e3:1e3*(c?c.retryCount+1:1);return Ee("Transfer",`Retryable error (${H?.errorCode||H?.httpStatus}) during transfer of ${e}. Waiting ${F}ms and retrying...`),await new Promise(ne=>setTimeout(ne,F)),c&&c.retryCount++,this.transferItem(e,t,a,r,i,c,n)}if(H?.httpStatus===500||H?.isPotentialSuccess){Ee("Transfer",`500 error during transfer of ${e}. Verifying ghost success...`),await new Promise(W=>setTimeout(W,1500)),await Ve.loadProfile(!0);let F=j.getState(),ne=F.getAllInventory().find(W=>W.itemInstanceId===e),K=ne?this.getItemSource(ne):"unknown";const v=a?"vault":r;if(K===v){if(Ee("Transfer",`Ghost success detected for ${e} manual transfer to ${v}`),!n?.silent&&!a){const g=P.getItem(t)?.displayProperties?.name||"Item";d({type:"success",message:`${g} moved to character`})}return{success:!0,request:{itemId:e,itemHash:t,toCharacter:h,action:"transfer"}}}if(await new Promise(W=>setTimeout(W,1e3)),await Ve.loadProfile(!0),F=j.getState(),ne=F.getAllInventory().find(W=>W.itemInstanceId===e),K=ne?this.getItemSource(ne):"unknown",K===v){if(Ee("Transfer",`Ghost success detected (retry) for ${e} manual transfer to ${v}`),!n?.silent&&!a){const g=P.getItem(t)?.displayProperties?.name||"Item";d({type:"success",message:`${g} moved to character`})}return{success:!0,request:{itemId:e,itemHash:t,toCharacter:h,action:"transfer"}}}}const D=H instanceof Wt&&H.isNoRoomError()||H?.errorCode===1622;return Ve.loadProfile(!0),n?.silent||d({type:"error",message:H.message||"Transfer failed"}),{success:!1,error:D?"NoSpace":H.message,request:{itemId:e,itemHash:t,toCharacter:h,action:"transfer"}}}finally{j.getState().removeActiveTransfer(e)}}async equipItem(e,t,a){const{addActiveTransfer:r}=j.getState(),{addToast:i}=Ht.getState();r(e,t);const c=j.getState(),n=c.characters.find(m=>m.characterId===t);if(!n)return{success:!1,error:"Char not found",request:{itemId:e,itemHash:0,toCharacter:t,action:"equip"}};const l=c.getAllInventory().find(m=>m.itemInstanceId===e);if(l&&(c.characterEquipment[t]||[]).some(f=>f.itemInstanceId===e))return re("Transfer",`Item ${l.itemHash} is already equipped on ${t}. Skipping API call.`),{success:!0,request:{itemId:e,itemHash:l.itemHash,toCharacter:t,action:"equip"}};const h=(await ve.getPrimaryMembership())?.membershipType??n.membershipType;if(l){const m=P.getItem(l.itemHash);if(m?.inventory?.equippingLabel){const E=(c.characterEquipment?.[t]||[]).find(p=>P.getItem(p.itemHash)?.inventory?.equippingLabel===m.inventory?.equippingLabel&&p.itemInstanceId!==e&&p.bucketHash!==l.bucketHash);if(E){Ee("Transfer",`Resolving exotic conflict: Unequipping ${E.itemInstanceId} to equip ${e}`);const p=new Set([e,E.itemInstanceId]),R=this.findReplacementItem(E.bucketHash,t,p,n.classType);if(R){const A=this.getItemSource(R);if(A!==t){const T=Zt([R.itemInstanceId,e],3,t),H=await this.moveItem(R,A,t,T,{silent:!0});if(!H.success)return de("Transfer",`Failed to move replacement ${R.itemInstanceId} for exotic conflict: ${H.error}`),H}const _=await this.equipItem(R.itemInstanceId,t,{silent:!0});_.success||de("Transfer",`Failed to equip replacement ${R.itemInstanceId}: ${_.error}`)}else de("Transfer",`No replacement found for conflicting exotic in bucket ${E.bucketHash}`)}}}try{if(ve.updateLocalStore({instanceId:e,sourceId:t,targetId:t,isEquip:!0}),await lt.post(ge.endpoints.equipItem,{itemId:e,characterId:t,membershipType:h},!0),!a?.silent){const m=P.getItem(j.getState().itemInstances[e]?.itemHash||0);i({type:"success",message:`${m?.displayProperties?.name||"Item"} equipped`,duration:3e3})}return{success:!0,request:{itemId:e,itemHash:0,toCharacter:t,action:"equip"}}}catch(m){const f=m?.errorCode;if((m?.httpStatus===500||m?.httpStatus===504)&&!a?.silent&&!a?.silent)return Ee("Transfer",`500 error during equip of ${e}. Retrying once...`),await new Promise(E=>setTimeout(E,1e3)),this.equipItem(e,t,{...a,silent:!0});if(m?.httpStatus===500||m?.isPotentialSuccess){re("Transfer",`500 error during equip of ${e}. Verifying ghost success...`),await new Promise(p=>setTimeout(p,1500)),await Ve.loadProfile(!0);let E=j.getState().itemInstances[e];if(E?.isEquipped){if(Ee("Transfer",`Ghost success detected for ${e} equip on ${t}`),!a?.silent){const p=P.getName(E.itemHash||0)||"Item";i({type:"success",message:`${p} equipped`})}return{success:!0,request:{itemId:e,itemHash:0,toCharacter:t,action:"equip"}}}if(await new Promise(p=>setTimeout(p,1e3)),await Ve.loadProfile(!0),E=j.getState().itemInstances[e],E?.isEquipped){if(Ee("Transfer",`Ghost success detected (retry) for ${e} equip on ${t}`),!a?.silent){const p=P.getName(E.itemHash||0)||"Item";i({type:"success",message:`${p} equipped`})}return{success:!0,request:{itemId:e,itemHash:0,toCharacter:t,action:"equip"}}}}return(f===_e.DestinyItemNotFound||m?.httpStatus===500)&&(await Ve.loadProfile(!0),j.getState().itemInstances[e]?.isEquipped)?{success:!0,request:{itemId:e,itemHash:0,toCharacter:t,action:"equip"}}:(a?.silent||i({type:"error",message:m.message||"Equip failed"}),{success:!1,error:m.message,request:{itemId:e,itemHash:0,toCharacter:t,action:"equip"}})}finally{j.getState().removeActiveTransfer(e)}}async smartTransfer(e,t,a,r,i,c){const l=j.getState().getAllInventory().find(d=>d.itemInstanceId===e);return l?this.moveItem(l,this.getItemSource(l),a?"vault":r,i,c):{success:!1,error:"Not found",request:{itemId:e,itemHash:t,toCharacter:a?"vault":r,action:"transfer"}}}async snapshotLoadout(e,t){const a=await ve.getPrimaryMembership(),r=P.getDefaultLoadoutIdentifiers();if(!a||!r)return{success:!1,error:"Missing data"};try{return await lt.post(ge.endpoints.snapshotLoadout,{loadoutIndex:t,characterId:e,membershipType:a.membershipType,colorHash:r.colorHash,iconHash:r.iconHash,nameHash:r.nameHash},!0),{success:!0}}catch(i){return{success:!1,error:i.message}}}async moveItemToVault(e,t){const a=j.getState(),r=Zt([],1),i=this.findMoveAsideCandidates(t,e,r,a);return i.length>0?this.moveItem(i[0],e,"vault",r,{silent:!0}):{success:!1,error:"No candidates",request:{itemId:"",itemHash:0,toCharacter:"vault",action:"transfer"}}}async applyItemSocketOverrides(e,t,a,r){const c=j.getState().itemInstances[e];for(const[n,l]of Object.entries(t)){const d=parseInt(n);if(c?.sockets?.find(h=>h.socketIndex===d)?.plugHash!==l)try{await this.insertSocketPlugFree(e,l,d,a,{silent:!0}),await new Promise(h=>setTimeout(h,250))}catch(h){(h.httpStatus===500||h.errorCode===5)&&(await Ve.loadProfile(!0),await new Promise(m=>setTimeout(m,1e3)))}}await Ve.loadProfile(!0)}async equipItems(e,t,a=0,r){if(e.length===0)return{success:!0,failedIds:[],results:{}};if(a>2)return{success:!1,failedIds:e,results:{}};const i=j.getState(),c=i.characters.find(m=>m.characterId===t),n=i.characterEquipment[t]||[],l=e.filter(m=>!n.some(f=>f.itemInstanceId===m));if(l.length===0)return re("Transfer",`All items in bulk request are already equipped on ${t}. Skipping API call.`),{success:!0,failedIds:[],results:{}};const h=(await ve.getPrimaryMembership())?.membershipType??c?.membershipType;try{const m=await lt.post(ge.endpoints.equipItems,{itemIds:l,characterId:t,membershipType:h},!0),f={},E=[];let p=!1;return m.equipResults.forEach(R=>{f[R.itemInstanceId]=R.equipStatus,R.equipStatus===1?ve.updateLocalStore({instanceId:R.itemInstanceId,sourceId:t,targetId:t,isEquip:!0}):(E.push(R.itemInstanceId),(R.equipStatus===1634||R.equipStatus===1663)&&(p=!0))}),E.length>0&&a<2&&!p?(await new Promise(R=>setTimeout(R,2e3)),await Ve.loadProfile(!0),this.equipItems(E,t,a+1,r)):{success:E.length===0,error:p?"ORBIT_REQUIRED":void 0,failedIds:E,results:f}}catch(m){if(m?.httpStatus===500||m?.isPotentialSuccess){re("Transfer",`500 error during bulk equip on ${t}. Verifying ghost success...`),await new Promise(A=>setTimeout(A,1200)),await Ve.loadProfile(!0);const E=j.getState().characterEquipment[t]||[],p={},R=[];if(e.forEach(A=>{E.some(T=>T.itemInstanceId===A)?(p[A]=1,ve.updateLocalStore({instanceId:A,sourceId:t,targetId:t,isEquip:!0})):(R.push(A),p[A]=0)}),R.length<e.length)return Ee("Transfer",`Partial ghost success detected for bulk equip on ${t}. ${e.length-R.length} items equipped.`),{success:R.length===0,failedIds:R,results:p}}return{success:!1,error:m.message,failedIds:e,results:{}}}}async equipBuild(e,t,a,r=!1,i){return Sn(async()=>{const c=j.getState();c.selectedCharacterId!==t&&c.setSelectedCharacter(t),await Ve.loadProfile(!0);const n=j.getState(),l=n.getAllInventory(),d=[],h=(g,$,ee)=>{const z=Xa[g]??g,Ae=l.filter(Me=>Me.itemHash===z),ae=Ae.find(Me=>this.getItemSource(Me)===ee);if(ae)return ae;const Ne=Ae[0];if(Ne&&!((Ne.transferStatus&2)===2))return Ne},m=(g,$)=>{const ee=h(g,$,t);return ee||d.push($||g.toString()),ee},f=e.exoticWeapon?m(e.exoticWeapon.hash,e.exoticWeapon.name||""):void 0,E=e.exoticArmor?m(e.exoticArmor.hash,e.exoticArmor.name||""):void 0,p=n.characters.find(g=>g.characterId===t),R=[...n.characterInventories[t]||[],...n.characterEquipment[t]||[]];let A;const _=e.subclassConfig;if(_?.subclassHash){const g=Xa[_.subclassHash]??_.subclassHash;A=R.find($=>$.itemHash===g)}!A&&e.element&&(A=this.findSubclassItem(e.element,R,p?.classType)),A||d.push(`Subclass (${e.element})`),d.length>0&&!i?.silent&&Ht.getState().addToast({type:"warning",message:`Some loadout items missing: ${d.join(", ")}. Equipping remaining components.`,duration:4e3});const T=[];f&&this.itemCanBeEquippedBy(f,t)&&T.push(f),E&&this.itemCanBeEquippedBy(E,t)&&T.push(E),A&&this.itemCanBeEquippedBy(A,t)&&T.push(A),(e.items||[]).forEach(g=>{const $=m(g.hash,g.name||"");$&&this.itemCanBeEquippedBy($,t)&&T.push($)});const H=Zt(T.map(g=>g.itemInstanceId).filter(Boolean),5,t);a||(a=()=>{});let C=[];const D=[];let F=!1;const ne=[];let K=[];try{a("Dequipping Conflicts...",15);const g=T.filter(ee=>(ee.transferStatus&1)===1&&this.getItemSource(ee)!==t);for(const ee of g)try{await ve.ensureItemUnequipped(this.getItemSource(ee),ee.itemInstanceId)}catch(z){de("Transfer",`Initial dequip failed for ${ee.itemHash}`,z)}C=await this.resolveExoticConflicts(t,f,E,H),await Ve.loadProfile(!0),a("Moving Gear...",40);for(const ee of T){const z=this.getItemSource(ee);if(z!==t){let Ae=await this.moveItem(ee,z,t,H,{silent:!0});if(!Ae.success&&(await Ve.loadProfile(!0),Ae=await this.moveItem(ee,this.getItemSource(ee),t,H,{silent:!0}),!Ae.success)){const ae=P.getItem(ee.itemHash);D.push({hash:ee.itemHash,name:ae?.displayProperties?.name||ee.itemHash.toString()})}}}if(r)return{success:!0,session:H,missing:d,failed:[],equipped:[]};a("Equipping Build...",60),K=Array.from(new Set(C.concat(T).map(ee=>ee.itemInstanceId)));const $=await this.equipItems(K,t,0,{silent:!0});if($.error==="ORBIT_REQUIRED"&&(F=!0),$.failedIds?.forEach(ee=>{const z=n.itemInstances[ee];ne.push(z?.itemHash&&P.getItem(z.itemHash)?.displayProperties.name||ee)}),A&&!e.skipSubclassSwap)try{(n.characterEquipment[t]||[]).find(z=>z.bucketHash===q.SUBCLASS)?.itemInstanceId!==A.itemInstanceId&&(a("Switching Subclass...",70),await this.equipItem(A.itemInstanceId,t,{silent:!0}),await new Promise(z=>setTimeout(z,1e3)),await Ve.loadProfile(!0))}catch{F=!0,de("Transfer","Subclass pre-equip failed")}}catch(g){de("Transfer","Gear phase failure (continuing to subclass/mods)",g)}const v=[...new Set([...ne,...D.map(g=>g.name)])],W=v.length>0;if(!e.skipSocketOverrides){if(A&&e.subclassConfig){a("Configuring Subclass...",85);try{await this.applySubclassConfiguration(A,e.subclassConfig,t,g=>a(g,85),{silent:!0})}catch(g){de("Transfer",`Failed to apply subclass config: ${g}`)}}if(e.armorMods?.length){a("Applying Armor Mods...",95);try{await this.applyArmorMods(t,e.armorMods,g=>a(g,95),{silent:!0})}catch(g){de("Transfer",`Failed to apply armor mods: ${g}`)}}}if(!i?.silent){let g=`${e.name} equipped successfully!`,$="success";F?(g=`${e.name} moved, but Orbit is required to equip.`,$="warning"):(W||d.length>0)&&(g=`${e.name} applied with issues. Check notifications.`,$="warning"),Ht.getState().addToast({type:$,message:g})}return{success:!F&&!W,session:H,missing:d,failed:v,equipped:K}}).catch(c=>(de("Transfer","EquipBuild Fatal",c),{success:!1,error:c.message,missing:[],failed:[],equipped:[]}))}async moveItem(e,t,a,r,i){const c=r||Zt([e.itemInstanceId]);let n=j.getState();const l=i?.equip??!1,d=n.itemInstances[e.itemInstanceId]?.isLocked,h=(t==="vault"?n.vaultInventory.filter(T=>T.itemHash===e.itemHash&&this.getNativeBucketHash(T)===this.getNativeBucketHash(e)):[...n.characterEquipment[t]||[],...n.characterInventories[t]||[]].filter(T=>T.itemHash===e.itemHash&&T.bucketHash===e.bucketHash)).length>1,m=d!==void 0&&h?d:void 0;if(t===a)return l?this.equipItem(e.itemInstanceId,a,i):{success:!0,request:{itemId:e.itemInstanceId,itemHash:e.itemHash,toCharacter:a,action:"transfer"}};const f=t==="vault",E=a==="vault";if(!f&&!E){if((n.characterEquipment[t]||[]).some(K=>K.itemInstanceId===e.itemInstanceId)){const v=P.getItem(e.itemHash)?.tierType===6;if(Ee("Transfer",`[Charâ†’Char] Step 1: Dequipping ${e.itemHash} at source ${t} (exotic=${v})`),!await ve.ensureItemUnequipped(t,e.itemInstanceId,v,c))return de("Transfer",`Failed to dequip ${e.itemHash} at source`),{success:!1,error:"Dequip failed at source",request:{itemId:e.itemInstanceId,itemHash:e.itemHash,toCharacter:a,action:"transfer"}};await new Promise(g=>setTimeout(g,200)),n=j.getState()}Ee("Transfer",`[Charâ†’Char] Step 2: Ensuring vault space for ${e.itemHash}`);const H={id:"vault",isVault:!0,items:n.vaultInventory};if(!await this.ensureCanMoveToStore(e,H,1,c))return{success:!1,error:"No space in vault",request:{itemId:e.itemInstanceId,itemHash:e.itemHash,toCharacter:a,action:"transfer"}};Ee("Transfer",`[Charâ†’Char] Step 3: Moving ${e.itemHash} to vault`);const C=await this.moveToStore(e,t,"vault",!1,c,{silent:!0});if(!C.success)return C;await new Promise(K=>setTimeout(K,200)),n=j.getState(),Ee("Transfer",`[Charâ†’Char] Step 4: Ensuring target space + exotic conflicts for ${e.itemHash}`);const D=n.characters.find(K=>K.characterId===a);if(D){const K={...D,id:a};if(!await this.ensureValidTransfer(l,K,e,1,c))return{success:!1,error:"Cannot complete transfer to target",request:{itemId:e.itemInstanceId,itemHash:e.itemHash,toCharacter:a,action:"transfer"}}}Ee("Transfer",`[Charâ†’Char] Step 5: Moving ${e.itemHash} from vault to ${a}`);const F=await this.moveToStore(e,"vault",a,l,c,i);if(!F.success)return F;n=j.getState();const ne=(n.characterEquipment[a]||[]).some(K=>K.itemInstanceId===e.itemInstanceId);return l&&!ne?(Ee("Transfer",`[Charâ†’Char] Step 6: Final equip for ${e.itemHash}`),this.equipItem(e.itemInstanceId,a,i)):(this.handleLockStateReset(e,a,m,n),F)}if(!f&&(n.characterEquipment[t]||[]).some(H=>H.itemInstanceId===e.itemInstanceId)){const C=P.getItem(e.itemHash)?.tierType===6;if(Ee("Transfer",`[Single-hop] Dequipping ${e.itemHash} at source ${t} (exotic=${C})`),!await ve.ensureItemUnequipped(t,e.itemInstanceId,C,c))return{success:!1,error:"Dequip failed at source",request:{itemId:e.itemInstanceId,itemHash:e.itemHash,toCharacter:a,action:"transfer"}};await new Promise(F=>setTimeout(F,200)),n=j.getState()}const R=E?null:n.characters.find(T=>T.characterId===a),A=E?{id:"vault",isVault:!0,items:n.vaultInventory}:R?{...R,id:a}:null;if(A&&!await this.ensureValidTransfer(l&&!E,A,e,1,c))return{success:!1,error:"No space available",request:{itemId:e.itemInstanceId,itemHash:e.itemHash,toCharacter:a,action:"transfer"}};const _=await this.moveToStore(e,t,a,l&&!E,c,i);return this.handleLockStateReset(e,a,m,n),_}async ensureValidTransfer(e,t,a,r,i){const c=P.getItem(a.itemHash);return e&&!t.isVault&&c?.inventory?.equippingLabel&&!await this.canEquipExotic(a,t,i)?(de("Transfer",`Cannot equip exotic ${a.itemHash} on ${t.id||t.characterId}`),!1):this.ensureCanMoveToStore(a,t,r,i)}async canEquipExotic(e,t,a){const r=P.getItem(e.itemHash);if(!r?.inventory?.equippingLabel)return!0;const i=t.id||t.characterId,n=j.getState().characterEquipment[i]||[],l=r.inventory.equippingLabel;re("Transfer",`canEquipExotic: Checking for conflict with label=${l} on ${i}`);const d=n.find(m=>P.getItem(m.itemHash)?.inventory?.equippingLabel===l&&m.bucketHash!==e.bucketHash);return d?(Ee("Transfer",`canEquipExotic: Conflict found - ${d.itemHash} in bucket ${d.bucketHash}. Dequipping...`),await ve.ensureItemUnequipped(i,d.itemInstanceId,!0,a)?(Ee("Transfer",`canEquipExotic: Successfully dequipped ${d.itemHash}`),!0):(de("Transfer",`canEquipExotic: Failed to dequip conflicting exotic ${d.itemHash}`),!1)):(re("Transfer","canEquipExotic: No conflict found"),!0)}async moveToStore(e,t,a,r,i,c){const n=a==="vault",l=n?t:a,d=await this.transferItem(e.itemInstanceId,e.itemHash,n,l,1,i,{...c,silent:!0,skipSpaceCheck:!0});if(!d.success)return c?.silent||Ht.getState().addToast({type:"error",message:d.error||"Transfer failed"}),d;if(r&&!n){const h=await this.equipItem(e.itemInstanceId,a,{silent:!0});return h.success||c?.silent||Ht.getState().addToast({type:"warning",message:"Item moved but equip failed"}),h}if(!c?.silent){const h=P.getItem(e.itemHash);Ht.getState().addToast({type:"success",message:`${h?.displayProperties?.name||"Item"} moved`,duration:2e3})}return d}handleLockStateReset(e,t,a,r){if(a!==void 0){const i=Object.keys(r.characterInventories)[0],c=t==="vault"?i:t;c&&(re("Transfer",`Bungie Lock Bug: Resetting lock status of ${e.itemHash} to ${a}`),this.setItemLockState(e.itemInstanceId,c,a).catch(()=>{}))}}async ensureCanMoveToStore(e,t,a,r,i={excludes:[]}){const{excludes:c,numRetries:n=0,depth:l=0}=i;if(l>10)return de("Transfer",`Max recursion depth reached trying to make space for ${e.itemHash}`),!1;const d=j.getState(),h=["Titan","Hunter","Warlock"],m=[...d.characters.map(D=>({...D,id:D.characterId,name:h[D.classType]||"Guardian"})),{name:"Vault",id:"vault",isVault:!0,items:d.vaultInventory}],f=this.getNativeBucketHash(e),E={};E[t.id]=a;const p=this.getItemSource(e,d);p!=="vault"&&!t.isVault&&p!==t.id&&(E.vault=a);const R={};for(const D of m)if(E[D.id]){const F=this.getSpaceInBucket(f,D.id,d,r);R[D.id]=Math.max(0,E[D.id]-F),re("Transfer",`Space check for ${D.name} (${D.id}): left=${F}, reserved=${E[D.id]}, movesNeeded=${R[D.id]}`)}if(Object.values(R).every(D=>D===0))return!0;const A=Object.entries(R).reverse().filter(([D,F])=>F>0),[_]=A[0]||[];if(!_)return!0;const T=m.find(D=>D.id===_),H={originalItemType:f,excludes:c,spaceLeft:(D,F)=>{let ne=this.getSpaceInBucket(this.getNativeBucketHash(F),D.id,d,r);return D.id===t.id&&this.getNativeBucketHash(F)===f&&(ne-=a),Math.max(0,ne)}};Ee("Transfer",`Making space in ${T?.name||_} for ${e.itemHash}. Moves needed:`,R);const C=this.chooseMoveAsideItem(T,e,H,d,r);if(!C.item||!C.target)return de("Transfer",`No move-aside candidate found for bucket ${f} in ${T?.name||_}. Total possible candidates checked: ${this.findMoveAsideCandidates(f,_,r,d).length}`),!1;try{Ee("Transfer",`Moving aside ${C.item.itemHash} from ${T?.name||_} to ${C.target.name||C.target.id} to make room.`);const D=await this.moveItem(C.item,_,C.target.id,r,{silent:!0});if(!D.success)throw new Error(`Move-aside failed: ${D.error}`);return await new Promise(F=>setTimeout(F,50)),this.ensureCanMoveToStore(e,t,a,r,{excludes:c,numRetries:0,depth:l+1})}catch{return n<3?(Ee("Transfer",`Move-aside failed for ${C.item.itemHash}, retrying with exclusion.`),c.push(C.item),this.ensureCanMoveToStore(e,t,a,r,{excludes:c,numRetries:n+1,depth:l})):!1}}chooseMoveAsideItem(e,t,a,r,i){const c=this.findMoveAsideCandidates(this.getNativeBucketHash(t),e.id,i,r);if(!c.length)return{};const l=this.sortMoveAsideCandidates(c,e,r)[0],h=[...r.characters.sort((m,f)=>new Date(m.dateLastPlayed).getTime()-new Date(f.dateLastPlayed).getTime()).map(m=>({...m,id:m.characterId})),{name:"Vault",id:"vault",isVault:!0,items:r.vaultInventory}].find(m=>m.id!==e.id&&this.getSpaceInBucket(this.getNativeBucketHash(l),m.id,r,i)>0);return{item:l,target:h}}sortMoveAsideCandidates(e,t,a){const r=a.builds||[],i=new Set(r.flatMap(c=>[c.kineticWeapon?.itemInstanceId,c.energyWeapon?.itemInstanceId,c.powerWeapon?.itemInstanceId,c.helmet?.itemInstanceId,c.gauntlets?.itemInstanceId,c.chestArmor?.itemInstanceId,c.legArmor?.itemInstanceId,c.classArmor?.itemInstanceId]).filter(Boolean));return e.sort((c,n)=>{const l=i.has(c.itemInstanceId)?1:0,d=i.has(n.itemInstanceId)?1:0;if(l!==d)return l-d;const h=(a.characterEquipment[t.id]||[]).some(A=>A.itemInstanceId===c.itemInstanceId),m=(a.characterEquipment[t.id]||[]).some(A=>A.itemInstanceId===n.itemInstanceId);if(h!==m)return h?1:-1;const f=c.tierType||0,E=n.tierType||0;if(f!==E)return f-E;const p=a.itemInstances[c.itemInstanceId]?.power||0,R=a.itemInstances[n.itemInstanceId]?.power||0;return p!==R?p-R:0})}getSpaceInBucket(e,t,a,r){const i=r?.reservations?.[t]?.[e]||0;if(t==="vault"){if([q.KINETIC_WEAPONS,q.ENERGY_WEAPONS,q.POWER_WEAPONS,q.HELMET,q.GAUNTLETS,q.CHEST_ARMOR,q.LEG_ARMOR,q.CLASS_ARMOR,q.GHOST,q.VEHICLE,q.SHIPS].includes(e)){const h=a.vaultInventory.filter(m=>{const f=this.getNativeBucketHash(m);return![q.CONSUMABLES,q.MODIFICATIONS].includes(f)}).length;return Math.max(0,En-(h+i))}if(e===q.CONSUMABLES){const h=a.vaultInventory.filter(m=>this.getNativeBucketHash(m)===q.CONSUMABLES).length;return Math.max(0,50-(h+i))}if(e===q.MODIFICATIONS){const h=a.vaultInventory.filter(m=>this.getNativeBucketHash(m)===q.MODIFICATIONS).length;return Math.max(0,50-(h+i))}return 0}const n=(a.characterInventories[t]||[]).filter(d=>this.getNativeBucketHash(d)===e).length;let l=(pn[e]||10)-(n+i);return(pa.has(e)||e===q.CONSUMABLES)&&(l-=1),Math.max(0,l)}findMoveAsideCandidates(e,t,a,r){const i=t==="vault",c=i?[]:r.characterEquipment[t]||[],n=i?[]:r.characterInventories[t]||[],l=i?r.vaultInventory:[...n,...c],d=l.filter(h=>{const m=this.getNativeBucketHash(h);if(i){const f=E=>![q.CONSUMABLES,q.MODIFICATIONS].includes(E);if(f(e)&&!f(m)||e===q.CONSUMABLES&&m!==q.CONSUMABLES||e===q.MODIFICATIONS&&m!==q.MODIFICATIONS)return!1}else if(m!==e)return!1;return!(a.involvedItems.has(h.itemInstanceId)||!i&&h.location!==1)});return d.length===0&&l.length>0&&Ee("Transfer",`No candidates found in ${t} for bucket ${e}. Total items checked: ${l.length}. Involved: ${a.involvedItems.size}`),d.sort((h,m)=>{const f=c.some(p=>p.itemInstanceId===h.itemInstanceId),E=c.some(p=>p.itemInstanceId===m.itemInstanceId);return f!==E?f?1:-1:h.tierType!==m.tierType?(h.tierType||0)-(m.tierType||0):(r.itemInstances[h.itemInstanceId]?.power||0)-(r.itemInstances[m.itemInstanceId]?.power||0)})}async orchestrateBulkDequip(e,t){const i=(j.getState().characterEquipment?.[e]||[]).filter(c=>{const n=t.find(h=>h.bucketHash===c.bucketHash);if(!n)return!1;const l=P.getItem(n.itemHash),d=P.getItem(c.itemHash);return l?.tierType===6&&d?.tierType===6});for(const c of i)await ve.ensureItemUnequipped(e,c.itemInstanceId,!0);return!0}async resolveExoticConflicts(e,t,a,r){const i=[],c=j.getState(),n=c.characters.find(h=>h.characterId===e),l=c.characterEquipment?.[e]||[],d=async h=>{if(!h)return;const m=P.getItem(h.itemHash),f=l.find(E=>P.getItem(E.itemHash)?.inventory?.equippingLabel===m?.inventory?.equippingLabel&&E.itemInstanceId!==h.itemInstanceId);if(f){const E=this.findReplacementItem(f.bucketHash,e,r.involvedItems,n?.classType);if(E){const p=this.getItemSource(E,c);p!==e&&await this.moveItem(E,p,e,r,{silent:!0}),await this.equipItem(E.itemInstanceId,e,{silent:!0}),i.push(E),r.involvedItems.add(E.itemInstanceId)}}};return await d(t),await d(a),i}searchForSimilarItem(e,t,a=new Set,r,i=!0){const c=j.getState(),n=[...c.vaultInventory,...Object.entries(c.characterInventories).flatMap(([d,h])=>h)],l=n.filter(d=>{const h=this.getNativeBucketHash(d),m=P.getItem(d.itemHash),f=(c.characterEquipment[this.getItemSource(d,c)]||[]).some(E=>E.itemInstanceId===d.itemInstanceId);return h===e.bucketHash&&!f&&!a.has(d.itemInstanceId)&&(d.transferStatus&2)===0&&(!i||m?.tierType!==6)&&(r===void 0||m?.classType===r||m?.classType===3)});if(l.length===0){Ee("Transfer",`searchForSimilarItem: No candidates for bucket ${e.bucketHash}. Checked ${n.length} items. ExcludeExotic: ${i}`);return}return l.sort((d,h)=>{const m=a.has(d.itemInstanceId)?1:0,f=a.has(h.itemInstanceId)?1:0;if(m!==f)return m-f;const E=d.tierType||0,p=h.tierType||0;if(E!==p)return E===6?1:p===6?-1:p-E;const R=this.getItemSource(d,c),A=this.getItemSource(h,c),_=C=>C===t?0:C==="vault"?1:2;if(_(R)!==_(A))return _(R)-_(A);const T=c.itemInstances[d.itemInstanceId]?.power||0;return(c.itemInstances[h.itemInstanceId]?.power||0)-T})[0]}findReplacementItem(e,t,a=new Set,r,i=!0){return this.searchForSimilarItem({bucketHash:e},t,a,r,i)}findSubclassItem(e,t,a){if(!e)return;const r=e.toLowerCase(),i=$r[r.toUpperCase()];return t.find(c=>{if(c.bucketHash!==q.SUBCLASS)return!1;const n=P.getItem(c.itemHash);return!n||a!==void 0&&n.classType!==a&&n.classType!==3?!1:i&&n.defaultDamageTypeHash===i?!0:(n.displayProperties?.name||"").toLowerCase().includes(r)})}async applyArmorMods(e,t,a,r){await Ja.applyArmorMods(e,t,a,r)}async applySubclassConfiguration(e,t,a,r,i){await Ja.applySubclassConfiguration(e,t,a,r,i)}async setItemLockState(e,t,a){const r=j.getState().characters.find(n=>n.characterId===t)||j.getState().characters[0];if(!r)return!1;const c=(await ve.getPrimaryMembership())?.membershipType??r.membershipType;try{return await lt.post(ge.endpoints.setLockState,{state:a,itemId:e,characterId:r.characterId,membershipType:c},!0),!0}catch{return!1}}async insertSocketPlugFree(e,t,a,r,i){const c=j.getState(),n=c.characters.find(f=>f.characterId===r);if(!n)return{success:!1};if(c.itemInstances[e]?.sockets?.find(f=>f.socketIndex===a)?.plugHash===t)return re("Transfer",`Socket ${a} already has plug ${t}, skipping API call`),{success:!0};const m=(await ve.getPrimaryMembership())?.membershipType??n.membershipType;ve.updateLocalSocketPlug(e,a,t);try{const f=await lt.post(ge.endpoints.insertSocketPlugFree,{itemId:e,plug:{plugItemHash:t,socketIndex:a,socketArrayType:0},characterId:r,membershipType:m},!0);return f&&ve.updateItemFromChange(e,f),{success:!0}}catch(f){if(f?.httpStatus===500||f?.isPotentialSuccess){re("Transfer",`500 error during socket plug of ${t}. Verifying ghost success...`),await new Promise(T=>setTimeout(T,1500)),await Ve.loadProfile(!0);let R=j.getState(),A=R.itemInstances[e],_=A?.sockets?.find(T=>T.socketIndex===a);if(_?.plugHash===t)return Ee("Transfer",`Ghost success detected for socket plug ${t} on item ${e}`),{success:!0};if(await new Promise(T=>setTimeout(T,1e3)),await Ve.loadProfile(!0),R=j.getState(),A=R.itemInstances[e],_=A?.sockets?.find(T=>T.socketIndex===a),_?.plugHash===t)return Ee("Transfer",`Ghost success detected (retry) for socket plug ${t} on item ${e}`),{success:!0}}const E=f?.ErrorCode||f?.bungieErrorCode?.(),p=E===1618||E===1663||E===1634||E===1642;return p||E===1640?re("Transfer",`Socket plug restricted: ${E} for item ${e}, socket ${a}${p?" - STOPPING":""}`):f?.httpStatus===500?re("Transfer",`Socket plug server error for item ${e}, socket ${a}: ${f.message}`):de("Transfer",`Socket plug failed for item ${e}, socket ${a}:`,f),{success:!1,stop:p}}}getNativeBucketHash(e){return pa.has(e.bucketHash)?e.bucketHash:P.getItem(e.itemHash)?.inventory?.bucketTypeHash||e.bucketHash}getItemSource(e,t){const a=t||j.getState();if(a.vaultInventory?.some(r=>r.itemInstanceId===e.itemInstanceId))return"vault";for(const[r,i]of Object.entries(a.characterInventories))if(i.some(c=>c.itemInstanceId===e.itemInstanceId))return r;for(const[r,i]of Object.entries(a.characterEquipment))if(i.some(c=>c.itemInstanceId===e.itemInstanceId))return r;return""}itemCanBeEquippedBy(e,t){const r=j.getState().characters.find(c=>c.characterId===t);if(!r)return!1;const i=P.getItem(e.itemHash);return!(!i||!i.equippable&&!i.inventory?.equippable&&!pa.has(e.bucketHash)||!this.isClassCompatible(i.classType,r.classType))}isClassCompatible(e,t){return e===3||t===3||e===t}}const pt=new An,Za=new WeakMap;function Tn(o,e){let t=Za.get(e);if(t)return t;const a=new Map;for(const r of o)a.has(r.bucketHash)||a.set(r.bucketHash,[]),a.get(r.bucketHash).push(r);return Za.set(e,a),a}class Rn{activeCharacterId=null;membershipCache=null;membershipCacheTime=0;findItemsByBucket(e,t){return Tn(e.items,e).get(t)||[]}updateLocalStore(e){const t=j.getState(),{characterInventories:a,characterEquipment:r,vaultInventory:i}=t;let c=null;const n=[...i],l={...a},d={...r},h=m=>{const f=m.findIndex(E=>E.itemInstanceId===e.instanceId);return f!==-1?(c={...m[f]},m.splice(f,1),!0):!1};if(!h(n)){for(const m of Object.keys(l)){const f=[...l[m]||[]];if(h(f)){l[m]=f;break}}if(!c)for(const m of Object.keys(d)){const f=[...d[m]||[]];if(h(f)){d[m]=f;break}}}if(c){if(e.customAction&&e.customAction(c),e.targetId==="vault")n.push(c);else if(e.isEquip){const m=[...d[e.targetId]||[]],E=P.getItem(c.itemHash)?.inventory?.equippingLabel,p=m.findIndex(R=>R.bucketHash===c.bucketHash);if(p!==-1){const R=m.splice(p,1)[0];l[e.targetId]=[...l[e.targetId]||[],R]}if(E){const R=m.findIndex(A=>P.getItem(A.itemHash)?.inventory?.equippingLabel===E);if(R!==-1){const A=m.splice(R,1)[0];l[e.targetId]=[...l[e.targetId]||[],A]}}m.push(c),d[e.targetId]=m}else l[e.targetId]=[...l[e.targetId]||[],c];j.setState({vaultInventory:n,characterInventories:l,characterEquipment:d,responseMintedTimestamp:new Date().toISOString(),lastUpdated:Date.now()})}}updateItemFromChange(e,t){const a=j.getState(),r=t.item;if(!r)return;const i={...a.itemInstances};if(i[e]){const m=r,f=i[e].sockets;i[e]={...i[e],power:m.primaryStat?.value,damageType:m.damageType,isEquipped:m.isEquipped,sockets:f}}const c=m=>{const f=m.findIndex(E=>E.itemInstanceId===e);return f!==-1?(m[f]={...m[f],...r,tierType:P.getItem(r.itemHash)?.inventory?.tierType||0},!0):!1},n=[...a.vaultInventory],l={...a.characterInventories},d={...a.characterEquipment};let h=c(n);if(!h)for(const m of Object.keys(l)){const f=[...l[m]||[]];if(c(f)){l[m]=f,h=!0;break}}if(!h)for(const m of Object.keys(d)){const f=[...d[m]||[]];if(c(f)){d[m]=f,h=!0;break}}j.setState({itemInstances:i,vaultInventory:n,characterInventories:l,characterEquipment:d,lastUpdated:Date.now()})}async getActiveCharacterId(){if(this.activeCharacterId)return this.activeCharacterId;const e=await this.getProfile();if(!e?.characters?.data)return null;const t=Object.values(e.characters.data).sort((a,r)=>new Date(r.dateLastPlayed).getTime()-new Date(a.dateLastPlayed).getTime());return this.activeCharacterId=t[0]?.characterId||null}async getProfile(){if(!await xe.getAuthTokens())return null;const t=await this.getPrimaryMembership();if(!t)return null;try{const a=[100,102,201,205,200,202,204,206,300,301,304,305,900,1100,1400,1401];return await lt.request(`/Destiny2/${t.membershipType}/Profile/${t.membershipId}/?components=${a.join(",")}`,{requiresAuth:!0})}catch{return null}}async getPrimaryMembership(){if(this.membershipCache&&Date.now()-this.membershipCacheTime<3e5)return this.membershipCache;try{const e=await lt.request("/User/GetMembershipsForCurrentUser/",{requiresAuth:!0}),t=e.destinyMemberships.find(a=>a.membershipId===e.primaryMembershipId)||e.destinyMemberships[0];return this.membershipCacheTime=Date.now(),this.membershipCache={membershipId:t.membershipId,membershipType:t.membershipType,displayName:t.displayName,bungieGlobalDisplayName:e.bungieNetUser?.cachedBungieGlobalDisplayName||t.displayName,bungieGlobalDisplayNameCode:e.bungieNetUser?.cachedBungieGlobalDisplayNameCode||0}}catch{return null}}async getClanInfo(){const e=await this.getPrimaryMembership();if(!e)return null;try{return(await lt.get(`/GroupV2/User/${e.membershipType}/${e.membershipId}/0/1/`,!0))?.results?.[0]?.group?.name||null}catch{return null}}formatForStore(e){const t={},a={},r={};e.characterInventories?.data&&Object.entries(e.characterInventories.data).forEach(([p,R])=>t[p]=R.items.map(A=>({...A,tierType:P.getItem(A.itemHash)?.inventory?.tierType||0}))),e.characterEquipment?.data&&Object.entries(e.characterEquipment.data).forEach(([p,R])=>a[p]=R.items.map(A=>({...A,tierType:P.getItem(A.itemHash)?.inventory?.tierType||0})));const i=(e.profileInventory?.data?.items||[]).map(p=>({...p,tierType:P.getItem(p.itemHash)?.inventory?.tierType||0}));e.itemComponents?.instances?.data&&Object.entries(e.itemComponents.instances.data).forEach(([p,R])=>{r[p]={power:R.primaryStat?.value,damageType:R.damageType,isEquipped:R.isEquipped,isLocked:R.isLocked,canEquip:R.canEquip,energy:{...R.energy,isArtifice:e.itemComponents.sockets?.data?.[p]?.sockets.some(A=>A.plugHash===3727270518)||!1},sockets:(e.itemComponents.sockets?.data?.[p]?.sockets||[]).map((A,_)=>({...A,socketIndex:_,plugName:P.getName(A.plugHash||0),plugIcon:P.getIcon(A.plugHash||0)})),objectives:e.itemComponents.objectives?.data?.[p]?.objectives||[]}}),e.itemComponents?.stats?.data&&Object.entries(e.itemComponents.stats.data).forEach(([p,R])=>{r[p]||(r[p]={sockets:[]});const A={total:0};Object.values(R.stats).forEach(_=>{_.statHash===ms.MOBILITY&&(A.mobility=_.value),_.statHash===ms.RESILIENCE&&(A.resilience=_.value),_.statHash===ms.RECOVERY&&(A.recovery=_.value),_.statHash===ms.DISCIPLINE&&(A.discipline=_.value),_.statHash===ms.INTELLECT&&(A.intellect=_.value),_.statHash===ms.STRENGTH&&(A.strength=_.value)}),r[p].stats=A});const c=Object.keys(e.characterProgressions?.data||{})[0],n=e.profileCommendations?.data,l=n?.totalScore||0,d=n?.commendationNodeScoresByHash||{},h=n?.commendationNodePercentagesByHash||{},m=n?.scoreDetailValues||[],f=m[0]||0,E=m[1]||0;return{characterInventories:t,characterEquipment:a,vaultInventory:i,itemInstances:r,activeSeasonRank:c&&e.characterProgressions.data[c]?.progressions["362041442"]?.level||0,responseMintedTimestamp:e.responseMintedTimestamp,commendationScore:l,commendationNodeScores:d,commendationNodePercentages:h,commendationsSent:E,commendationsReceived:f}}async getItemSockets(e){const a=j.getState().itemInstances[e];if(a?.sockets?.length)return{sockets:a.sockets};const r=await this.getPrimaryMembership();if(!r)return{sockets:[]};try{return{sockets:(await lt.request(`/Destiny2/${r.membershipType}/Profile/${r.membershipId}/Item/${e}/?components=305`,{requiresAuth:!0})).sockets?.data?.sockets||[]}}catch{return{sockets:[]}}}updateLocalSocketPlug(e,t,a){const r=P.getName(a),i=P.getIcon(a);j.getState().updateItemSocket(e,t,a,r,i)}async ensureItemUnequipped(e,t,a=!1,r){re("Transfer",`ensureItemUnequipped: char=${e} item=${t} excludeExotic=${a}`);const i=j.getState(),n=i.getAllInventory().find(R=>R.itemInstanceId===t);if(!n)return re("Transfer","ensureItemUnequipped: item not found in inventory, returning true"),!0;if(!(i.characterEquipment?.[e]||[]).some(R=>R.itemInstanceId===t))return re("Transfer",`ensureItemUnequipped: item not equipped on ${e}, returning true`),!0;re("Transfer",`ensureItemUnequipped: item ${n.itemHash} IS equipped on ${e}, finding replacement...`);const d=n.bucketHash,h=i.characters.find(R=>R.characterId===e),m=i.characterInventories[e]||[];let f=m.find(R=>{if(R.bucketHash!==d||R.itemInstanceId===t||r?.involvedItems?.has(R.itemInstanceId))return!1;const A=P.getItem(R.itemHash);return!(a&&A?.tierType===6||h?.classType!==void 0&&A?.classType!==3&&A?.classType!==h.classType)});if(f||(re("Transfer","ensureItemUnequipped: no local replacement, searching globally..."),f=pt.findReplacementItem(d,e,new Set([t,...r?.involvedItems||[]]),h?.classType,a)),!f)return de("Transfer",`ensureItemUnequipped: failed to find replacement item for bucket ${d} on character ${e}`),!1;re("Transfer",`ensureItemUnequipped: found replacement ${f.itemHash} (${f.itemInstanceId})`);const E=pt.getItemSource(f);if(E!==e){Ee("Transfer",`Moving replacement ${f.itemInstanceId} from ${E} to ${e}`);const R=r||Zt([f.itemInstanceId,t],3,e);if(R.involvedItems.add(t),R.involvedItems.add(f.itemInstanceId),m.filter(C=>C.bucketHash===d).length>=10-1){const C=m.filter(D=>D.bucketHash===d&&D.itemInstanceId!==t&&!R.involvedItems.has(D.itemInstanceId));if(C.length>0){C.sort((ne,K)=>{const v=ne.tierType||0,W=K.tierType||0;if(v!==W)return v-W;const g=i.itemInstances[ne.itemInstanceId]?.power||0,$=i.itemInstances[K.itemInstanceId]?.power||0;return g-$});const D=C[0];Ee("Transfer",`Pre-emptive space-making: moving ${D.itemInstanceId} to vault before dequip`);const F=await pt.moveItem(D,e,"vault",R,{silent:!0});if(!F.success)return de("Transfer",`Failed to make space for dequip replacement: ${F.error}`),!1}else return de("Transfer",`No items to move aside for dequip space-making in bucket ${d}`),!1}const T=await pt.moveItem(f,E,e,R,{silent:!0});if(!T.success)return de("Transfer",`Failed to move replacement item ${f.itemInstanceId} to ${e}: ${T.error}`),!1;if(await Ve.loadProfile(!0),f=j.getState().getAllInventory().find(C=>C.itemInstanceId===f?.itemInstanceId),!f)return de("Transfer",`Replacement item ${t} disappeared after move refresh`),!1}re("Transfer",`ensureItemUnequipped: equipping replacement ${f.itemInstanceId} via updateLocalStore + API`),this.updateLocalStore({instanceId:f.itemInstanceId,sourceId:e,targetId:e,isEquip:!0});const p=await this.equipItemInstance(e,f.itemInstanceId);return re("Transfer",`ensureItemUnequipped: equipItemInstance returned ${p}`),p}async equipItemInstance(e,t){re("Transfer",`equipItemInstance: char=${e} item=${t}`);const a=await this.getPrimaryMembership();if(!a)return de("Transfer","equipItemInstance: no membership found"),!1;try{return await lt.post("/Destiny2/Actions/Items/EquipItem/",{itemId:t,characterId:e,membershipType:a.membershipType},!0),re("Transfer","equipItemInstance: API call succeeded"),!0}catch(r){return de("Transfer","equipItemInstance: API call failed",r),!1}}async transferItem(e,t,a,r){const i=await this.getPrimaryMembership();if(!i)return!1;try{return await lt.post("/Destiny2/Actions/Items/TransferItem/",{itemReferenceHash:e,stackSize:1,transferToVault:a,itemId:t,characterId:r,membershipType:i.membershipType},!0),!0}catch{return!1}}}const ve=new Rn;class In{loadPromise=null;isLoading=!1;autoRefreshTimeout=null;isAutoRefreshing=!1;async loadProfile(e=!1,t=0){return this.loadPromise?e?(await this.loadPromise,this.loadProfile(!0,t)):this.loadPromise:(this.isLoading=!0,j.getState().setLoading(!0),this.loadPromise=(async()=>{try{const a=await ve.getProfile();if(!a)return!1;const r=j.getState(),i=ve.formatForStore(a);r.setInventories(i)===Zs.DISCARDED_STALE&&t===0&&setTimeout(()=>this.loadProfile(!1,1),5e3);const n=a.profile?.data?.currentGuardianRank||0,l=a.profile?.data?.lifetimeScore||0;j.setState({currentGuardianRank:n,lifetimeScore:l}),r.setCharacters(a.characters.data?Object.values(a.characters.data).sort((m,f)=>new Date(f.dateLastPlayed).getTime()-new Date(m.dateLastPlayed).getTime()).map(m=>({...m,guardianRank:n,seasonRank:i.activeSeasonRank||0})):[]);const d=j.getState();d.selectedCharacterId&&!d.characters.some(m=>m.characterId===d.selectedCharacterId)&&(je("Profile","Selected character no longer valid after profile refresh, resetting..."),d.setSelectedCharacter(d.characters[0]?.characterId||null));const{ghostFarming:h}=Ns.getState();return h&&!e&&t===0&&this.runFarmingCheck(),!0}catch(a){return a instanceof Wt&&a.errorCode===_e.SystemDisabled&&console.warn("[ProfileLoader] Maintenance detected during profile load."),!1}finally{this.isLoading=!1,j.getState().setLoading(!1),this.loadPromise=null}})(),this.loadPromise)}async runFarmingCheck(){const e=j.getState(),t=e.characters;for(const a of t){const r=[1498876634,2465295065,953998645,3448274439,3551918588,14239492,20886954,1585787867];for(const i of r)ve.findItemsByBucket({items:[...e.characterInventories[a.characterId]||[],...e.characterEquipment[a.characterId]||[]]},i).length>=9&&(console.log(`[Farming] Bucket ${i} is almost full on ${a.characterId}. Moving item to vault...`),await pt.moveItemToVault(a.characterId,i))}}startAutoRefresh(e=3e4){if(this.isAutoRefreshing)return;this.isAutoRefreshing=!0;const t=()=>{document.hidden?this.stopAutoRefresh(!0):this.triggerImmediateRefresh()};document.addEventListener("visibilitychange",t),window.addEventListener("online",()=>this.triggerImmediateRefresh()),this.scheduleNextRefresh(e)}scheduleNextRefresh(e){this.stopAutoRefresh(!0),this.isAutoRefreshing&&(this.autoRefreshTimeout=setTimeout(async()=>{const t=Qs.getState().isMaintenance;!document.hidden&&j.getState().activeTransfers.size===0&&!t&&await this.loadProfile(),this.scheduleNextRefresh(e)},e))}triggerImmediateRefresh(){this.autoRefreshTimeout&&clearTimeout(this.autoRefreshTimeout),this.loadProfile(),this.scheduleNextRefresh(3e4)}stopAutoRefresh(e=!1){this.autoRefreshTimeout&&(clearTimeout(this.autoRefreshTimeout),this.autoRefreshTimeout=null),e||(this.isAutoRefreshing=!1)}get loading(){return this.isLoading}}const Ve=new In,ri=Object.freeze(Object.defineProperty({__proto__:null,profileLoader:Ve,profileService:ve},Symbol.toStringTag,{value:"Module"}));function $e(o){if(o){if(o.includes("https://www.bungie.net")&&o.startsWith("https://www.bungie.net")){if(o.indexOf("https",10)>-1){const t=o.indexOf("/common");if(t>-1)return`https://www.bungie.net${o.substring(t)}`}return o}return o.startsWith("/")?`https://www.bungie.net${o}`:o.startsWith("http")?o:`https://www.bungie.net/${o}`}}class gn{lastFullRefresh=0;heartbeatTimer=null;isRefreshing=!1;FULL_REFRESH_STALE_THRESHOLD=300*1e3;DELTA_REFRESH_STALE_THRESHOLD=90*1e3;HEARTBEAT_INTERVAL=180*1e3;init(){document.addEventListener("visibilitychange",()=>this.handleVisibilityChange()),window.addEventListener("online",()=>this.handleOnline()),this.startHeartbeat(),this.refresh()}handleVisibilityChange(){if(document.hidden)this.stopHeartbeat();else{this.startHeartbeat();const e=Date.now()-this.lastFullRefresh;e>this.FULL_REFRESH_STALE_THRESHOLD?this.refresh(!0):e>this.DELTA_REFRESH_STALE_THRESHOLD&&this.refresh(!1)}}handleOnline(){this.refresh(!0)}startHeartbeat(){this.stopHeartbeat(),this.heartbeatTimer=window.setInterval(()=>{this.refresh(!1)},this.HEARTBEAT_INTERVAL)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}async refresh(e=!0){if(this.isRefreshing)return;const t=j.getState();if(t.isEquipping)return;const a=Qs.getState();if(!a.isAuthenticated&&!t.characters.length){this.isRefreshing=!1;return}if(!(!t.setInventories||a.isMaintenance)){this.isRefreshing=!0;try{if(e){const i=await ve.getProfile();if(i){const c=ve.formatForStore(i);t.setInventories(c),i.characters?.data&&t.setCharacters(Object.values(i.characters.data)),this.lastFullRefresh=Date.now()}}else{const i=await ve.getProfile();if(i){const c=ve.formatForStore(i);t.setInventories(c),i.characters?.data&&t.setCharacters(Object.values(i.characters.data))}}}catch{}finally{this.isRefreshing=!1}}}async triggerImmediateSync(){await new Promise(e=>setTimeout(e,800)),this.refresh(!1)}}const ni=new gn;function ii(){const{toasts:o,removeToast:e}=Ht();return o.length===0?null:S.jsx("div",{className:"toast-container",children:o.map(t=>S.jsxs("div",{className:`toast toast--${t.type}`,role:"alert",style:{"--duration":`${t.duration??5e3}ms`},children:[S.jsx("div",{className:"toast__progress-inward"}),S.jsx("div",{className:"toast__icon",children:yn(t.type)}),S.jsxs("div",{className:"toast__content",children:[t.type==="alert"&&S.jsx("div",{className:"toast__alert-title",children:"SERVICE ALERT"}),t.type==="success"&&S.jsx("div",{className:"toast__alert-title",children:"TRANSFER COMPLETE"}),t.type==="error"&&S.jsx("div",{className:"toast__alert-title",children:"TRANSFER FAILED"}),t.type==="lock"&&S.jsx("div",{className:"toast__alert-title",children:"ITEM LOCKED"}),t.type==="unlock"&&S.jsx("div",{className:"toast__alert-title",children:"ITEM UNLOCKED"}),S.jsx("p",{className:"toast__message",children:t.message})]}),S.jsx("button",{className:"toast__close",onClick:()=>e(t.id),"aria-label":"Dismiss",children:S.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:S.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]},t.id))})}function yn(o){switch(o){case"success":return S.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:S.jsx("path",{d:"M20 6L9 17l-5-5"})});case"error":return S.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[S.jsx("circle",{cx:"12",cy:"12",r:"10"}),S.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]});case"warning":return S.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[S.jsx("path",{d:"M12 9v4M12 17h.01"}),S.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})]});case"alert":return S.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[S.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"#dc2626"}),S.jsx("path",{d:"M12 7v6M12 16h.01",fill:"none",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round"})]});case"lock":return S.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#dc2626",strokeWidth:"2.5",children:[S.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),S.jsx("path",{d:"M7 11V7a5 5 0 0110 0v4"})]});case"unlock":return S.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#22c55e",strokeWidth:"2.5",children:[S.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),S.jsx("path",{d:"M7 11V7a5 5 0 019.9-1"})]});default:return S.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[S.jsx("circle",{cx:"12",cy:"12",r:"10"}),S.jsx("path",{d:"M12 16v-4M12 8h.01"})]})}}function Nn(){const o=Ht(e=>e.addToast);return{success:e=>o({type:"success",message:e}),error:e=>o({type:"error",message:e}),warning:e=>o({type:"warning",message:e}),info:e=>o({type:"info",message:e}),alert:e=>o({type:"alert",message:e})}}function On(o,e){return o.find(t=>t.bucketHash===e)}function oi(o){const e=On(o,q.SUBCLASS);return e?Cn(e.itemHash):"void"}function Cn(o){const e=P.getItem(o);if(!e)return"void";const a={2:"arc",3:"solar",4:"void",6:"stasis",7:"strand",8:"prismatic"}[e.defaultDamageType||0];if(!a){const r=e.displayProperties?.name?.toLowerCase()||"";if(/\bprismatic\b/.test(r))return"prismatic";if(/\bsolar\b/.test(r))return"solar";if(/\bvoid\b/.test(r))return"void";if(/\barc\b/.test(r))return"arc";if(/\bstasis\b/.test(r))return"stasis";if(/\bstrand\b/.test(r))return"strand"}return a||"void"}function ci(o,e){const t={mobility:0,resilience:0,recovery:0,discipline:0,intellect:0,strength:0,total:0},a=[q.HELMET,q.GAUNTLETS,q.CHEST_ARMOR,q.LEG_ARMOR,q.CLASS_ARMOR];return o.filter(r=>a.includes(r.bucketHash)).forEach(r=>{if(!r.itemInstanceId)return;const i=e[r.itemInstanceId];i?.stats&&(t.mobility+=i.stats.mobility||0,t.resilience+=i.stats.resilience||0,t.recovery+=i.stats.recovery||0,t.discipline+=i.stats.discipline||0,t.intellect+=i.stats.intellect||0,t.strength+=i.stats.strength||0)}),t.total=t.mobility+t.resilience+t.recovery+t.discipline+t.intellect+t.strength,t}function Ks(o){const e=o.tierType;return e===6?"exotic":e===5?"legendary":e===4?"rare":e===3?"uncommon":"common"}function ga({tier:o}){if(!o||o<=0)return null;const e=Math.min(o,5);return S.jsx("div",{className:`tier-badge tier-badge--${e}`,children:Array.from({length:5}).map((t,a)=>S.jsx("svg",{className:`tier-badge__star ${a<e?"active":"inactive"}`,viewBox:"0 0 24 24",fill:"currentColor",children:S.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})},a))})}const Ar=I.createContext(null);function li({children:o}){const[e,t]=I.useState({item:null,instance:null}),[a,r]=I.useState({x:0,y:0}),[i,c]=I.useState(!1),n=I.useRef(null),l=I.useRef(null),d=I.useRef(null),h=I.useRef({x:0,y:0}),m=I.useRef(!1),f=I.useRef(!1);I.useEffect(()=>{m.current=!!e.isFocused,f.current=!!e.isHud},[e.isFocused,e.isHud]),I.useEffect(()=>{const H=C=>{!i||m.current||f.current||(h.current={x:C.clientX,y:C.clientY},d.current&&cancelAnimationFrame(d.current),d.current=requestAnimationFrame(()=>{r({x:h.current.x,y:h.current.y})}))};return window.addEventListener("mousemove",H,{passive:!0}),()=>{window.removeEventListener("mousemove",H),d.current&&cancelAnimationFrame(d.current)}},[i,e]);const E=I.useCallback((H,C,D,F,ne,K,v,W,g,$,ee)=>{l.current&&(clearTimeout(l.current),l.current=null),m.current=!!F,f.current=!!v,t(z=>z.item?.itemInstanceId===H.itemInstanceId&&z.overrideElement===D&&z.isFocused===F&&z.isHud===v&&z.fixedPosition?.x===W?.x&&z.fixedPosition?.y===W?.y&&z.hideStats===g?z:{item:H,instance:C||null,overrideElement:D,isFocused:F,onTransfer:ne,onEquip:K,isHud:v,fixedPosition:W,hideStats:g,onRightClick:$,hideSynergizeAction:ee}),c(!0)},[]),p=I.useCallback(()=>{l.current=window.setTimeout(()=>{c(!1),setTimeout(()=>{t({item:null,instance:null})},50)},30)},[]),R=I.useCallback(()=>{t(H=>({...H,showTransferMenu:!0}))},[]),_=(()=>{if(e.isHud){if(e.fixedPosition){const $=n.current?.offsetWidth||0,ee=n.current?.offsetHeight||0;let z=e.fixedPosition.x,Ae=e.fixedPosition.y-ee/2-40;const ae=180;return z+$>window.innerWidth-15&&(z=window.innerWidth-$-15),Ae+ee>window.innerHeight-20&&(Ae=window.innerHeight-ee-20),z=Math.max(10,z),Ae=Math.max(ae,Ae),{x:z,y:Ae}}return{x:40,y:180}}if(!n.current||!i)return{x:a.x+25,y:180};const H=25,C=-25,D=n.current.offsetWidth,F=n.current.offsetHeight,ne=180;let K=a.x+H,v=Math.max(ne,a.y+C);return K+D>window.innerWidth-20&&(K=a.x-D-H),v+F>window.innerHeight-250&&(v=window.innerHeight-F-250),K=Math.max(10,Math.min(K,window.innerWidth-D-10)),v=Math.max(ne,v),{x:K,y:v}})(),T={position:"fixed",left:`${_.x}px`,top:`${_.y}px`,pointerEvents:e.isFocused||e.isHud?"auto":"none",zIndex:e.isFocused||e.isHud?500:99999,opacity:i&&e.item?1:0,transition:e.isHud||e.fixedPosition?"opacity 0.05s ease-out":"opacity 0.05s ease-out, left 0.15s ease-out, top 0.15s ease-out"};return S.jsxs(Ar.Provider,{value:{showTooltip:E,hideTooltip:p,openTransferMenu:R},children:[o,Ut.createPortal(S.jsx("div",{ref:n,style:T,children:e.item&&S.jsx(Xs,{item:e.item,instance:e.instance,overrideElement:e.overrideElement,isFocused:e.isFocused,onTransfer:e.onTransfer,onEquip:e.onEquip,externalShowTransferMenu:e.showTransferMenu,followMouse:!1,inline:!0,hideStats:e.hideStats,onRightClick:e.onRightClick,hideSynergizeAction:e.hideSynergizeAction})}),document.body)]})}function _n(){const o=I.useContext(Ar);if(!o)throw new Error("useTooltip must be used within TooltipProvider");return o}const se={KINETIC:{ACE_OF_SPADES:347366834,AGERS_SCEPTER:1833195496,ALETHONYM:2350354266,ARBALEST:2130065553,BAD_JUJU:2816212794,BASTION:2415517654,CERBERUS_PLUS_1:1541131350,CHAPERONE:3413860062,CONDITIONAL_FINALITY:3371017761,CRIMSON:3437746471,CRYOTHESIA_77K:603721696,DEAD_MANS_TALE:3654674561,DEAD_MANS_TALE_CRAFTED:2188764214,EUPHONY:3284383335,FINAL_WARNING:3121540812,FORERUNNER:2179048386,HAWKMOON:3856705927,HUCKLEBERRY:2286143274,IZANAGIS_BURDEN:3211806999,JADE_RABBIT:3844694310,KHVOSTOV_7G_0X:4129629253,LUMINA:3512014804,MALFEASANCE:204878059,PRAXIC_BLADE:3049715579,MICROCOSM:4207066264,MIDA_MULTITOOL:1331482397,MONTE_CARLO:4068264807,NO_TIME_TO_EXPLAIN:1594120904,OSTEO_STRIGA:46524085,OUTBREAK_PERFECTED:400096939,OUTBREAK_PERFECTED_CRAFTED:3824673936,QUICKSILVER_STORM:4293613902,RAT_KING:2362471601,REVISION_ZERO:1473821207,STURM:2907129556,SUROS_REGIME:2856683562,SWEET_BUSINESS:1345867570,THORN:3973202132,TOUCH_OF_MALICE:1802135586,TRAVELERS_CHOSEN:1853180924,VIGILANCE_WING:3628991659,VERGLAS_CURVE:3659414143,WICKED_IMPLEMENT:940371471,WISH_ENDER:814876684,WISH_KEEPER:2910326942,WITHERHOARD:2357297366,WHISPER_OF_THE_WORM:1891561814,WHISPER_OF_THE_WORM_CRAFTED:1983149589,STILL_HUNT_OR_SIMILAR:2905188646,NEW_LAND_BEYOND:3049715580,NEW_MALPAIS:3049715581,LAST_WORD:1363886208,NECROCHASM:3010183924,NAVIGATOR:1619638630},ENERGY:{ARCBOLT_SPIKE:648595258,BOREALIS:3141979347,BURIED_BLOODLINE:3886719505,CENTRIFUSE:1912669214,CHOIR_OF_ONE:3698448090,CLOUDSTRIKE:2603483885,COLDHEART:1345867571,COLLECTIVE_OBLIGATION:3505113722,DEAD_MESSENGER:2812324401,DELICATE_TOMB:374573733,DEVILS_RUIN:3824106094,DIVINITY:4103414242,DUALITY:3460576091,EDGE_OF_CONCURRENCE:542203595,EDGE_OF_INTENT:14194600,ERIANAS_VOW:3524313097,EX_DIRIS:3821409356,FIGHTING_LION:3549153978,GRAVITON_LANCE:3628991658,HARD_LIGHT:4124984448,HIERARCHY_OF_NEEDS:4174431791,JOTUNN:417164956,LE_MONARQUE:3588934839,LORD_OF_WOLVES:3413860063,LORENTZ_DRIVER:3761898871,MERCILESS:4190156464,POLARIS_LANCE:3413074534,PROMETHEUS_LENS:19024058,RED_DEATH_REFORMED:427899681,RISKRUNNER:3089417789,RUINOUS_EFFIGY:1363238943,SKYBURNERS_OATH:4255268456,STILL_HUNT:2905188646,SUNSHOT:2907129557,SYMMETRY:4017959782,TARRABAH:3110698812,TELESTO:2208405142,TESSELLATION:3561203890,TICUUS_DIVINATION:3260753130,TOMMYS_MATCHBOOK:776191470,TRINITY_GHOUL:814876685,TRESPASSER:1234150730,VEX_MYTHOCLAST:4289226715,VEXCALIBUR:3118061005,WAVESPLITTER:1852863732,ERGO_SUM:1681583613,AGERS_SCEPTER:1833195496,LODESTAR:1681583614,THIRD_ITERATION:1681583615,GRAVITON_SPIKE:1681583616,ICE_BREAKER:1681583617,SLAYERS_FANG:1681583618,HEIRLOOM:4000000001},POWER:{ANARCHY:2376481550,BLACK_TALON:3766045777,COLONY:3899270607,DARCI:3141979346,DEATHBRINGER:2232171099,DETERMINISTIC_CHAOS:449318888,DRAGONS_BREATH:17096506,EYES_OF_TOMORROW:2399110176,GJALLARHORN:1363886209,GRAND_OVERTURE:1763584999,HEARTSHADOW:3664831848,HEIR_APPARENT:2084878005,LAMENT:3487253372,LEGEND_OF_ACRIUS:3580904580,LEVIATHANS_BREATH:2591746970,ONE_THOUSAND_VOICES:2069224589,PARASITE:2812324400,PROSPECTOR:3549153979,QUEENBREAKER:2044500762,SALVATIONS_GRIP:370712896,SLEEPER_SIMULANT:4036115577,THUNDERLORD:3325463374,TRACTOR_CANNON:3580904581,TRUTH:1201830623,TWO_TAILED_FOX:2694576561,WHISPER_OF_THE_WORM:1983149589,WHISPER_OF_THE_WORM_CRAFTED:1891561814,WINTERBITE:3118061004,WORLDLINE_ZERO:1864563948,XENOPHAGE:1395261499,WARDCLIFF_COIL:1509356047,THE_LAMENT:3487253372,SERVICE_OF_LUZAKU:4284533075,WHIRLING_OVATION:4284533076,BARROW_DYAD:4284533077,WOLFSBANE:4284533078}},at={ACD_0_FEEDBACK_FENCE:3649264718,ACTIUM_WAR_RIG:3768376419,AEON_SAFE:1906855381,ANTAEUS_WARDS:2423243921,ARBOR_WARDEN:523456396,ARMAMENTARIUM:3874247549,ASHEN_WAKE:1734844650,CADMUS_RIDGE_LANCECAP:3574051505,CITANS_RAMPARTS:2551549824,CREST_OF_ALPHA_LUPI:3768376418,CUIRASS_OF_THE_FALLING_STAR:4057875770,DOOM_FANG_PAULDRON:2002759682,DUNEMARCHERS:3790373072,ETERNAL_WARRIOR:3692827145,HALLOWFIRE_HEART:2094927311,HAZARDOUS_PROPULSION:3050442980,HEART_OF_INMOST_LIGHT:1462291111,HELM_OF_SAINT_14:1362342075,HOARFROST_Z:4165710258,ICEFALL_MANTLE:1734674241,KHEPRIS_HORN:2384488862,LION_RAMPANT:3790373074,LORELEY_SPLENDOR:4258262391,MASK_OF_THE_QUIET_ONE:4060352315,MELAS_PANOPLIA:1479082656,MK_44_STAND_ASIDES:3182840395,NO_BACKUP_PLANS:3267996858,ONE_EYED_MASK:3918600864,PATH_OF_THE_BURNING_STEPS:4119704973,PEACEKEEPERS:3790373075,PEREGRINE_GREAVES:3450721096,PHOENIX_CRADLE:2439379860,POINT_CONTACT_CANNON_BRACE:1703598057,PRECIOUS_SCARS:3974038291,PYROGALE_GAUNTLETS:2066430310,SECOND_CHANCE:4268030601,SEVERANCE_ENCLOSURE:2326396534,STRONGHOLD:2240152949,SYNTHOCEPS:2002759681,URSA_FURIOSA:2046130360,WISHFUL_IGNORANCE:4157369212,WORMGOD_CARESS:1734844651,ABEYANT_LEAP:3849355625,AN_INSURMOUNTABLE_SKULLFORT:3216110440,PRAXIC_VESTMENT:4184605701,BLASTWAVE_STRIDERS:4184605702,STOICISM:1572351650},Ye={AEON_SWIFT:3942036043,ASSASSINS_COWL:3400283633,ATHRYS_EMBRACE:2415768376,BALANCE_OF_POWER:3001449507,BLIGHT_RANGER:1703551922,BOMBARDIERS:2177224557,CALIBAN_HAND:3453042252,CELESTIAL_NIGHTHAWK:3960926756,CYRTARACHNE_FACADE:1008364980,DRAGONS_SHADOW:2766109874,FOETRACER:1667080809,FR0ST_EE5:1737050140,GEMINI_JESTER:2132672800,GIFTED_CONVICTION:1627691271,GRAVITON_FORFEIT:3926392527,GWISIN_VEST:4070560770,GYRFALCONS_HAUBERK:2447096246,KHEPRIS_STING:4002939008,KNUCKLEHEAD_RADAR:3960926757,LIARS_HANDSHAKE:4165919945,LUCKY_PANTS:2405271939,LUCKY_RASPBERRY:1803778317,MASK_OF_BAKRIS:1619425569,MECHANEERS_TRICKSLEEVES:4284305243,MOTHKEEPER_WRAPS:3688534631,OATHKEEPER:3883286571,OMNIOCULUS:4255001288,OPHIDIA_SPATHE:3642110725,ORPHEUS_RIG:2405271938,RADIAN_DANCE_MACHINES:1709794165,RAIDEN_FLUX:2766109872,RAIJUS_HARNESS:2767482390,RELATIVISM:2809120022,RENEWAL_GRASPS:3793245444,SEALED_AHAMKARA_GRASPS:3987871714,SHARDS_OF_GALANOR:3883286570,SHINOBUS_VOW:1786557270,SIXTH_COYOTE:4070560771,SPEEDLOADER_SLACKS:2390471904,STAR_EATER_SCALES:1006498763,ST0MP_EE5:2405271937,TRITON_VICE:3093309525,WORMHUSK_CROWN:3721047650,YOUNG_AHAMKARAS_SPINE:4284305242,THE_SIXTH_COYOTE:4070560771,FORTUNES_FAVOR:4010324161,MASK_OF_FEALTY:4010324162,ESSENTIALISM:2960682229,MOIRAI:4000000002},He={AEON_SOUL:2950045886,APOTHEOSIS_VEIL:3897389303,ASTROCYTE_VERSE:4035625646,BALLIDORSE_WRATHWEAVERS:3831935023,BOOTS_OF_THE_ASSEMBLER:3045642045,BRIARBINDS:3234692237,CENOTAPH_MASK:3589022772,CHROMATIC_FIRE:4057299718,CLAWS_OF_AHAMKARA:3288917178,CONTRAVERSE_HOLD:3261527845,CROWN_OF_TEMPESTS:3381022969,DAWN_CHORUS:3767088557,DEIMOSUFFUSION:1479082657,EYE_OF_ANOTHER_WORLD:3381022970,FALLEN_SUNSTAR:3781549120,FELWINTERS_HELM:2822465023,GEOMAG_STABILIZERS:3608857511,GETAWAY_ARTIST:4177778015,KARNSTEIN_ARMLETS:3844826440,LUNAFACTION_BOOTS:4136768282,MANTLE_OF_BATTLE_HARMONY:3301944824,MATAIODOXIA:1955548646,NECROTIC_GRIP:2780717641,NEZARECS_SIN:3381022971,NOTHING_MANACLES:3982932616,OPHIDIAN_ASPECT:3627185503,OSMIOMANCY_GLOVES:3259193988,PHOENIX_PROTOCOL:4057299719,PROMETHIUM_SPUR:3864952146,RAIN_OF_FIRE:1624882687,SANGUINE_ALCHEMY:3070555693,SECANT_FILAMENTS:4029987901,SKULL_OF_DIRE_AHAMKARA:3050017626,SOLIPSISM:2273643087,SPEAKERS_SIGHT:3617849232,STAG:3008550972,STARFIRE_PROTOCOL:2782999717,STORMDANCERS_BRACE:1996008488,SUNBRACERS:3787517196,SWARMERS:2463947681,TRANSVERSIVE_STEPS:3337759189,VERITYS_BROW:2897117448,VESPER_OF_RADIUS:3139221735,WINGS_OF_SACRED_DAWN:2782999716,WINTERS_GUILE:3844826443,SOLIPSISM_YEAR_PROPHECY:1374563539,RIME_COAT_RAIMENT:1374563540,EUNOIA:4000000003},s={VOID:{TITAN:{SUPER:{WARD_OF_DAWN:4260353953,SENTINEL_SHIELD:4260353952,TWILIGHT_ARSENAL:4260353955},ASPECTS:{BASTION:1602994569,CONTROLLED_DEMOLITION:1602994568,OFFENSIVE_BULWARK:1602994570,UNBREAKABLE:1602994571},GRENADES:{SUPPRESSOR:2265076177,VOIDWALL:2809141585,VORTEX:1016030582,AXION_BOLT:3232422679,SCATTER:1514173218,MAGNETIC:1547656727,SPIKE:1255073825},MELEE:{SHIELD_THROW:4220332374,SHIELD_BASH:4220332375},CLASS_ABILITIES:{TOWERING_BARRICADE:2722641740,RALLY_BARRICADE:2722641741},JUMPS:{HIGH_LIFT:1380268166,STRAFE_LIFT:1380268167,CATAPULT_LIFT:1380268164}},HUNTER:{SUPER:{SPECTRAL_BLADES:2722573682,SHADOWSHOT_MOEBIUS_QUIVER:2722573681,SHADOWSHOT_DEADFALL:2722573683},ASPECTS:{TRAPPERS_AMBUSH:187655372,VANISHING_STEP:187655373,STYLISH_EXECUTIONER:187655374,ON_THE_PROWL:187655375},GRENADES:{SCATTER:1514173218,VOIDWALL:2809141585,VORTEX:1016030582,SUPPRESSOR:2265076177,MAGNETIC:1547656727,SPIKE:1255073825,AXION_BOLT:3232422679},MELEE:{SNARE_BOMB:1139822081},CLASS_ABILITIES:{MARKSMANS_DODGE:2816982784,GAMBLERS_DODGE:2816982785},JUMPS:{HIGH_JUMP:20616658,STRAFE_JUMP:20616659,TRIPLE_JUMP:20616656,BLINK:0}},WARLOCK:{SUPER:{NOVA_BOMB_VORTEX:1656118681,NOVA_BOMB_CATACLYSM:1656118682,NOVA_WARP:1656118680},ASPECTS:{CHAOS_ACCELERANT:2321824285,FEED_THE_VOID:2321824284,CHILD_OF_THE_OLD_GODS:2321824287},GRENADES:{VORTEX:1016030582,AXION_BOLT:3232422679,SCATTER:1514173218,MAGNETIC:1547656727,SUPPRESSOR:2265076177,SPIKE:1255073825,VOIDWALL:2809141585},MELEE:{POCKET_SINGULARITY:2299867342},CLASS_ABILITIES:{HEALING_RIFT:2209081649,EMPOWERING_RIFT:2209081648},JUMPS:{BURST_GLIDE:1237488986,STRAFE_GLIDE:1237488987,BALANCED_GLIDE:1237488985,BLINK:1237488984}},FRAGMENTS:{ECHO_OF_REPRISAL:2272984669,ECHO_OF_LEECHING:2272984670,ECHO_OF_UNDERMINING:2272984668,ECHO_OF_HARVEST:2661180601,ECHO_OF_EXPULSION:2272984665,ECHO_OF_PROVISION:2272984664,ECHO_OF_EXCHANGE:2272984667,ECHO_OF_REMNANTS:2272984666,ECHO_OF_PERSISTENCE:2272984671,ECHO_OF_DOMINEERING:2272984657,ECHO_OF_DILATION:2272984656,ECHO_OF_INSTABILITY:2661180600,ECHO_OF_OBSCURITY:2661180602,ECHO_OF_STARVATION:2661180603,ECHO_OF_VIGILANCE:3854948621,ECHO_OF_CESSATION:3854948620}},SOLAR:{TITAN:{SUPER:{HAMMER_OF_SOL:2747500761,BURNING_MAUL:2747500760},ASPECTS:{SOL_INVICTUS:2984351205,ROARING_FLAMES:2984351204,CONSECRATION:2984351206},GRENADES:{THERMITE:3969294337,FUSION:1013086087,INCENDIARY:2581086849,TRIPMINE:2946990961,SOLAR:2216698406,SWARM:3199702642,FIREBOLT:2202441959,HEALING:1841016428},MELEE:{THROWING_HAMMER:852252789,HAMMER_STRIKE:852252788},CLASS_ABILITIES:{TOWERING_BARRICADE:2495523340,RALLY_BARRICADE:2495523341},JUMPS:{HIGH_LIFT:2225231092,STRAFE_LIFT:2225231093,CATAPULT_LIFT:2225231094}},HUNTER:{SUPER:{GOLDEN_GUN_DEADSHOT:375052469,GOLDEN_GUN_MARKSMAN:375052468,BLADE_BARRAGE:375052471},ASPECTS:{KNOCK_EM_DOWN:3066103998,ON_YOUR_MARK:3066103999,GUNPOWDER_GAMBLE:3066103996},GRENADES:{INCENDIARY:2581086849,TRIPMINE:2946990961,SWARM:3199702642,SOLAR:2216698406,FIREBOLT:2202441959,HEALING:1841016428,THERMITE:3969294337,FUSION:1013086087},MELEE:{KNIFE_TRICK:4016776972,WEIGHTED_THROWING_KNIFE:4016776975,LIGHTWEIGHT_KNIFE:4016776974,PROXIMITY_EXPLOSIVE_KNIFE:4016776973},CLASS_ABILITIES:{MARKSMANS_DODGE:3636300854,GAMBLERS_DODGE:3636300855,ACROBATS_DODGE:3636300852},JUMPS:{HIGH_JUMP:1128768654,STRAFE_JUMP:1128768655,TRIPLE_JUMP:1128768652}},WARLOCK:{SUPER:{DAYBREAK:2274196886,WELL_OF_RADIANCE:2274196887,SONG_OF_FLAME:2274196884},ASPECTS:{HEAT_RISES:83039194,ICARUS_DASH:83039195,TOUCH_OF_FLAME:83039193,HELLION:83039192},GRENADES:{HEALING:3040080535,SOLAR:2216698406,THERMITE:2400634603,SWARM:3199702642,FUSION:1013086087,INCENDIARY:2581086849,TRIPMINE:2946990961,FIREBOLT:2202441959},MELEE:{INCINERATOR_SNAP:1470370538,CELESTIAL_FIRE:1470370539},CLASS_ABILITIES:{HEALING_RIFT:2979486803,EMPOWERING_RIFT:2979486802,PHOENIX_DIVE:2979486801},JUMPS:{BURST_GLIDE:3686638442,STRAFE_GLIDE:3686638443,BALANCED_GLIDE:3686638441}},FRAGMENTS:{EMBER_OF_COMBUSTION:362132289,EMBER_OF_SEARING:1051276351,EMBER_OF_CHAR:362132291,EMBER_OF_RESOLVE:4180586736,EMBER_OF_SINGEING:362132293,EMBER_OF_BENEVOLENCE:362132292,EMBER_OF_BEAMS:362132295,EMBER_OF_EMPYREAN:362132294,EMBER_OF_TORCHES:362132288,EMBER_OF_TEMPERING:362132290,EMBER_OF_BLISTERING:362132301,EMBER_OF_SOLACE:362132300,EMBER_OF_ERUPTION:1051276348,EMBER_OF_ASHES:1051276349,EMBER_OF_WONDER:1051276350,EMBER_OF_MERCY:4180586737}},ARC:{TITAN:{SUPER:{FISTS_OF_HAVOC:119041299,THUNDERCRASH:119041298},ASPECTS:{TOUCH_OF_THUNDER:1656549672,JUGGERNAUT:1656549673,KNOCKOUT:1656549674},GRENADES:{STORM:1713935764,PULSE:1713935764,SKIP:146194908,FLASHBANG:2909720723,LIGHTNING:2994412667,FLUX:4198689901,ARCBOLT:1582574009},MELEE:{SEISMIC_STRIKE:2708585277,BALLISTIC_SLAM:2708585276,THUNDERCLAP:2708585279},CLASS_ABILITIES:{TOWERING_BARRICADE:489583096,RALLY_BARRICADE:489583097,THRUSTER:2868073563},JUMPS:{HIGH_LIFT:1698387814,STRAFE_LIFT:1698387815,CATAPULT_LIFT:1698387812}},HUNTER:{SUPER:{ARC_STAFF:3769507633,GATHERING_STORM:3769507632,STORMS_EDGE:3769507635},ASPECTS:{FLOW_STATE:4194622036,TEMPEST_STRIKE:4194622037,LETHAL_CURRENT:4194622038,ASCENSION:4194622039},GRENADES:{SKIP:146194908,FLUX:4198689901,PULSE:1713935764,ARCBOLT:1582574009,STORM:2481624867,FLASHBANG:2909720723,LIGHTNING:2994412667},MELEE:{COMBINATION_BLOW:2716335211,DISORIENTING_BLOW:2716335210},CLASS_ABILITIES:{MARKSMANS_DODGE:3933525366,GAMBLERS_DODGE:3933525367},JUMPS:{HIGH_JUMP:95544330,STRAFE_JUMP:95544331,TRIPLE_JUMP:95544328,BLINK:95544329}},WARLOCK:{SUPER:{STORMTRANCE:1081893460,CHAOS_REACH:1081893461},ASPECTS:{ARC_SOUL:1293395731,ELECTROSTATIC_MIND:1293395729,LIGHTNING_SURGE:1293395730},GRENADES:{STORM:2481624867,PULSE:2994412667,ARCBOLT:1582574009,FLASHBANG:2909720723,LIGHTNING:2994412667,SKIP:146194908,FLUX:4198689901},MELEE:{CHAIN_LIGHTNING:1232050831,BALL_LIGHTNING:1232050830},CLASS_ABILITIES:{HEALING_RIFT:2209081649,EMPOWERING_RIFT:2209081648},JUMPS:{BURST_GLIDE:1237488986,STRAFE_GLIDE:1237488987,BALANCED_GLIDE:1237488985,BLINK:1237488984}},FRAGMENTS:{SPARK_OF_SHOCK:1727069364,SPARK_OF_IONS:1727069363,SPARK_OF_DISCHARGE:1727069362,SPARK_OF_FOCUS:1727069360,SPARK_OF_MAGNITUDE:1727069374,SPARK_OF_AMPLITUDE:3277705906,SPARK_OF_VOLTS:3277705904,SPARK_OF_BRILLIANCE:3277705905,SPARK_OF_HASTE:3478354817,SPARK_OF_INSTINCT:3478354816,SPARK_OF_RESISTANCE:1727069366,SPARK_OF_RECHARGE:1727069361,SPARK_OF_BEACONS:1727069367,SPARK_OF_FREQUENCY:1727069365,SPARK_OF_MOMENTUM:1727069375,SPARK_OF_FEEDBACK:1727069373}},STASIS:{TITAN:{SUPER:{GLACIAL_QUAKE:2021620139},ASPECTS:{CRYOCLASM:2031919265,TECTONIC_HARVEST:2031919264,HOWL_OF_THE_STORM:1563930741,DIAMOND_LANCE:3866705246},GRENADES:{GLACIER:1399217,DUSKFIELD:1399216,COLDSNAP:1399219},MELEE:{SHIVER_STRIKE:2028772231},CLASS_ABILITIES:{TOWERING_BARRICADE:3260056808,RALLY_BARRICADE:3260056809},JUMPS:{HIGH_LIFT:469281040,STRAFE_LIFT:469281041,CATAPULT_LIFT:469281042}},HUNTER:{SUPER:{SILENCE_AND_SQUALL:2625980631},ASPECTS:{SHATTERDIVE:2934767476,WINTERS_SHROUD:2934767477,GRIM_HARVEST:1920417385,TOUCH_OF_WINTER:4184589900},GRENADES:{GLACIER:1399217,DUSKFIELD:1399216,COLDSNAP:1399219},MELEE:{WITHERING_BLADE:1341767667},CLASS_ABILITIES:{MARKSMANS_DODGE:3933525366,GAMBLERS_DODGE:3933525367},JUMPS:{HIGH_JUMP:3531427694,STRAFE_JUMP:3531427695,TRIPLE_JUMP:3531427692}},WARLOCK:{SUPER:{WINTERS_WRATH:3683904166},ASPECTS:{ICEFLARE_BOLTS:668903196,BLEAK_WATCHER:2642597904,FROSTPULSE:668903197,GLACIAL_HARVEST:2651551055},GRENADES:{GLACIER:1399217,DUSKFIELD:1399216,COLDSNAP:1399219},MELEE:{PENUMBRAL_BLAST:2543177538},CLASS_ABILITIES:{HEALING_RIFT:3492047641,EMPOWERING_RIFT:3492047640},JUMPS:{BURST_GLIDE:890263312,STRAFE_GLIDE:890263313,BALANCED_GLIDE:890263315}},FRAGMENTS:{WHISPER_OF_HEDRONS:3469412970,WHISPER_OF_FISSURES:3469412971,WHISPER_OF_REFRACTION:3469412968,WHISPER_OF_DURANCE:3469412969,WHISPER_OF_BONDS:3469412974,WHISPER_OF_SHARDS:3469412975,WHISPER_OF_CHAINS:537774540,WHISPER_OF_TORMENT:537774541,WHISPER_OF_FRACTURES:537774542,WHISPER_OF_IMPETUS:537774543,WHISPER_OF_CONDUCTION:2483898429,WHISPER_OF_RENDING:2483898428,WHISPER_OF_HUNGER:2483898431,WHISPER_OF_RIME:2483898430,WHISPER_OF_REVERSAL:2368990400,WHISPER_OF_CHILL:2368990401}},STRAND:{TITAN:{SUPER:{BLADEFURY:3574662354},ASPECTS:{INTO_THE_FRAY:988980153,DRENGRS_LASH:988980152,BANNER_OF_WAR:988980154,FLECHETTE_STORM:988980155},GRENADES:{SHACKLE:2809342386,THREADLING:4228170798,GRAPPLE:2470512752},MELEE:{FRENZIED_BLADE:4094417246},CLASS_ABILITIES:{TOWERING_BARRICADE:489583096,RALLY_BARRICADE:489583097},JUMPS:{HIGH_LIFT:3350493949,STRAFE_LIFT:3350493948,CATAPULT_LIFT:3350493951}},HUNTER:{SUPER:{SILKSTRIKE:2463983862},ASPECTS:{ENSNARING_SLAM:4249729126,WIDOWS_SILK:4249729127,THREADED_SPECTER:4249729125,WHIRLING_MAELSTROM:4249729124},GRENADES:{GRAPPLE:2470512752,THREADLING:4228170798,SHACKLE:2809342386},MELEE:{THREADED_SPIKE:1680616210},CLASS_ABILITIES:{MARKSMANS_DODGE:1282157891,GAMBLERS_DODGE:1282157890},JUMPS:{HIGH_JUMP:3721022587,STRAFE_JUMP:3721022586,TRIPLE_JUMP:3721022585}},WARLOCK:{SUPER:{NEEDLESTORM:1885339915},ASPECTS:{WEAVERS_CALL:262821317,MINDSPUN_INVOCATION:262821318,THE_WANDERER:262821319,WEAVEWALK:262821312},GRENADES:{THREADLING:4228170798,SHACKLE:2809342386,GRAPPLE:2470512752},MELEE:{ARCANE_NEEDLE:2307689415},CLASS_ABILITIES:{HEALING_RIFT:383852320,EMPOWERING_RIFT:383852321},JUMPS:{BURST_GLIDE:2628485817,STRAFE_GLIDE:2628485816,BALANCED_GLIDE:2628485818}},FRAGMENTS:{THREAD_OF_MIND:4208512218,THREAD_OF_FURY:4208512219,THREAD_OF_ASCENT:4208512216,THREAD_OF_FINALITY:4208512217,THREAD_OF_WARDING:4208512222,THREAD_OF_WISDOM:4208512223,THREAD_OF_REBIRTH:4208512220,THREAD_OF_TRANSMUTATION:4208512221,THREAD_OF_PROPAGATION:4208512210,THREAD_OF_EVOLUTION:4208512211,THREAD_OF_ISOLATION:3192552689,THREAD_OF_BINDING:3192552688,THREAD_OF_GENERATION:3192552691,THREAD_OF_CONTINUITY:3192552690}},PRISMATIC:{TITAN:{SUBCLASS_HASH:1616346845,SUPER:{TWILIGHT_ARSENAL:2529942646,GLACIAL_QUAKE:2529942645,THUNDERCRASH:2529942644,BLADEFURY:2529942642,HAMMER_OF_SOL:2529942647},ASPECTS:{KNOCKOUT:1262901523,UNBREAKABLE:1262901521,CONSECRATION:1262901520,DRENGRS_LASH:1262901525,DIAMOND_LANCE:1262901522},MELEE:{SHIELD_THROW:1980796560,THUNDERCLAP:1980796563,FRENZIED_BLADE:1980796564,HAMMER_STRIKE:1980796562,SHIVER_STRIKE:1980796561},GRENADES:{GLACIER:934199459,SHACKLE:1517917190,THERMITE:2400634603,PULSE:1323461861,SUPPRESSOR:3923577992,VOIDWALL:2809141585,SPIKE:1255073825,SCATTER:1514173218,VORTEX:1016030582,MAGNETIC:1547656727,AXION_BOLT:3232422679,STORM:2481624867,SKIP:146194908,FLASHBANG:2909720723,LIGHTNING:2994412667,FLUX:4198689901,FUSION:1013086087,INCENDIARY:2581086849,TRIPMINE:2946990961,SOLAR:2216698406,SWARM:3199702642,FIREBOLT:2202441959,HEALING:1841016428},CLASS_ABILITIES:{TOWERING_BARRICADE:2868073561,RALLY_BARRICADE:2868073560,THRUSTER:2868073563},JUMPS:{HIGH_LIFT:266130439,STRAFE_LIFT:266130438,CATAPULT_LIFT:266130437}},HUNTER:{SUBCLASS_HASH:4282591831,SUPER:{STORMS_EDGE:2370269388,GOLDEN_GUN_MARKSMAN:2370269390,SILENCE_AND_SQUALL:2370269391,SILKSTRIKE:2370269384,DEADFALL:2370269389,SHADOWSHOT_DEADFALL:2370269389},ASPECTS:{STYLISH_EXECUTIONER:2835214900,GUNPOWDER_GAMBLE:2835214903,WINTERS_SHROUD:2835214902,THREADED_SPECTER:2835214897,ASCENSION:2835214901},MELEE:{COMBINATION_BLOW:2657901005,THREADED_SPIKE:2657901002,WITHERING_BLADE:2657901006,SNARE_BOMB:2657901007,KNIFE_TRICK:2657901004},GRENADES:{MAGNETIC:886607940,SWARM:2842514288,DUSKFIELD:4051767608,GRAPPLE:1225978592,ARCBOLT:3897682694,VOIDWALL:2809141585,SPIKE:1255073825,SCATTER:1514173218,VORTEX:1016030582,SUPPRESSOR:2265076177,AXION_BOLT:3232422679,FUSION:1013086087,INCENDIARY:2581086849,TRIPMINE:2946990961,SOLAR:2216698406,THERMITE:3969294337,FIREBOLT:2202441959,HEALING:1841016428,PULSE:1713935764,STORM:2481624867,SKIP:146194908,FLASHBANG:2909720723,LIGHTNING:2994412667,FLUX:4198689901,GLACIER:1399217,SHACKLE:2809342386,THREADLING:4228170798},CLASS_ABILITIES:{MARKSMANS_DODGE:2711519341,GAMBLERS_DODGE:2711519340,ACROBATS_DODGE:2711519343,ARACHS_CHOSEN_CASQUE:3564883403},JUMPS:{HIGH_JUMP:1588878499,STRAFE_JUMP:1588878498,TRIPLE_JUMP:1588878497,BLINK:1588878496}},WARLOCK:{SUBCLASS_HASH:3893112950,SUPER:{SONG_OF_FLAME:1869939005,NEEDLESTORM:1869939001,WINTERS_WRATH:1869939006,NOVA_BOMB_CATACLYSM:1869939004,STORMTRANCE:1869939007},ASPECTS:{FEED_THE_VOID:790664815,BLEAK_WATCHER:790664813,HELLION:790664814,LIGHTNING_SURGE:790664812,WEAVERS_CALL:790664810},MELEE:{INCINERATOR_SNAP:3644045869,PENUMBRAL_BLAST:3644045867,ARCANE_NEEDLE:3644045871,POCKET_SINGULARITY:3644045870,CHAIN_LIGHTNING:3644045868},GRENADES:{STORM:4241856103,HEALING:3040080535,COLDSNAP:4265391440,THREADLING:3994381207,VORTEX:1048847436},CLASS_ABILITIES:{HEALING_RIFT:1444664838,EMPOWERING_RIFT:1444664839,PHOENIX_DIVE:1444664836},JUMPS:{BURST_GLIDE:1237488986,STRAFE_GLIDE:1237488987,BALANCED_GLIDE:1237488985,BLINK:1237488984}},FRAGMENTS:{FACET_OF_DAWN:2626922126,FACET_OF_HOPE:2626922122,FACET_OF_PROTECTION:2626922120,FACET_OF_RUIN:124726499,FACET_OF_PURPOSE:124726498,FACET_OF_COURAGE:2626922124,FACET_OF_AWAKENING:124726505,FACET_OF_BALANCE:2626922114,FACET_OF_BRAVERY:124726503,FACET_OF_BLESSING:124726496,FACET_OF_COMMAND:124726497,FACET_OF_DEFIANCE:74393640,FACET_OF_DEVOTION:2626922125,FACET_OF_DOMINANCE:124726504,FACET_OF_GENEROSITY:2626922127,FACET_OF_GRACE:2626922121,FACET_OF_HONOR:124726501,FACET_OF_JUSTICE:2626922115,FACET_OF_MENDING:124726500,FACET_OF_SOLITUDE:2626922123,FACET_OF_SACRIFICE:124726502}}},Qa={INCANDESCENT:4293542123},Ln={262821317:790664810,1293395730:790664812,83039192:790664814,2642597904:790664813,2321824284:790664815,3866705246:1262901522,988980152:1262901525,1602994571:1262901521,2984351206:1262901520,1656549674:1262901523,4194622039:2835214901,3066103996:2835214903,2934767477:2835214902,4249729125:2835214897,187655374:2835214900};Object.entries(Ln).reduce((o,[e,t])=>(o[t]=Number(e),o),{});function er({hash:o,instance:e,onClick:t,onMouseEnter:a,onMouseLeave:r,className:i}){const c=I.useMemo(()=>P.getItem(o),[o]);if(!c)return S.jsx("div",{className:"rich-item-icon rich-item-icon--empty"});const n=c.displayProperties?.icon?$e(c.displayProperties.icon):"",l=c.inventory?.tierType||0,d=l===6?"exotic":l===5?"legendary":l===4?"rare":"common",h=$e(c.secondarySpecial),m=$e(c.secondaryIcon),f=$e(c.secondaryOverlay),E=c.iconWatermark,p=c.iconWatermarkFeatured,R=!p&&!!E||zs(c.quality?.currentVersion),A=$e(p||E),_=!!(e?.state&&e.state&4),T=!!(e?.state&&e.state&8),H=!!(T&&e?.gearTier&&e.gearTier>=2),C=c.itemType===3;return S.jsxs("div",{className:`rich-item-icon rich-item-icon--${d} ${_?"rich-item-icon--masterwork":""} ${i||""}`,onClick:t,onMouseEnter:a,onMouseLeave:r,children:[(m||h||f)&&S.jsxs("div",{className:"rich-item-icon__banner",children:[m&&S.jsx("img",{src:m,className:"rich-item-icon__banner-layer",alt:"",style:{zIndex:1}}),h&&S.jsx("img",{src:h,className:"rich-item-icon__banner-layer",alt:"",style:{zIndex:2}}),f&&S.jsx("img",{src:f,className:"rich-item-icon__banner-layer",alt:"",style:{zIndex:3}})]}),S.jsxs("div",{className:"rich-item-icon__main",children:[S.jsx("img",{src:n,alt:c.displayProperties?.name,className:"rich-item-icon__img"}),A&&S.jsx("img",{src:A,className:`rich-item-icon__watermark ${R?"rich-item-icon__watermark--legacy":"rich-item-icon__watermark--featured"}`,alt:""}),(c.itemType===3||c.itemType===2&&l!==6)&&S.jsx(ga,{tier:e?.gearTier||0}),C&&(T||H)&&S.jsxs("div",{className:"rich-item-icon__status",children:[T&&S.jsx("img",{src:$e("/img/destiny_content/items/crafted-icon-overlay.png"),alt:"Crafted"}),H&&S.jsx("img",{src:$e("/img/destiny_content/items/enhanced-item-overlay.png"),alt:"Enhanced"})]})]}),e?.power>0&&S.jsx("div",{className:"rich-item-icon__power",children:S.jsx("span",{className:"rich-item-icon__power-value",children:e.power})})]})}const Hn={3448274439:"helmet",3551918588:"arms",14239492:"chest",20886954:"legs",1585787867:"classItem"},tr=o=>{const e=P.getItem(o);if(!e)return"other";const t=(e.displayProperties?.name||"").toLowerCase(),a=(e.plug?.plugCategoryIdentifier||"").toLowerCase(),r=(e.displayProperties?.description||"").toLowerCase(),i=(e.itemTypeDisplayName||"").toLowerCase();return t.includes("resilience")||t.includes("recovery")||t.includes("recuperation")||t.includes("better already")||t.includes("siphon")||r.includes("orb of power")||t.includes("resistance")||a.includes("resistance")||t.includes("absolution")||t.includes("better already")?"health":t.includes("strength")||t.includes("melee")||t.includes("impact induction")||t.includes("outreach")||t.includes("heavy handed")||t.includes("focusing strike")?"melee":t.includes("discipline")||t.includes("grenade")||t.includes("firepower")||t.includes("bomber")||t.includes("bolstering detonation")||t.includes("innervation")||t.includes("momentum transfer")?"grenade":t.includes("intellect")||t.includes("super")||t.includes("ashes to assets")||t.includes("hands-on")||t.includes("dynamo")||t.includes("font of wisdom")?"super":t.includes("mobility")||t.includes("class")||t.includes("utility")||t.includes("reaper")||t.includes("distribution")?"class":t.includes("loader")||t.includes("dexterity")||t.includes("scavenger")||t.includes("holster")||t.includes("surge")||t.includes("targeting")||t.includes("unflinching")||i.includes("loader")||i.includes("dexterity")||t.includes("aim")||t.includes("reload")||t.includes("steady")||t.includes("handling")?"weapon":"other"};function Mn(o){let e=null,t=null;const a=[];return Array.from(new Set(o)).forEach(i=>{const c=P.getItem(i);if(!c)return;const n=(c.plug?.plugCategoryIdentifier||"").toLowerCase(),l=(c.displayProperties?.name||"").toLowerCase(),d=(c.itemTypeDisplayName||"").toLowerCase();n.includes("shader")||n.includes("appearance")||n.includes("ornament")||n.includes("skins")||d.includes("shader")||d.includes("ornament")||(n.includes("armor_stats")&&!n.includes("artifice")?e?a.push(i):e=i:n.includes("artifice")||l.includes("font of")||n.includes(".stat.")?t?a.push(i):t=i:a.push(i))}),a.sort((i,c)=>{const n=P.getItem(i)?.displayProperties?.name?.toLowerCase()||"",l=P.getItem(c)?.displayProperties?.name?.toLowerCase()||"";return n.localeCompare(l)}),{mainStat:e,secondaryStat:t,others:a}}function ui(o,e){const t={helmet:{},arms:{},chest:{},legs:{},classItem:{},general:{}},a={helmet:[],arms:[],chest:[],legs:[],classItem:[],general:[]},r={health:[],melee:[],grenade:[],super:[],class:[],weapon:[],other:[]},i=new Map;o.parameters?.mods&&o.parameters.mods.forEach(f=>i.set(f,(i.get(f)||0)+1));const c=new Map,n={helmet:0,arms:0,chest:0,legs:0,classItem:0},l=(f,E,p)=>{c.set(f,(c.get(f)||0)+1);const R=P.getItem(f),A=(R?.plug?.plugCategoryIdentifier||"").toLowerCase(),_=(R?.itemTypeDisplayName||"").toLowerCase(),T=A.includes("shader")||_.includes("shader")||p===5,H=A.includes("ornament")||A.includes("appearance")||A.includes("skins")||_.includes("ornament")||p===6,C=A.includes("enhancements")||A.includes("armor_stats")||A.includes("armor_mods");if(!(A.includes("fragments")||A.includes("aspects")||A.includes("abilities")||A.includes("supers")||A.includes("plugs.subclass")||_.includes("fragment")||_.includes("aspect")||R?.itemCategoryHashes?.includes(1313488945)||R?.itemCategoryHashes?.includes(764703411)))if((T||H)&&!C){const F=t[E];F&&(T?F.shader=f:H&&(F.ornament=f))}else{a[E]?.push(f),n[E]!==void 0&&n[E]++;const F=tr(f);r[F].push(f)}},d=f=>{const E=P.getItem(f);if(!E)return!0;const p=(E.plug?.plugCategoryIdentifier||"").toLowerCase(),R=(E.itemTypeDisplayName||"").toLowerCase(),A=(E.displayProperties?.name||E?.name||"").toLowerCase();return p.includes("shader")||p.includes("appearance")||p.includes("ornament")||p.includes("skins")||R.includes("shader")||R.includes("ornament")?!1:p.includes("armor_stats")||p.includes("artifice")||A.includes("resilience")||A.includes("recovery")||A.includes("discipline")||A.includes("strength")||A.includes("intellect")||A.includes("mobility")||A==="melee mod"||A==="armor charge mod"||A.includes("/ -")||A.includes("+class")||p.includes("seasonal")||p.includes("artifact")?!0:(p.includes("head")||p.includes("helmet")||p.includes("arms")||p.includes("gauntlets")||p.includes("chest")||p.includes("plate")||p.includes("vest")||p.includes("legs")||p.includes("boots")||p.includes("class")||p.includes("cloak")||p.includes("bond")||p.includes("mark"),!1)},h=[];if(Object.entries(e).forEach(([f,E])=>{E&&E.socketOverrides&&Object.entries(E.socketOverrides).forEach(([p,R])=>{const A=Number(R),_=parseInt(p);if(A&&A!==3696633656){const T=P.getItem(A);T&&(T.itemType===1||T.itemType===19||T.itemType===24||T.itemType===11||T.plug?.plugCategoryIdentifier)&&(d(A)?(h.push(A),c.set(A,(c.get(A)||0)+1)):l(A,f,_))}})}),o.parameters?.modsByBucket)for(const[f,E]of Object.entries(o.parameters.modsByBucket)){const p=parseInt(f),R=Hn[p];Array.isArray(E)&&E.forEach(A=>{d(A)?(h.push(A),c.set(A,(c.get(A)||0)+1)):l(A,R||"general")})}const m=["helmet","arms","chest","legs","classItem"];return h.forEach(f=>{let E="general",p=1/0;for(const A of m)e[A]&&n[A]<p&&(p=n[A],E=A);a[E]?.push(f),n[E]!==void 0&&n[E]++;const R=tr(f);r[R].push(f)}),i.forEach((f,E)=>{const p=c.get(E)||0,R=f-p;if(R<=0)return;const A=P.getItem(E);if(!A){for(let T=0;T<R;T++)l(E,"general");return}let _="general";if(!d(E)){const T=(A.plug?.plugCategoryIdentifier||"").toLowerCase();T.includes("head")||T.includes("helmet")?_="helmet":T.includes("arms")||T.includes("gauntlets")?_="arms":T.includes("chest")||T.includes("plate")||T.includes("vest")?_="chest":T.includes("legs")||T.includes("boots")?_="legs":(T.includes("class")||T.includes("cloak")||T.includes("bond"))&&(_="classItem")}if(_!=="general")for(let T=0;T<R;T++)l(E,_);else for(let T=0;T<R;T++){let H="general",C=1/0;for(const D of m)e[D]&&n[D]<C&&(C=n[D],H=D);l(E,H)}}),{modGroups:a,armorCosmetics:t,themedMods:r}}let Tr=null;function bn(){return JSON.stringify(Tr,null,2)}const Pn=4287799666;function sr(o){const e={},t=[];let a=[],r=!1;for(const c of o)c===Pn?(r=!0,a.length>0&&(t.push([...a]),a=[])):a.push(c);if(a.length>0&&t.push([...a]),!r&&t.length<=1)return{};const i=[q.HELMET,q.GAUNTLETS,q.CHEST_ARMOR,q.LEG_ARMOR,q.CLASS_ARMOR];for(let c=0;c<t.length&&c<i.length;c++){const n=i[c],l=t[c];l.length>0&&(e[n]=l)}return e}async function Dn(o){try{const e=o.match(/[?&]loadout=([^&]+)/);if(e){const m=e[1],f=decodeURIComponent(m),E=JSON.parse(f);if(!E.name||E.classType===void 0||!E.equipped)throw new Error("Loadout data is missing required fields");if(E.parameters?.mods&&E.parameters.mods.length>0){const p=sr(E.parameters.mods);if(!E.parameters.modsByBucket)E.parameters.modsByBucket=p;else for(const[R,A]of Object.entries(p)){const _=parseInt(R),T=E.parameters.modsByBucket[_]||[];E.parameters.modsByBucket[_]=[...T,...A]}}return E}if(o.match(/destinyitemmanager\.com\/\d+\/d2\/(loadouts|inventory|progress|records|optimizer|collections)/i))throw new Error(`This is a DIM profile page link, not a loadout share link. To share a loadout from DIM:
1. Open DIM and go to your Loadouts page
2. Click on a loadout
3. Click the Share button to get a dim.gg share link
Or paste a DIM loadout URL with ?loadout= parameter.`);const a=o.match(/dim\.gg\/([a-z0-9]+)/i);if(a){const m=a[1];console.log("[LoadoutLink] Fetching DIM loadout:",m);const f=`/dim-proxy.php?shareId=${m}`;console.log("[LoadoutLink] Fetching from DIM API via Proxy:",m);const E=await fetch(f);if(!E.ok){const _=await E.text();throw console.error("[LoadoutLink] Proxy Error Response:",_),new Error(`Failed to fetch loadout from DIM (Status: ${E.status}).`)}const p=await E.text();let R;try{R=JSON.parse(p)}catch{throw console.error("[LoadoutLink] Failed to parse JSON. Raw response:",p),new Error("DIM Proxy returned an invalid response. See console for details.")}if(Tr=R,console.log("[LoadoutLink] RAW DIM RESPONSE:",JSON.stringify(R,null,2)),!R.loadout)throw new Error("No loadout data received from DIM");const A=R.loadout;if(A.parameters?.mods&&A.parameters.mods.length>0){const _=sr(A.parameters.mods);if(!A.parameters.modsByBucket)A.parameters.modsByBucket=_;else for(const[T,H]of Object.entries(_)){const C=parseInt(T),D=A.parameters.modsByBucket[C]||[];A.parameters.modsByBucket[C]=[...D,...H]}console.log("[LoadoutLink] Parsed mods array into modsByBucket:",A.parameters.modsByBucket)}return console.log("[LoadoutLink] Successfully fetched DIM loadout:",R.loadout.name),A}const r=o.match(/\/loadout\/([A-Za-z0-9+/=_-]+)/);if(!r)throw o.includes("loadout/")?new Error("Invalid loadout link format. Please paste a DIM share link or ExoEngine loadout link."):new Error("Not a recognizable loadout link. Please verify the URL.");const i=r[1].replace(/-/g,"+").replace(/_/g,"/"),c=atob(i),n=new Uint8Array(c.length);for(let m=0;m<c.length;m++)n[m]=c.charCodeAt(m);let l;if(n[0]===31&&n[1]===139)l=Ys.ungzip(n,{to:"string"});else if(n[0]===120)l=Ys.inflate(n,{to:"string"});else try{l=Ys.inflateRaw(n,{to:"string"})}catch{l=c}const d=l.replace(/\0+$/,"");let h;if(d.includes("\0")&&!d.startsWith("[")&&!d.startsWith("{")){const m=d.indexOf("\0"),f=d.substring(0,m),E=d.charCodeAt(m+1),p=d.indexOf("",m+2),_=(p>0?d.substring(m+2,p):d.substring(m+2)).split("|").filter(H=>H).map(H=>{const C=H.split(","),D=parseInt(C[0],36),F={};for(let ne=1;ne<C.length;ne++){const[K,v]=C[ne].split(":");K&&v&&(F[parseInt(K,36)]=parseInt(v,36))}return{hash:D,socketOverrides:F}});let T;if(p>0){const H=d.substring(p+1);T={mods:[],modsByBucket:{},exoticArmorHash:void 0};const C={};H.split(";").forEach(F=>{if(F.includes(":")){const ne=F.split(":"),K=ne[0],v=ne.slice(1).join(":");K&&v&&(C[K]=v)}}),C.m&&(T.mods=C.m.split(",").map(F=>parseInt(F,36))),C.b&&C.b.split("|").forEach(ne=>{const K=ne.split(":");if(K.length===2){const v=parseInt(K[0],36),W=K[1].split(",").map(g=>parseInt(g,36));T.modsByBucket[v]=W}}),C.e&&(T.exoticArmorHash=parseInt(C.e,36)),C.a&&(T.artifactPerks=C.a.split(",").map(F=>parseInt(F,36)))}h={id:`imported-${Date.now()}`,name:f,classType:E,equipped:_,parameters:T,source:"exoengine"}}else{const m=JSON.parse(d);if(Array.isArray(m)&&typeof m[0]=="string"&&typeof m[1]=="number"){const f=m[0],E=m[1];let p=m.indexOf(null,2);p===-1&&(p=m.length);const A=m.slice(2,p).map(T=>{if(typeof T=="number")return{hash:T,socketOverrides:{}};if(Array.isArray(T)){const H=T[0],C={};for(let D=1;D<T.length;D+=2)C[T[D]]=T[D+1];return{hash:H,socketOverrides:C}}return{hash:T,socketOverrides:{}}});let _;if(p<m.length-1){const T=m.slice(p+1);_={mods:Array.isArray(T[0])?T[0]:[],modsByBucket:typeof T[1]=="object"&&!Array.isArray(T[1])?T[1]:{},exoticArmorHash:typeof T[2]=="number"?T[2]:void 0,artifactPerks:Array.isArray(T[3])?T[3]:[]}}h={id:`imported-${Date.now()}`,name:f,classType:E,equipped:A,parameters:_}}else Array.isArray(m)&&m.length>=3&&!m[0].hasOwnProperty("length")?h={id:`imported-${Date.now()}`,name:m[0],classType:m[1],equipped:m[2].map(f=>{if(Array.isArray(f)){const E=f[0],p=f[1],R={};if(p)for(let A=0;A<p.length;A+=2)R[p[A]]=p[A+1];return{hash:E,socketOverrides:Object.keys(R).length>0?R:{}}}return{hash:f,socketOverrides:{}}}),parameters:m[3]?{mods:m[3].m||[],modsByBucket:m[3].mb||{},exoticArmorHash:m[3].ea,artifactPerks:m[3].ap||[]}:void 0}:m.n!==void 0&&m.c!==void 0&&m.e!==void 0?h={id:`imported-${Date.now()}`,name:m.n,classType:m.c,equipped:m.e.map(f=>({hash:f.h,socketOverrides:f.s||{}})),parameters:m.p?{mods:m.p.m||[],modsByBucket:m.p.mb||{},exoticArmorHash:m.p.ea,artifactPerks:m.p.ap||[]}:void 0}:h=m}if(!h.name||h.classType===void 0||!h.equipped)throw new Error("Loadout data is missing required fields");return h&&!h.source&&(h.source="dim"),h}catch(e){throw e instanceof Error?e:new Error("Failed to parse loadout link")}}function vn(o){try{let e="";const t=o.name.substring(0,20);if(e+=t+"\0",e+=String.fromCharCode(o.classType),o.equipped.forEach((l,d)=>{d>0&&(e+="|"),e+=l.hash.toString(36);const h=l.socketOverrides;h&&Object.keys(h).length>0&&Object.entries(h).forEach(([m,f])=>{e+=","+parseInt(m).toString(36)+":"+f.toString(36)})}),o.parameters&&(o.parameters.mods&&o.parameters.mods.length>0||o.parameters.modsByBucket&&Object.keys(o.parameters.modsByBucket).length>0||o.parameters.exoticArmorHash)){if(e+="",o.parameters.mods&&o.parameters.mods.length>0&&(e+=`;m:${o.parameters.mods.map(d=>d.toString(36)).join(",")}`),o.parameters.modsByBucket&&Object.keys(o.parameters.modsByBucket).length>0){const d=Object.entries(o.parameters.modsByBucket).map(([h,m])=>{const f=parseInt(h).toString(36),E=m.map(p=>p.toString(36)).join(",");return`${f}:${E}`});e+=`;b:${d.join("|")}`}o.parameters.exoticArmorHash&&(e+=`;e:${o.parameters.exoticArmorHash.toString(36)}`),o.parameters.artifactPerks&&o.parameters.artifactPerks.length>0&&(e+=`;a:${o.parameters.artifactPerks.map(d=>d.toString(36)).join(",")}`)}const r=new TextEncoder().encode(e),i=Ys.deflate(r,{level:9,windowBits:15}),c=btoa(String.fromCharCode(...i)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");return`${typeof window<"u"?window.location.origin:"https://exoengine.online"}/loadout/${c}`}catch(e){throw e}}function Fn(o){try{const e={id:o.id,name:o.name,classType:o.classType,equipped:o.equipped,unequipped:o.unequipped||[],parameters:o.parameters,notes:o.notes,destinyVersion:2,game:"d2",source:"ExoEngine"},t=JSON.stringify(e);return`https://app.destinyitemmanager.com/loadouts?loadout=${encodeURIComponent(t)}`}catch(e){throw e}}function kn(o){const e=o.equipped.find(n=>{const l=P.getItem(n.hash);return l?.itemType===16||l?.inventory?.bucketTypeHash===q.SUBCLASS});let t="solar";if(e){const n=P.getItem(e.hash),l=n?.talentGrid?.hudDamageType||n?.defaultDamageType||0;t={1:"kinetic",2:"arc",3:"solar",4:"void",5:"stasis",6:"strand",7:"prismatic"}[l]||"solar"}const a=o.equipped.find(n=>{const l=P.getItem(n.hash);return l?.tierType===6&&l.itemType===3}),r=o.equipped.find(n=>{const l=P.getItem(n.hash);return l?.tierType===6&&l.itemType===2}),i={subclassHash:e?.hash,superHash:0,aspects:[],fragments:[],grenadeHash:0,meleeHash:0,classAbilityHash:0};if(e&&e.socketOverrides){const n=P.getItem(e.hash);if(n&&n.sockets){const l=d=>(n.sockets.socketCategories||n.sockets.categories)?.find(m=>m.socketIndexes.includes(d))?.socketCategoryHash;for(const[d,h]of Object.entries(e.socketOverrides)){const m=parseInt(d),f=h,E=l(m),p=P.getItem(f);if(E===be.SUPER)i.superHash=f;else if(E===be.ABILITIES){if(p){const R=p.plug?.plugCategoryIdentifier||"";R.includes("class_abilities")?i.classAbilityHash=f:R.includes("grenades")?i.grenadeHash=f:R.includes("melee")?i.meleeHash=f:p.itemType===16&&(i.superHash=f)}}else if(E===be.ASPECTS)i.aspects?.push(f);else if(E===be.FRAGMENTS)i.fragments?.push(f);else if(p){const R=p.plug?.plugCategoryIdentifier||"";R.includes("aspects")?i.aspects?.push(f):R.includes("fragments")?i.fragments?.push(f):R.includes("super")&&(i.superHash=f)}}}}const c=[];for(const n of o.equipped){if(n.hash===a?.hash||n.hash===r?.hash||n.hash===e?.hash)continue;const l=P.getItem(n.hash);l?c.push({hash:n.hash,name:l.name,socketOverrides:n.socketOverrides}):c.push({hash:n.hash,name:"Unknown",socketOverrides:n.socketOverrides})}return{id:o.id||`imported-${Date.now()}`,name:o.name||"Imported Loadout",element:t,guardianClass:o.classType,exoticWeapon:{hash:a?.hash||0,name:"Unknown",slot:1},exoticArmor:{hash:r?.hash||0,name:"Unknown",slot:0},subclassConfig:i,armorMods:o.parameters?.mods||[],artifactPerks:o.parameters?.artifactPerks||[],items:c,playstyle:"Imported from Loadout Link",difficulty:"intermediate"}}function ya(o){const e=[],t={"0-Arc":2932390016,"0-Solar":2550323932,"0-Void":4178525824,"0-Stasis":613647804,"0-Strand":242419065,"0-Prismatic":3450112461,"1-Arc":2328211300,"1-Solar":2240888816,"1-Void":2453351420,"1-Stasis":873720784,"1-Strand":3785442599,"1-Prismatic":1040198773,"2-Arc":3168997075,"2-Solar":3941205951,"2-Void":2849050827,"2-Stasis":3291545503,"2-Strand":4204413574,"2-Prismatic":2806388174};o.exoticWeapon?.hash&&o.exoticWeapon.hash>0&&e.push({hash:o.exoticWeapon.hash,socketOverrides:o.exoticWeapon.socketOverrides||{}}),o.exoticArmor?.hash&&o.exoticArmor.hash>0&&e.push({hash:o.exoticArmor.hash,socketOverrides:o.exoticArmor.socketOverrides||{}}),o.items&&o.items.forEach(c=>e.push({hash:c.hash,socketOverrides:c.socketOverrides||{}}));const a=typeof o.element=="string"?o.element.charAt(0).toUpperCase()+o.element.slice(1).toLowerCase():String(o.element),r=`${o.guardianClass}-${a}`,i=o.subclassConfig?.subclassHash||t[r]||0;if(i){const c={},n=P.getItem(i);if(n?.sockets?.socketCategories){const l=p=>p.flatMap(R=>{const A=n.sockets.socketCategories.find(_=>_.socketCategoryHash===R);return A?A.socketIndexes:[]}).sort((R,A)=>R-A),d=l([be.ASPECTS,be.ASPECTS_IKORA,be.ASPECTS_STRANGER,be.ASPECTS_NEOMUNA]),h=l([be.FRAGMENTS,be.FRAGMENTS_IKORA,be.FRAGMENTS_STRANGER,be.FRAGMENTS_NEOMUNA]),m=l([be.SUPER]);o.subclassConfig?.superHash&&m.length>0&&(c[m[0]]=o.subclassConfig.superHash),o.subclassConfig?.aspects&&o.subclassConfig.aspects.forEach((p,R)=>{p&&R<d.length&&(c[d[R]]=p)}),o.subclassConfig?.fragments&&o.subclassConfig.fragments.forEach((p,R)=>{p&&R<h.length&&(c[h[R]]=p)});const f=l([be.ABILITIES,be.ABILITIES_IKORA]);[o.subclassConfig?.classAbilityHash,o.subclassConfig?.meleeHash,o.subclassConfig?.grenadeHash].filter(Boolean).forEach(p=>{const R=P.getItem(p);if(!R)return;const A=f.find(_=>{if(c[_])return!1;const T=n.sockets.socketEntries[_];if(!T)return!1;const H=P.getRawDefinition("DestinySocketTypeDefinition",T.socketTypeHash);return H?.plugWhitelist?H.plugWhitelist.some(C=>C.categoryHash===R.plug?.plugCategoryHash):!1});A!==void 0&&(c[A]=p)})}else o.subclassConfig?.superHash&&(c[0]=o.subclassConfig.superHash),o.subclassConfig?.aspects?.[0]&&(c[1]=o.subclassConfig.aspects[0]),o.subclassConfig?.aspects?.[1]&&(c[2]=o.subclassConfig.aspects[1]),o.subclassConfig?.fragments?.forEach((l,d)=>{l&&(c[10+d]=l)}),o.subclassConfig?.grenadeHash&&(c[20]=o.subclassConfig.grenadeHash),o.subclassConfig?.meleeHash&&(c[21]=o.subclassConfig.meleeHash),o.subclassConfig?.classAbilityHash&&(c[22]=o.subclassConfig.classAbilityHash);e.push({hash:i,socketOverrides:c})}return{id:o.id,name:o.name,classType:o.guardianClass,equipped:e,parameters:{mods:o.armorMods,exoticArmorHash:o.exoticArmor?.hash,artifactPerks:o.artifactPerks}}}async function wn(o){try{const e=JSON.stringify(o),a=new TextEncoder().encode(e);if(typeof CompressionStream<"u"){const i=new Blob([a]).stream().pipeThrough(new CompressionStream("gzip")),c=await new Response(i).blob(),n=new Uint8Array(await c.arrayBuffer());return`/loadout/${btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}`}else return`/loadout/${btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}`}catch{throw new Error("Failed to generate loadout link")}}async function Gn(){try{throw new Error("DIM link generation requires DIM API access. Use ExoEngine link instead (S key).")}catch(o){throw o}}const ar={parseLoadoutLink:Dn,generateExoEngineLink:vn,generateDIMCompatibleLink:Fn,generateLoadoutLink:wn,generateDIMLink:Gn,getLastDebugRaw:bn,importDIMJson:xn,convertToBuildTemplate:kn,convertBuildToLoadoutShareData:ya};function xn(o){const e=[];return o.name&&o.equipped?e.push(o):o.loadouts&&Array.isArray(o.loadouts)&&o.loadouts.forEach(t=>{t.loadout&&e.push(t.loadout)}),e}const Ea={};function rr(o){const e=o.toLowerCase().trim(),t=j.getState(),{characterEquipment:a,characterInventories:r,vaultInventory:i}=t,c=new Set;for(const n of Object.values(a))for(const l of n)c.add(l.itemHash);for(const n of Object.values(r))for(const l of n)c.add(l.itemHash);for(const n of i)c.add(n.itemHash);for(const n of c)if(P.getItem(n)?.displayProperties?.name?.toLowerCase()===e)return n}function is(o,e,t){if(!o)return null;let a=null;(e===0||e==="Titan")&&(a="TITAN"),(e===1||e==="Hunter")&&(a="HUNTER"),(e===2||e==="Warlock")&&(a="WARLOCK");const r=t.toUpperCase();if(!a||!s[r])return null;const i=l=>l.toLowerCase().replace(/['â€™]/g,"").replace(/[^a-z0-9 ]/g,"").trim().replace(/ /g,"_").toUpperCase();if(r==="PRISMATIC"){const l=s.PRISMATIC[a];if(!l)return null;const h=(m=>{const f=i(o);if(typeof m=="object"){if(m[f])return m[f];for(const E in m){const p=m[E];if(typeof p=="number"){if(E===f)return p}else if(typeof p=="object"&&p[f])return p[f]}}return null})(l);if(h)return h;if(s.PRISMATIC.FRAGMENTS){const m=i(o);if(s.PRISMATIC.FRAGMENTS[m])return s.PRISMATIC.FRAGMENTS[m]}return null}const c=s,n=c[r]?.[a];if(n){const l=i(o);if(n.SUPER?.[l])return n.SUPER[l];if(n.JUMPS?.[l])return n.JUMPS[l];if(n.MELEE?.[l])return n.MELEE[l];if(n.GRENADES?.[l])return n.GRENADES[l];if(n.CLASS_ABILITIES?.[l])return n.CLASS_ABILITIES[l];if(n.ASPECTS?.[l])return n.ASPECTS[l];if(c[r]?.FRAGMENTS?.[l])return c[r].FRAGMENTS[l]}return null}function Xt(o,e){if(!o)return null;const t=`${e}-${o.toLowerCase()}`;if(Ea[t])return Ea[t];const a=o.toLowerCase().trim(),r=j.getState(),{characterEquipment:i,itemInstances:c}=r;for(const n of Object.values(i))for(const l of n){const d=l.itemInstanceId?c[l.itemInstanceId]:null;if(d?.sockets)for(const h of d.sockets){if(!h.plugHash)continue;const m=P.getItem(h.plugHash);if(!m?.displayProperties?.name)continue;const f=m.displayProperties.name.toLowerCase(),E=m.plug?.plugCategoryIdentifier?.toLowerCase()||"";if(f===a||f.includes(a)||a.includes(f)){let p=!1;switch(e){case"super":p=E.includes("super");break;case"ability":p=E.includes("grenade")||E.includes("melee")||E.includes("class_abilities")||E.includes("movement");break;case"aspect":p=E.includes("aspects");break;case"fragment":p=E.includes("fragments")||E.includes("facets");break}if(p)return Ea[t]=h.plugHash,h.plugHash}}}return null}const Bn={"0-Arc":2932390016,"0-Solar":2550323932,"0-Void":4178525824,"0-Stasis":613647804,"0-Strand":242419065,"0-Prismatic":3450112461,"1-Arc":2328211300,"1-Solar":2240888816,"1-Void":2453351420,"1-Stasis":873720784,"1-Strand":3785442599,"1-Prismatic":1040198773,"2-Arc":3168997075,"2-Solar":3941205951,"2-Void":2849050827,"2-Stasis":3291545503,"2-Strand":4204413574,"2-Prismatic":2806388174};function Un({synergy:o,onClose:e,onEquip:t}){const a=["Titan","Hunter","Warlock"],{success:r,error:i}=Nn(),[c,n]=I.useState(null),[l,d]=I.useState(!1),[h,m]=I.useState(null),[f,E]=I.useState(null),[p,R]=I.useState({x:0,y:0}),A=W=>{const{clientX:g,clientY:$}=W,{innerWidth:ee,innerHeight:z}=window,Ae=g/ee-.5,ae=$/z-.5;R({x:Ae,y:ae})},{isLoaded:_}=Oa(),[T,H]=I.useState({superHash:0,superIcon:"",superName:"",grenadeHash:0,grenadeIcon:"",grenadeName:"",meleeHash:0,meleeIcon:"",meleeName:"",classAbilityHash:0,classAbilityIcon:"",classAbilityName:"",jumpHash:0,jumpIcon:"",jumpName:"",aspects:[],fragments:[],weaponHash:0,weaponIcon:"",armorHash:0,armorIcon:""}),C=I.useCallback(()=>{const W=o.element.charAt(0).toUpperCase()+o.element.slice(1).toLowerCase(),g=`${o.classType}-${W}`,$=Bn[g]||0;return{id:`synergy-${Date.now()}`,name:o.buildName,element:o.element.toLowerCase(),guardianClass:o.classType,exoticWeapon:{hash:T.weaponHash||0,name:o.weapon,slot:1},exoticArmor:{hash:T.armorHash||0,name:o.armor,slot:0},subclassConfig:{subclassHash:$,superHash:T.superHash,aspects:T.aspects.map(ee=>ee.hash).filter(ee=>ee>0),fragments:T.fragments.map(ee=>ee.hash).filter(ee=>ee>0),grenadeHash:T.grenadeHash,meleeHash:T.meleeHash,classAbilityHash:T.classAbilityHash},armorMods:[],artifactPerks:[],items:[],playstyle:o.description,difficulty:"intermediate"}},[o,T]),D=I.useCallback(async()=>{try{const W=C(),g=ya(W),$=await ar.generateExoEngineLink(g);await navigator.clipboard.writeText($),r("ExoEngine Link copied to clipboard!")}catch{i("Failed to generate link")}},[C,r,i]),F=I.useCallback(()=>{try{const W=C(),g=ya(W),$=ar.generateDIMCompatibleLink(g);navigator.clipboard.writeText($),r("DIM Link copied to clipboard!")}catch{i("Failed to generate DIM link")}},[C,r,i]);I.useEffect(()=>{const W=$=>{$.key.toLowerCase()==="a"&&d(ee=>!ee),$.key.toLowerCase()==="f"&&t&&(t(o),Ss.getState().triggerGlobalTransmat("success")),$.key.toLowerCase()==="s"&&D(),$.key.toLowerCase()==="d"&&F(),$.key==="Escape"&&e()},g=$=>{$.preventDefault(),e()};return window.addEventListener("keydown",W),window.addEventListener("contextmenu",g),()=>{window.removeEventListener("keydown",W),window.removeEventListener("contextmenu",g)}},[e,t,o,D,F]),I.useEffect(()=>{if(!_)return;async function W(){const g={superHash:0,superIcon:"",superName:"",grenadeHash:0,grenadeIcon:"",grenadeName:"",meleeHash:0,meleeIcon:"",meleeName:"",classAbilityHash:0,classAbilityIcon:"",classAbilityName:"",jumpHash:0,jumpIcon:"",jumpName:"",aspects:[],fragments:[],weaponHash:0,weaponIcon:"",armorHash:0,armorIcon:""},$=o.weapon?rr(o.weapon):void 0,ee=o.armor?rr(o.armor):void 0;if($){g.weaponHash=$,g.weaponIcon=P.getIcon($)||"";const Ie=P.getItem($);Ie?.screenshot&&n(Ie.screenshot)}if(ee&&(g.armorHash=ee,g.armorIcon=P.getIcon(ee)||"",!c)){const Ie=P.getItem(ee);Ie?.screenshot&&n(Ie.screenshot)}const z=is(o.super,o.classType,o.element)||Xt(o.super,"super");z&&(g.superHash=z,g.superIcon=P.getIcon(z)||"",g.superName=o.super);const Ae=is(o.grenade,o.classType,o.element)||Xt(o.grenade,"ability");Ae&&(g.grenadeHash=Ae,g.grenadeIcon=P.getIcon(Ae)||"",g.grenadeName=o.grenade);const ae=is(o.melee,o.classType,o.element)||Xt(o.melee,"ability");ae&&(g.meleeHash=ae,g.meleeIcon=P.getIcon(ae)||"",g.meleeName=o.melee);const Ne=is(o.classAbility,o.classType,o.element)||Xt(o.classAbility,"ability");Ne&&(g.classAbilityHash=Ne,g.classAbilityIcon=P.getIcon(Ne)||"",g.classAbilityName=o.classAbility);const Me=is(o.jump,o.classType,o.element)||Xt(o.jump,"ability");if(Me&&(g.jumpHash=Me,g.jumpIcon=P.getIcon(Me)||"",g.jumpName=o.jump),o.element.toLowerCase()==="prismatic"&&(g.transcendenceIcon=P.getIcon(3976332159)||"",o.transcendentAbility)){const Ie=Xt(o.transcendentAbility,"ability");Ie&&(g.transcendentAbilityHash=Ie,g.transcendentAbilityIcon=P.getIcon(Ie)||"",g.transcendentAbilityName=o.transcendentAbility)}for(const Ie of o.aspects){const Fe=is(Ie,o.classType,o.element)||Xt(Ie,"aspect");if(Fe){const it=P.getIcon(Fe)||"";g.aspects.push({hash:Fe,icon:it,name:Ie})}}for(const Ie of o.fragments){const Fe=is(Ie,o.classType,o.element)||Xt(Ie,"fragment");if(Fe){const it=P.getIcon(Fe)||"";g.fragments.push({hash:Fe,icon:it,name:Ie})}}H(g)}W()},[o,_]);const{renderCompactMods:ne}={renderCompactMods:(g,$=null,ee=null)=>{const{mainStat:z,secondaryStat:Ae,others:ae}=Mn(g),Ne=Ie=>{const Fe=Ie?P.getItem(Ie):null;return Fe?S.jsx("div",{className:"mod-pod cosmetic-pod",onMouseEnter:()=>E(Ie),onMouseLeave:()=>E(null),children:S.jsx("img",{src:$e(Fe.displayProperties?.icon||""),alt:""})},Ie):S.jsx("div",{className:"mod-pod cosmetic-pod placeholder-pod"})},Me=Ie=>{const Fe=P.getItem(Ie);return Fe?S.jsx("div",{className:"mod-pod",onMouseEnter:()=>E(Ie),onMouseLeave:()=>E(null),children:S.jsx("img",{src:$e(Fe.displayProperties?.icon||""),alt:""})},Ie):null};return S.jsxs("div",{className:"armor-mods-pod-grid",children:[Ne(ee?.hash),Ne($?.hash),z&&Me(z),Ae&&Me(Ae),ae.map(Ie=>Me(Ie))]})}},K=W=>{m(W)},v=o.element.toLowerCase();return Ut.createPortal(S.jsxs("div",{className:`synergy-build-overlay synergy-build-overlay--${v}`,onMouseMove:A,style:{"--parallax-x":p.x,"--parallax-y":p.y},children:[S.jsxs("div",{className:"synergy-build-overlay__bg",children:[S.jsx("div",{className:"synergy-build-overlay__pattern"}),c&&S.jsx("img",{src:c,className:"synergy-build-overlay__screenshot",alt:""}),S.jsx("div",{className:"synergy-build-overlay__vignette"})]}),S.jsx("div",{className:"synergy-build-overlay__header",children:S.jsxs("div",{className:"synergy-build-overlay__title-group",children:[S.jsx("h1",{className:"synergy-build-overlay__name",children:o.buildName}),S.jsxs("div",{className:"synergy-build-overlay__subtitle",children:[S.jsx("span",{className:`element-badge element-badge--${v}`,children:o.element}),S.jsxs("span",{children:[a[o.classType]," â€¢ ",o.subclassType]})]})]})}),S.jsxs("div",{className:"synergy-build-overlay__content",children:[S.jsx("div",{className:"build-section build-section--super",children:T.superIcon&&S.jsx("div",{className:"super-node-large",onMouseEnter:()=>K(T.superHash),onMouseLeave:()=>K(null),children:S.jsx("img",{src:T.superIcon,alt:T.superName})})}),S.jsxs("div",{className:"build-section--middle",children:[S.jsxs("div",{className:"build-section--middle__top-row",children:[S.jsxs("div",{className:"node-section section-abilities",children:[S.jsx("div",{className:"node-section-header-prefixed",children:"| ABILITIES"}),S.jsxs("div",{className:"node-section-content",children:[T.classAbilityIcon&&S.jsx("div",{className:`build-item element--${v}`,onMouseEnter:()=>K(T.classAbilityHash),onMouseLeave:()=>K(null),children:S.jsx("img",{src:T.classAbilityIcon,alt:T.classAbilityName})}),T.jumpIcon&&S.jsx("div",{className:`build-item element--${v}`,onMouseEnter:()=>K(T.jumpHash),onMouseLeave:()=>K(null),children:S.jsx("img",{src:T.jumpIcon,alt:T.jumpName})}),T.grenadeIcon&&S.jsx("div",{className:`build-item element--${v}`,onMouseEnter:()=>K(T.grenadeHash),onMouseLeave:()=>K(null),children:S.jsx("img",{src:T.grenadeIcon,alt:T.grenadeName})}),T.meleeIcon&&S.jsx("div",{className:`build-item element--${v}`,onMouseEnter:()=>K(T.meleeHash),onMouseLeave:()=>K(null),children:S.jsx("img",{src:T.meleeIcon,alt:T.meleeName})})]})]}),S.jsxs("div",{className:"node-section section-aspects",children:[S.jsx("div",{className:"node-section-header-prefixed",children:"| ASPECTS"}),S.jsxs("div",{className:"node-section-content",children:[T.aspects.map((W,g)=>S.jsx("div",{className:`build-item element--${v}`,onMouseEnter:()=>K(W.hash),onMouseLeave:()=>K(null),children:S.jsx("img",{src:W.icon,alt:W.name})},g)),T.transcendenceIcon&&S.jsx("div",{className:"build-item element--prismatic",onMouseEnter:()=>K(3976332159),onMouseLeave:()=>K(null),children:S.jsx("img",{src:T.transcendenceIcon,alt:"Transcendence"})})]})]})]}),S.jsx("div",{className:"build-section--middle__bottom-row",children:S.jsxs("div",{className:"node-section section-fragments",children:[S.jsx("div",{className:"node-section-header-prefixed",children:"| FRAGMENTS"}),S.jsx("div",{className:"synergy-build-overlay__fragments-grid",children:T.fragments.map((W,g)=>S.jsx("div",{className:`build-item build-item--fragment element--${v}`,onMouseEnter:()=>K(W.hash),onMouseLeave:()=>K(null),children:S.jsx("img",{src:W.icon,alt:W.name})},g))})]})}),S.jsx("div",{className:"build-section--middle__gear-row",children:S.jsxs("div",{className:"node-section section-gear",children:[S.jsx("div",{className:"node-section-header-prefixed",children:"| LOADOUT & GEAR"}),S.jsxs("div",{className:"synergy-build-overlay__gear-horizontal-grid",children:[T.weaponIcon&&S.jsxs("div",{className:"gear-item-horizontal",onMouseEnter:()=>E(T.weaponHash||null),onMouseLeave:()=>E(null),children:[S.jsx(er,{hash:T.weaponHash||0,instance:{state:4}}),S.jsx("div",{className:"gear-item-info",children:S.jsx("span",{className:"build-item__label--compact",children:o.weapon})})]}),T.armorHash>0&&S.jsxs("div",{className:"gear-item-horizontal",onMouseEnter:()=>E(T.armorHash||null),onMouseLeave:()=>E(null),children:[S.jsx(er,{hash:T.armorHash||0,instance:{state:4}}),S.jsxs("div",{className:"gear-item-info",children:[S.jsx("span",{className:"build-item__label--compact",children:o.armor}),o.armorMods&&o.armorMods.length>0&&ne(o.armorMods)]})]})]})]})})]})]}),S.jsxs("div",{className:`synergy-build-overlay__lore-panel ${l?"synergy-build-overlay__lore-panel--open":""}`,children:[S.jsx("div",{className:"lore-panel__header",children:S.jsx("h2",{className:"lore-panel__title",children:"Build Strategy"})}),S.jsx("div",{className:"lore-panel__content",children:o.description})]}),(h||f)&&S.jsx(Xs,{item:{hash:h||f}})]}),document.body)}const js={solar:"#f97316",arc:"#7df9ff",void:"#a855f7",stasis:"#4d88ff",strand:"#10b981",prismatic:"#ff6be8",kinetic:"#ffffff"};function Wn({connections:o,sourcePosition:e,sourceNodeId:t,getItemPosition:a,onEquipSynergy:r,onSynergyOverlayChange:i,itemInstances:c,onWireClick:n,onWireHoverChange:l,onWireHover:d,onWireLock:h,onClose:m,isExiting:f=!1,syncedWirePositions:E,hoveredNodeId:p,forceCloseTrigger:R}){const[A,_]=I.useState(null),[T,H]=I.useState(null),[C,D]=I.useState([]),[F,ne]=I.useState(0),[K,v]=I.useState(1),[W,g]=I.useState(null);I.useEffect(()=>{R&&R>0&&Et()},[R]);const $=I.useRef(null),ee=I.useRef(null),z=I.useRef(null),Ae=I.useRef(E),ae=I.useRef(null),Ne=I.useRef(null),Me=A&&C.find(x=>x.synergy.buildName===A.buildName&&x.targetType===A.targetType)||null,Ie=T&&C.find(x=>x.synergy.buildName===T.buildName&&x.targetType===T.targetType)||null;I.useEffect(()=>{ee.current=Me},[Me]),I.useEffect(()=>{z.current=T},[T]),I.useEffect(()=>()=>{ae.current&&clearTimeout(ae.current),Ne.current&&clearTimeout(Ne.current)},[]),I.useEffect(()=>{Ae.current=E},[E]);const Fe=I.useRef(!1);I.useEffect(()=>{if(p){const x=C.find(he=>he.armorResult?.item.itemInstanceId===p||he.weaponResult?.item.itemInstanceId===p);if(x){ae.current&&(clearTimeout(ae.current),ae.current=null);const he={buildName:x.synergy.buildName,targetType:x.targetType,abilityName:x.abilityName};(A?.buildName!==he.buildName||A?.targetType!==he.targetType||A?.abilityName!==he.abilityName)&&_(he),Fe.current||(Fe.current=!0,l?.(!0),d?.({armorInstanceId:x.armorResult?.item.itemInstanceId||null,weaponInstanceId:x.weaponResult?.item.itemInstanceId||null}))}}},[p,C,A,l,d]),I.useEffect(()=>{if(!f){v(1);return}const x=performance.now(),he=400,Se=fe=>{const ce=fe-x,Ze=1-Math.min(ce/he,1);v(Ze*Ze),Ze>0&&requestAnimationFrame(Se)};requestAnimationFrame(Se)},[f]),I.useEffect(()=>{if(!e||!o.length||f){D([]);return}let x;const he={current:""},Se=()=>{const fe=Ae.current,ce=[];let Ze=e.x,ot=e.y,ie=e.scale??1;if(t){const oe=a("","equipped",void 0,t);oe&&(Ze=oe.x,ot=oe.y,ie=oe.scale)}const Oe={},At=t?.includes("subclass");let tt="";if(t&&At){const oe=t.match(/subclass-(\d+)/);if(oe){const Be=parseInt(oe[1]);tt={2366883719:"solar",240538059:"void",139534062:"arc",1256795856:"stasis",1811800262:"strand",2732997195:"prismatic",2240825105:"solar",245081432:"void",3164832584:"arc",3291544903:"stasis",3828340157:"strand",2835214899:"prismatic",2024474330:"solar",2007421831:"void",1215437841:"arc",1530663428:"stasis",531398864:"strand",2984351206:"prismatic",1262901524:"prismatic"}[Be]||""}}if(!tt&&o.length>0&&(tt=o[0].element.toLowerCase()),fe&&fe.length>0){let oe=0;for(const Be of o){const ze=Be.element.toLowerCase();Oe[ze]===void 0&&(Oe[ze]=a(`${ze} subclass`,"equipped"));const Ue=Oe[ze],Tt=Ue?.nodeId===t,St=At&&!Tt,_t=St?Ue?.x:void 0,wt=St?Ue?.y:void 0;if(Be.armorResult&&oe<fe.length){const Je=fe[oe++];ce.push({sourceX:Ze,sourceY:ot,sourceScale:ie,hubX:_t,hubY:wt,hubScale:Ue?.scale,hubOpacity:Ue?.opacity,targetX:Je.targetX,targetY:Je.targetY,targetScale:Je.targetScale,targetOpacity:Je.targetOpacity,targetOpacityActual:Je.targetOpacity,targetRadius:Je.targetRadius,element:tt||Be.element,synergy:Be.synergy,armorResult:Be.armorResult,weaponResult:Be.weaponResult,targetType:"armor"})}if(Be.weaponResult&&oe<fe.length){const Je=fe[oe++];ce.push({sourceX:Ze,sourceY:ot,sourceScale:ie,hubX:_t,hubY:wt,hubScale:Ue?.scale,hubOpacity:Ue?.opacity,targetX:Je.targetX,targetY:Je.targetY,targetScale:Je.targetScale,targetOpacity:Je.targetOpacity,targetOpacityActual:Je.targetOpacity,targetRadius:Je.targetRadius,element:tt||Be.element,synergy:Be.synergy,armorResult:Be.armorResult,weaponResult:Be.weaponResult,targetType:"weapon"})}}}else for(const oe of o){const Be=oe.element.toLowerCase();Oe[Be]===void 0&&(Oe[Be]=a(`${Be} subclass`,"equipped"));const ze=Oe[Be],Ue=ze?.nodeId===t,Tt=At&&!Ue,St=Tt?ze?.x:void 0,_t=Tt?ze?.y:void 0;let wt=null,Je=null;oe.armorResult&&(wt=a(oe.synergy.armor,oe.armorResult.location,oe.armorResult.characterId,oe.armorResult.item.itemInstanceId)),oe.weaponResult&&(Je=a(oe.synergy.weapon,oe.weaponResult.location,oe.weaponResult.characterId,oe.weaponResult.item.itemInstanceId));const we=(ct,Ce)=>{ct&&ce.push({sourceX:Ze,sourceY:ot,sourceScale:ie,hubX:St,hubY:_t,hubScale:ze?.scale,hubOpacity:ze?.opacity,targetX:ct.x,targetY:ct.y,targetScale:ct.scale,targetOpacity:ct.opacity,targetOpacityActual:ct.opacity,targetRadius:Math.max(0,32*ct.scale),element:oe.element,synergy:oe.synergy,armorResult:oe.armorResult,weaponResult:oe.weaponResult,targetType:Ce})};we(wt,"armor"),we(Je,"weapon");const Le=A?.buildName===oe.synergy.buildName,mt=T?.buildName===oe.synergy.buildName;if(Le||mt){const ct=[{name:oe.synergy.super,type:"super"},{name:oe.synergy.grenade,type:"grenade"},{name:oe.synergy.melee,type:"melee"},{name:oe.synergy.classAbility,type:"classAbility"},...(oe.synergy.aspects||[]).map(Ce=>({name:Ce,type:"aspect"})),...(oe.synergy.fragments||[]).map(Ce=>({name:Ce,type:"fragment"}))];for(const Ce of ct){if(!Ce.name)continue;const ut=a(Ce.name,"equipped");ut&&ce.push({sourceX:Ze,sourceY:ot,sourceScale:ie,hubX:St,hubY:_t,hubScale:ze?.scale,hubOpacity:ze?.opacity,targetX:ut.x,targetY:ut.y,targetScale:ut.scale*.8,targetOpacity:ut.opacity,targetOpacityActual:ut.opacity,targetRadius:Math.max(0,24*ut.scale),element:oe.element,synergy:oe.synergy,armorResult:oe.armorResult,weaponResult:oe.weaponResult,targetType:"ability",abilityName:Ce.name})}}}const Pe=JSON.stringify(ce.map(oe=>({tx:Math.round(oe.targetX),ty:Math.round(oe.targetY),ts:oe.targetScale.toFixed(3),to:oe.targetOpacity.toFixed(2)})));Pe!==he.current&&(he.current=Pe,D(ce)),x=requestAnimationFrame(Se)};return x=requestAnimationFrame(Se),()=>cancelAnimationFrame(x)},[o,e,t,a,f]),I.useEffect(()=>{if(!o.length)return;const x=performance.now(),he=600,Se=fe=>{const ce=Math.min((fe-x)/he,1);ne(ce),ce<1&&requestAnimationFrame(Se)};requestAnimationFrame(Se)},[o]);const it=I.useCallback((x,he=1)=>{const{sourceX:Se,sourceY:fe,targetX:ce,targetY:Ze,targetScale:ot}=x,ie=ce-Se,Oe=Ze-fe,At=Math.sqrt(ie*ie+Oe*Oe),tt=Math.min(At*.25,300),Pe=Math.max(20,tt)*ot,oe=Se+ie*.25,Be=fe+Oe*.25-Pe,ze=Se+ie*.75,Ue=fe+Oe*.75+Pe,Tt=Se+ie*he,St=fe+Oe*he;return he<1?`M ${Se} ${fe} Q ${oe} ${Be} ${Tt} ${St}`:`M ${Se} ${fe} C ${oe} ${Be} ${ze} ${Ue} ${ce} ${Ze}`},[]),Kt=I.useCallback(x=>{if(ae.current&&(clearTimeout(ae.current),ae.current=null),!z.current){if(ee.current?.synergy.buildName===x.synergy.buildName&&ee.current?.targetType===x.targetType)return;Ne.current&&clearTimeout(Ne.current),Ne.current=setTimeout(()=>{_({buildName:x.synergy.buildName,targetType:x.targetType}),l?.(!0),d?.({armorInstanceId:x.armorResult?.item.itemInstanceId||null,weaponInstanceId:x.weaponResult?.item.itemInstanceId||null}),Ne.current=null},200)}},[l,d]),ke=I.useCallback(()=>{z.current||(Ne.current&&(clearTimeout(Ne.current),Ne.current=null),ae.current=setTimeout(()=>{_(null),l?.(!1),d?.(null),ae.current=null},150))},[l,d]),Ot=I.useCallback(()=>{z.current||(ae.current&&clearTimeout(ae.current),ae.current=setTimeout(()=>{_(null),l?.(!1),d?.(null),ae.current=null},150))},[l,d]),Mt=I.useCallback(()=>{ae.current&&(clearTimeout(ae.current),ae.current=null);const x=Ie||ee.current;x&&(_({buildName:x.synergy.buildName,targetType:x.targetType}),d?.({armorInstanceId:x.armorResult?.item.itemInstanceId||null,weaponInstanceId:x.weaponResult?.item.itemInstanceId||null})),l?.(!0)},[l,d,Ie]),Ct=I.useCallback(x=>{re("SynergyWeb",`End node click: ${x.targetType}`,x);const he={buildName:x.synergy.buildName,targetType:x.targetType};if(z.current?.buildName===he.buildName&&z.current?.targetType===he.targetType)H(null),_(null),l?.(!1),d?.(null),h?.(null);else{H(he),_(he),l?.(!0),d?.({armorInstanceId:x.armorResult?.item.itemInstanceId||null,weaponInstanceId:x.weaponResult?.item.itemInstanceId||null});const fe=x.targetType==="armor"?x.armorResult?.item.itemInstanceId:x.weaponResult?.item.itemInstanceId;re("SynergyWeb",`Calling onWireLock: ${fe}`),h?.(fe||null)}},[l,d,h]),cs=I.useCallback(()=>{z.current&&(H(null),_(null),l?.(!1),d?.(null),h?.(null))},[l,d,h]),bt=I.useCallback(x=>{g(x),_(null),l?.(!1),i&&i(!0,x)},[l,i]),Et=I.useCallback(()=>{g(null),i&&i(!1,null)},[i]),ps=I.useCallback(x=>{if(!x)return null;const he=`synergy-wire-${x.synergy.buildName}-${x.synergy.armor}-${x.synergy.weapon}`;return S.jsx("div",{className:"synergy-web__combined-tooltip",onMouseEnter:Mt,onMouseLeave:Ot,children:S.jsxs("div",{className:"synergy-web__combined-tooltip-items",children:[x.armorResult?.item&&S.jsx("div",{className:"synergy-web__combined-tooltip-item",children:S.jsx(Xs,{item:x.armorResult.item,instance:x.armorResult.item.itemInstanceId?c[x.armorResult.item.itemInstanceId]:void 0,inline:!0,followMouse:!1,hideZoomButtons:!1,clickActionLabel:"Confirm Synergy",onClick:()=>bt(x.synergy),hideSynergizeAction:!0},`${he}-armor`)}),x.weaponResult?.item&&S.jsx("div",{className:"synergy-web__combined-tooltip-item",children:S.jsx(Xs,{item:x.weaponResult.item,instance:x.weaponResult.item.itemInstanceId?c[x.weaponResult.item.itemInstanceId]:void 0,inline:!0,followMouse:!1,hideZoomButtons:!1,onClick:()=>bt(x.synergy),hideSynergizeAction:!0},`${he}-weapon`)})]})})},[Mt,Ot,c,bt]),es=I.useCallback(x=>{Ct(x),n&&n(x.synergy)},[n,Ct]);if(I.useEffect(()=>{const x=he=>{if(he.key==="Escape"){if(z.current){H(null),_(null),l?.(!1),d?.(null),h?.(null);return}m&&m()}};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[m,l,d,h]),!C.length)return null;const Cs=C.reduce((x,he)=>(x[he.element]||(x[he.element]=[]),x[he.element].push(he),x),{}),kt=Ie||Me;return S.jsxs("div",{className:"synergy-web",onClick:cs,children:[S.jsxs("svg",{ref:$,className:"synergy-web__svg",style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,pointerEvents:"auto"},children:[S.jsxs("defs",{children:[S.jsxs("filter",{id:"glow-solar",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[S.jsx("feGaussianBlur",{stdDeviation:"3",result:"blur1"}),S.jsx("feGaussianBlur",{stdDeviation:"8",result:"blur2"}),S.jsx("feColorMatrix",{in:"blur2",type:"matrix",values:`\r
                            1.2 0 0 0 0\r
                            0.8 0 0 0 0\r
                            0 0 0 0 0\r
                            0 0 0 1 0`,result:"orangeGlow"}),S.jsxs("feMerge",{children:[S.jsx("feMergeNode",{in:"orangeGlow"}),S.jsx("feMergeNode",{in:"blur1"}),S.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),S.jsxs("filter",{id:"glow-arc",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[S.jsx("feTurbulence",{type:"fractalNoise",baseFrequency:"2",numOctaves:"2",result:"noise",seed:"1"}),S.jsx("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"1.5",result:"displacement"}),S.jsx("feGaussianBlur",{in:"displacement",stdDeviation:"2",result:"blur"}),S.jsx("feColorMatrix",{in:"blur",type:"matrix",values:`\r
                            0.5 0 0 0 0\r
                            0.8 0 0 0 0\r
                            1 0 0 0 0\r
                            0 0 0 1 0`,result:"cyanGlow"}),S.jsxs("feMerge",{children:[S.jsx("feMergeNode",{in:"cyanGlow"}),S.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),S.jsxs("filter",{id:"glow-void",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[S.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),S.jsxs("feMerge",{children:[S.jsx("feMergeNode",{in:"blur"}),S.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),S.jsxs("filter",{id:"glow-stasis",x:"-80%",y:"-80%",width:"260%",height:"260%",children:[S.jsx("feGaussianBlur",{stdDeviation:"1",result:"blur1"}),S.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur2"}),S.jsx("feColorMatrix",{in:"blur2",type:"matrix",values:`\r
                            0.3 0 0 0 0\r
                            0.5 0 0 0 0\r
                            1 0 0 0 0.2\r
                            0 0 0 1 0`,result:"iceGlow"}),S.jsxs("feMerge",{children:[S.jsx("feMergeNode",{in:"iceGlow"}),S.jsx("feMergeNode",{in:"blur1"}),S.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),S.jsxs("filter",{id:"glow-strand",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[S.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),S.jsxs("feMerge",{children:[S.jsx("feMergeNode",{in:"blur"}),S.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),S.jsxs("filter",{id:"glow-prismatic",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[S.jsx("feGaussianBlur",{stdDeviation:"5",result:"blur1"}),S.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur2"}),S.jsx("feColorMatrix",{in:"blur1",type:"matrix",values:`\r
                            1 0 0 0 0.3\r
                            0.5 0 0 0 0\r
                            1 0 0 0 0.4\r
                            0 0 0 1 0`,result:"pinkGlow"}),S.jsx("feColorMatrix",{in:"blur2",type:"matrix",values:`\r
                            1 0 0 0 0.4\r
                            0.8 0 0 0 0.2\r
                            0.6 0 0 0 0\r
                            0 0 0 0.5 0`,result:"rainbowGlow"}),S.jsxs("feMerge",{children:[S.jsx("feMergeNode",{in:"rainbowGlow"}),S.jsx("feMergeNode",{in:"pinkGlow"}),S.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),S.jsxs("linearGradient",{id:"prismatic-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[S.jsx("stop",{offset:"0%",stopColor:"#ff8df6"}),S.jsx("stop",{offset:"100%",stopColor:"#eecc44"})]}),Object.entries(Cs).map(([x,he])=>he.map((Se,fe)=>{const ce=`fade-${x}-${fe}`,Ze=Se.hubX!==void 0&&Se.hubY!==void 0,ot=Ze?Se.hubX:Se.sourceX,ie=Ze?Se.hubY:Se.sourceY,Oe=Se.targetX,At=Se.targetY,tt=js[x]||"#fff",Pe=tt;return S.jsxs("linearGradient",{id:ce,gradientUnits:"userSpaceOnUse",x1:ot,y1:ie,x2:Oe,y2:At,children:[S.jsx("stop",{offset:"0%",stopColor:tt,stopOpacity:1}),S.jsx("stop",{offset:"30%",stopColor:tt,stopOpacity:.7}),S.jsx("stop",{offset:"100%",stopColor:Pe,stopOpacity:.2})]},ce)}))]}),Object.keys(js).map(x=>{const he=C.filter(Pe=>Pe.element===x);if(he.length===0)return null;const Se=he[0],fe=Se.hubX!==void 0&&Se.hubY!==void 0,ce=Se.sourceX,Ze=Se.sourceY,ot=Se.sourceScale,ie=Se.hubX??ce,Oe=Se.hubY??Ze,At=Se.hubScale??ot,tt=Se.hubOpacity??1;return S.jsxs("g",{children:[fe&&S.jsx("g",{style:{opacity:tt},children:null}),he.map((Pe,oe)=>{const ze=Math.min(1,F*C.length/(oe+1))*K,Ue=Me===Pe,Tt=Me!==null,St=fe?ie:ce,_t=fe?Oe:Ze,wt=fe?At:ot;let Je=Pe.targetOpacityActual*K;return Tt&&!Ue&&(Je*=.1),S.jsx("g",{style:{opacity:Je},children:(()=>{const we=it({...Pe,sourceX:St,sourceY:_t,sourceScale:wt},1);return S.jsxs(S.Fragment,{children:[S.jsx("circle",{cx:Pe.targetX,cy:Pe.targetY,r:Math.max(0,50*Pe.targetScale),fill:"transparent",style:{cursor:"pointer",pointerEvents:"fill"},onPointerEnter:()=>Kt(Pe),onPointerLeave:ke,onClick:Le=>{Le.stopPropagation(),es(Pe)}}),ze===1&&(()=>{const Le=Ue?1.2:.6,mt=!!(A||T),ct=Ue||T?.buildName===Pe.synergy.buildName&&T?.targetType===Pe.targetType;let Ce=Ue?.6:.4;switch(mt&&!ct&&(Ce*=.15),Pe.element){case"solar":return S.jsxs(S.Fragment,{children:[S.jsx("path",{d:we,stroke:"#ff8800",strokeWidth:Le*3,fill:"none",strokeLinecap:"round",opacity:Ce*.3,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:"#ffaa00",strokeWidth:Le*2,fill:"none",strokeLinecap:"round",opacity:Ce*.5,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:"#ff6600",strokeWidth:Le,fill:"none",strokeLinecap:"round",opacity:Ce,style:{pointerEvents:"none"}})]});case"arc":return S.jsxs(S.Fragment,{children:[S.jsx("path",{d:we,stroke:"#00d4ff",strokeWidth:Le*2.5,fill:"none",strokeLinecap:"round",opacity:Ce*.4,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:"#88f0ff",strokeWidth:Le*1.5,fill:"none",strokeLinecap:"round",opacity:Ce*.6,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:"#00ffff",strokeWidth:Le,fill:"none",strokeLinecap:"round",opacity:Ce,style:{pointerEvents:"none"}})]});case"stasis":return S.jsxs(S.Fragment,{children:[S.jsx("path",{d:we,stroke:"#2266ff",strokeWidth:Le*2,fill:"none",strokeLinecap:"round",opacity:Ce*.5,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:"#66aaff",strokeWidth:Le*1.2,fill:"none",strokeLinecap:"round",opacity:Ce*.7,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:"#aaddff",strokeWidth:Le*.8,fill:"none",strokeLinecap:"round",opacity:Ce,style:{pointerEvents:"none"}})]});case"void":return S.jsxs(S.Fragment,{children:[S.jsx("path",{d:we,stroke:"#6600cc",strokeWidth:Le*3,fill:"none",strokeLinecap:"round",opacity:Ce*.4,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:"#9933ff",strokeWidth:Le*2,fill:"none",strokeLinecap:"round",opacity:Ce*.6,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:"#cc66ff",strokeWidth:Le,fill:"none",strokeLinecap:"round",opacity:Ce,style:{pointerEvents:"none"}})]});case"prismatic":return S.jsxs(S.Fragment,{children:[S.jsx("path",{d:we,stroke:"#ff66dd",strokeWidth:Le*3,fill:"none",strokeLinecap:"round",opacity:Ce*.3,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:"#ff88ee",strokeWidth:Le*2,fill:"none",strokeLinecap:"round",opacity:Ce*.5,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:"#ffaaff",strokeWidth:Le*1.5,fill:"none",strokeLinecap:"round",opacity:Ce*.7,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:"#ff6be8",strokeWidth:Le,fill:"none",strokeLinecap:"round",opacity:Ce,style:{pointerEvents:"none"}})]});default:return S.jsxs(S.Fragment,{children:[S.jsx("path",{d:we,stroke:js[Pe.element],strokeWidth:Le*2,fill:"none",strokeLinecap:"round",opacity:Ce*.5,style:{pointerEvents:"none"}}),S.jsx("path",{d:we,stroke:js[Pe.element],strokeWidth:Le,fill:"none",strokeLinecap:"round",opacity:Ce,style:{pointerEvents:"none"}})]})}})()]})})()},`${Pe.synergy.buildName}-${Pe.targetType}-${oe}`)})]},`element-group-${x}`)})]}),kt&&(()=>{let x;if(Ie){let he=kt.targetX,Se=kt.targetY-40;const fe=300;Se-fe/2<100&&(Se=100+fe/2),Se+fe/2>window.innerHeight-20&&(Se=window.innerHeight-20-fe/2),x={left:`${he}px`,top:`${Se}px`,bottom:"auto",transform:"translateY(-50%) translateX(-50%)"}}else x={left:"50%",bottom:"40px",top:"auto"};return S.jsx("div",{className:`synergy-web__combined-tooltip-wrapper synergy-web__combined-tooltip-wrapper--${kt.element}${Ie?" synergy-web__combined-tooltip-wrapper--locked":""}`,style:x,onClick:he=>he.stopPropagation(),onMouseEnter:()=>{ae.current&&(clearTimeout(ae.current),ae.current=null)},onMouseLeave:ke,children:ps(kt)})})(),W&&S.jsx(Un,{synergy:W,onClose:Et,onEquip:x=>{Et(),r&&r(x)}})]})}const os=new Map;function qs(o){return o.toLowerCase().trim().replace(/['`â€™]/g,"").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ")}function Ca(o){const e=qs(o);if(os.has(e))return os.get(e);const t=j.getState(),{characterEquipment:a,characterInventories:r,vaultInventory:i}=t,c=new Map;for(const n of Object.values(a))for(const l of n){const d=P.getItem(l.itemHash);d?.displayProperties?.name&&c.set(l.itemHash,qs(d.displayProperties.name))}for(const n of Object.values(r))for(const l of n){const d=P.getItem(l.itemHash);d?.displayProperties?.name&&c.set(l.itemHash,qs(d.displayProperties.name))}for(const n of i){const l=P.getItem(n.itemHash);l?.displayProperties?.name&&c.set(n.itemHash,qs(l.displayProperties.name))}for(const[n,l]of c.entries())if(l===e)return os.set(e,n),n;for(const[n,l]of c.entries())if(l.startsWith(e))return os.set(e,n),n;if(e.length>=3){for(const[n,l]of c.entries())if(l.split(/\s+/).some(m=>m.startsWith(e)))return os.set(e,n),n}if(e.length>=4){for(const[n,l]of c.entries())if(l.includes(e))return os.set(e,n),n}}async function Rr(o){const e=j.getState(),{characterInventories:t,characterEquipment:a,vaultInventory:r,selectedCharacterId:i}=e,c=P.getItem(o);if(!c)return null;if(i){const l=a[i]||[],d=t[i]||[],h=l.find(f=>f.itemHash===o);if(h)return{item:h,definition:c,location:"equipped",characterId:i};const m=d.find(f=>f.itemHash===o);if(m)return{item:m,definition:c,location:"inventory",characterId:i}}for(const[l,d]of Object.entries(a)){if(l===i)continue;const h=d.find(m=>m.itemHash===o);if(h)return{item:h,definition:c,location:"equipped",characterId:l}}for(const[l,d]of Object.entries(t)){if(l===i)continue;const h=d.find(m=>m.itemHash===o);if(h)return{item:h,definition:c,location:"inventory",characterId:l}}const n=r.find(l=>l.itemHash===o);return n?{item:n,definition:c,location:"vault"}:null}async function Ir(o){const e=Ca(o);return e?Rr(e):null}async function Kn(o){const e=j.getState(),{characterInventories:t,characterEquipment:a,vaultInventory:r}=e,i=[],c=Ca(o);if(!c)return i;const n=P.getItem(c);if(!n)return i;for(const[l,d]of Object.entries(a))for(const h of d)h.itemHash===c&&i.push({item:h,definition:n,location:"equipped",characterId:l});for(const[l,d]of Object.entries(t))for(const h of d)h.itemHash===c&&i.push({item:h,definition:n,location:"inventory",characterId:l});for(const l of r)l.itemHash===c&&i.push({item:l,definition:n,location:"vault"});return i}async function jn(o,e="armor"){const t=j.getState(),{characterInventories:a,characterEquipment:r,vaultInventory:i}=t,c=[],n=(l,d,h)=>{const m=P.getItem(l.itemHash);if(!m||m.inventory?.tierType!==6)return;const f=e==="armor"?2:3;m.itemType===f&&(m.classType!==3&&m.classType!==o||c.push({item:l,definition:m,location:d,characterId:h}))};for(const[l,d]of Object.entries(r))d.forEach(h=>n(h,"equipped",l));for(const[l,d]of Object.entries(a))d.forEach(h=>n(h,"inventory",l));return i.forEach(l=>n(l,"vault")),c}async function qn(o){return await Ir(o)!==null}function Vn(){os.clear()}function $n(o){const e=j.getState(),{characterInventories:t,characterEquipment:a,vaultInventory:r}=e,i=[],c=Ca(o);if(!c)return i;const n=P.getItem(c);if(!n)return i;for(const[l,d]of Object.entries(a))for(const h of d)h.itemHash===c&&i.push({item:h,definition:n,location:"equipped",characterId:l});for(const[l,d]of Object.entries(t))for(const h of d)h.itemHash===c&&i.push({item:h,definition:n,location:"inventory",characterId:l});for(const l of r)l.itemHash===c&&i.push({item:l,definition:n,location:"vault"});return i}const Vs={findItemByHash:Rr,findItemByName:Ir,findAllItemsByName:Kn,findAllItemsByNameSync:$n,findAllExoticsForClass:jn,hasItem:qn,clearItemSearchCache:Vn},gr=[{id:"titan-solar-sunspot-loop",name:"Sunspot Engine",element:G.Solar,guardianClass:Y.Titan,requiredExpansion:X.BaseGame,exoticArmor:{hash:at.HALLOWFIRE_HEART,name:"Hallowfire Heart",slot:Z.Chest},exoticWeapon:{hash:se.ENERGY.SUNSHOT,name:"Sunshot"},requiredGrenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,subclassNode:{superHash:s.SOLAR.TITAN.SUPER.HAMMER_OF_SOL,superName:"Hammer of Sol",aspectHashes:[s.SOLAR.TITAN.ASPECTS.SOL_INVICTUS,s.SOLAR.TITAN.ASPECTS.ROARING_FLAMES],aspectNames:["Sol Invictus","Roaring Flames"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_SINGEING],fragmentNames:["Ember of Solace","Ember of Empyrean","Ember of Ashes","Ember of Singeing"],grenadeHash:s.SOLAR.TITAN.GRENADES.THERMITE,grenadeName:"Thermite Grenade",meleeHash:s.SOLAR.TITAN.MELEE.THROWING_HAMMER,meleeName:"Throwing Hammer",classAbilityHash:s.SOLAR.TITAN.CLASS_ABILITIES.RALLY_BARRICADE,classAbilityName:"Rally Barricade",jumpHash:s.SOLAR.TITAN.JUMPS.HIGH_LIFT,jumpName:"High Lift"},weaponPerk:{perkHash:Qa.INCANDESCENT,perkName:"Incandescent",weaponTypes:["SMG","Hand Cannon","Scout Rifle"]},loopDescription:"Sunspots heal you and boost ability regen. Hallowfire Heart supercharges this when Super is full. Incandescent weapons spread scorch to create more Sunspots.",playstyle:"Hold your Super to maximize ability regen. Stand in Sunspots for healing. Use Throwing Hammer for easy Sunspot creation.",difficulty:Q.Beginner,tags:["survivability","ability-spam","solo-friendly","add-clear"]},{id:"titan-arc-thundercrash-dps",name:"Ballistic Missile",element:G.Arc,guardianClass:Y.Titan,requiredExpansion:X.BeyondLight,exoticArmor:{hash:at.CUIRASS_OF_THE_FALLING_STAR,name:"Cuirass of the Falling Star",slot:Z.Chest},exoticWeapon:{hash:se.POWER.THUNDERLORD,name:"Thunderlord"},subclassNode:{superHash:s.ARC.TITAN.SUPER.THUNDERCRASH,superName:"Thundercrash",aspectHashes:[s.ARC.TITAN.ASPECTS.TOUCH_OF_THUNDER,s.ARC.TITAN.ASPECTS.KNOCKOUT],aspectNames:["Touch of Thunder","Knockout"],fragmentHashes:[s.ARC.FRAGMENTS.SPARK_OF_MAGNITUDE,s.ARC.FRAGMENTS.SPARK_OF_SHOCK,s.ARC.FRAGMENTS.SPARK_OF_IONS,s.ARC.FRAGMENTS.SPARK_OF_RECHARGE],fragmentNames:["Spark of Magnitude","Spark of Shock","Spark of Ions","Spark of Recharge"],grenadeHash:s.ARC.TITAN.GRENADES.STORM,grenadeName:"Storm Grenade",meleeHash:s.ARC.TITAN.MELEE.THUNDERCLAP,meleeName:"Thunderclap",classAbilityHash:s.ARC.TITAN.CLASS_ABILITIES.THRUSTER,classAbilityName:"Thruster",jumpHash:s.ARC.TITAN.JUMPS.HIGH_LIFT,jumpName:"High Lift"},loopDescription:"Cuirass doubles Thundercrash damage and gives overshield on impact. Touch of Thunder enhances Storm Grenades for add clear between DPS phases.",playstyle:"Build Super quickly with orbs. Save for boss DPS. Storm Grenades roam and clear adds.",difficulty:Q.Beginner,tags:["boss-dps","burst-damage","endgame","simple"]},{id:"hunter-solar-knife-spam",name:"Blade Dancer",element:G.Solar,guardianClass:Y.Hunter,requiredExpansion:X.WitchQueen,exoticArmor:{hash:Ye.CALIBAN_HAND,name:"Caliban's Hand",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.SUNSHOT,name:"Sunshot"},requiredGrenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,subclassNode:{superHash:s.SOLAR.HUNTER.SUPER.BLADE_BARRAGE,superName:"Blade Barrage",aspectHashes:[s.SOLAR.HUNTER.ASPECTS.KNOCK_EM_DOWN,s.SOLAR.HUNTER.ASPECTS.ON_YOUR_MARK],aspectNames:["Knock 'Em Down","On Your Mark"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES,s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE,s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR],fragmentNames:["Ember of Torches","Ember of Solace","Ember of Ashes","Ember of Char"],meleeHash:s.SOLAR.HUNTER.MELEE.KNIFE_TRICK,meleeName:"Knife Trick",grenadeHash:s.SOLAR.HUNTER.GRENADES.TRIPMINE,grenadeName:"Tripmine Grenade",classAbilityHash:s.SOLAR.HUNTER.CLASS_ABILITIES.MARKSMANS_DODGE,classAbilityName:"Marksman's Dodge",jumpHash:s.SOLAR.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},weaponPerk:{perkHash:Qa.INCANDESCENT,perkName:"Incandescent",weaponTypes:["Hand Cannon","SMG"]},loopDescription:"Proximity Knife ignites on hit. Caliban's Hand causes ignition explosions and refunds knife on scorched kills.",playstyle:"Throw knives constantly. Kills refund the knife. Ignitions clear rooms. Knock Em Down extends duration.",difficulty:Q.Intermediate,tags:["ability-spam","ignition","add-clear","fun"]},{id:"warlock-solar-starfire",name:"Grenade Battery",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.BaseGame,exoticArmor:{hash:He.STARFIRE_PROTOCOL,name:"Starfire Protocol",slot:Z.Chest},exoticWeapon:{hash:se.ENERGY.SUNSHOT,name:"Sunshot"},requiredGrenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.WELL_OF_RADIANCE,superName:"Well of Radiance",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME,s.SOLAR.WARLOCK.ASPECTS.ICARUS_DASH],aspectNames:["Touch of Flame","Icarus Dash"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES,s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE,s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_SINGEING],fragmentNames:["Ember of Torches","Ember of Solace","Ember of Ashes","Ember of Singeing"],grenadeHash:s.SOLAR.WARLOCK.GRENADES.FUSION,grenadeName:"Fusion Grenade",meleeHash:s.SOLAR.WARLOCK.MELEE.CELESTIAL_FIRE,meleeName:"Celestial Fire",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.EMPOWERING_RIFT,classAbilityName:"Empowering Rift",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Fusion Grenades get two charges and deal bonus damage. Empowered weapon hits (Rift) recharge grenades. Touch of Flame makes them stronger.",playstyle:"Drop Rift, throw grenades, shoot boss, repeat. Two Fusion Grenades constantly available for huge DPS.",difficulty:Q.Beginner,tags:["boss-dps","grenade-spam","endgame","simple"]},{id:"titan-stasis-hoarfrost",name:"Glacial Wall",element:G.Stasis,guardianClass:Y.Titan,requiredExpansion:X.WitchQueen,exoticArmor:{hash:at.HOARFROST_Z,name:"Hoarfrost-Z",slot:Z.Chest},exoticWeapon:{hash:se.KINETIC.VERGLAS_CURVE,name:"Verglas Curve"},subclassNode:{superHash:s.STASIS.TITAN.SUPER.GLACIAL_QUAKE,superName:"Glacial Quake",aspectHashes:[s.STASIS.TITAN.ASPECTS.TECTONIC_HARVEST,s.STASIS.TITAN.ASPECTS.HOWL_OF_THE_STORM],aspectNames:["Tectonic Harvest","Howl of the Storm"],fragmentHashes:[s.STASIS.FRAGMENTS.WHISPER_OF_SHARDS,s.STASIS.FRAGMENTS.WHISPER_OF_CHAINS,s.STASIS.FRAGMENTS.WHISPER_OF_RIME,s.STASIS.FRAGMENTS.WHISPER_OF_CONDUCTION],fragmentNames:["Whisper of Shards","Whisper of Chains","Whisper of Rime","Whisper of Conduction"],meleeHash:s.STASIS.TITAN.MELEE.SHIVER_STRIKE,meleeName:"Shiver Strike",grenadeHash:s.STASIS.TITAN.GRENADES.GLACIER,grenadeName:"Glacier Grenade",classAbilityHash:s.STASIS.TITAN.CLASS_ABILITIES.TOWERING_BARRICADE,classAbilityName:"Towering Barricade",jumpHash:s.STASIS.TITAN.JUMPS.HIGH_LIFT,jumpName:"High Lift"},playstyle:"Barricade creates Stasis crystals. Destroy them for damage resist and shards. Be an immovable ice object.",difficulty:Q.Intermediate,tags:["defensive","damage-resist","crystal-spam"],loopDescription:"Barricade creates Stasis crystals. Destroy them for damage resist and shards. Be an immovable ice object."},{id:"titan-strand-abeyant",name:"Suspend King",element:G.Strand,guardianClass:Y.Titan,requiredExpansion:X.Lightfall,exoticArmor:{hash:at.ABEYANT_LEAP,name:"Abeyant Leap",slot:Z.Legs},exoticWeapon:{hash:se.ENERGY.LE_MONARQUE,name:"Le Monarque"},subclassNode:{superHash:s.STRAND.TITAN.SUPER.BLADEFURY,superName:"Bladefury",aspectHashes:[s.STRAND.TITAN.ASPECTS.DRENGRS_LASH,s.STRAND.TITAN.ASPECTS.INTO_THE_FRAY],aspectNames:["Drengrs Lash","Into the Fray"],fragmentHashes:[s.STRAND.FRAGMENTS.THREAD_OF_WARDING,s.STRAND.FRAGMENTS.THREAD_OF_MIND,s.STRAND.FRAGMENTS.THREAD_OF_CONTINUITY,s.STRAND.FRAGMENTS.THREAD_OF_GENERATION],fragmentNames:["Thread of Warding","Thread of Mind","Thread of Continuity","Thread of Generation"],meleeHash:s.STRAND.TITAN.MELEE.FRENZIED_BLADE,meleeName:"Frenzied Blade",grenadeHash:s.STRAND.TITAN.GRENADES.SHACKLE,grenadeName:"Shackle Grenade",classAbilityHash:s.STRAND.TITAN.CLASS_ABILITIES.RALLY_BARRICADE,classAbilityName:"Rally Barricade",jumpHash:s.STRAND.TITAN.JUMPS.HIGH_LIFT,jumpName:"High Lift"},playstyle:"Barricade sends 3 suspending waves. Suspending enemies grants Woven Mail. Lock down the entire battlefield.",difficulty:Q.Intermediate,tags:["crowd-control","suspend","woven-mail"],loopDescription:"Barricade sends 3 suspending waves. Suspending enemies grants Woven Mail. Lock down the entire battlefield."},{id:"hunter-arc-shinobu",name:"Skip Spammer",element:G.Arc,guardianClass:Y.Hunter,requiredExpansion:X.BaseGame,exoticArmor:{hash:Ye.SHINOBUS_VOW,name:"Shinobu's Vow",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.RISKRUNNER,name:"Riskrunner"},subclassNode:{superHash:s.ARC.HUNTER.SUPER.GATHERING_STORM,superName:"Gathering Storm",aspectHashes:[s.ARC.HUNTER.ASPECTS.FLOW_STATE,s.ARC.HUNTER.ASPECTS.LETHAL_CURRENT],aspectNames:["Flow State","Lethal Current"],fragmentHashes:[s.ARC.FRAGMENTS.SPARK_OF_SHOCK,s.ARC.FRAGMENTS.SPARK_OF_IONS,s.ARC.FRAGMENTS.SPARK_OF_DISCHARGE,s.ARC.FRAGMENTS.SPARK_OF_RECHARGE],fragmentNames:["Spark of Shock","Spark of Ions","Spark of Discharge","Spark of Recharge"],grenadeHash:s.ARC.HUNTER.GRENADES.SKIP,grenadeName:"Skip Grenade",meleeHash:s.ARC.HUNTER.MELEE.COMBINATION_BLOW,meleeName:"Combination Blow",classAbilityHash:s.ARC.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gambler's Dodge",jumpHash:s.ARC.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},playstyle:"Grenades improve tracking and refund energy on hit. Throw grenades, jolt enemies, repeat.",difficulty:Q.Beginner,tags:["grenade-spam","tracking","easy"],loopDescription:"Grenades improve tracking and refund energy on hit. Throw grenades, jolt enemies, repeat."},{id:"hunter-stasis-bakris",name:"Void Shift",element:G.Stasis,guardianClass:Y.Hunter,requiredExpansion:X.BeyondLight,exoticArmor:{hash:Ye.MASK_OF_BAKRIS,name:"Mask of Bakris",slot:Z.Helmet},exoticWeapon:{hash:se.ENERGY.CLOUDSTRIKE,name:"Cloudstrike"},subclassNode:{superHash:s.STASIS.HUNTER.SUPER.SILENCE_AND_SQUALL,superName:"Silence and Squall",aspectHashes:[s.STASIS.HUNTER.ASPECTS.TOUCH_OF_WINTER,s.STASIS.HUNTER.ASPECTS.WINTERS_SHROUD],aspectNames:["Touch of Winter","Winters Shroud"],fragmentHashes:[s.STASIS.FRAGMENTS.WHISPER_OF_HEDRONS,s.STASIS.FRAGMENTS.WHISPER_OF_REFRACTION,s.STASIS.FRAGMENTS.WHISPER_OF_DURANCE,s.STASIS.FRAGMENTS.WHISPER_OF_SHARDS],fragmentNames:["Whisper of Hedrons","Whisper of Refraction","Whisper of Durance","Whisper of Shards"],meleeHash:s.STASIS.HUNTER.MELEE.WITHERING_BLADE,meleeName:"Withering Blade",grenadeHash:s.STASIS.HUNTER.GRENADES.DUSKFIELD,grenadeName:"Duskfield Grenade",classAbilityHash:s.STASIS.HUNTER.CLASS_ABILITIES.MARKSMANS_DODGE,classAbilityName:"Marksman's Dodge",jumpHash:s.STASIS.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},playstyle:"Dodge teleports and boosts Arc/Stasis weapon damage. Use Cloudstrike or Arc weapons for huge burst damage.",difficulty:Q.Advanced,tags:["dps","burst-damage","teleport"],loopDescription:"Dodge teleports and boosts Arc/Stasis weapon damage. Use Cloudstrike or Arc weapons for huge burst damage."},{id:"hunter-strand-cyrtarachne",name:"Woven Spider",element:G.Strand,guardianClass:Y.Hunter,requiredExpansion:X.Lightfall,exoticArmor:{hash:Ye.CYRTARACHNE_FACADE,name:"Cyrtarachne's Facade",slot:Z.Helmet},exoticWeapon:{hash:se.KINETIC.QUICKSILVER_STORM,name:"Quicksilver Storm"},subclassNode:{superHash:s.STRAND.HUNTER.SUPER.SILKSTRIKE,superName:"Silkstrike",aspectHashes:[s.STRAND.HUNTER.ASPECTS.WIDOWS_SILK,s.STRAND.HUNTER.ASPECTS.WHIRLING_MAELSTROM],aspectNames:["Widows Silk","Whirling Maelstrom"],fragmentHashes:[s.STRAND.FRAGMENTS.THREAD_OF_WARDING,s.STRAND.FRAGMENTS.THREAD_OF_GENERATION,s.STRAND.FRAGMENTS.THREAD_OF_ASCENT,s.STRAND.FRAGMENTS.THREAD_OF_FURY],fragmentNames:["Thread of Warding","Thread of Generation","Thread of Ascent","Thread of Fury"],grenadeHash:s.STRAND.HUNTER.GRENADES.GRAPPLE,grenadeName:"Grapple",meleeHash:s.STRAND.HUNTER.MELEE.THREADED_SPIKE,meleeName:"Threaded Spike",classAbilityHash:s.STRAND.HUNTER.CLASS_ABILITIES.MARKSMANS_DODGE,classAbilityName:"Marksman's Dodge",jumpHash:s.STRAND.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},playstyle:"Grappling gives Woven Mail. Swing around the arena safely. Creates tangles for Whirling Maelstrom.",difficulty:Q.Intermediate,tags:["mobility","survivability","grapple"],loopDescription:"Grappling gives Woven Mail. Swing around the arena safely. Creates tangles for Whirling Maelstrom."},{id:"warlock-arc-crown",name:"Tempest King",element:G.Arc,guardianClass:Y.Warlock,requiredExpansion:X.BaseGame,exoticArmor:{hash:He.CROWN_OF_TEMPESTS,name:"Crown of Tempests",slot:Z.Helmet},exoticWeapon:{hash:se.ENERGY.RISKRUNNER,name:"Riskrunner"},subclassNode:{superHash:s.ARC.WARLOCK.SUPER.STORMTRANCE,superName:"Stormtrance",aspectHashes:[s.ARC.WARLOCK.ASPECTS.ELECTROSTATIC_MIND,s.ARC.WARLOCK.ASPECTS.LIGHTNING_SURGE],aspectNames:["Electrostatic Mind","Lightning Surge"],fragmentHashes:[s.ARC.FRAGMENTS.SPARK_OF_IONS,s.ARC.FRAGMENTS.SPARK_OF_DISCHARGE,s.ARC.FRAGMENTS.SPARK_OF_MAGNITUDE,s.ARC.FRAGMENTS.SPARK_OF_SHOCK],fragmentNames:["Spark of Ions","Spark of Discharge","Spark of Magnitude","Spark of Shock"],grenadeHash:s.ARC.WARLOCK.GRENADES.STORM,grenadeName:"Storm Grenade",meleeHash:s.ARC.WARLOCK.MELEE.CHAIN_LIGHTNING,meleeName:"Chain Lightning",classAbilityHash:s.ARC.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.ARC.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},playstyle:"Conduction Tines stacks recharge abilities. Stormtrance lasts forever. The ultimate ability spam build.",difficulty:Q.Beginner,tags:["ability-spam","add-clear","super-duration"],loopDescription:"Conduction Tines stacks recharge abilities. Stormtrance lasts forever. The ultimate ability spam build."},{id:"warlock-stasis-ballidorse",name:"Winter Wrath",element:G.Stasis,guardianClass:Y.Warlock,requiredExpansion:X.Lightfall,exoticArmor:{hash:He.BALLIDORSE_WRATHWEAVERS,name:"Ballidorse Wrathweavers",slot:Z.Arms},exoticWeapon:{hash:se.KINETIC.VERGLAS_CURVE,name:"Verglas Curve"},subclassNode:{superHash:s.STASIS.WARLOCK.SUPER.WINTERS_WRATH,superName:"Winter's Wrath",aspectHashes:[s.STASIS.WARLOCK.ASPECTS.GLACIAL_HARVEST,s.STASIS.WARLOCK.ASPECTS.BLEAK_WATCHER],aspectNames:["Glacial Harvest","Bleak Watcher"],fragmentHashes:[s.STASIS.FRAGMENTS.WHISPER_OF_RIME,s.STASIS.FRAGMENTS.WHISPER_OF_SHARDS,s.STASIS.FRAGMENTS.WHISPER_OF_FISSURES,s.STASIS.FRAGMENTS.WHISPER_OF_CONDUCTION],fragmentNames:["Whisper of Rime","Whisper of Shards","Whisper of Fissures","Whisper of Conduction"],grenadeHash:s.STASIS.WARLOCK.GRENADES.COLDSNAP,grenadeName:"Coldsnap Grenade",meleeHash:s.STASIS.WARLOCK.MELEE.PENUMBRAL_BLAST,meleeName:"Penumbral Blast",classAbilityHash:s.STASIS.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.STASIS.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},playstyle:"Boosts Winter's Wrath shatter damage. Rift gives Stasis surge to allies. Control the field and shatter everything.",difficulty:Q.Advanced,tags:["super-damage","team-support","shatter"],loopDescription:"Boosts Winter's Wrath shatter damage. Rift gives Stasis surge to allies. Control the field and shatter everything."},{id:"titan-prismatic-consecration",name:"Consecration Master",element:G.Prismatic,guardianClass:Y.Titan,requiredExpansion:X.FinalShape,exoticArmor:{hash:at.WISHFUL_IGNORANCE,name:"Wishful Ignorance",slot:Z.Arms},exoticWeapon:{hash:se.KINETIC.KHVOSTOV_7G_0X,name:"Khvostov 7G-0X"},subclassNode:{superHash:s.PRISMATIC.TITAN.SUPER.TWILIGHT_ARSENAL,superName:"Twilight Arsenal",aspectHashes:[s.PRISMATIC.TITAN.ASPECTS.CONSECRATION,s.PRISMATIC.TITAN.ASPECTS.KNOCKOUT],aspectNames:["Consecration","Knockout"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_DAWN,s.PRISMATIC.FRAGMENTS.FACET_OF_RUIN,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION,s.PRISMATIC.FRAGMENTS.FACET_OF_COURAGE],fragmentNames:["Facet of Dawn","Facet of Ruin","Facet of Protection","Facet of Courage"],grenadeHash:s.PRISMATIC.TITAN.GRENADES.THERMITE,grenadeName:"Thermite Grenade",meleeHash:s.PRISMATIC.TITAN.MELEE.FRENZIED_BLADE,meleeName:"Frenzied Blade",classAbilityHash:s.PRISMATIC.TITAN.CLASS_ABILITIES.THRUSTER,classAbilityName:"Thruster",jumpHash:s.PRISMATIC.TITAN.JUMPS.HIGH_LIFT,jumpName:"High Lift"},loopDescription:"Consecration unleashes devastating slam attacks. Synthoceps boosts damage when surrounded. Twilight Arsenal for burst damage.",playstyle:"Slide + Melee for Consecration. Get surrounded for Synthoceps buff. Chain slams and axes for room clear.",difficulty:Q.Advanced,tags:["burst-damage","melee-build","add-clear","prismatic"]},{id:"hunter-prismatic-assassin",name:"Prismatic Assassin",element:G.Prismatic,guardianClass:Y.Hunter,requiredExpansion:X.FinalShape,exoticArmor:{hash:Ye.GYRFALCONS_HAUBERK,name:"Gyrfalcon's Hauberk",slot:Z.Chest},exoticWeapon:{hash:se.KINETIC.OUTBREAK_PERFECTED,name:"Outbreak Perfected"},subclassNode:{superHash:s.PRISMATIC.HUNTER.SUPER.STORMS_EDGE,superName:"Storm's Edge",aspectHashes:[s.PRISMATIC.HUNTER.ASPECTS.STYLISH_EXECUTIONER,s.PRISMATIC.HUNTER.ASPECTS.THREADED_SPECTER],aspectNames:["Stylish Executioner","Threaded Specter"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_DAWN,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION,s.PRISMATIC.FRAGMENTS.FACET_OF_RUIN,s.PRISMATIC.FRAGMENTS.FACET_OF_HOPE],fragmentNames:["Facet of Dawn","Facet of Protection","Facet of Ruin","Facet of Hope"],grenadeHash:s.PRISMATIC.HUNTER.GRENADES.DUSKFIELD,grenadeName:"Duskfield Grenade",meleeHash:s.PRISMATIC.HUNTER.MELEE.SNARE_BOMB,meleeName:"Snare Bomb",classAbilityHash:s.PRISMATIC.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gambler's Dodge",jumpHash:s.PRISMATIC.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Kill weakened enemies for invisibility and damage buff. Gyrfalcon grants volatile rounds on exiting invis.",playstyle:"Weaken with grenade/smoke, kill for invis, exit invis for volatile rounds. Repeat the assassination loop.",difficulty:Q.Intermediate,tags:["invisibility","volatile","assassination","prismatic"]},{id:"warlock-solar-sunbracers-v1",name:"Solar Spammer",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.BaseGame,exoticArmor:{hash:He.SUNBRACERS,name:"Sunbracers",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.SUNSHOT,name:"Sunshot"},requiredGrenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.WELL_OF_RADIANCE,superName:"Well of Radiance",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME,s.SOLAR.WARLOCK.ASPECTS.HEAT_RISES],aspectNames:["Touch of Flame","Heat Rises"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_SINGEING,s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE],fragmentNames:["Ember of Empyrean","Ember of Ashes","Ember of Singeing","Ember of Solace"],grenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,grenadeName:"Solar Grenade",meleeHash:s.SOLAR.WARLOCK.MELEE.INCINERATOR_SNAP,meleeName:"Incinerator Snap",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Melee kills grant unlimited grenades. Heat Rises gives melee energy on air kills. Touch of Flame makes grenades stronger.",playstyle:"Eat grenade for Heat Rises -> Melee kill -> Spam grenades from the sky. Repeat.",difficulty:Q.Intermediate,tags:["grenade-spam","airborne","add-clear","solar"]},{id:"titan-solar-pyrogale",name:"Burning Fists",element:G.Solar,guardianClass:Y.Titan,requiredExpansion:X.Lightfall,exoticArmor:{hash:at.PYROGALE_GAUNTLETS,name:"Pyrogale Gauntlets",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.JOTUNN,name:"Jotunn"},subclassNode:{superHash:s.SOLAR.TITAN.SUPER.BURNING_MAUL,superName:"Burning Maul",aspectHashes:[s.SOLAR.TITAN.ASPECTS.SOL_INVICTUS,s.SOLAR.TITAN.ASPECTS.ROARING_FLAMES],aspectNames:["Sol Invictus","Roaring Flames"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ERUPTION,s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES],fragmentNames:["Ember of Eruption","Ember of Ashes","Ember of Char","Ember of Torches"],grenadeHash:s.SOLAR.TITAN.GRENADES.FUSION,grenadeName:"Fusion Grenade",meleeHash:s.SOLAR.TITAN.MELEE.THROWING_HAMMER,meleeName:"Throwing Hammer",classAbilityHash:s.SOLAR.TITAN.CLASS_ABILITIES.RALLY_BARRICADE,classAbilityName:"Rally Barricade",jumpHash:s.SOLAR.TITAN.JUMPS.HIGH_LIFT,jumpName:"High Lift"},loopDescription:"Pyrogale changes Burning Maul into a powerful slam attack. Roaring Flames stacks increase all Solar damage.",playstyle:"Build Roaring Flames stacks with hammer. Pop Super for massive single slam. Ignitions everywhere.",difficulty:Q.Advanced,tags:["super-damage","ignition","burst-dps","solar"]},{id:"hunter-solar-galanor",name:"Blade Spam",element:G.Solar,guardianClass:Y.Hunter,requiredExpansion:X.Forsaken,exoticArmor:{hash:Ye.SHARDS_OF_GALANOR,name:"Shards of Galanor",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.PROMETHEUS_LENS,name:"Prometheus Lens"},subclassNode:{superHash:s.SOLAR.HUNTER.SUPER.BLADE_BARRAGE,superName:"Blade Barrage",aspectHashes:[s.SOLAR.HUNTER.ASPECTS.KNOCK_EM_DOWN,s.SOLAR.HUNTER.ASPECTS.GUNPOWDER_GAMBLE],aspectNames:["Knock 'Em Down","Gunpowder Gamble"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_COMBUSTION,s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE,s.SOLAR.FRAGMENTS.EMBER_OF_SINGEING],fragmentNames:["Ember of Combustion","Ember of Ashes","Ember of Solace","Ember of Singeing"],grenadeHash:s.SOLAR.HUNTER.GRENADES.TRIPMINE,grenadeName:"Tripmine Grenade",meleeHash:s.SOLAR.HUNTER.MELEE.KNIFE_TRICK,meleeName:"Knife Trick",classAbilityHash:s.SOLAR.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gambler's Dodge",jumpHash:s.SOLAR.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Blade Barrage hits return Super energy with Shards. Knock Em Down makes knives throw more. Constant Supers.",playstyle:"Use Super on groups for maximum refund. Knock Em Down boosts knives. Gunpowder Gamble for add clear between Supers.",difficulty:Q.Beginner,tags:["super-spam","add-clear","burst-damage","solar"]},{id:"warlock-void-manacles",name:"Handheld Supernova",element:G.Void,guardianClass:Y.Warlock,requiredExpansion:X.BaseGame,exoticArmor:{hash:He.NOTHING_MANACLES,name:"Nothing Manacles",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.GRAVITON_LANCE,name:"Graviton Lance"},subclassNode:{superHash:s.VOID.WARLOCK.SUPER.NOVA_WARP,superName:"Nova Warp",aspectHashes:[s.VOID.WARLOCK.ASPECTS.CHAOS_ACCELERANT,s.VOID.WARLOCK.ASPECTS.FEED_THE_VOID],aspectNames:["Chaos Accelerant","Feed the Void"],fragmentHashes:[s.VOID.FRAGMENTS.ECHO_OF_UNDERMINING,s.VOID.FRAGMENTS.ECHO_OF_EXPULSION,s.VOID.FRAGMENTS.ECHO_OF_INSTABILITY,s.VOID.FRAGMENTS.ECHO_OF_STARVATION],fragmentNames:["Echo of Undermining","Echo of Expulsion","Echo of Instability","Echo of Starvation"],grenadeHash:s.VOID.WARLOCK.GRENADES.SCATTER,grenadeName:"Scatter Grenade",meleeHash:s.VOID.WARLOCK.MELEE.POCKET_SINGULARITY,meleeName:"Pocket Singularity",classAbilityHash:s.VOID.WARLOCK.CLASS_ABILITIES.EMPOWERING_RIFT,classAbilityName:"Empowering Rift",jumpHash:s.VOID.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Nothing Manacles gives two Scatter Grenades with improved tracking. Chaos Accelerant makes them devastating.",playstyle:"Charge Scatter Grenades for Handheld Supernova. Two charges means constant HHSN spam. Devour for survivability.",difficulty:Q.Advanced,tags:["grenade-spam","burst-damage","devour","void"]},{id:"hunter-void-gyrfalcon",name:"Volatile Hunter",element:G.Void,guardianClass:Y.Hunter,requiredExpansion:X.WitchQueen,exoticArmor:{hash:Ye.GYRFALCONS_HAUBERK,name:"Gyrfalcon's Hauberk",slot:Z.Chest},exoticWeapon:{hash:se.KINETIC.WITHERHOARD,name:"Witherhoard"},subclassNode:{superHash:s.VOID.HUNTER.SUPER.SHADOWSHOT_DEADFALL,superName:"Shadowshot: Deadfall",aspectHashes:[s.VOID.HUNTER.ASPECTS.VANISHING_STEP,s.VOID.HUNTER.ASPECTS.TRAPPERS_AMBUSH],aspectNames:["Vanishing Step","Trappers Ambush"],fragmentHashes:[s.VOID.FRAGMENTS.ECHO_OF_OBSCURITY,s.VOID.FRAGMENTS.ECHO_OF_INSTABILITY,s.VOID.FRAGMENTS.ECHO_OF_STARVATION,s.VOID.FRAGMENTS.ECHO_OF_PERSISTENCE],fragmentNames:["Echo of Obscurity","Echo of Instability","Echo of Starvation","Echo of Persistence"],grenadeHash:s.VOID.HUNTER.GRENADES.VORTEX,grenadeName:"Vortex Grenade",meleeHash:s.VOID.HUNTER.MELEE.SNARE_BOMB,meleeName:"Snare Bomb",classAbilityHash:s.VOID.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gambler's Dodge",jumpHash:s.VOID.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Exiting invisibility grants Volatile Rounds and a damage buff. Witherhoard keeps dealing damage while invis.",playstyle:"Go invis, place Witherhoard, exit invis near enemies with volatile rounds. Rinse repeat.",difficulty:Q.Intermediate,tags:["invisibility","volatile","zone-control","void"]},{id:"titan-arc-peacekeepers",name:"SMG Striker",element:G.Arc,guardianClass:Y.Titan,requiredExpansion:X.BaseGame,exoticArmor:{hash:at.PEACEKEEPERS,name:"Peacekeepers",slot:Z.Legs},exoticWeapon:{hash:se.ENERGY.RISKRUNNER,name:"Riskrunner"},subclassNode:{superHash:s.ARC.TITAN.SUPER.FISTS_OF_HAVOC,superName:"Fists of Havoc",aspectHashes:[s.ARC.TITAN.ASPECTS.TOUCH_OF_THUNDER,s.ARC.TITAN.ASPECTS.JUGGERNAUT],aspectNames:["Touch of Thunder","Juggernaut"],fragmentHashes:[s.ARC.FRAGMENTS.SPARK_OF_SHOCK,s.ARC.FRAGMENTS.SPARK_OF_IONS,s.ARC.FRAGMENTS.SPARK_OF_MOMENTUM,s.ARC.FRAGMENTS.SPARK_OF_RECHARGE],fragmentNames:["Spark of Shock","Spark of Ions","Spark of Momentum","Spark of Recharge"],grenadeHash:s.ARC.TITAN.GRENADES.STORM,grenadeName:"Storm Grenade",meleeHash:s.ARC.TITAN.MELEE.THUNDERCLAP,meleeName:"Thunderclap",classAbilityHash:s.ARC.TITAN.CLASS_ABILITIES.THRUSTER,classAbilityName:"Thruster",jumpHash:s.ARC.TITAN.JUMPS.HIGH_LIFT,jumpName:"High Lift"},loopDescription:"Peacekeepers auto-reload stowed SMGs and grant mobility. Riskrunner chains Arc damage when taking Arc damage.",playstyle:"Sprint with Juggernaut shield. Swap SMGs constantly with instant ready. Riskrunner procs make you unkillable in Arc content.",difficulty:Q.Beginner,tags:["smg","mobility","arc-damage","aggressive"]},{id:"warlock-solar-sunbracers",name:"Grenade Rain",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.BaseGame,exoticArmor:{hash:He.SUNBRACERS,name:"Sunbracers",slot:Z.Arms},exoticWeapon:{hash:se.KINETIC.MONTE_CARLO,name:"Monte Carlo"},requiredGrenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.DAYBREAK,superName:"Daybreak",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.HEAT_RISES,s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME],aspectNames:["Heat Rises","Touch of Flame"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES,s.SOLAR.FRAGMENTS.EMBER_OF_SINGEING],fragmentNames:["Ember of Ashes","Ember of Char","Ember of Torches","Ember of Singeing"],grenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,grenadeName:"Solar Grenade",meleeHash:s.SOLAR.WARLOCK.MELEE.CELESTIAL_FIRE,meleeName:"Celestial Fire",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Solar melee kills grant unlimited Solar grenades for 5 seconds. Monte Carlo keeps melee charged.",playstyle:"Get melee kill, spam 5+ Solar grenades while airborne. Monte Carlo refunds melee for next cycle. Rain fire.",difficulty:Q.Intermediate,tags:["grenade-spam","airborne","add-clear","solar"]},{id:"hunter-arc-assassin",name:"Lightning Assassin",element:G.Arc,guardianClass:Y.Hunter,requiredExpansion:X.Shadowkeep,exoticArmor:{hash:Ye.ASSASSINS_COWL,name:"Assassin's Cowl",slot:Z.Helmet},exoticWeapon:{hash:se.KINETIC.MONTE_CARLO,name:"Monte Carlo"},requiredGrenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,subclassNode:{superHash:s.ARC.HUNTER.SUPER.GATHERING_STORM,superName:"Gathering Storm",aspectHashes:[s.ARC.HUNTER.ASPECTS.LETHAL_CURRENT,s.ARC.HUNTER.ASPECTS.FLOW_STATE],aspectNames:["Lethal Current","Flow State"],fragmentHashes:[s.ARC.FRAGMENTS.SPARK_OF_RESISTANCE,s.ARC.FRAGMENTS.SPARK_OF_SHOCK,s.ARC.FRAGMENTS.SPARK_OF_FEEDBACK,s.ARC.FRAGMENTS.SPARK_OF_MAGNITUDE],fragmentNames:["Spark of Resistance","Spark of Shock","Spark of Feedback","Spark of Magnitude"],grenadeHash:s.ARC.HUNTER.GRENADES.PULSE,grenadeName:"Pulse Grenade",meleeHash:s.ARC.HUNTER.MELEE.COMBINATION_BLOW,meleeName:"Combination Blow",classAbilityHash:s.ARC.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gamblers Dodge",jumpHash:s.ARC.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Powered melee kills heal you and make you invisible. Combination Blow increases damage. Infinite punch-invis-punch loop.",playstyle:"Punch to kill -> Invis -> Find next target -> Punch. Safe and deadly.",difficulty:Q.Intermediate,tags:["arc","invisibility","melee","healing"]},{id:"warlock-prismatic-getaway-praxic",name:"Praxic Stormcaller",element:G.Prismatic,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.GETAWAY_ARTIST,name:"Getaway Artist",slot:Z.Arms},exoticWeapon:{hash:se.KINETIC.PRAXIC_BLADE,name:"Praxic Blade"},subclassNode:{superHash:s.PRISMATIC.WARLOCK.SUPER.STORMTRANCE,superName:"Stormtrance",aspectHashes:[s.PRISMATIC.WARLOCK.ASPECTS.BLEAK_WATCHER,s.PRISMATIC.WARLOCK.ASPECTS.FEED_THE_VOID],aspectNames:["Bleak Watcher","Feed the Void"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_RUIN,s.PRISMATIC.FRAGMENTS.FACET_OF_HOPE,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION,s.PRISMATIC.FRAGMENTS.FACET_OF_PURPOSE],fragmentNames:["Facet of Ruin","Facet of Hope","Facet of Protection","Facet of Purpose"],grenadeHash:s.PRISMATIC.WARLOCK.GRENADES.STORM,grenadeName:"Storm Grenade",meleeHash:s.PRISMATIC.WARLOCK.MELEE.ARCANE_NEEDLE,meleeName:"Arcane Needle",classAbilityHash:s.PRISMATIC.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.PRISMATIC.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Getaway Artist provides an Arc Soul while Praxic Blade heavy attacks reflect damage and clear groups. Prismatic synergies keep ability energy flowing.",playstyle:"Consume grenade for Arc Soul. Use Praxic Blade to reflect damage and sever targets. Combined turret and sword damage controls the battlefield.",difficulty:Q.Intermediate,tags:["prismatic","praxic-blade","getaway-artist","warlock"]},{id:"titan-prismatic-hazardous",name:"Hazardous Artillery",element:G.Prismatic,guardianClass:Y.Titan,requiredExpansion:X.FinalShape,exoticArmor:{hash:at.HAZARDOUS_PROPULSION,name:"Hazardous Propulsion",slot:Z.Chest},exoticWeapon:{hash:se.ENERGY.GRAVITON_LANCE,name:"Graviton Lance"},subclassNode:{superHash:s.PRISMATIC.TITAN.SUPER.TWILIGHT_ARSENAL,superName:"Twilight Arsenal",aspectHashes:[s.PRISMATIC.TITAN.ASPECTS.KNOCKOUT,s.PRISMATIC.TITAN.ASPECTS.DRENGRS_LASH],aspectNames:["Knockout","Drengrs Lash"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_DAWN,s.PRISMATIC.FRAGMENTS.FACET_OF_RUIN,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION,s.PRISMATIC.FRAGMENTS.FACET_OF_HOPE],fragmentNames:["Facet of Dawn","Facet of Ruin","Facet of Protection","Facet of Hope"],grenadeHash:s.PRISMATIC.TITAN.GRENADES.SHACKLE,grenadeName:"Shackle Grenade",meleeHash:s.PRISMATIC.TITAN.MELEE.SHIELD_THROW,meleeName:"Shield Throw",classAbilityHash:s.PRISMATIC.TITAN.CLASS_ABILITIES.THRUSTER,classAbilityName:"Thruster",jumpHash:s.PRISMATIC.TITAN.JUMPS.HIGH_LIFT,jumpName:"High Lift"},loopDescription:"Hazardous Propulsion builds up rockets on hits. Class ability fires them. Twilight Arsenal fits the artillery theme.",playstyle:"Build stacks. Dash/Thrust to fire homing rockets. Barrage with Twilight Arsenal.",difficulty:Q.Advanced,tags:["prismatic","rockets","burst","range"]},{id:"hunter-prismatic-punch",name:"Rocket Punch",element:G.Prismatic,guardianClass:Y.Hunter,requiredExpansion:X.FinalShape,exoticArmor:{hash:Ye.LIARS_HANDSHAKE,name:"Liar's Handshake",slot:Z.Arms},exoticWeapon:{hash:se.KINETIC.MONTE_CARLO,name:"Monte Carlo"},requiredGrenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,subclassNode:{superHash:s.PRISMATIC.HUNTER.SUPER.SILENCE_AND_SQUALL,superName:"Silence and Squall",aspectHashes:[s.PRISMATIC.HUNTER.ASPECTS.STYLISH_EXECUTIONER,s.PRISMATIC.HUNTER.ASPECTS.WINTERS_SHROUD],aspectNames:["Stylish Executioner","Winters Shroud"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_DAWN,s.PRISMATIC.FRAGMENTS.FACET_OF_RUIN,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION,s.PRISMATIC.FRAGMENTS.FACET_OF_HOPE],fragmentNames:["Facet of Dawn","Facet of Ruin","Facet of Protection","Facet of Hope"],grenadeHash:s.PRISMATIC.HUNTER.GRENADES.GRAPPLE,grenadeName:"Grapple Grenade",meleeHash:s.PRISMATIC.HUNTER.MELEE.COMBINATION_BLOW,meleeName:"Combination Blow",classAbilityHash:s.PRISMATIC.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gamblers Dodge",jumpHash:s.PRISMATIC.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Combination Blow + Liar's Handshake on Prismatic. Grapple Melee counts as melee. Stylish Executioner for invis.",playstyle:"Punch, Dodge, Punch. Repeat. Invis on kills. Massive single target damage.",difficulty:Q.Advanced,tags:["prismatic","melee","invis","high-dps"]},{id:"warlock-prismatic-devour-weave",name:"Devour Weave",element:G.Prismatic,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.SWARMERS,name:"Swarmers",slot:Z.Legs},exoticWeapon:{hash:se.KINETIC.WISH_KEEPER,name:"Wish-Keeper"},requiredAspectHash:s.PRISMATIC.WARLOCK.ASPECTS.WEAVERS_CALL,subclassNode:{superHash:s.PRISMATIC.WARLOCK.SUPER.NEEDLESTORM,superName:"Needlestorm",aspectHashes:[s.PRISMATIC.WARLOCK.ASPECTS.WEAVERS_CALL,s.PRISMATIC.WARLOCK.ASPECTS.FEED_THE_VOID],aspectNames:["Weaver's Call","Feed the Void"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_HOPE,s.PRISMATIC.FRAGMENTS.FACET_OF_BALANCE,s.PRISMATIC.FRAGMENTS.FACET_OF_COURAGE,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION,s.PRISMATIC.FRAGMENTS.FACET_OF_PURPOSE],fragmentNames:["Facet of Hope","Facet of Balance","Facet of Courage","Facet of Protection","Facet of Purpose"],grenadeHash:s.PRISMATIC.WARLOCK.GRENADES.THREADLING,grenadeName:"Threadling Grenade",meleeHash:s.PRISMATIC.WARLOCK.MELEE.ARCANE_NEEDLE,meleeName:"Arcane Needle",classAbilityHash:s.PRISMATIC.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.PRISMATIC.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Consume Threadlings to heal. Weaver's Call spawns Threadlings on dive. Swarmers make them Unravel.",playstyle:"Constant threadling spam that heals you. Use dive to spawn threadlings and proc Weaver's Call.",difficulty:Q.Advanced,tags:["prismatic","threadlings","healing","warlock"]},{id:"warlock-strand-swarmers",name:"Broodweaver Swarm",element:G.Strand,guardianClass:Y.Warlock,requiredExpansion:X.Lightfall,exoticArmor:{hash:He.SWARMERS,name:"Swarmers",slot:Z.Legs},exoticWeapon:{hash:se.KINETIC.QUICKSILVER_STORM,name:"Quicksilver Storm"},requiredAspectHash:s.STRAND.WARLOCK.ASPECTS.WEAVERS_CALL,subclassNode:{superHash:s.STRAND.WARLOCK.SUPER.NEEDLESTORM,superName:"Needlestorm",aspectHashes:[s.STRAND.WARLOCK.ASPECTS.WEAVERS_CALL,s.STRAND.WARLOCK.ASPECTS.THE_WANDERER],aspectNames:["Weaver's Call","The Wanderer"],fragmentHashes:[s.STRAND.FRAGMENTS.THREAD_OF_EVOLUTION,s.STRAND.FRAGMENTS.THREAD_OF_GENERATION,s.STRAND.FRAGMENTS.THREAD_OF_REBIRTH,s.STRAND.FRAGMENTS.THREAD_OF_WARDING],fragmentNames:["Thread of Evolution","Thread of Generation","Thread of Rebirth","Thread of Warding"],grenadeHash:s.STRAND.WARLOCK.GRENADES.THREADLING,grenadeName:"Threadling Grenade",meleeHash:s.STRAND.WARLOCK.MELEE.ARCANE_NEEDLE,meleeName:"Arcane Needle",classAbilityHash:s.STRAND.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.STRAND.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Swarmers allows threadlings to Unravel enemies. The Wanderer creates tangles that suspend. Maximum summoner build.",playstyle:"Throw tangle -> Suspend -> Kill with Quicksilver -> Spawn Threadlings -> Unravel. Control the battlefield.",difficulty:Q.Intermediate,tags:["strand","summoner","unravel","suspend"]},{id:"warlock-arc-getaway",name:"Sentient Arc Soul",element:G.Arc,guardianClass:Y.Warlock,requiredExpansion:X.BaseGame,exoticArmor:{hash:He.GETAWAY_ARTIST,name:"Getaway Artist",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.CENTRIFUSE,name:"Centrifuse"},subclassNode:{superHash:s.ARC.WARLOCK.SUPER.CHAOS_REACH,superName:"Chaos Reach",aspectHashes:[s.ARC.WARLOCK.ASPECTS.ARC_SOUL,s.ARC.WARLOCK.ASPECTS.ELECTROSTATIC_MIND],aspectNames:["Arc Soul","Electrostatic Mind"],fragmentHashes:[s.ARC.FRAGMENTS.SPARK_OF_MAGNITUDE,s.ARC.FRAGMENTS.SPARK_OF_SHOCK,s.ARC.FRAGMENTS.SPARK_OF_BEACONS,s.ARC.FRAGMENTS.SPARK_OF_AMPLITUDE],fragmentNames:["Spark of Magnitude","Spark of Shock","Spark of Beacons","Spark of Amplitude"],grenadeHash:s.ARC.WARLOCK.GRENADES.STORM,grenadeName:"Storm Grenade",meleeHash:s.ARC.WARLOCK.MELEE.CHAIN_LIGHTNING,meleeName:"Chain Lightning",classAbilityHash:s.ARC.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.ARC.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Getaway Artist converts grenade into a supercharged Arc Soul. Centrifuse builds charge while sprinting to blind enemies.",playstyle:"Consume grenade for Arc Soul. Sprint and shoot Centrifuse. Generate Ionic Traces to get grenade back immediately.",difficulty:Q.Beginner,tags:["arc","auto-turret","speed","blind"]},{id:"warlock-prismatic-winter",name:"Lightning God",element:G.Prismatic,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.WINTERS_GUILE,name:"Winter's Guile",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.TRINITY_GHOUL,name:"Trinity Ghoul"},subclassNode:{superHash:s.PRISMATIC.WARLOCK.SUPER.STORMTRANCE,superName:"Stormtrance",aspectHashes:[s.PRISMATIC.WARLOCK.ASPECTS.LIGHTNING_SURGE,s.PRISMATIC.WARLOCK.ASPECTS.FEED_THE_VOID],aspectNames:["Lightning Surge","Feed the Void"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION,s.PRISMATIC.FRAGMENTS.FACET_OF_PURPOSE,s.PRISMATIC.FRAGMENTS.FACET_OF_BRAVERY,s.PRISMATIC.FRAGMENTS.FACET_OF_BALANCE],fragmentNames:["Facet of Protection","Facet of Purpose","Facet of Bravery","Facet of Balance"],grenadeHash:s.PRISMATIC.WARLOCK.GRENADES.STORM,grenadeName:"Storm Grenade",meleeHash:s.PRISMATIC.WARLOCK.MELEE.ARCANE_NEEDLE,meleeName:"Arcane Needle",classAbilityHash:s.PRISMATIC.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.PRISMATIC.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Use Arcane Needle to activate Lightning Surge slide-melee. Winter's Guile stacks melee damage to absurd levels.",playstyle:"Slide, zap, heal via Devour, repeat. High APM melee nuke build.",difficulty:Q.Advanced,tags:["prismatic","melee","add-clear","warlock"]},{id:"warlock-prismatic-monte-winters",name:"Melee Rampage",element:G.Prismatic,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.WINTERS_GUILE,name:"Winter's Guile",slot:Z.Arms},exoticWeapon:{hash:se.KINETIC.MONTE_CARLO,name:"Monte Carlo"},requiredGrenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,subclassNode:{superHash:s.PRISMATIC.WARLOCK.SUPER.NOVA_BOMB_CATACLYSM,superName:"Nova Bomb",aspectHashes:[s.PRISMATIC.WARLOCK.ASPECTS.HELLION,s.PRISMATIC.WARLOCK.ASPECTS.FEED_THE_VOID],aspectNames:["Hellion","Feed the Void"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_COURAGE,s.PRISMATIC.FRAGMENTS.FACET_OF_SACRIFICE,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION,s.PRISMATIC.FRAGMENTS.FACET_OF_BALANCE],fragmentNames:["Facet of Courage","Facet of Sacrifice","Facet of Protection","Facet of Balance"],grenadeHash:s.PRISMATIC.WARLOCK.GRENADES.VORTEX,grenadeName:"Vortex Grenade",meleeHash:s.PRISMATIC.WARLOCK.MELEE.ARCANE_NEEDLE,meleeName:"Arcane Needle",classAbilityHash:s.PRISMATIC.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.PRISMATIC.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Monte Carlo keeps melee charged. Winter's Guile stacks melee damage up to 5x. Works on any subclass.",playstyle:"Constant melee attacks with ramping damage. Monte Carlo ensures you always have melee energy. Universal synergy.",difficulty:Q.Beginner,tags:["prismatic","melee","neutral-game","any-subclass","universal"]},{id:"warlock-prismatic-blade",name:"Prismatic Conductor",element:G.Prismatic,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.SPEAKERS_SIGHT,name:"Speaker's Sight",slot:Z.Helmet},exoticWeapon:{hash:se.ENERGY.ERGO_SUM,name:"Ergo Sum"},subclassNode:{superHash:s.PRISMATIC.WARLOCK.SUPER.SONG_OF_FLAME,superName:"Song of Flame",aspectHashes:[s.PRISMATIC.WARLOCK.ASPECTS.HELLION,s.PRISMATIC.WARLOCK.ASPECTS.FEED_THE_VOID],aspectNames:["Hellion","Feed the Void"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_HOPE,s.PRISMATIC.FRAGMENTS.FACET_OF_BALANCE,s.PRISMATIC.FRAGMENTS.FACET_OF_DAWN,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION],fragmentNames:["Facet of Hope","Facet of Balance","Facet of Dawn","Facet of Protection"],grenadeHash:s.PRISMATIC.WARLOCK.GRENADES.HEALING,grenadeName:"Healing Grenade",meleeHash:s.PRISMATIC.WARLOCK.MELEE.INCINERATOR_SNAP,meleeName:"Incinerator Snap",classAbilityHash:s.PRISMATIC.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.PRISMATIC.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Speaker's Sight turns healing nades into turrets. Ergo Sum clears adds with Arc Conductor.",playstyle:"Support heavy build with high add-clear potential. Keep turrets up and chain lightning.",difficulty:Q.Intermediate,tags:["prismatic","support","healing","ergo-sum"]},{id:"titan-prismatic-stronghold-praxic",name:"Praxic Knight",element:G.Prismatic,guardianClass:Y.Titan,requiredExpansion:X.FinalShape,exoticArmor:{hash:at.STRONGHOLD,name:"Stronghold",slot:Z.Arms},exoticWeapon:{hash:se.KINETIC.PRAXIC_BLADE,name:"Praxic Blade"},subclassNode:{superHash:s.PRISMATIC.TITAN.SUPER.TWILIGHT_ARSENAL,superName:"Twilight Arsenal",aspectHashes:[s.PRISMATIC.TITAN.ASPECTS.CONSECRATION,s.PRISMATIC.TITAN.ASPECTS.KNOCKOUT],aspectNames:["Consecration","Knockout"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_RUIN,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION,s.PRISMATIC.FRAGMENTS.FACET_OF_PURPOSE,s.PRISMATIC.FRAGMENTS.FACET_OF_BALANCE],fragmentNames:["Facet of Ruin","Facet of Protection","Facet of Purpose","Facet of Balance"],grenadeHash:s.PRISMATIC.TITAN.GRENADES.GLACIER,grenadeName:"Glacier Grenade",meleeHash:s.PRISMATIC.TITAN.MELEE.FRENZIED_BLADE,meleeName:"Frenzied Blade",classAbilityHash:s.PRISMATIC.TITAN.CLASS_ABILITIES.THRUSTER,classAbilityName:"Thruster",jumpHash:s.PRISMATIC.TITAN.JUMPS.HIGH_LIFT,jumpName:"High Lift"},loopDescription:"Infinite sword guard with Stronghold. Praxic Blade heavy attacks reflect incoming damage and sever targets. Consecration for burst.",playstyle:"Be the unbreakable wall. Block damage with Stronghold, then use Praxic Blade's heavy attack to reflect damage back at enemies.",difficulty:Q.Advanced,tags:["prismatic","sword","tank","praxic-blade"]},{id:"hunter-prismatic-blade",name:"Prismatic Duelist",element:G.Prismatic,guardianClass:Y.Hunter,requiredExpansion:X.FinalShape,exoticArmor:{hash:Ye.GIFTED_CONVICTION,name:"Gifted Conviction",slot:Z.Chest},exoticWeapon:{hash:se.ENERGY.ERGO_SUM,name:"Ergo Sum"},subclassNode:{superHash:s.PRISMATIC.HUNTER.SUPER.STORMS_EDGE,superName:"Storm's Edge",aspectHashes:[s.PRISMATIC.HUNTER.ASPECTS.ASCENSION,s.PRISMATIC.HUNTER.ASPECTS.STYLISH_EXECUTIONER],aspectNames:["Ascension","Stylish Executioner"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_DAWN,s.PRISMATIC.FRAGMENTS.FACET_OF_HOPE,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION,s.PRISMATIC.FRAGMENTS.FACET_OF_COURAGE],fragmentNames:["Facet of Dawn","Facet of Hope","Facet of Protection","Facet of Courage"],grenadeHash:s.PRISMATIC.HUNTER.GRENADES.ARCBOLT,grenadeName:"Arcbolt Grenade",meleeHash:s.PRISMATIC.HUNTER.MELEE.COMBINATION_BLOW,meleeName:"Combination Blow",classAbilityHash:s.PRISMATIC.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gamblers Dodge",jumpHash:s.PRISMATIC.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Ascension + Gifted Conviction for bouncing explosives. Ergo Sum chains lightning via Arc Conductor.",playstyle:"Extremely mobile add-clear. Use Ascension to jolt and spawn explosives, then mop up with the blade.",difficulty:Q.Advanced,tags:["prismatic","mobility","add-clear","ergo-sum"]},{id:"hunter-void-gyrfalcon-loop",name:"Gyrfalcon's Volatility",element:G.Void,guardianClass:Y.Hunter,requiredExpansion:X.WitchQueen,exoticArmor:{hash:Ye.GYRFALCONS_HAUBERK,name:"Gyrfalcon's Hauberk",slot:Z.Chest},exoticWeapon:{hash:se.ENERGY.FIGHTING_LION,name:"Fighting Lion"},subclassNode:{superHash:s.VOID.HUNTER.SUPER.SHADOWSHOT_DEADFALL,superName:"Shadowshot: Deadfall",aspectHashes:[s.VOID.HUNTER.ASPECTS.STYLISH_EXECUTIONER,s.VOID.HUNTER.ASPECTS.VANISHING_STEP],aspectNames:["Stylish Executioner","Vanishing Step"],fragmentHashes:[s.VOID.FRAGMENTS.ECHO_OF_INSTABILITY,s.VOID.FRAGMENTS.ECHO_OF_STARVATION,s.VOID.FRAGMENTS.ECHO_OF_PERSISTENCE,s.VOID.FRAGMENTS.ECHO_OF_OBSCURITY],fragmentNames:["Echo of Instability","Echo of Starvation","Echo of Persistence","Echo of Obscurity"],meleeHash:s.VOID.HUNTER.MELEE.SNARE_BOMB,meleeName:"Snare Bomb",grenadeHash:s.VOID.HUNTER.GRENADES.VORTEX,grenadeName:"Vortex Grenade",classAbilityHash:s.VOID.HUNTER.CLASS_ABILITIES.MARKSMANS_DODGE,classAbilityName:"Marksman's Dodge",jumpHash:s.VOID.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Coming out of invisibility grants Volatile Rounds to Void weapons. Kills on debuffed enemies grant invisibility via Stylish Executioner.",playstyle:"Dodge to go invis -> Kill an enemy to get Volatile Rounds -> Kill another to go back invis. Infinite loop of purple explosions.",difficulty:Q.Intermediate,tags:["void","volatile","invisibility","add-clear"]},{id:"hunter-any-lucky-pants-dps",name:"Lucky Shots",element:G.Kinetic,guardianClass:Y.Hunter,requiredExpansion:X.BaseGame,exoticArmor:{hash:Ye.LUCKY_PANTS,name:"Lucky Pants",slot:Z.Legs},exoticWeapon:{hash:se.KINETIC.MALFEASANCE,name:"Malfeasance"},subclassNode:{superHash:s.SOLAR.HUNTER.SUPER.GOLDEN_GUN_MARKSMAN,superName:"Golden Gun: Marksman",aspectHashes:[s.SOLAR.HUNTER.ASPECTS.ON_YOUR_MARK,s.SOLAR.HUNTER.ASPECTS.KNOCK_EM_DOWN],aspectNames:["On Your Mark","Knock 'Em Down"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES,s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_ASHES],fragmentNames:["Ember of Torches","Ember of Solace","Ember of Empyrean","Ember of Ashes"],meleeHash:s.SOLAR.HUNTER.MELEE.WEIGHTED_THROWING_KNIFE,meleeName:"Weighted Throwing Knife",grenadeHash:s.SOLAR.HUNTER.GRENADES.HEALING,grenadeName:"Healing Grenade",classAbilityHash:s.SOLAR.HUNTER.CLASS_ABILITIES.MARKSMANS_DODGE,classAbilityName:"Marksman's Dodge",jumpHash:s.SOLAR.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Readying a fully loaded Hand Cannon matching your element (or Kinetic) grants massive damage bonuses. Malfeasance deals monstrous damage to bosses.",playstyle:"Whip out your Hand Cannon when a major or boss appears. Land quick shots to stack the damage buff. Swap away once the buff ends.",difficulty:Q.Intermediate,tags:["kinetic","hand-cannon","boss-dps","burst-damage"]},{id:"hunter-solar-celestial-nuke",name:"One Shot Sharpshooter",element:G.Solar,guardianClass:Y.Hunter,requiredExpansion:X.BaseGame,exoticArmor:{hash:Ye.CELESTIAL_NIGHTHAWK,name:"Celestial Nighthawk",slot:Z.Helmet},exoticWeapon:{hash:se.POWER.WHISPER_OF_THE_WORM,name:"Whisper of the Worm"},subclassNode:{superHash:s.SOLAR.HUNTER.SUPER.GOLDEN_GUN_MARKSMAN,superName:"Golden Gun: Marksman",aspectHashes:[s.SOLAR.HUNTER.ASPECTS.ON_YOUR_MARK,s.SOLAR.HUNTER.ASPECTS.KNOCK_EM_DOWN],aspectNames:["On Your Mark","Knock 'Em Down"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES,s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_ASHES],fragmentNames:["Ember of Torches","Ember of Solace","Ember of Empyrean","Ember of Ashes"],meleeHash:s.SOLAR.HUNTER.MELEE.WEIGHTED_THROWING_KNIFE,meleeName:"Weighted Throwing Knife",grenadeHash:s.SOLAR.HUNTER.GRENADES.HEALING,grenadeName:"Healing Grenade",classAbilityHash:s.SOLAR.HUNTER.CLASS_ABILITIES.MARKSMANS_DODGE,classAbilityName:"Marksman's Dodge",jumpHash:s.SOLAR.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Golden Gun becomes a single, high-damage shot. Precision kills with any weapon refund Golden Gun energy.",playstyle:"Aim for the head. Line up your one Golden Gun shot for massive boss damage. Keep getting headshots to build your next super.",difficulty:Q.Beginner,tags:["solar","boss-dps","burst-damage","precision"]},{id:"warlock-any-assembler-support",name:"Assembler's Blessing",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.BeyondLight,exoticArmor:{hash:He.BOOTS_OF_THE_ASSEMBLER,name:"Boots of the Assembler",slot:Z.Legs},exoticWeapon:{hash:se.KINETIC.LUMINA,name:"Lumina"},subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.WELL_OF_RADIANCE,superName:"Well of Radiance",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME,s.SOLAR.WARLOCK.ASPECTS.HELLION],aspectNames:["Touch of Flame","Hellion"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_BENEVOLENCE,s.SOLAR.FRAGMENTS.EMBER_OF_MERCY,s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN],fragmentNames:["Ember of Benevolence","Ember of Mercy","Ember of Solace","Ember of Empyrean"],meleeHash:s.SOLAR.WARLOCK.MELEE.CELESTIAL_FIRE,meleeName:"Celestial Fire",grenadeHash:s.SOLAR.WARLOCK.GRENADES.HEALING,grenadeName:"Healing Grenade",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Standing in a rift spawns noble seekers that track and heal/empower allies. Lumina kills provide even more noble rounds.",playstyle:"Drop your rift and stay in it to keep the seekers flowing. Tap allies with Lumina to give them 35% damage bonus.",difficulty:Q.Intermediate,tags:["solar","healing","team-support","lumina"]},{id:"warlock-any-necrotic-poison",name:"Contagion Architect",element:G.Strand,guardianClass:Y.Warlock,requiredExpansion:X.Lightfall,exoticArmor:{hash:He.NECROTIC_GRIP,name:"Necrotic Grip",slot:Z.Arms},exoticWeapon:{hash:se.KINETIC.OSTEO_STRIGA,name:"Osteo Striga"},subclassNode:{superHash:s.STRAND.WARLOCK.SUPER.NEEDLESTORM,superName:"Needlestorm",aspectHashes:[s.STRAND.WARLOCK.ASPECTS.MINDSPUN_INVOCATION,s.STRAND.WARLOCK.ASPECTS.WEAVEWALK],aspectNames:["Mindspun Invocation","Weaverwalk"],fragmentHashes:[s.STRAND.FRAGMENTS.THREAD_OF_GENERATION,s.STRAND.FRAGMENTS.THREAD_OF_EVOLUTION,s.STRAND.FRAGMENTS.THREAD_OF_MIND,s.STRAND.FRAGMENTS.THREAD_OF_CONTINUITY],fragmentNames:["Thread of Generation","Thread of Evolution","Thread of Mind","Thread of Continuity"],meleeHash:s.STRAND.WARLOCK.MELEE.ARCANE_NEEDLE,meleeName:"Arcane Needle",grenadeHash:s.STRAND.WARLOCK.GRENADES.SHACKLE,grenadeName:"Shackle Grenade",classAbilityHash:s.STRAND.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.VOID.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Melee hits poison enemies. Poison kills spread the effect. Osteo Striga triggers this effect on every kill.",playstyle:"Shoot one enemy with Osteo Striga and watch the poison clear the whole room. Shackle grenades to keep them still while they rot.",difficulty:Q.Beginner,tags:["strand","poison","add-clear","passive-damage"]},{id:"warlock-prismatic-nezarec-loop",name:"Nezarec's Spectrum",element:G.Prismatic,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.NEZARECS_SIN,name:"Nezarec's Sin",slot:Z.Helmet},exoticWeapon:{hash:se.ENERGY.GRAVITON_LANCE,name:"Graviton Lance"},subclassNode:{superHash:s.PRISMATIC.WARLOCK.SUPER.NOVA_BOMB_CATACLYSM,superName:"Nova Bomb",aspectHashes:[s.PRISMATIC.WARLOCK.ASPECTS.FEED_THE_VOID,s.PRISMATIC.WARLOCK.ASPECTS.HELLION],aspectNames:["Feed the Void","Hellion"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_HOPE,s.PRISMATIC.FRAGMENTS.FACET_OF_BRAVERY,s.PRISMATIC.FRAGMENTS.FACET_OF_BALANCE,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION],fragmentNames:["Facet of Hope","Facet of Bravery","Facet of Balance","Facet of Protection"],meleeHash:s.PRISMATIC.WARLOCK.MELEE.POCKET_SINGULARITY,meleeName:"Pocket Singularity",grenadeHash:s.PRISMATIC.WARLOCK.GRENADES.VORTEX,grenadeName:"Vortex Grenade",classAbilityHash:s.PRISMATIC.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.PRISMATIC.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"All Void kills (weapon or ability) trigger Abyssal Extractors for massive ability energy. Feed the Void grants Devour on any ability kill.",playstyle:"The ultimate ability spam build. Use Graviton Lance to trigger Nezarec, and use your abilities to stay alive via Devour.",difficulty:Q.Beginner,tags:["prismatic","ability-spam","void-synergy","healing"]},{id:"warlock-solar-dawn-chorus",name:"Daybreak Scorch",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.BeyondLight,exoticArmor:{hash:He.DAWN_CHORUS,name:"Dawn Chorus",slot:Z.Helmet},exoticWeapon:{hash:se.ENERGY.SKYBURNERS_OATH,name:"Skyburner's Oath"},subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.DAYBREAK,superName:"Daybreak",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME,s.SOLAR.WARLOCK.ASPECTS.HEAT_RISES],aspectNames:["Touch of Flame","Heat Rises"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_SINGEING,s.SOLAR.FRAGMENTS.EMBER_OF_COMBUSTION],fragmentNames:["Ember of Ashes","Ember of Char","Ember of Singeing","Ember of Combustion"],meleeHash:s.SOLAR.WARLOCK.MELEE.INCINERATOR_SNAP,meleeName:"Incinerator Snap",grenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,grenadeName:"Solar Grenade",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Massive damage buff for Daybreak and Scorch builds. Scorch deals more damage and refunds melee energy.",playstyle:"Scorch everything. Use Skyburner's for easy scorch application. Daybreak deals massive damage to scorched targets.",difficulty:Q.Intermediate,tags:["solar","scorch","daybreak","warlock"]},{id:"warlock-void-briarbinds",name:"Void Soul Weaver",element:G.Void,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.BRIARBINDS,name:"Briarbinds",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.GRAVITON_LANCE,name:"Graviton Lance"},subclassNode:{superHash:s.VOID.WARLOCK.SUPER.NOVA_BOMB_VORTEX,superName:"Nova Bomb: Vortex",aspectHashes:[s.VOID.WARLOCK.ASPECTS.CHILD_OF_THE_OLD_GODS,s.VOID.WARLOCK.ASPECTS.FEED_THE_VOID],aspectNames:["Child of the Old Gods","Feed the Void"],fragmentHashes:[s.VOID.FRAGMENTS.ECHO_OF_UNDERMINING,s.VOID.FRAGMENTS.ECHO_OF_EXPULSION,s.VOID.FRAGMENTS.ECHO_OF_STARVATION,s.VOID.FRAGMENTS.ECHO_OF_PERSISTENCE],fragmentNames:["Echo of Undermining","Echo of Expulsion","Echo of Starvation","Echo of Persistence"],meleeHash:s.VOID.WARLOCK.MELEE.POCKET_SINGULARITY,meleeName:"Pocket Singularity",grenadeHash:s.VOID.WARLOCK.GRENADES.VORTEX,grenadeName:"Vortex Grenade",classAbilityHash:s.VOID.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.VOID.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Lets you retrieve and move your Void Soul. Void Souls last longer and deal escalating damage.",playstyle:"Deploy Void Soul, then pick it up to redeploy it with increased duration and damage. Keep the purple orb moving.",difficulty:Q.Intermediate,tags:["void","void-soul","warlock","control"]},{id:"titan-strand-abeyant-leap",name:"Puppeteer's Control",element:G.Strand,guardianClass:Y.Titan,requiredExpansion:X.Lightfall,exoticArmor:{hash:at.ABEYANT_LEAP,name:"Abeyant Leap",slot:Z.Legs},exoticWeapon:{hash:se.KINETIC.WISH_KEEPER,name:"Wish-Keeper"},subclassNode:{superHash:s.STRAND.TITAN.SUPER.BLADEFURY,superName:"Bladefury",aspectHashes:[s.STRAND.TITAN.ASPECTS.DRENGRS_LASH,s.STRAND.TITAN.ASPECTS.BANNER_OF_WAR],aspectNames:["Drengr's Lash","Banner of War"],fragmentHashes:[s.STRAND.FRAGMENTS.THREAD_OF_MIND,s.STRAND.FRAGMENTS.THREAD_OF_CONTINUITY,s.STRAND.FRAGMENTS.THREAD_OF_WARDING,s.STRAND.FRAGMENTS.THREAD_OF_GENERATION],fragmentNames:["Thread of Mind","Thread of Continuity","Thread of Warding","Thread of Generation"],meleeHash:s.STRAND.TITAN.MELEE.FRENZIED_BLADE,meleeName:"Frenzied Blade",grenadeHash:s.STRAND.TITAN.GRENADES.SHACKLE,grenadeName:"Shackle Grenade",classAbilityHash:s.STRAND.TITAN.CLASS_ABILITIES.RALLY_BARRICADE,classAbilityName:"Rally Barricade",jumpHash:s.STRAND.TITAN.JUMPS.STRAFE_LIFT,jumpName:"Strafe Lift"},loopDescription:"Improves Drengr's Lash: Barricade creates three seeking lashes that Suspend targets and grant Woven Mail.",playstyle:"Spam barricades to lock down entire rooms. Use Wish-Keeper to keep the suspension loop going.",difficulty:Q.Intermediate,tags:["strand","suspend","titan","control"]},{id:"titan-solar-pyrogale-slam",name:"Burning Wrath",element:G.Solar,guardianClass:Y.Titan,requiredExpansion:X.FinalShape,exoticArmor:{hash:at.PYROGALE_GAUNTLETS,name:"Pyrogale Gauntlets",slot:Z.Arms},exoticWeapon:{hash:se.POWER.DRAGONS_BREATH,name:"Dragon's Breath"},subclassNode:{superHash:s.SOLAR.TITAN.SUPER.BURNING_MAUL,superName:"Burning Maul",aspectHashes:[s.SOLAR.TITAN.ASPECTS.CONSECRATION,s.SOLAR.TITAN.ASPECTS.ROARING_FLAMES],aspectNames:["Consecration","Roaring Flames"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_ERUPTION,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES],fragmentNames:["Ember of Ashes","Ember of Eruption","Ember of Char","Ember of Torches"],meleeHash:s.SOLAR.TITAN.MELEE.THROWING_HAMMER,meleeName:"Throwing Hammer",grenadeHash:s.SOLAR.TITAN.GRENADES.THERMITE,grenadeName:"Thermite Grenade",classAbilityHash:s.SOLAR.TITAN.CLASS_ABILITIES.RALLY_BARRICADE,classAbilityName:"Rally Barricade",jumpHash:s.SOLAR.TITAN.JUMPS.STRAFE_LIFT,jumpName:"Strafe Lift"},loopDescription:"Turns the Burning Maul Super into a single high-damage slam with fire cyclones. Consecration creates fire cyclones too.",playstyle:"Nuke bosses with a single Super slam. Chain Consecration slide-melees for massive add clear.",difficulty:Q.Intermediate,tags:["solar","burst-damage","titan","slam"]},{id:"hunter-solar-caliban-ignition",name:"Ignition Fever",element:G.Solar,guardianClass:Y.Hunter,requiredExpansion:X.WitchQueen,exoticArmor:{hash:Ye.CALIBAN_HAND,name:"Caliban's Hand",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.SUNSHOT,name:"Sunshot"},subclassNode:{superHash:s.SOLAR.HUNTER.SUPER.BLADE_BARRAGE,superName:"Blade Barrage",aspectHashes:[s.SOLAR.HUNTER.ASPECTS.KNOCK_EM_DOWN,s.SOLAR.HUNTER.ASPECTS.ON_YOUR_MARK],aspectNames:["Knock 'Em Down","On Your Mark"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_ERUPTION,s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES],fragmentNames:["Ember of Ashes","Ember of Char","Ember of Eruption","Ember of Torches"],meleeHash:s.SOLAR.HUNTER.MELEE.PROXIMITY_EXPLOSIVE_KNIFE,meleeName:"Proximity Explosive Knife",grenadeHash:s.SOLAR.HUNTER.GRENADES.HEALING,grenadeName:"Healing Grenade",classAbilityHash:s.SOLAR.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gambler's Dodge",jumpHash:s.SOLAR.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Your Proximity Knives cause massive Solar Ignitions on kills. Ignitions refund melee energy.",playstyle:"Throw proximity knives into groups. Every kill triggers an ignition that clears the rest. Infinite knife loop.",difficulty:Q.Intermediate,tags:["solar","ignition","hunter","add-clear"]},{id:"hunter-void-omnioculus",name:"Invisible Protector",element:G.Void,guardianClass:Y.Hunter,requiredExpansion:X.BeyondLight,exoticArmor:{hash:Ye.OMNIOCULUS,name:"Omnioculus",slot:Z.Chest},exoticWeapon:{hash:se.ENERGY.LE_MONARQUE,name:"Le Monarque"},subclassNode:{superHash:s.VOID.HUNTER.SUPER.SHADOWSHOT_DEADFALL,superName:"Shadowshot: Deadfall",aspectHashes:[s.VOID.HUNTER.ASPECTS.TRAPPERS_AMBUSH,s.VOID.HUNTER.ASPECTS.VANISHING_STEP],aspectNames:["Trappers Ambush","Vanishing Step"],fragmentHashes:[s.VOID.FRAGMENTS.ECHO_OF_OBSCURITY,s.VOID.FRAGMENTS.ECHO_OF_STARVATION,s.VOID.FRAGMENTS.ECHO_OF_PERSISTENCE,s.VOID.FRAGMENTS.ECHO_OF_HARVEST],fragmentNames:["Echo of Obscurity","Echo of Starvation","Echo of Persistence","Echo of Harvest"],meleeHash:s.VOID.HUNTER.MELEE.SNARE_BOMB,meleeName:"Snare Bomb",grenadeHash:s.VOID.HUNTER.GRENADES.VORTEX,grenadeName:"Vortex Grenade",classAbilityHash:s.VOID.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gambler's Dodge",jumpHash:s.VOID.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Grants a second Smoke Bomb charge and gives damage resistance while invisible. Making allies invisible refunds smoke energy.",playstyle:"Keep your team invisible and resistant. Dive into groups to save allies. Infinite smoke energy if you play as a team.",difficulty:Q.Advanced,tags:["void","invisibility","hunter","support"]},{id:"warlock-any-cenotaph-divinity",name:"Sect of Insight",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.CENOTAPH_MASK,name:"Cenotaph Mask",slot:Z.Helmet},exoticWeapon:{hash:se.ENERGY.DIVINITY,name:"Divinity"},subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.WELL_OF_RADIANCE,superName:"Well of Radiance",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME,s.SOLAR.WARLOCK.ASPECTS.HELLION],aspectNames:["Touch of Flame","Hellion"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_BENEVOLENCE,s.SOLAR.FRAGMENTS.EMBER_OF_MERCY,s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN],fragmentNames:["Ember of Benevolence","Ember of Mercy","Ember of Solace","Ember of Empyrean"],meleeHash:s.SOLAR.WARLOCK.MELEE.CELESTIAL_FIRE,meleeName:"Celestial Fire",grenadeHash:s.SOLAR.WARLOCK.GRENADES.HEALING,grenadeName:"Healing Grenade",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Mandatory for Divinity users. Marks targets to generate Heavy ammo for your team.",playstyle:"Lock onto champions and bosses with Divinity. Your team gets Heavy ammo when they kill the marked target.",difficulty:Q.Intermediate,tags:["solar","support","heavy-ammo","warlock"]},{id:"titan-solar-loreley-survival",name:"Sunspot Sanctuary",element:G.Solar,guardianClass:Y.Titan,requiredExpansion:X.WitchQueen,exoticArmor:{hash:at.LORELEY_SPLENDOR,name:"Loreley Splendor",slot:Z.Helmet},exoticWeapon:{hash:se.ENERGY.SUNSHOT,name:"Sunshot"},subclassNode:{superHash:s.SOLAR.TITAN.SUPER.HAMMER_OF_SOL,superName:"Hammer of Sol",aspectHashes:[s.SOLAR.TITAN.ASPECTS.SOL_INVICTUS,s.SOLAR.TITAN.ASPECTS.ROARING_FLAMES],aspectNames:["Sol Invictus","Roaring Flames"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES,s.SOLAR.FRAGMENTS.EMBER_OF_BENEVOLENCE],fragmentNames:["Ember of Solace","Ember of Empyrean","Ember of Torches","Ember of Benevolence"],meleeHash:s.SOLAR.TITAN.MELEE.THROWING_HAMMER,meleeName:"Throwing Hammer",grenadeHash:s.SOLAR.TITAN.GRENADES.THERMITE,grenadeName:"Thermite Grenade",classAbilityHash:s.SOLAR.TITAN.CLASS_ABILITIES.RALLY_BARRICADE,classAbilityName:"Rally Barricade",jumpHash:s.SOLAR.TITAN.JUMPS.STRAFE_LIFT,jumpName:"Strafe Lift"},loopDescription:"Automatically creates a Sunspot when you are critically wounded or use your class ability. Sunspots heal you and damage enemies.",playstyle:"Aggressive play with a safety net. Use Sunshot to create sunspots on kills via Sol Invictus. Stay in the sunspots for Restoration.",difficulty:Q.Beginner,tags:["solar","survival","healing","titan"]},{id:"titan-stasis-cadmus-lance",name:"Diamond Stalker",element:G.Stasis,guardianClass:Y.Titan,requiredExpansion:X.FinalShape,exoticArmor:{hash:at.CADMUS_RIDGE_LANCECAP,name:"Cadmus Ridge Lancecap",slot:Z.Helmet},exoticWeapon:{hash:se.KINETIC.WICKED_IMPLEMENT,name:"Wicked Implement"},subclassNode:{superHash:s.STASIS.TITAN.SUPER.GLACIAL_QUAKE,superName:"Glacial Quake",aspectHashes:[s.STASIS.TITAN.ASPECTS.DIAMOND_LANCE,s.STASIS.TITAN.ASPECTS.TECTONIC_HARVEST],aspectNames:["Diamond Lance","Tectonic Harvest"],fragmentHashes:[s.STASIS.FRAGMENTS.WHISPER_OF_SHARDS,s.STASIS.FRAGMENTS.WHISPER_OF_CHAINS,s.STASIS.FRAGMENTS.WHISPER_OF_CONDUCTION,s.STASIS.FRAGMENTS.WHISPER_OF_BONDS],fragmentNames:["Whisper of Shards","Whisper of Chains","Whisper of Conduction","Whisper of Bonds"],meleeHash:s.STASIS.TITAN.MELEE.SHIVER_STRIKE,meleeName:"Shiver Strike",grenadeHash:s.STASIS.TITAN.GRENADES.GLACIER,grenadeName:"Glacier Grenade",classAbilityHash:s.STASIS.TITAN.CLASS_ABILITIES.RALLY_BARRICADE,classAbilityName:"Rally Barricade",jumpHash:s.STASIS.TITAN.JUMPS.STRAFE_LIFT,jumpName:"Strafe Lift"},loopDescription:"Precision hits with a Stasis weapon create Diamond Lances near you while standing behind a rally barricade.",playstyle:"Park behind your barricade and use Wicked Implement to slow targets. Every few precision hits spawns a Lance you can throw to freeze groups.",difficulty:Q.Intermediate,tags:["stasis","precision","titan","freeze"]},{id:"hunter-any-mothkeeper-wraps",name:"Swarm Lord",element:G.Neutral,guardianClass:Y.Hunter,requiredExpansion:X.FinalShape,exoticArmor:{hash:Ye.MOTHKEEPER_WRAPS,name:"Mothkeeper's Wraps",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.EX_DIRIS,name:"Ex Diris"},subclassNode:{superHash:s.ARC.HUNTER.SUPER.GATHERING_STORM,superName:"Gathering Storm",aspectHashes:[s.ARC.HUNTER.ASPECTS.FLOW_STATE,s.ARC.HUNTER.ASPECTS.ASCENSION],aspectNames:["Flow State","Ascension"],fragmentHashes:[s.ARC.FRAGMENTS.SPARK_OF_SHOCK,s.ARC.FRAGMENTS.SPARK_OF_IONS,s.ARC.FRAGMENTS.SPARK_OF_RESISTANCE,s.ARC.FRAGMENTS.SPARK_OF_AMPLITUDE],fragmentNames:["Spark of Shock","Spark of Ions","Spark of Resistance","Spark of Amplitude"],meleeHash:s.ARC.HUNTER.MELEE.COMBINATION_BLOW,meleeName:"Combination Blow",grenadeHash:s.ARC.HUNTER.GRENADES.STORM,grenadeName:"Storm Grenade",classAbilityHash:s.ARC.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gambler's Dodge",jumpHash:s.ARC.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Converts your grenade into a cage of loyal moths that track enemies to explode or track allies to grant overshields. Ex Diris spawns more moths.",playstyle:"Spam moths everywhere. Use Ex Diris to keep the swarm growing. Great for both add clear and team protection.",difficulty:Q.Beginner,tags:["neutral","moths","overshield","hunter"]},{id:"warlock-stasis-osmiomancy-freeze",name:"Glacial Overlord",element:G.Stasis,guardianClass:Y.Warlock,requiredExpansion:X.WitchQueen,exoticArmor:{hash:He.OSMIOMANCY_GLOVES,name:"Osmiomancy Gloves",slot:Z.Arms},exoticWeapon:{hash:se.KINETIC.AGERS_SCEPTER,name:"Ager's Scepter"},subclassNode:{superHash:s.STASIS.WARLOCK.SUPER.WINTERS_WRATH,superName:"Winter's Wrath",aspectHashes:[s.STASIS.WARLOCK.ASPECTS.BLEAK_WATCHER,s.STASIS.WARLOCK.ASPECTS.ICEFLARE_BOLTS],aspectNames:["Bleak Watcher","Iceflare Bolts"],fragmentHashes:[s.STASIS.FRAGMENTS.WHISPER_OF_HEDRONS,s.STASIS.FRAGMENTS.WHISPER_OF_DURANCE,s.STASIS.FRAGMENTS.WHISPER_OF_REFRACTION,s.STASIS.FRAGMENTS.WHISPER_OF_BONDS],fragmentNames:["Whisper of Hedrons","Whisper of Durance","Whisper of Refraction","Whisper of Bonds"],meleeHash:s.STASIS.WARLOCK.MELEE.PENUMBRAL_BLAST,meleeName:"Penumbral Blast",grenadeHash:s.STASIS.WARLOCK.GRENADES.COLDSNAP,grenadeName:"Coldsnap Grenade",classAbilityHash:s.STASIS.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.STASIS.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Grants a second Coldsnap charge with significantly improved tracking and energy refund on hits. Bleak Watchers last much longer.",playstyle:"Lock down the entire room with multiple Bleak Watcher turrets. Use Ager's Scepter to shatter everything.",difficulty:Q.Intermediate,tags:["stasis","freeze","warlock","crowd-control"]},{id:"warlock-solar-sunbracers-polaris",name:"Solar Ignition Loop",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.BeyondLight,exoticArmor:{hash:He.SUNBRACERS,name:"Sunbracers",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.POLARIS_LANCE,name:"Polaris Lance"},subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.WELL_OF_RADIANCE,superName:"Well of Radiance",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME,s.SOLAR.WARLOCK.ASPECTS.HEAT_RISES],aspectNames:["Touch of Flame","Heat Rises"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE],fragmentNames:["Ember of Ashes","Ember of Char","Ember of Empyrean","Ember of Solace"],meleeHash:s.SOLAR.WARLOCK.MELEE.INCINERATOR_SNAP,meleeName:"Incinerator Snap",grenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,grenadeName:"Solar Grenade",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Melee kills grant infinite Solar grenades for a short duration. Polaris Lance causes ignitions to keep the heat growing.",playstyle:"Kill a red bar with your snap, then carpet the floor in Solar grenades. Use Polaris Lance at range to ignite high-health targets.",difficulty:Q.Intermediate,tags:["solar","explosions","warlock","grenades"]},{id:"warlock-solar-dawn-polaris",name:"Scorching Vision",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.BeyondLight,exoticArmor:{hash:He.DAWN_CHORUS,name:"Dawn Chorus",slot:Z.Helmet},exoticWeapon:{hash:se.ENERGY.POLARIS_LANCE,name:"Polaris Lance"},subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.SONG_OF_FLAME,superName:"Song of Flame",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.HELLION,s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME],aspectNames:["Hellion","Touch of Flame"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_SINGEING],fragmentNames:["Ember of Ashes","Ember of Char","Ember of Empyrean","Ember of Singeing"],meleeHash:s.SOLAR.WARLOCK.MELEE.INCINERATOR_SNAP,meleeName:"Incinerator Snap",grenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,grenadeName:"Solar Grenade",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Dawn Chorus makes your Scorch deal more damage and grants melee energy when you damage scorched targets. Polaris Lance applies massive scorch.",playstyle:"Stay at range and use Polaris Lance to ignite everything. Every ignition refunds melee energy thanks to the helmet.",difficulty:Q.Beginner,tags:["solar","scorch","warlock","precision"]},{id:"warlock-solar-starfire-polaris",name:"Fusion Firestorm",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.BaseGame,exoticArmor:{hash:He.STARFIRE_PROTOCOL,name:"Starfire Protocol",slot:Z.Chest},exoticWeapon:{hash:se.ENERGY.POLARIS_LANCE,name:"Polaris Lance"},subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.WELL_OF_RADIANCE,superName:"Well of Radiance",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME,s.SOLAR.WARLOCK.ASPECTS.HELLION],aspectNames:["Touch of Flame","Hellion"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_RESOLVE],fragmentNames:["Ember of Ashes","Ember of Char","Ember of Empyrean","Ember of Resolve"],meleeHash:s.SOLAR.WARLOCK.MELEE.INCINERATOR_SNAP,meleeName:"Incinerator Snap",grenadeHash:s.SOLAR.WARLOCK.GRENADES.FUSION,grenadeName:"Fusion Grenade",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.EMPOWERING_RIFT,classAbilityName:"Empowering Rift",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Fusion Grenade hits grant Class Ability energy. Empowered weapon damage grants Fusion Grenade energy. Polaris Lance provides constant precision damage to fuel the loop.",playstyle:"Drop an Empowering Rift and land precision shots with Polaris Lance to rapidly regen Fusion Grenades. Use grenades to get your rift back.",difficulty:Q.Intermediate,tags:["solar","grenades","warlock","infinite-loop"]},{id:"hunter-solar-caliban-polaris",name:"Explosive Precision",element:G.Solar,guardianClass:Y.Hunter,requiredExpansion:X.BeyondLight,exoticArmor:{hash:Ye.CALIBAN_HAND,name:"Caliban's Hand",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.POLARIS_LANCE,name:"Polaris Lance"},subclassNode:{superHash:s.SOLAR.HUNTER.SUPER.BLADE_BARRAGE,superName:"Blade Barrage",aspectHashes:[s.SOLAR.HUNTER.ASPECTS.KNOCK_EM_DOWN,s.SOLAR.HUNTER.ASPECTS.ON_YOUR_MARK],aspectNames:["Knock 'Em Down","On Your Mark"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES],fragmentNames:["Ember of Ashes","Ember of Char","Ember of Empyrean","Ember of Torches"],meleeHash:s.SOLAR.HUNTER.MELEE.PROXIMITY_EXPLOSIVE_KNIFE,meleeName:"Proximity Explosive Knife",grenadeHash:s.SOLAR.HUNTER.GRENADES.SOLAR,grenadeName:"Solar Grenade",classAbilityHash:s.SOLAR.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gambler's Dodge",jumpHash:s.SOLAR.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Proximity Knife causes ignitions on direct hits. Polaris Lance provides the perfect long-range solar complement for constant scorch.",playstyle:"Throw your knife into groups and shoot the perfect fifth into those who survive. Everything explodes.",difficulty:Q.Intermediate,tags:["solar","ignitions","hunter","explosions"]},{id:"warlock-arc-getaway-artist",name:"Sentient Thunder",element:G.Arc,guardianClass:Y.Warlock,requiredExpansion:X.Forsaken,exoticArmor:{hash:He.GETAWAY_ARTIST,name:"Getaway Artist",slot:Z.Arms},subclassNode:{superHash:s.ARC.WARLOCK.SUPER.STORMTRANCE,superName:"Stormtrance",aspectHashes:[s.ARC.WARLOCK.ASPECTS.ARC_SOUL,s.ARC.WARLOCK.ASPECTS.ELECTROSTATIC_MIND],aspectNames:["Arc Soul","Electrostatic Mind"],fragmentHashes:[s.ARC.FRAGMENTS.SPARK_OF_SHOCK,s.ARC.FRAGMENTS.SPARK_OF_IONS,s.ARC.FRAGMENTS.SPARK_OF_RESISTANCE,s.ARC.FRAGMENTS.SPARK_OF_MAGNITUDE],fragmentNames:["Spark of Shock","Spark of Ions","Spark of Resistance","Spark of Magnitude"],meleeHash:s.ARC.WARLOCK.MELEE.BALL_LIGHTNING,meleeName:"Ball Lightning",grenadeHash:s.ARC.WARLOCK.GRENADES.STORM,grenadeName:"Storm Grenade",classAbilityHash:s.ARC.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.ARC.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Consume your grenade to summon a supercharged, auto-firing Arc Soul. Pairs perfectly with Arc weapons to maintain amplification.",playstyle:"Keep your Sentient Soul active at all times. Use Electrostatic Mind to generate Ionic Traces for constant grenade energy.",difficulty:Q.Beginner,tags:["arc-soul","passive-damage","warlock","arc"]},{id:"warlock-prismatic-getaway-turret",name:"Prismatic Battery",element:G.Prismatic,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.GETAWAY_ARTIST,name:"Getaway Artist",slot:Z.Arms},subclassNode:{superHash:s.PRISMATIC.WARLOCK.SUPER.SONG_OF_FLAME,superName:"Song of Flame",aspectHashes:[s.PRISMATIC.WARLOCK.ASPECTS.BLEAK_WATCHER,s.PRISMATIC.WARLOCK.ASPECTS.FEED_THE_VOID],aspectNames:["Bleak Watcher","Feed the Void"],fragmentHashes:[s.PRISMATIC.FRAGMENTS.FACET_OF_DAWN,s.PRISMATIC.FRAGMENTS.FACET_OF_HOPE,s.PRISMATIC.FRAGMENTS.FACET_OF_PROTECTION,s.PRISMATIC.FRAGMENTS.FACET_OF_BALANCE],fragmentNames:["Facet of Dawn","Facet of Hope","Facet of Protection","Facet of Balance"],meleeHash:s.PRISMATIC.WARLOCK.MELEE.ARCANE_NEEDLE,meleeName:"Arcane Needle",grenadeHash:s.PRISMATIC.WARLOCK.GRENADES.STORM,grenadeName:"Storm Grenade",classAbilityHash:s.PRISMATIC.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.PRISMATIC.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Consuming your grenade spawns BOTH a supercharged Arc Soul AND a Stasis Bleak Watcher turret. Feed the Void ensures constant grenade energy.",playstyle:"A support-damage hybrid. Lock down rooms with Stasis turrets while your auto-firing Arc Soul melts targets.",difficulty:Q.Intermediate,tags:["prismatic","turrets","warlock","support"]},{id:"titan-strand-service-of-luzaku",name:"Hive Memory Shield",element:G.Strand,guardianClass:Y.Titan,requiredExpansion:X.FinalShape,exoticArmor:{hash:at.ABEYANT_LEAP,name:"Abeyant Leap",slot:Z.Legs},exoticWeapon:{hash:se.POWER.SERVICE_OF_LUZAKU,name:"Service of Luzaku"},subclassNode:{superHash:s.STRAND.TITAN.SUPER.BLADEFURY,superName:"Bladefury",aspectHashes:[s.STRAND.TITAN.ASPECTS.BANNER_OF_WAR,s.STRAND.TITAN.ASPECTS.INTO_THE_FRAY],aspectNames:["Banner of War","Into the Fray"],fragmentHashes:[s.STRAND.FRAGMENTS.THREAD_OF_WARDING,s.STRAND.FRAGMENTS.THREAD_OF_FURY,s.STRAND.FRAGMENTS.THREAD_OF_GENERATION,s.STRAND.FRAGMENTS.THREAD_OF_CONTINUITY],fragmentNames:["Thread of Warding","Thread of Fury","Thread of Generation","Thread of Continuity"],meleeHash:s.STRAND.TITAN.MELEE.FRENZIED_BLADE,meleeName:"Frenzied Blade",grenadeHash:s.STRAND.TITAN.GRENADES.SHACKLE,grenadeName:"Shackle Grenade",classAbilityHash:s.STRAND.TITAN.CLASS_ABILITIES.TOWERING_BARRICADE,classAbilityName:"Towering Barricade",jumpHash:s.STRAND.TITAN.JUMPS.STRAFE_LIFT,jumpName:"Strafe Lift"},loopDescription:"Rapid hits with Service of Luzaku create a Hive Shield. Combine with Banner of War for ultimate frontline survivability.",playstyle:"The ultimate tank. Charge into battle, unleash needle fire to unravel targets, and stay alive with your custom frontal shield.",difficulty:Q.Intermediate,tags:["strand","tank","titan","defense"]},{id:"warlock-arc-getaway-centrifuse",name:"Sentient Thunder",element:G.Arc,guardianClass:Y.Warlock,requiredExpansion:X.Forsaken,exoticArmor:{hash:He.GETAWAY_ARTIST,name:"Getaway Artist",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.CENTRIFUSE,name:"Centrifuse"},subclassNode:{superHash:s.ARC.WARLOCK.SUPER.STORMTRANCE,superName:"Stormtrance",aspectHashes:[s.ARC.WARLOCK.ASPECTS.ARC_SOUL,s.ARC.WARLOCK.ASPECTS.ELECTROSTATIC_MIND],aspectNames:["Arc Soul","Electrostatic Mind"],fragmentHashes:[s.ARC.FRAGMENTS.SPARK_OF_IONS,s.ARC.FRAGMENTS.SPARK_OF_SHOCK,s.ARC.FRAGMENTS.SPARK_OF_AMPLITUDE,s.ARC.FRAGMENTS.SPARK_OF_RECHARGE],fragmentNames:["Spark of Ions","Spark of Shock","Spark of Amplitude","Spark of Recharge"],meleeHash:s.ARC.WARLOCK.MELEE.CHAIN_LIGHTNING,meleeName:"Chain Lightning",grenadeHash:s.ARC.WARLOCK.GRENADES.STORM,grenadeName:"Storm Grenade",classAbilityHash:s.ARC.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.ARC.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Consume your grenade to summon a Sentient Arc Soul. Centrifuse builds charge as you sprint, blinding enemies and feeding your arc engine.",playstyle:"Run and gun. Keep moving to charge Centrifuse and let your Arc Soul auto-target everything nearby.",difficulty:Q.Intermediate,tags:["warlock","arc","speed","battlemage","auto-rifle"]},{id:"titan-strand-stronghold-lament",name:"Immortal Guard",element:G.Strand,guardianClass:Y.Titan,requiredExpansion:X.FinalShape,exoticArmor:{hash:at.STRONGHOLD,name:"Stronghold",slot:Z.Arms},exoticWeapon:{hash:se.POWER.THE_LAMENT,name:"The Lament"},subclassNode:{superHash:s.STRAND.TITAN.SUPER.BLADEFURY,superName:"Bladefury",aspectHashes:[s.STRAND.TITAN.ASPECTS.BANNER_OF_WAR,s.STRAND.TITAN.ASPECTS.INTO_THE_FRAY],aspectNames:["Banner of War","Into the Fray"],fragmentHashes:[s.STRAND.FRAGMENTS.THREAD_OF_WARDING,s.STRAND.FRAGMENTS.THREAD_OF_FURY,s.STRAND.FRAGMENTS.THREAD_OF_GENERATION,s.STRAND.FRAGMENTS.THREAD_OF_CONTINUITY],fragmentNames:["Thread of Warding","Thread of Fury","Thread of Generation","Thread of Continuity"],meleeHash:s.STRAND.TITAN.MELEE.FRENZIED_BLADE,meleeName:"Frenzied Blade",grenadeHash:s.STRAND.TITAN.GRENADES.SHACKLE,grenadeName:"Shackle Grenade",classAbilityHash:s.STRAND.TITAN.CLASS_ABILITIES.TOWERING_BARRICADE,classAbilityName:"Towering Barricade",jumpHash:s.STRAND.TITAN.JUMPS.STRAFE_LIFT,jumpName:"Strafe Lift"},loopDescription:"Stronghold makes your guard infinite and heals you on blocks. The Lament shreds everything. Banner of War heals your team.",playstyle:'The "Immortal King". Block damage to heal, rev up The Lament to erase champions, and keep Banner of War stacking.',difficulty:Q.Advanced,tags:["tank","sword","titan","stronghold","strand"]},{id:"warlock-solar-chromatic-outbreak",name:"Nanite Explosion",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.CHROMATIC_FIRE,name:"Chromatic Fire",slot:Z.Chest},exoticWeapon:{hash:se.KINETIC.OUTBREAK_PERFECTED,name:"Outbreak Perfected"},subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.WELL_OF_RADIANCE,superName:"Well of Radiance",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME,s.SOLAR.WARLOCK.ASPECTS.HELLION],aspectNames:["Touch of Flame","Hellion"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_BENEVOLENCE,s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_ASHES],fragmentNames:["Ember of Benevolence","Ember of Torches","Ember of Empyrean","Ember of Ashes"],meleeHash:s.SOLAR.WARLOCK.MELEE.INCINERATOR_SNAP,meleeName:"Incinerator Snap",grenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,grenadeName:"Solar Grenade",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Precision kills with Outbreak Perfected create BOTH SIVA nanites AND Solar explosions from Chromatic Fire. The ultimate ad-clear display.",playstyle:"Precision management. Land headshots to trigger dual explosions that wipe out clusters of enemies instantly.",difficulty:Q.Intermediate,tags:["warlock","solar","explosion","siva","kinetic"]},{id:"hunter-void-graviton-heartshadow",name:"Spectral Shadow",element:G.Void,guardianClass:Y.Hunter,requiredExpansion:X.FinalShape,exoticArmor:{hash:Ye.GRAVITON_FORFEIT,name:"Graviton Forfeit",slot:Z.Helmet},exoticWeapon:{hash:se.POWER.HEARTSHADOW,name:"Heartshadow"},subclassNode:{superHash:s.VOID.HUNTER.SUPER.SHADOWSHOT_DEADFALL,superName:"Shadowshot: Deadfall",aspectHashes:[s.VOID.HUNTER.ASPECTS.VANISHING_STEP,s.VOID.HUNTER.ASPECTS.STYLISH_EXECUTIONER],aspectNames:["Vanishing Step","Stylish Executioner"],fragmentHashes:[s.VOID.FRAGMENTS.ECHO_OF_OBSCURITY,s.VOID.FRAGMENTS.ECHO_OF_STARVATION,s.VOID.FRAGMENTS.ECHO_OF_PERSISTENCE,s.VOID.FRAGMENTS.ECHO_OF_LEECHING],fragmentNames:["Echo of Obscurity","Echo of Starvation","Echo of Persistence","Echo of Leeching"],meleeHash:s.VOID.HUNTER.MELEE.SNARE_BOMB,meleeName:"Snare Bomb",grenadeHash:s.VOID.HUNTER.GRENADES.VORTEX,grenadeName:"Vortex Grenade",classAbilityHash:s.VOID.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gambler's Dodge",jumpHash:s.VOID.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Heartshadow grants invisibility on heavy attacks. Graviton Forfeit extends it. Stylish Executioner lets you chain invisible kills forever.",playstyle:"True Assassin. Strike from the shadows with your void sword, vanish, and reposition. You are never seen.",difficulty:Q.Advanced,tags:["hunter","void","stealth","sword","invisibility"]},{id:"titan-solar-pyrogale-sunshot",name:"Burning Cyclone",element:G.Solar,guardianClass:Y.Titan,requiredExpansion:X.FinalShape,exoticArmor:{hash:at.PYROGALE_GAUNTLETS,name:"Pyrogale Gauntlets",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.SUNSHOT,name:"Sunshot"},subclassNode:{superHash:s.SOLAR.TITAN.SUPER.BURNING_MAUL,superName:"Burning Maul",aspectHashes:[s.SOLAR.TITAN.ASPECTS.ROARING_FLAMES,s.SOLAR.TITAN.ASPECTS.SOL_INVICTUS],aspectNames:["Roaring Flames","Sol Invictus"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_BLISTERING,s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE],fragmentNames:["Ember of Ashes","Ember of Blazing","Ember of Empyrean","Ember of Solace"],meleeHash:s.SOLAR.TITAN.MELEE.THROWING_HAMMER,meleeName:"Throwing Hammer",grenadeHash:s.SOLAR.TITAN.GRENADES.THERMITE,grenadeName:"Thermite Grenade",classAbilityHash:s.SOLAR.TITAN.CLASS_ABILITIES.RALLY_BARRICADE,classAbilityName:"Rally Barricade",jumpHash:s.SOLAR.TITAN.JUMPS.STRAFE_LIFT,jumpName:"Strafe Lift"},loopDescription:"Sunshot chains explosions to build Roaring Flames. Consecration (from Pyrogale effect) and Burning Maul creates massive fire cyclones.",playstyle:"Explosive carnage. Use Sunshot for adds, and drop the Pyrogale hammer on bosses.",difficulty:Q.Intermediate,tags:["titan","solar","explosions","sunspot","dps"]},{id:"hunter-solar-heirloom-explosion",name:"Wookiee Demolitionist",element:G.Solar,guardianClass:Y.Hunter,requiredExpansion:X.FinalShape,exoticArmor:{hash:Ye.CALIBAN_HAND,name:"Caliban's Hand",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.HEIRLOOM,name:"Heirloom"},subclassNode:{superHash:s.SOLAR.HUNTER.SUPER.BLADE_BARRAGE,superName:"Blade Barrage",aspectHashes:[s.SOLAR.HUNTER.ASPECTS.KNOCK_EM_DOWN,s.SOLAR.HUNTER.ASPECTS.GUNPOWDER_GAMBLE],aspectNames:["Knock 'Em Down","Gunpowder Gamble"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_ERUPTION,s.SOLAR.FRAGMENTS.EMBER_OF_TORCHES],fragmentNames:["Ember of Ashes","Ember of Char","Ember of Eruption","Ember of Torches"],meleeHash:s.SOLAR.HUNTER.MELEE.PROXIMITY_EXPLOSIVE_KNIFE,meleeName:"Proximity Explosive Knife",grenadeHash:s.SOLAR.HUNTER.GRENADES.TRIPMINE,grenadeName:"Tripmine Grenade",classAbilityHash:s.SOLAR.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gambler's Dodge",jumpHash:s.SOLAR.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Heirloom's explosive bolts trigger Solar ignitions. Caliban's Hand ensures your knives also explode. Gunpowder Gamble adds even more explosions.",playstyle:"Charge your bow for maximum blast radius, then follow up with explosive knives. Everything burns.",difficulty:Q.Intermediate,tags:["solar","bow","explosion","hunter","caliban"]},{id:"warlock-solar-heirloom-rain",name:"Orbital Bombardment",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.RAIN_OF_FIRE,name:"Rain of Fire",slot:Z.Legs},exoticWeapon:{hash:se.ENERGY.HEIRLOOM,name:"Heirloom"},subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.SONG_OF_FLAME,superName:"Song of Flame",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME,s.SOLAR.WARLOCK.ASPECTS.ICARUS_DASH],aspectNames:["Touch of Flame","Icarus Dash"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_EMPYREAN,s.SOLAR.FRAGMENTS.EMBER_OF_SOLACE,s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_SEARING],fragmentNames:["Ember of Empyrean","Ember of Solace","Ember of Ashes","Ember of Searing"],meleeHash:s.SOLAR.WARLOCK.MELEE.INCINERATOR_SNAP,meleeName:"Incinerator Snap",grenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,grenadeName:"Solar Grenade",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Air dashes reload Heirloom instantly (Rain of Fire). Hover above the battlefield raining down explosive solar bolts.",playstyle:"Aerial superiority. Dash to reload, charge a shot, fire, repeat. Keep radiant active 100% of the time.",difficulty:Q.Advanced,tags:["solar","bow","aerial","warlock","rain-of-fire"]},{id:"titan-arc-praxic-vestment",name:"Thunderbird",element:G.Arc,guardianClass:Y.Titan,requiredExpansion:X.FinalShape,exoticArmor:{hash:at.PRAXIC_VESTMENT,name:"Praxic Vestment",slot:Z.Chest},exoticWeapon:{hash:se.ENERGY.RISKRUNNER,name:"Riskrunner"},subclassNode:{superHash:s.ARC.TITAN.SUPER.THUNDERCRASH,superName:"Thundercrash",aspectHashes:[s.ARC.TITAN.ASPECTS.KNOCKOUT,s.ARC.TITAN.ASPECTS.TOUCH_OF_THUNDER],aspectNames:["Knockout","Touch of Thunder"],fragmentHashes:[s.ARC.FRAGMENTS.SPARK_OF_RESISTANCE,s.ARC.FRAGMENTS.SPARK_OF_SHOCK,s.ARC.FRAGMENTS.SPARK_OF_RECHARGE,s.ARC.FRAGMENTS.SPARK_OF_AMPLITUDE],fragmentNames:["Spark of Resistance","Spark of Shock","Spark of Recharge","Spark of Amplitude"],meleeHash:s.ARC.TITAN.MELEE.BALLISTIC_SLAM,meleeName:"Ballistic Slam",grenadeHash:s.ARC.TITAN.GRENADES.PULSE,grenadeName:"Pulse Grenade",classAbilityHash:s.ARC.TITAN.CLASS_ABILITIES.THRUSTER,classAbilityName:"Thruster",jumpHash:s.ARC.TITAN.JUMPS.STRAFE_LIFT,jumpName:"Strafe Lift"},loopDescription:"Arc kills build fuel for Praxic Vestment's jetpack. Boost into the air and slam down with Ballistic Slam or the jetpack collision.",playstyle:"Hyper-aggressive aerial assault. Use Riskrunner to stay safe from Arc damage while building fuel.",difficulty:Q.Intermediate,tags:["arc","titan","jetpack","mobility","slam"]},{id:"warlock-strand-deimosuffusion",name:"Weaver's Trap",element:G.Strand,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.DEIMOSUFFUSION,name:"Deimosuffusion",slot:Z.Helmet},exoticWeapon:{hash:se.KINETIC.WISH_KEEPER,name:"Wish-Keeper"},subclassNode:{superHash:s.STRAND.WARLOCK.SUPER.NEEDLESTORM,superName:"Needlestorm",aspectHashes:[s.STRAND.WARLOCK.ASPECTS.THE_WANDERER,s.STRAND.WARLOCK.ASPECTS.MINDSPUN_INVOCATION],aspectNames:["The Wanderer","Mindspun Invocation"],fragmentHashes:[s.STRAND.FRAGMENTS.THREAD_OF_MIND,s.STRAND.FRAGMENTS.THREAD_OF_WISDOM,s.STRAND.FRAGMENTS.THREAD_OF_GENERATION,s.STRAND.FRAGMENTS.THREAD_OF_CONTINUITY],fragmentNames:["Thread of Mind","Thread of Wisdom","Thread of Generation","Thread of Continuity"],meleeHash:s.STRAND.WARLOCK.MELEE.ARCANE_NEEDLE,meleeName:"Arcane Needle",grenadeHash:s.STRAND.WARLOCK.GRENADES.SHACKLE,grenadeName:"Shackle Grenade",classAbilityHash:s.STRAND.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.STRAND.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Casting Rift suspends everyone nearby (Deimosuffusion). Suspended targets take DOT and heal you. Wish-Keeper traps any survivors.",playstyle:"Drop your rift aggressively in the middle of enemies. Watch them hang helpless while you heal.",difficulty:Q.Intermediate,tags:["strand","warlock","suspend","control","healing"]},{id:"hunter-void-fortune-favor",name:"Void Apex",element:G.Void,guardianClass:Y.Hunter,requiredExpansion:X.FinalShape,exoticArmor:{hash:Ye.FORTUNES_FAVOR,name:"Fortune's Favor",slot:Z.Legs},exoticWeapon:{hash:se.ENERGY.GRAVITON_LANCE,name:"Graviton Lance"},subclassNode:{superHash:s.VOID.HUNTER.SUPER.SHADOWSHOT_MOEBIUS_QUIVER,superName:"Moebius Quiver",aspectHashes:[s.VOID.HUNTER.ASPECTS.STYLISH_EXECUTIONER,s.VOID.HUNTER.ASPECTS.VANISHING_STEP],aspectNames:["Stylish Executioner","Vanishing Step"],fragmentHashes:[s.VOID.FRAGMENTS.ECHO_OF_VIGILANCE,s.VOID.FRAGMENTS.ECHO_OF_PERSISTENCE,s.VOID.FRAGMENTS.ECHO_OF_STARVATION,s.VOID.FRAGMENTS.ECHO_OF_LEECHING],fragmentNames:["Echo of Vigilance","Echo of Persistence","Echo of Starvation","Echo of Leeching"],meleeHash:s.VOID.HUNTER.MELEE.SNARE_BOMB,meleeName:"Snare Bomb",grenadeHash:s.VOID.HUNTER.GRENADES.VORTEX,grenadeName:"Vortex Grenade",classAbilityHash:s.VOID.HUNTER.CLASS_ABILITIES.MARKSMANS_DODGE,classAbilityName:"Marksman's Dodge",jumpHash:s.VOID.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Get a kill at full health to gain a Void Overshield. While shielded, enjoy +20% damage and laser-beam accuracy with simple weapons like Graviton Lance.",playstyle:"Marksman. Keep your distance, keep your health full, and chain kills to maintain the damage buff.",difficulty:Q.Beginner,tags:["void","hunter","damage-buff","overshield","neutral"]},{id:"warlock-strand-luzaku",name:"Brood Mother's Wrath",element:G.Strand,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.SWARMERS,name:"Swarmers",slot:Z.Legs},exoticWeapon:{hash:se.POWER.SERVICE_OF_LUZAKU,name:"Service of Luzaku"},subclassNode:{superHash:s.STRAND.WARLOCK.SUPER.NEEDLESTORM,superName:"Needlestorm",aspectHashes:[s.STRAND.WARLOCK.ASPECTS.WEAVERS_CALL,s.STRAND.WARLOCK.ASPECTS.THE_WANDERER],aspectNames:["Weaver's Call","The Wanderer"],fragmentHashes:[s.STRAND.FRAGMENTS.THREAD_OF_EVOLUTION,s.STRAND.FRAGMENTS.THREAD_OF_REBIRTH,s.STRAND.FRAGMENTS.THREAD_OF_GENERATION,s.STRAND.FRAGMENTS.THREAD_OF_WARDING],fragmentNames:["Thread of Evolution","Thread of Rebirth","Thread of Generation","Thread of Warding"],meleeHash:s.STRAND.WARLOCK.MELEE.ARCANE_NEEDLE,meleeName:"Arcane Needle",grenadeHash:s.STRAND.WARLOCK.GRENADES.THREADLING,grenadeName:"Threadling Grenade",classAbilityHash:s.STRAND.WARLOCK.CLASS_ABILITIES.HEALING_RIFT,classAbilityName:"Healing Rift",jumpHash:s.STRAND.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Service of Luzaku spawns Threadlings on hip-fire. Swarmers makes them Unravel. Warlock aspects create even more Threadlings.",playstyle:"Summoner. Hip-fire your LMG to flood the field with minions while staying healed.",difficulty:Q.Intermediate,tags:["strand","warlock","threadlings","summoner","lmg"]},{id:"titan-solar-whirling-ovation",name:"Scorched Earth Protocol",element:G.Solar,guardianClass:Y.Titan,requiredExpansion:X.FinalShape,exoticArmor:{hash:at.PYROGALE_GAUNTLETS,name:"Pyrogale Gauntlets",slot:Z.Arms},exoticWeapon:{hash:se.POWER.WHIRLING_OVATION,name:"Whirling Ovation"},subclassNode:{superHash:s.SOLAR.TITAN.SUPER.BURNING_MAUL,superName:"Burning Maul",aspectHashes:[s.SOLAR.TITAN.ASPECTS.ROARING_FLAMES,s.SOLAR.TITAN.ASPECTS.SOL_INVICTUS],aspectNames:["Roaring Flames","Sol Invictus"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_ERUPTION,s.SOLAR.FRAGMENTS.EMBER_OF_SEARING],fragmentNames:["Ember of Ashes","Ember of Char","Ember of Eruption","Ember of Searing"],meleeHash:s.SOLAR.TITAN.MELEE.THROWING_HAMMER,meleeName:"Throwing Hammer",grenadeHash:s.SOLAR.TITAN.GRENADES.THERMITE,grenadeName:"Thermite Grenade",classAbilityHash:s.SOLAR.TITAN.CLASS_ABILITIES.RALLY_BARRICADE,classAbilityName:"Rally Barricade",jumpHash:s.SOLAR.TITAN.JUMPS.STRAFE_LIFT,jumpName:"Strafe Lift"},loopDescription:"Whirling Ovation charges quickly and deals massive Solar damage. Pyrogale Gauntlets turn your super into a boss-melting nuke. Roaring Flames buffs both.",playstyle:"Boss Damage Specialist. Stack Roaring Flames with abilities, then unleash rockets and your Pyrogale super.",difficulty:Q.Intermediate,tags:["solar","titan","dps","rockets","pyrogale"]},{id:"hunter-arc-graviton-spike",name:"Temporal Shock",element:G.Arc,guardianClass:Y.Hunter,requiredExpansion:X.FinalShape,exoticArmor:{hash:Ye.MASK_OF_BAKRIS,name:"Mask of Bakris",slot:Z.Helmet},exoticWeapon:{hash:se.ENERGY.GRAVITON_SPIKE,name:"Graviton Spike"},subclassNode:{superHash:s.STASIS.HUNTER.SUPER.SILENCE_AND_SQUALL,superName:"Silence and Squall",aspectHashes:[s.STASIS.HUNTER.ASPECTS.WINTERS_SHROUD,s.STASIS.HUNTER.ASPECTS.TOUCH_OF_WINTER],aspectNames:["Winter's Shroud","Touch of Winter"],fragmentHashes:[s.STASIS.FRAGMENTS.WHISPER_OF_HEDRONS,s.STASIS.FRAGMENTS.WHISPER_OF_IMPETUS,s.STASIS.FRAGMENTS.WHISPER_OF_FISSURES,s.STASIS.FRAGMENTS.WHISPER_OF_REFRACTION],fragmentNames:["Whisper of Hedrons","Whisper of Impetus","Whisper of Fissures","Whisper of Refraction"],meleeHash:s.STASIS.HUNTER.MELEE.WITHERING_BLADE,meleeName:"Withering Blade",grenadeHash:s.STASIS.HUNTER.GRENADES.DUSKFIELD,grenadeName:"Duskfield Grenade",classAbilityHash:s.STASIS.HUNTER.CLASS_ABILITIES.MARKSMANS_DODGE,classAbilityName:"Marksman's Dodge",jumpHash:s.STASIS.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Graviton Spike swaps between Arc and Stasis. Mask of Bakris buffs BOTH damage types after shifting. Kills in one mode charge the other.",playstyle:"Shift behind enemies, unleash Arc fire, freeze them with Stasis mode, shatter them intact. Maximum hybrid synergy.",difficulty:Q.Advanced,tags:["stasis","arc","hybrid","hunter","bakris"]},{id:"hunter-void-third-iteration",name:"Iterative Stalker",element:G.Void,guardianClass:Y.Hunter,requiredExpansion:X.FinalShape,exoticArmor:{hash:Ye.GYRFALCONS_HAUBERK,name:"Gyrfalcon's Hauberk",slot:Z.Chest},exoticWeapon:{hash:se.ENERGY.THIRD_ITERATION,name:"Third Iteration"},subclassNode:{superHash:s.VOID.HUNTER.SUPER.SHADOWSHOT_DEADFALL,superName:"Shadowshot: Deadfall",aspectHashes:[s.VOID.HUNTER.ASPECTS.STYLISH_EXECUTIONER,s.VOID.HUNTER.ASPECTS.VANISHING_STEP],aspectNames:["Stylish Executioner","Vanishing Step"],fragmentHashes:[s.VOID.FRAGMENTS.ECHO_OF_OBSCURITY,s.VOID.FRAGMENTS.ECHO_OF_STARVATION,s.VOID.FRAGMENTS.ECHO_OF_PERSISTENCE,s.VOID.FRAGMENTS.ECHO_OF_INSTABILITY],fragmentNames:["Echo of Obscurity","Echo of Starvation","Echo of Persistence","Echo of Instability"],meleeHash:s.VOID.HUNTER.MELEE.SNARE_BOMB,meleeName:"Snare Bomb",grenadeHash:s.VOID.HUNTER.GRENADES.VORTEX,grenadeName:"Vortex Grenade",classAbilityHash:s.VOID.HUNTER.CLASS_ABILITIES.GAMBLERS_DODGE,classAbilityName:"Gambler's Dodge",jumpHash:s.VOID.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Third Iteration marks targets and grants invisibility on kills. Gyrfalcon's Hauberk gives Volatile Rounds when you exit invisibility. It's an infinite loop.",playstyle:"Mark enemies from safe distance. Kill them to vanishing. Reappear with explosive volatile rounds.",difficulty:Q.Intermediate,tags:["void","hunter","volatile","invisibility","scout"]},{id:"hunter-strand-moirai",name:"Weaver's Retrieval",element:G.Strand,guardianClass:Y.Hunter,requiredExpansion:X.FinalShape,exoticArmor:{hash:Ye.MOIRAI,name:"Moirai",slot:Z.Chest},exoticWeapon:{hash:se.KINETIC.FINAL_WARNING,name:"Final Warning"},subclassNode:{superHash:s.STRAND.HUNTER.SUPER.SILKSTRIKE,superName:"Silkstrike",aspectHashes:[s.STRAND.HUNTER.ASPECTS.WHIRLING_MAELSTROM,s.STRAND.HUNTER.ASPECTS.THREADED_SPECTER],aspectNames:["Whirling Maelstrom","Threaded Specter"],fragmentHashes:[s.STRAND.FRAGMENTS.THREAD_OF_GENERATION,s.STRAND.FRAGMENTS.THREAD_OF_WARDING,s.STRAND.FRAGMENTS.THREAD_OF_TRANSMUTATION,s.STRAND.FRAGMENTS.THREAD_OF_EVOLUTION],fragmentNames:["Thread of Generation","Thread of Warding","Thread of Transmutation","Thread of Evolution"],meleeHash:s.STRAND.HUNTER.MELEE.THREADED_SPIKE,meleeName:"Threaded Spike",grenadeHash:s.STRAND.HUNTER.GRENADES.GRAPPLE,grenadeName:"Grapple",classAbilityHash:s.STRAND.HUNTER.CLASS_ABILITIES.MARKSMANS_DODGE,classAbilityName:"Marksman's Dodge",jumpHash:s.STRAND.HUNTER.JUMPS.TRIPLE_JUMP,jumpName:"Triple Jump"},loopDescription:"Moirai allows Threaded Spike to detonate and retrieve Tangles. Use Final Warning to generate Tangles, then use your melee to manipulate the battlefield.",playstyle:"Tangle Master. Create tangles, throw your spike to retrieve/detonate them, and keep Woven Mail up.",difficulty:Q.Advanced,tags:["strand","hunter","tangle","melee","moirai"]},{id:"warlock-solar-eunoia",name:"Hellfire Barrage",element:G.Solar,guardianClass:Y.Warlock,requiredExpansion:X.FinalShape,exoticArmor:{hash:He.EUNOIA,name:"Eunoia",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.SUNSHOT,name:"Sunshot"},subclassNode:{superHash:s.SOLAR.WARLOCK.SUPER.SONG_OF_FLAME,superName:"Song of Flame",aspectHashes:[s.SOLAR.WARLOCK.ASPECTS.HELLION,s.SOLAR.WARLOCK.ASPECTS.TOUCH_OF_FLAME],aspectNames:["Hellion","Touch of Flame"],fragmentHashes:[s.SOLAR.FRAGMENTS.EMBER_OF_ASHES,s.SOLAR.FRAGMENTS.EMBER_OF_CHAR,s.SOLAR.FRAGMENTS.EMBER_OF_SINGEING,s.SOLAR.FRAGMENTS.EMBER_OF_BENEVOLENCE],fragmentNames:["Ember of Ashes","Ember of Char","Ember of Singeing","Ember of Benevolence"],meleeHash:s.SOLAR.WARLOCK.MELEE.INCINERATOR_SNAP,meleeName:"Incinerator Snap",grenadeHash:s.SOLAR.WARLOCK.GRENADES.SOLAR,grenadeName:"Solar Grenade",classAbilityHash:s.SOLAR.WARLOCK.CLASS_ABILITIES.PHOENIX_DIVE,classAbilityName:"Phoenix Dive",jumpHash:s.SOLAR.WARLOCK.JUMPS.BURST_GLIDE,jumpName:"Burst Glide"},loopDescription:"Eunoia causes your Hellion shots to explode mid-flight for AOE carpet bombing. Cast Rift/Dive to summon Hellion, then reign fire.",playstyle:"Artillery Mage. Summon your Solar Buddy and watch it carpet bomb everything in front of you.",difficulty:Q.Intermediate,tags:["solar","warlock","hellion","explosions","summoner"]},{id:"titan-void-melas-panoplia",name:"Void Fortress",element:G.Void,guardianClass:Y.Titan,requiredExpansion:X.FinalShape,exoticArmor:{hash:at.MELAS_PANOPLIA,name:"Melas Panoplia",slot:Z.Arms},exoticWeapon:{hash:se.ENERGY.VEXCALIBUR,name:"Vexcalibur"},subclassNode:{superHash:s.VOID.TITAN.SUPER.WARD_OF_DAWN,superName:"Ward of Dawn",aspectHashes:[s.VOID.TITAN.ASPECTS.BASTION,s.VOID.TITAN.ASPECTS.OFFENSIVE_BULWARK],aspectNames:["Bastion","Offensive Bulwark"],fragmentHashes:[s.VOID.FRAGMENTS.ECHO_OF_LEECHING,s.VOID.FRAGMENTS.ECHO_OF_VIGILANCE,s.VOID.FRAGMENTS.ECHO_OF_PERSISTENCE,s.VOID.FRAGMENTS.ECHO_OF_REPRISAL],fragmentNames:["Echo of Leeching","Echo of Vigilance","Echo of Persistence","Echo of Reprisal"],meleeHash:s.VOID.TITAN.MELEE.SHIELD_BASH,meleeName:"Shield Bash",grenadeHash:s.VOID.TITAN.GRENADES.VORTEX,grenadeName:"Vortex Grenade",classAbilityHash:s.VOID.TITAN.CLASS_ABILITIES.TOWERING_BARRICADE,classAbilityName:"Towering Barricade",jumpHash:s.VOID.TITAN.JUMPS.CATAPULT_LIFT,jumpName:"Catapult Lift"},loopDescription:"Melas Panoplia enhances your defensive capabilities. Combine with Vexcalibur and Bastion for maximum Void Overshield uptime.",playstyle:"The Wall. Create barriers, block damage, and protect your team with impenetrable void defenses.",difficulty:Q.Beginner,tags:["void","titan","tank","defense","overshield"]}],di=Object.freeze(Object.defineProperty({__proto__:null,SYNERGY_DEFINITIONS:gr},Symbol.toStringTag,{value:"Module"})),nr={solar:{0:{super:"Hammer of Sol",classAbility:"Towering Barricade",jump:"Strafe Lift",melee:"Throwing Hammer",grenade:"Thermite Grenade",aspects:["Sol Invictus","Roaring Flames"],fragments:["Ember of Torches","Ember of Empyrean","Ember of Solace"]},1:{super:"Golden Gun: Marksman",classAbility:"Marksman's Dodge",jump:"Triple Jump",melee:"Knife Trick",grenade:"Tripmine Grenade",aspects:["Knock 'Em Down","On Your Mark"],fragments:["Ember of Torches","Ember of Singeing","Ember of Searing"]},2:{super:"Well of Radiance",classAbility:"Healing Rift",jump:"Burst Glide",melee:"Celestial Fire",grenade:"Solar Grenade",aspects:["Touch of Flame","Heat Rises"],fragments:["Ember of Ashes","Ember of Char","Ember of Wonder"]}},arc:{0:{super:"Thundercrash",classAbility:"Thruster",jump:"Catapult Lift",melee:"Thunderclap",grenade:"Storm Grenade",aspects:["Touch of Thunder","Knockout"],fragments:["Spark of Shock","Spark of Magnitude","Spark of Resistance"]},1:{super:"Gathering Storm",classAbility:"Gambler's Dodge",jump:"Triple Jump",melee:"Combination Blow",grenade:"Pulse Grenade",aspects:["Flow State","Lethal Current"],fragments:["Spark of Shock","Spark of Ions","Spark of Resistance"]},2:{super:"Chaos Reach",classAbility:"Healing Rift",jump:"Burst Glide",melee:"Chain Lightning",grenade:"Pulse Grenade",aspects:["Electrostatic Mind","Arc Soul"],fragments:["Spark of Shock","Spark of Beacons","Spark of Discharge"]}},void:{0:{super:"Twilight Arsenal",classAbility:"Towering Barricade",jump:"Strafe Lift",melee:"Shield Throw",grenade:"Vortex Grenade",aspects:["Bastion","Controlled Demolition"],fragments:["Echo of Undermining","Echo of Starvation","Echo of Persistence"]},1:{super:"Shadowshot: Deadfall",classAbility:"Gambler's Dodge",jump:"Triple Jump",melee:"Snare Bomb",grenade:"Vortex Grenade",aspects:["Vanishing Step","Stylish Executioner"],fragments:["Echo of Undermining","Echo of Starvation","Echo of Persistence"]},2:{super:"Nova Bomb: Cataclysm",classAbility:"Healing Rift",jump:"Burst Glide",melee:"Pocket Singularity",grenade:"Vortex Grenade",aspects:["Feed the Void","Child of the Old Gods"],fragments:["Echo of Undermining","Echo of Starvation","Echo of Remnants"]}},stasis:{0:{super:"Glacial Quake",classAbility:"Towering Barricade",jump:"High Lift",melee:"Shiver Strike",grenade:"Glacier Grenade",aspects:["Tectonic Harvest","Diamond Lance"],fragments:["Whisper of Shards","Whisper of Rime","Whisper of Chains"]},1:{super:"Silence and Squall",classAbility:"Marksman's Dodge",jump:"Triple Jump",melee:"Withering Blade",grenade:"Duskfield Grenade",aspects:["Touch of Winter","Grim Harvest"],fragments:["Whisper of Shards","Whisper of Durance","Whisper of Chains"]},2:{super:"Winter's Wrath",classAbility:"Healing Rift",jump:"Burst Glide",melee:"Penumbral Blast",grenade:"Coldsnap Grenade",aspects:["Iceflare Bolts","Bleak Watcher"],fragments:["Whisper of Torment","Whisper of Refraction","Whisper of Chains"]}},strand:{0:{super:"Bladefury",classAbility:"Towering Barricade",jump:"Strafe Lift",melee:"Frenzied Blade",grenade:"Shackle Grenade",aspects:["Banner of War","Into the Fray"],fragments:["Thread of Warding","Thread of Generation","Thread of Fury"]},1:{super:"Silkstrike",classAbility:"Gambler's Dodge",jump:"Triple Jump",melee:"Threaded Spike",grenade:"Grapple",aspects:["Widow's Silk","Whirling Maelstrom"],fragments:["Thread of Warding","Thread of Generation","Thread of Ascent"]},2:{super:"Needlestorm",classAbility:"Healing Rift",jump:"Burst Glide",melee:"Arcane Needle",grenade:"Threadling Grenade",aspects:["Weavewalk","The Wanderer"],fragments:["Thread of Warding","Thread of Evolution","Thread of Generation"]}},prismatic:{0:{super:"Twilight Arsenal",classAbility:"Thruster",jump:"Strafe Lift",melee:"Thunderclap",grenade:"Shackle Grenade",aspects:["Knockout","Consecration"],fragments:["Facet of Dawn","Facet of Hope","Facet of Protection"]},1:{super:"Silence and Squall",classAbility:"Gambler's Dodge",jump:"Triple Jump",melee:"Combination Blow",grenade:"Grapple",aspects:["Stylish Executioner","Winter's Shroud"],fragments:["Facet of Dawn","Facet of Hope","Facet of Protection"]},2:{super:"Song of Flame",classAbility:"Phoenix Dive",jump:"Burst Glide",melee:"Arcane Needle",grenade:"Vortex Grenade",aspects:["Feed the Void","Hellion"],fragments:["Facet of Dawn","Facet of Hope","Facet of Protection"]}}},Yn={necrotic:["thorn","osteo striga","necrochasm","touch of malice","euphony"],"rain of fire":["vex mythoclast","dragon's breath"],mothkeeper:["ex diris"],cenotaph:["divinity","ager's scepter","coldheart"],"dawn chorus":["skyburner's oath","polaris lance","dragon's breath","tommy's matchbook"],"speaker's sight":["red death reformed","lumina","no time to explain","edge of intent"],sunbracers:["sunshot","skyburner's oath","polaris lance","ticuu's divination","monte carlo"],osmiomancy:["ager's scepter","wicked implement","verglas curve","conditional finality","winterbite"],briarbinds:["graviton lance","le monarque","buried bloodline","collective obligation","choir of one"],gyrfalcon:["graviton lance","le monarque","wavesplitter","collective obligation","fighting lion","buried bloodline","rat king"],"starfire protocol":["witherhoard","anarchy","dragon's breath"],"lucky pants":["malfeasance","crimson","the last word","sunshot","ace of spades","hawkmoon","wardens law"],oathkeeper:["wish-ender","le monarque","ticuu's divination","trinity ghoul","leviathan's breath","wish-keeper"],mechaneer:["forerunner","rat king","traveler's chosen","devil's ruin","buried bloodline"],caliban:["sunshot","skyburner's oath","polaris lance","dragon's breath"],omnioculus:["le monarque","wish-ender","rat king"],"mask of bakris":["fourth horseman","cloudstrike","anarchy","thunderlord","legend of acrius"],"triton vice":["winterbite","vexcalibur","edge of concurrence","black talon"],cyrtarachne:["quicksilver storm","final warning","the navigator","wish-keeper"],"star-eater":["izaganis burden","the fourth horseman","still hunt","bad juju"],"celestial nighthawk":["still hunt"],"actium war rig":["sweet business","xenophage","heir apparent","thunderlord","grand overture","khvostov 7g-0x","microcosm"],stronghold:["the lament","black talon","heartshadow","crown-splitter","throne-cleaver"],"abeyant leap":["wish-keeper","quicksilver storm","final warning"],pyrogale:["dragon's breath","sunshot","tommy's matchbook"],"cadmus ridge":["wicked implement","ager's scepter","verglas curve","winterbite"],"hazard pulse":["grand overture","the colony","deathbringer","two-tailed fox","truth"],peacekeepers:["tarrabah","riskrunner","huckleberry","osteo striga"],"no backup plans":["conditional finality","lord of wolves","duality","fourth horseman"],"doom fang pauldrons":["monte carlo"],"chromatic fire":["outbreak perfected","bad juju","necrochasm","ace of spades"],"getaway artist":["centrifuse","riskrunner","trinity ghoul","coldheart"],"graviton forfeit":["le monarque","graviton lance","heartshadow"],swarmers:["euphony","quicksilver storm","final warning"],mataiodoxia:["wish-keeper","the navigator","euphony"],"point-contact cannon brace":["monte carlo"],sturm:["drang"],"mida multi-tool":["mida mini-tool"],necrochasm:["necrotic"],thorn:["necrotic"],"osteo striga":["necrotic"],"vex mythoclast":["rain of fire"],"ex diris":["mothkeeper"],divinity:["cenotaph"],"graviton lance":["gyrfalcon","briarbinds"],"le monarque":["gyrfalcon","omnioculus"],"wish-keeper":["abeyant leap"],"dragon's breath":["pyrogale","starfire protocol"],"skyburner's oath":["dawn chorus","caliban"],"still hunt":["celestial nighthawk"]},zn={"starfire protocol":["solar"],sunbracers:["solar"],"dawn chorus":["solar","prismatic"],"phoenix protocol":["solar"],"wings of sacred dawn":["solar","prismatic"],"promethium spur":["solar"],"pyrogale gauntlets":["solar","prismatic"],"loreley splendor helm":["solar"],"ashen wake":["solar"],"phoenix cradle":["solar"],"hallowfire heart":["solar"],"celestial nighthawk":["solar","prismatic"],"caliban's hand":["solar","prismatic"],"young ahamkara's spine":["solar"],"athrys's embrace":["solar"],"ophidia spathe":["solar","prismatic"],"skull of dire ahamkara":["void","prismatic"],briarbinds:["void"],"contraverse hold":["void","prismatic"],"nothing manacles":["void"],"secant filaments":["void"],"graviton forfeit":["void","prismatic"],"gwisin vest":["void"],omnioculus:["void"],"orpheus rig":["void","prismatic"],"gyrfalcon's hauberk":["void","prismatic"],"helm of saint-14":["void"],"doom fang pauldrons":["void"],"ursa furiosa":["void"],"second chance":["void","prismatic"],"crown of tempests":["arc","prismatic"],"fallen sunstar":["arc","prismatic"],"getaway artist":["arc","prismatic"],"stormdancer's brace":["arc"],"vesper of radius":["arc","prismatic"],"geomag stabilizers":["arc"],"raiden flux":["arc"],"liar's handshake":["arc","prismatic"],"shinobu's vow":["arc"],"blight ranger":["arc"],"raiju's harness":["arc"],"cuirass of the falling star":["arc"],"point-contact cannon brace":["arc","prismatic"],"insurmountable skullfort":["arc","prismatic"],"osmiomancy gloves":["stasis","prismatic"],"ballidorse wrathweavers":["stasis","prismatic"],"mask of bakris":["stasis","prismatic"],"renewal grasps":["stasis","prismatic"],"hoarfrost-z":["stasis"],"icefall mantle":["stasis"],"cadmus ridge lancecap":["stasis","prismatic"],swarmers:["strand","prismatic"],mataiodoxia:["strand","prismatic"],"cyrtarachne's faÃ§ade":["strand","prismatic"],"abeyant leap":["strand","prismatic"],solipsism:["prismatic"],essentialism:["prismatic"],stoicism:["prismatic"]},Js={solar:"solar",scorch:"solar",ignite:"solar",radiant:"solar",restoration:"solar",sunspot:"solar",cure:"solar",benevolence:"solar",ember:"solar",incandescent:"solar",daybreak:"solar","well of radiance":"solar","golden gun":"solar","blade barrage":"solar","hammer of sol":"solar","burning maul":"solar",void:"void",suppress:"void",weaken:"void",volatile:"void",invisibility:"void",devour:"void",overshield:"void",invis:"void",echo:"void",repulsor:"void",destabilizing:"void","nova bomb":"void",shadowshot:"void","sentinel shield":"void","ward of dawn":"void","twilight arsenal":"void","spectral blades":"void",arc:"arc",jolt:"arc",blind:"arc",amplified:"arc","ionic trace":"arc",spark:"arc",voltshot:"arc",stormtrance:"arc","chaos reach":"arc",thundercrash:"arc","fists of havoc":"arc","gathering storm":"arc","arc staff":"arc","storm's edge":"arc",stasis:"stasis",slow:"stasis",freeze:"stasis",shatter:"stasis",crystal:"stasis",whisper:"stasis","chill clip":"stasis",headstone:"stasis","winter's wrath":"stasis","glacial quake":"stasis","silence and squall":"stasis",strand:"strand",suspend:"strand",unravel:"strand",sever:"strand",tangle:"strand","woven mail":"strand",threadling:"strand",thread:"strand",hatchling:"strand",needlestorm:"strand",bladefury:"strand",silkstrike:"strand",prismatic:"prismatic",transcendence:"prismatic",facet:"prismatic","spirit of":"prismatic",solipsism:"prismatic",stoicism:"prismatic",essentialism:"prismatic",relativism:"prismatic","will of the flame":"solar",jetpack:"arc","arid overgrowth":"strand","twin fangs":"strand",maÃ«lstrom:"strand","hive memory":"strand","scorched earth":"solar","perfect fifth":"solar","arcane needle":"strand","feed the void":"void",hellion:"solar","sentient soul":"arc","arc soul":"arc","sentient arc soul":"arc","ability spam":"prismatic",cooldown:"prismatic","super energy":"prismatic",finisher:"prismatic",debuff:"prismatic",movement:"prismatic",handling:"prismatic",reload:"prismatic",health:"prismatic",healing:"prismatic","damage resistance":"prismatic",unstop:"prismatic",barrier:"prismatic",overload:"prismatic",reflect:"prismatic",guard:"prismatic",sword:"prismatic",kinetic:"prismatic",precision:"prismatic",explosion:"prismatic",universal:"prismatic"},Jn={"apotheosis veil":null,"cenotaph mask":null,"eye of another world":null,"felwinter's helm":null,"the stag":null,"aeon soul":null,"karnstein armlets":null,"necrotic grip":null,"ophidian aspect":null,"winter's guile":null,"chromatic fire":null,"mantle of battle harmony":null,"sanguine alchemy":null,"boots of the assembler":null,"lunafaction boots":null,"transversive steps":null,"verity's brow":null,"dawn chorus":["solar"],"speaker's sight":["solar","prismatic"],sunbracers:["solar"],"phoenix protocol":["solar"],"starfire protocol":["solar"],"wings of sacred dawn":["solar"],"promethium spur":["solar"],"nezarec's sin":["void","prismatic"],"skull of dire ahamkara":["void"],briarbinds:["void","prismatic"],"contraverse hold":["void"],"nothing manacles":["void"],"secant filaments":["void"],"crown of tempests":["arc"],"fallen sunstar":["arc"],"getaway artist":["arc","prismatic"],"stormdancer's brace":["arc"],"vesper of radius":["arc","prismatic"],"geomag stabilizers":["arc"],"ballidorse wrathweavers":["stasis"],"osmiomancy gloves":["stasis","prismatic"],mataiodoxÃ­a:["strand","prismatic"],swarmers:["strand","prismatic"],solipsism:["prismatic"],foetracer:null,"knucklehead radar":null,"wormhusk crown":null,"aeon swift":null,"mechaneer's tricksleeves":null,oathkeeper:null,"sealed ahamkara grasps":null,"the dragon's shadow":null,"the sixth coyote":null,"fr0st-ee5":null,"lucky pants":null,"st0mp-ee5":null,"the bombardiers":null,"star-eater scales":null,"celestial nighthawk":["solar"],"athrys's embrace":["solar","prismatic"],"caliban's hand":["solar"],"shards of galanor":["solar"],"young ahamkara's spine":["solar"],"ophidia spathe":["solar"],"graviton forfeit":["void","prismatic"],"khepri's sting":["void"],"gyrfalcon's hauberk":["void","prismatic"],omnioculus:["void"],"gwisin vest":["void"],"orpheus rig":["void"],"blight ranger":["arc"],"liar's handshake":["arc"],"shinobu's vow":["arc"],"raiden flux":["arc"],"raiju's harness":["arc"],"mask of bakris":["stasis"],"renewal grasps":["stasis","prismatic"],"cyrtarachne's faÃ§ade":["strand","prismatic"],essentialism:["prismatic"],relativism:["prismatic"],"one-eyed mask":null,"precious scars":null,synthoceps:null,"heart of inmost light":null,"actium war rig":null,dunemarchers:null,"hazardous propulsion":null,stronghold:null,"aeon safe":null,"loreley splendor":["solar"],"pyrogale gauntlets":["solar"],"ashen wake":["solar"],"phoenix cradle":["solar"],"hallowfire heart":["solar"],"helm of saint-14":["void"],"doom fang pauldrons":["void"],"ursa furiosa":["void"],"second chance":["void","prismatic"],"an insurmountable skullfort":["arc"],"cuirass of the falling star":["arc"],"point-contact cannon brace":["arc","prismatic"],"praxic vestment":["arc"],"cadmus ridge lancecap":["stasis"],"hoarfrost-z":["stasis"],"icefall mantle":["stasis"],"abeyant leap":["strand","prismatic"],"wishful ignorance":["strand","prismatic"],stoicism:["prismatic"]};function Xn(o){if(!o?.displayProperties)return null;const e=o.displayProperties.name.toLowerCase();for(const[r,i]of Object.entries(Jn))if(e.includes(r)||r.includes(e))return i;const t=(o.displayProperties.description+" "+o.displayProperties.name).toLowerCase(),a=new Set;for(const[r,i]of Object.entries(Js))t.includes(r)&&a.add(i);return a.size===0?null:a.size===1?Array.from(a)[0]:Array.from(a)}function ir(o){return o.charAt(0).toUpperCase()+o.slice(1)}function $s(o,e){const t=[...o],r=e!==void 0?(i=>{let c=typeof i=="string"?i.split("").reduce((n,l)=>(n<<5)-n+l.charCodeAt(0),0):i;return c=Math.abs(c)||1,()=>(c=c*16807%2147483647,(c-1)/2147483646)})(e):Math.random;for(let i=t.length-1;i>0;i--){const c=Math.floor(r()*(i+1));[t[i],t[c]]=[t[c],t[i]]}return t}async function Zn(o){return gr.filter(e=>e.guardianClass===o).map(e=>({score:100,classType:e.guardianClass,armor:e.exoticArmor.name,weapon:e.exoticWeapon?.name||"",buildName:e.name,description:e.loopDescription,subclassType:e.element,super:e.subclassNode.superName,classAbility:e.subclassNode.classAbilityName,jump:e.subclassNode.jumpName,melee:e.subclassNode.meleeName,grenade:e.subclassNode.grenadeName,aspects:e.subclassNode.aspectNames,fragments:e.subclassNode.fragmentNames,fragmentSlots:e.subclassNode.fragmentHashes?.length||0,element:e.element.toLowerCase(),definition:e}))}async function Aa(o,e,t,a={}){const{maxResults:r=100,minScore:i=0,seed:c=0}=a,n=await Zn(t);if(!n.length)return[];const l=`${e}-${c}`;let d;switch(o){case"subclass":const R=e.toLowerCase().split(",").map(H=>H.trim());R.some(H=>H==="all"||H===""||H==="kinetic")?d=n:d=n.filter(H=>R.includes(H.element)||R.some(C=>H.subclassType.toLowerCase().includes(C)));break;case"armor":const _=e.toLowerCase();d=n.filter(H=>H.armor.toLowerCase().includes(_)||_.includes(H.armor.toLowerCase()));break;case"weapon":const T=e.toLowerCase();d=n.filter(H=>H.weapon.toLowerCase().includes(T)||T.includes(H.weapon.toLowerCase()));break;default:d=[]}d=d.filter(R=>R.score>=i),d.sort((R,A)=>A.score-R.score);let h=[];const m=new Map;d.forEach(R=>{m.has(R.score)||m.set(R.score,[]),m.get(R.score).push(R)});const f=Array.from(m.keys()).sort((R,A)=>A-R);for(const R of f){const A=m.get(R),_=$s(A,`${l}-${R}`);h=[...h,..._]}d=h.slice(0,r*2);const E=[],p=new Set;for(const R of d){if(E.length>=r)break;if(!R.armor||!R.weapon)continue;const[A,_]=await Promise.all([Vs.findItemByName(R.armor),Vs.findItemByName(R.weapon)]);!A||!_||(p.add(A.item.itemInstanceId||R.armor),E.push({synergy:R,sourceType:o,armorResult:A,weaponResult:_,element:R.element}))}if(E.length<r){re("SynergyMatcher",`Strict search: ${E.length}/${r}, generating fallbacks...`);const R=e.toLowerCase().split(",").map(H=>H.trim()),A=R.some(H=>H==="all"||H===""||H==="kinetic");let _=await Vs.findAllExoticsForClass(t,"armor");A&&(_=$s(_,l));const T=await Vs.findAllExoticsForClass(3,"weapon");for(const H of _){if(E.length>=r)break;const C=H.definition.displayProperties.name.toLowerCase(),D=H.item.itemInstanceId||H.item.itemHash.toString();if(o==="armor"&&!H.definition.displayProperties.name.toLowerCase().includes(e.toLowerCase()))continue;let F=Xn(H.definition),ne=[];const K=zn[C];K?ne=K:Array.isArray(F)?ne=F:F?ne=[F]:(ne=["prismatic","solar","void","arc","stasis","strand"],A&&(ne=$s(ne,`${l}-${D}`)));for(const v of ne){if(E.length>=r)break;if(o==="subclass"&&!A&&!R.includes(v))continue;let W=[];for(const[$,ee]of Object.entries(Yn))if(C.includes($)){const z=T.filter(Ae=>ee.some(ae=>Ae.definition.displayProperties.name.toLowerCase().includes(ae)));if(z.length>0){W=z;break}}if(W.length===0){const $=H.definition.displayProperties.description.toLowerCase(),ee=T.filter(z=>{const Ae=z.definition.displayProperties.description.toLowerCase();return Object.keys(Js).some(ae=>Js[ae]!=="universal"&&$.includes(ae)&&Ae.includes(ae))});ee.length>0&&(W=ee)}if(o==="weapon"){const $=e.toLowerCase(),z=T.find(ae=>ae.definition.displayProperties.name.toLowerCase().includes($))?.definition.displayProperties.description.toLowerCase()||"",Ae=W.find(ae=>ae.definition.displayProperties.name.toLowerCase().includes($));if(Ae)W=[Ae];else{const ae=v,Ne={arc:2,solar:3,void:4,stasis:6,strand:7},Ie=T.filter(Fe=>Fe.definition.displayProperties.name.toLowerCase().includes($)).find(Fe=>{const it=Number(Fe.definition.inventory?.bucketTypeHash)===Number(q.KINETIC_WEAPONS),Kt=Number(Fe.definition.defaultDamageTypeHash)===1;if(it&&Kt)return!0;const ke=Ne[ae]||0,Ot=Number(Fe.definition.defaultDamageTypeHash);if(Ot===ke||Ot===1)return!0;const Ct=H.definition.displayProperties.description.toLowerCase();return Object.keys(Js).some(bt=>Ct.includes(bt)&&z.includes(bt))||z.includes(ae)});if(Ie)W=[Ie];else continue}}if(W.length===0){const ee={arc:2,solar:3,void:4,stasis:6,strand:7}[v];ee&&(W=T.filter(z=>Number(z.definition.defaultDamageTypeHash)===ee)),W.length===0&&(W=T.filter(z=>{const Ae=Number(z.definition.defaultDamageTypeHash),ae=Number(z.definition.defaultDamageType);return Ae===1||ae===1}),W=W.filter(z=>!z.definition.displayProperties.name.toLowerCase().includes("praxic blade")))}W.length===0&&(W=T);let g=[W[0]];if(o==="weapon")g=[W[0]];else if(W.length>1){const $=new Map;W.forEach(ae=>{const Ne=ae.item.itemHash;if(!$.has(Ne))$.set(Ne,ae);else{const Me=$.get(Ne);ae.location==="equipped"&&Me.location!=="equipped"&&$.set(Ne,ae)}});const ee=Array.from($.values()),z=$s(ee,`${l}-${v}`),Ae=Math.min(3,r-E.length);g=z.slice(0,Ae)}for(const $ of g){const ee=`${D}-${$.item.itemInstanceId||$.item.itemHash}-${v}`;if(p.has(ee))continue;p.add(ee);const z=nr[v]?.[t]||nr.prismatic[t],Ae=v==="prismatic",ae={score:60,classType:t,armor:H.definition.displayProperties.name,weapon:$.definition.displayProperties.name,buildName:`${H.definition.displayProperties.name} ${Ae?"Prism":ir(v)}`,description:H.definition.displayProperties.description||`Synergy for ${H.definition.displayProperties.name}.`,subclassType:Ae?"Prismatic":ir(v),element:v,super:z?.super||"Roaming Super",classAbility:z?.classAbility||"Class Ability",jump:z?.jump||"Triple Jump",melee:z?.melee||"Charged Melee",grenade:z?.grenade||"Grenade",aspects:z?.aspects||[],fragments:z?.fragments||[],fragmentSlots:3,transcendentAbility:Ae?"Transcendence":void 0};if(Ae&&(ae.element="prismatic"),E.push({synergy:ae,sourceType:o,armorResult:H,weaponResult:$,element:v}),E.length>=r)break}}}}return E.sort((R,A)=>{const _=String(R.element).toLowerCase()==="prismatic",T=String(A.element).toLowerCase()==="prismatic";return _&&!T?-1:!_&&T?1:0}),E}const fs=[q.KINETIC_WEAPONS,q.ENERGY_WEAPONS,q.POWER_WEAPONS],hs=[q.HELMET,q.GAUNTLETS,q.CHEST_ARMOR,q.LEG_ARMOR,q.CLASS_ARMOR],Ta={1:"kinetic",2:"arc",3:"solar",4:"void",6:"stasis",7:"strand"},or={[G.Kinetic]:"#ffffff",[G.Arc]:"#7df9ff",[G.Solar]:"#ff9000",[G.Void]:"#bf84ff",[G.Stasis]:"#4d88ff",[G.Strand]:"#4aff9b",[G.Prismatic]:"#ff8df6"};function Ra(o,e,t,a,r){const i=o.itemHash||o.hash;if(i===void 0)return!0;const c=P.getItem(i);if(!c||t&&t!=="all"&&r(i).toLowerCase()!==t.toLowerCase())return!1;if(a&&a!=="all"){const R={titan:0,hunter:1,warlock:2}[a.toLowerCase()];if(R!==void 0&&c.classType!==3&&c.classType!==R)return!1}if(!e||!e.trim())return!0;const l=e.toLowerCase().trim().split(/\s+/),d=c.displayProperties?.name?.toLowerCase()||"",h=c.itemTypeDisplayName?.toLowerCase()||"",m=c.displayProperties?.description?.toLowerCase()||"",f=c.inventory?.tierType,E=r(i).toLowerCase();return l.every(p=>{let R=!1,A=p;return p.startsWith("is:")&&(R=!0,A=p.substring(3)),A==="weapon"&&c.itemType===3||A==="armor"&&c.itemType===2||A==="exotic"&&f===6||A==="legendary"&&f===5||A==="rare"&&f===4||A==="uncommon"&&f===3||A==="common"&&f===2||A==="kinetic"&&c.defaultDamageType===1||A==="arc"&&(c.defaultDamageType===2||E==="arc")||A==="solar"&&(c.defaultDamageType===3||E==="solar")||A==="void"&&(c.defaultDamageType===4||E==="void")||A==="stasis"&&(c.defaultDamageType===6||E==="stasis")||A==="strand"&&(c.defaultDamageType===7||E==="strand")||A==="prismatic"&&E==="prismatic"||A==="titan"&&c.classType===0||A==="hunter"&&c.classType===1||A==="warlock"&&c.classType===2?!0:R?!1:d.includes(A)||h.includes(A)||m.includes(A)})}function mi({searchQuery:o="",elementFilter:e="all",classFilter:t="all",isVaultSearchVisible:a=!1,onSynergyElementChange:r,onSynergyOverlayChange:i,viewMode:c="all",synergyFilter:n,onResetView:l,forceCloseTrigger:d,resetViewRef:h}={}){const m=I.useRef(o),f=I.useRef(c),E=I.useRef(e),p=I.useRef(t);I.useEffect(()=>{m.current=o,E.current=e,p.current=t,f.current=c},[o,e,t,c]);const R=I.useRef(null),A=I.useRef(null),_=I.useRef(null),T=I.useRef({x:0,y:0,z:-200}),H=I.useRef(!1),C=I.useRef({x:-1,y:-1}),D=I.useRef({x:-1,y:-1}),F=I.useRef(!0),ne=I.useRef(!0),K=I.useRef(!1),[v,W]=I.useState(!1),[g,$]=I.useState(null),[ee,z]=I.useState(0),[Ae,ae]=I.useState(0),[Ne,Me]=I.useState([]),[Ie,Fe]=I.useState(null),[it,Kt]=I.useState(null),[ke,Ot]=I.useState(!1),[Mt,Ct]=I.useState(!1),[cs,bt]=I.useState(null),[Et,ps]=I.useState(null),[es,Cs]=I.useState(!1),[kt,x]=I.useState(new Set),he=I.useMemo(()=>{const u=new Set;return it&&u.add(it),Ne.forEach(b=>{b.armorResult?.item.itemInstanceId&&u.add(b.armorResult.item.itemInstanceId),b.weaponResult?.item.itemInstanceId&&u.add(b.weaponResult.item.itemInstanceId),b.element&&u.add(`${b.element.toLowerCase()}-subclass`)}),u},[it,Ne]),Se=I.useCallback(u=>u.id&&he.has(u.id)||u.instanceId&&he.has(u.instanceId),[he]),fe=I.useRef(v),ce=I.useRef(null),Ze=I.useRef({width:0,height:0}),ot=I.useRef(null),ie=I.useRef(null),Oe=I.useRef(new Set),At=I.useRef(()=>{}),tt=I.useRef(()=>{}),Pe=I.useRef(!1),oe=I.useRef(!0),Be=I.useRef(!1),ze=I.useRef(!1),[Ue,Tt]=I.useState(!1),St=I.useRef(0),_t=I.useRef(0),{immersiveMode:wt}=Ns(),Je=I.useRef({x:0,y:0}),we=I.useRef(Math.random()*Math.PI*2),Le=I.useRef(null),mt=I.useRef(null),{hideGlobalUI:ct,setHideGlobalUI:Ce}=Ss(),ut=I.useRef(ke),yr=I.useRef(Ne),_a=I.useRef(it),La=I.useRef(a),Ha=I.useRef(ct),ts=I.useRef(Et),Ma=I.useRef(es),Rt=I.useRef({id:null,x:-1,y:-1});I.useEffect(()=>{fe.current=v,ut.current=ke,yr.current=Ne,_a.current=it,La.current=a,Ha.current=ct,ts.current=Et,Ma.current=es},[v,ke,Ne,it,a,ct,Et,es]);const ba=I.useRef(null),ea=I.useCallback(u=>{ba.current!==u&&(ba.current=u,r&&r(u))},[r]),We=I.useRef({x:0,y:0,z:-200}),jt=I.useRef({x:0,y:0}),qt=I.useRef({x:0,y:0}),Gt=I.useRef({x:0,y:0}),_s=I.useRef({offX:0,offY:0,offZ:0,tiltX:0,tiltY:0,centerX:0,centerY:0,focalLength:1e3}),Lt=I.useRef(null),xt=I.useCallback((u,b,k,M=800)=>isNaN(u)||isNaN(b)||isNaN(k)?(je("SynergyGalaxy","âš ï¸ NaN target in transition:",{targetX:u,targetY:b,targetZ:k}),!1):((isNaN(T.current.x)||isNaN(T.current.y)||isNaN(T.current.z))&&(je("SynergyGalaxy","âš ï¸ NaN offset detected, resetting"),T.current={x:0,y:0,z:-200}),Lt.current={active:!0,startTime:performance.now(),duration:M,start:{...T.current},target:{x:u,y:b,z:k}},We.current={x:u,y:b,z:k},!0),[]),st=I.useCallback((u,b,k)=>{const M=_s.current;if(isNaN(M.offX)||isNaN(M.offY)||isNaN(M.offZ))return je("SynergyGalaxy","âš ï¸ NaN in projection, using safe defaults"),{stageX:0,stageY:0,screenX:M.centerX||0,screenY:M.centerY||0,scale:1,finalZ:0};const V=-M.tiltX*Math.PI/180,me=M.tiltY*Math.PI/180,B=Math.cos(V),L=Math.sin(V),O=Math.cos(me),N=Math.sin(me),y=u*O+k*N,w=-u*N+k*O,U=b*B-w*L,J=b*L+w*B,te=y+M.offX,le=U+M.offY,ue=J+M.offZ,Te=Math.max(.01,Math.min(20,M.focalLength/Math.max(1,M.focalLength-ue))),ye=te*Te,De=le*Te,pe=ue<M.focalLength-5,Re=pe?Te:0;return{stageX:ye,stageY:De,screenX:M.centerX+ye,screenY:M.centerY+De,scale:Re,finalZ:ue,isVisible:pe}},[]),It=j(u=>u.characterEquipment),Pt=j(u=>u.characterInventories),ss=j(u=>u.vaultInventory),rt=j(u=>u.itemInstances),Vt=j(u=>u.selectedCharacterId),Ls=j(u=>u.responseMintedTimestamp),Nr=j(u=>u.isLoading),{maxSynergies:Es,organizedGalaxy:as,randomVaultSeed:gt,performanceMode:yt,showFps:Or}=Ns(),{isLoaded:$t}=Oa(),{showTooltip:Dt,hideTooltip:Ke,openTransferMenu:Pa}=_n(),ta=I.useMemo(()=>{if(!Ls)return!1;try{const u=new Date(Ls);return new Date().getTime()-u.getTime()>12e4}catch{return!1}},[Ls]),sa=I.useRef(!1),Hs=I.useRef([]),ls=I.useRef(new Map),us=550,Cr=220,Qe=I.useCallback(u=>{if(!$t)return G.Kinetic;const b=P.getItem(u);if(!b)return G.Kinetic;if(b.talentGrid?.hudDamageType===2)return G.Arc;if(b.talentGrid?.hudDamageType===3)return G.Solar;if(b.talentGrid?.hudDamageType===4)return G.Void;if(b.talentGrid?.hudDamageType===6)return G.Stasis;if(b.talentGrid?.hudDamageType===7)return G.Strand;const k=b.defaultDamageType;return k===2?G.Arc:k===3?G.Solar:k===4?G.Void:k===6?G.Stasis:k===7?G.Strand:(b.displayProperties?.name?.toLowerCase()||"").includes("prismatic")?G.Prismatic:G.Kinetic},[$t]),Nt=u=>{let b=typeof u=="string"?u.split("").reduce((M,V)=>(M=(M<<5)-M+V.charCodeAt(0),M&M),0):u;const k=Math.sin(b++)*1e4;return k-Math.floor(k)},{nodes:qe,vaultPoints:Ms}=I.useMemo(()=>{const u=[],b=Vt||"",k=It[b]||[],M=Pt[b]||[],V=k.find(y=>y.bucketHash===q.SUBCLASS),me=M.filter(y=>y.bucketHash===q.SUBCLASS);[V,...me].filter(Boolean).forEach((y,w)=>{const U=y.itemHash===V?.itemHash,J=U?0:w*-600-200,te=U?0:Math.sin(w*1.5)*450,le=U?0:Math.cos(w*1.5)*350;u.push({id:`subclass-${y.itemHash}-${w}`,type:"subclass",hash:y.itemHash,instanceId:y.itemInstanceId,bucketHash:q.SUBCLASS,element:Qe(y.itemHash),x:te,y:le,z:J,isEquipped:U,isEmpty:!1,originalItem:y,lodLevel:0})}),[...k,...M].forEach(y=>{if(y.bucketHash===q.SUBCLASS)return;const w=fs.includes(y.bucketHash),U=hs.includes(y.bucketHash);if(!w&&!U)return;const J=k.some(Re=>Re.itemInstanceId===y.itemInstanceId),te=y.itemInstanceId?rt[y.itemInstanceId]:void 0,le=P.getItem(y.itemHash),ue=te?.damageType||le?.defaultDamageType,Te=ue?Ta[ue]:void 0;let ye,De,pe;if(J){const Re=(w?fs:hs).indexOf(y.bucketHash);ye=w?-us:us,De=(Re-(w?1:2))*Cr,pe=0}else{const Re=y.itemInstanceId||y.itemHash.toString();if(as){const nt=(w?fs:hs).indexOf(y.bucketHash),Xe=w?-us-200:us+200,Ge=-500-nt*1200,ht=Ge-1200,et=Nt(Re+"z"),dt=Nt(Re+"x"),Jt=Nt(Re+"y");pe=Ge+et*(ht-Ge),ye=Xe+(dt-.5)*400,De=(Jt-.5)*800}else{const nt=Nt(Re+"rx"+gt),Xe=Nt(Re+"ry"+gt),Ge=Nt(Re+"rz"+gt);ye=(w?-us:us)+(nt-.5)*800,De=(Xe-.5)*800,pe=-200-Ge*4e3}}u.push({id:`gear-${y.itemInstanceId||y.itemHash}-${y.bucketHash}-${J?"eq":"inv"}`,type:w?"weapon":"armor",hash:y.itemHash,instanceId:y.itemInstanceId,bucketHash:y.bucketHash,element:Qe(y.itemHash),x:ye,y:De,z:pe,isEquipped:J,isEmpty:!1,tierClass:Ks(y),power:te?.power,damageIconUrl:w&&Te?$e(P.getDamageTypeIcon(Te)||""):void 0,watermarkUrl:le?$e(le.iconWatermarkFeatured||le.iconWatermark):void 0,isLegacyWatermark:le?!le.iconWatermarkFeatured&&!!le.iconWatermark||zs(le.quality?.currentVersion):!1,isMasterwork:!!(y.state&&y.state&4),isCrafted:!!(y.state&&y.state&8),isEnhanced:!!te?.sockets?.some(Re=>Re.plugHash===3727270518)||!!(y.state&&y.state&8&&te?.gearTier&&te.gearTier>=2),tier:te?.gearTier,originalItem:y,lodLevel:J?0:1,iconUrl:$e(P.getItem(y.overrideStyleItemHash||y.itemHash)?.displayProperties?.icon||"")})});const O=ss.filter(y=>{const U=P.getItem(y.itemHash)?.inventory?.bucketTypeHash||0;return fs.includes(U)||hs.includes(U)}),N=[];return O.forEach(y=>{const U=P.getItem(y.itemHash)?.inventory?.bucketTypeHash||0,J=fs.includes(U),te=hs.includes(U);if(!J&&!te)return;let le,ue,Te;const ye=y.itemInstanceId||y.itemHash.toString();if(as){let Xe=0,Ge=0,ht={min:0,max:0};J?(Ge=-2250,Xe=fs.indexOf(U),ht={min:-1500-Xe*3500,max:-1500-Xe*3500-3500}):(Ge=2250,Xe=hs.indexOf(U),ht={min:-1500-Xe*2300,max:-1500-Xe*2300-2300});const et=Nt(ye+"z"),dt=Nt(ye+"x"),Jt=Nt(ye+"y");Te=ht.min+et*(ht.max-ht.min),le=Ge+(dt-.5)*1200,ue=(Jt-.5)*2500}else{const Xe=Nt(ye+"rx"+gt),Ge=Nt(ye+"ry"+gt),ht=Nt(ye+"rz"+gt);le=(Xe-.5)*15e3,ue=(Ge-.5)*1e4,Te=-1e3-ht*25e3}const De=Qe(y.itemHash),pe=Ks(y),Re=pe==="exotic";let nt;as?Re?nt="#FFD700":pe==="legendary"?nt="#a850f2":nt=or[De]||"#fff":nt=or[De]||"#fff",N.push({x:le,y:ue,z:Te,color:nt,isMasterwork:!!(y.state&&y.state&4),isCrafted:!!(y.state&&y.state&8),isExotic:Re,originalItem:y,instanceId:y.itemInstanceId})}),{nodes:u,vaultPoints:N}},[Vt,It,Pt,ss,rt,Qe,as,gt,$t]),aa=I.useMemo(()=>{const u=new Set;return qe.forEach(b=>{Ra(b,o,e,t,Qe)&&u.add(b.id)}),u},[qe,o,e,t,Qe]),ra=I.useMemo(()=>Ms.filter(u=>Ra(u.originalItem,o,e,t,Qe)),[Ms,o,e,t,Qe]);I.useEffect(()=>{if(re("SynergyGalaxy","Filter effect check:",{synergyFilter:n,triggered:sa.current,manifestLoaded:$t,nodesCount:qe.length}),!n||sa.current||!$t||qe.length===0)return;const{weaponName:u,armorName:b,element:k}=n;if(!u&&!b)return;sa.current=!0;const{characters:M,selectedCharacterId:V}=j.getState(),B=M.find(N=>N.characterId===V)?.classType??0,L=qe.find(N=>N.type==="subclass"&&N.isEquipped),O=setTimeout(async()=>{try{const N=u?"weapon":"armor",y=u||b||"";re("SynergyGalaxy","Auto-trigger search:",{searchType:N,searchName:y,guardianClass:B});const w=await Aa(N,y,B,{maxResults:Es,seed:gt});if(re("SynergyGalaxy",`Found ${w.length} synergies`,{synergies:w,equippedSubclassNode:L,containerRect:ce.current}),w.length>0){if(Me(w),Ot(!0),Ct(!1),L&&(Kt(L.id),re("SynergyGalaxy",`Set source node: ${L.id}`),ce.current)){const{screenX:U,screenY:J,scale:te}=st(L.x,L.y,L.z);re("SynergyGalaxy","Set source position:",{screenX:U,screenY:J,scale:te}),Fe({x:U,y:J,scale:te})}r&&k&&r(k)}else re("SynergyGalaxy","No synergies found - items may not be in inventory")}catch(N){de("SynergyGalaxy","Failed to auto-trigger synergies:",N)}},800);return()=>clearTimeout(O)},[n,$t,qe,Es,gt,r,st]);const Da=I.useRef(aa),va=I.useRef(ra),Fa=I.useMemo(()=>{const u=It[Vt||""]||[],b=Pt[Vt||""]||[];return new Set([...u,...b].map(k=>k.itemHash))},[It,Pt,Vt]),bs=I.useRef([]),Ps=I.useCallback((u=0,b=0,k=0)=>{const M=_.current;if(!M||!ce.current)return;const V=M.getContext("2d");if(!V)return;const{width:me,height:B}=Ze.current;if(me===0||B===0)return;V.clearRect(0,0,me,B);const L=me/2,O=B/2,N=1e3,y=T.current.x+Gt.current.x,w=T.current.y+Gt.current.y,U=T.current.z;_s.current={offX:y,offY:w,offZ:U,tiltX:u,tiltY:b,centerX:L,centerY:O,focalLength:N};const J=[],te=-u*Math.PI/180,le=b*Math.PI/180,ue=Math.cos(te),Te=Math.sin(te),ye=Math.cos(le),De=Math.sin(le);va.current.forEach(pe=>{if(g&&pe.instanceId===g.instanceId||Fa.has(pe.originalItem.itemHash))return;const Re=Se(pe),nt=P.getItem(pe.originalItem.itemHash);if(!Re&&nt&&f.current!=="all"){if(f.current==="subclass-only")return;if(f.current==="inventory-only")return}const Xe=!0;let Ge=pe.x,ht=pe.y,et=pe.z;const dt=Ge*ye+et*De,Jt=-Ge*De+et*ye,Dr=ht*ue-Jt*Te,vr=ht*Te+Jt*ue,Fr=dt+y,kr=Dr+w,ma=vr+U,wr=yt==="low"?-5e3:yt==="medium"?-25e3:-6e4;if(!Re&&(ma>900||ma<wr))return;const Bs=N/(N-ma),Ts=L+Fr*Bs,Rs=O+kr*Bs;if(Ts<-100||Ts>me+100||Rs<-100||Rs>B+100)return;let Is=Math.max(.8,3.5*Bs),rs=Math.min(1,Math.max(.2,Bs*2.1));if(ut.current&&ts.current){const ds=pe.instanceId===ts.current.armorInstanceId,Gr=pe.instanceId===ts.current.weaponInstanceId;!ds&&!Gr&&(rs*=.08)}if(m.current&&Xe&&!Re){const ds=1+Math.sin(k/400)*.15;Is*=ds,rs=Math.min(1,rs*1.4)}if(pe.isMasterwork&&Xe){const ds=1+Math.sin(k/300)*.2;Is*=1.4*ds,rs=Math.min(1,rs*1.5*ds)}const Ba=pe.isMasterwork||as&&pe.isExotic;V.fillStyle=Ba?"#FFD700":pe.color,V.globalAlpha=rs*(Ba?.8:.55),V.beginPath(),V.arc(Ts,Rs,Is*3.5,0,Math.PI*2),V.fill(),V.fillStyle=as&&pe.isExotic?"#FFD700":pe.color,V.globalAlpha=Math.min(1,rs*1.5),V.beginPath(),V.arc(Ts,Rs,Is*2.8,0,Math.PI*2),V.fill(),J.push({px:Ts,py:Rs,size:Is*4,item:pe.originalItem,instanceId:pe.instanceId,x:pe.x,y:pe.y,z:pe.z,opacity:1})}),Hs.current=J},[g,Fa,Se,Qe,as,yt]);I.useEffect(()=>{Da.current=aa,va.current=ra,bs.current=Ms,Ps()},[aa,ra,Ms,Ps,Ae]);const ka=I.useCallback((u,b,k=0)=>{R.current&&(R.current.style.transform="none"),Ps(u,b,k)},[Ps]),ft=I.useCallback(()=>{re("SynergyGalaxy","Reset view triggered");const u=!v&&!g&&!ke&&!ie.current,b=Math.abs(T.current.x)<1&&Math.abs(T.current.y)<1&&Math.abs(T.current.z- -200)<1;u&&b||(W(!1),fe.current=!1,$(null),Ke(),ie.current=null,ps(null),ts.current=null,ke&&!Mt&&(Ct(!0),r&&r(null)),Ns.getState().rotateVaultSeed(),F.current=!0,ne.current=!0,qt.current={x:0,y:0},Gt.current={x:0,y:0},xt(0,0,-200,300),ke&&!Mt&&setTimeout(()=>{Me([]),Fe(null),Kt(null),Ot(!1),Ct(!1)},200))},[Ke,ke,Mt,r,v,g,xt]),_r=I.useCallback(()=>{Mt||requestAnimationFrame(()=>{Ut.flushSync(()=>{Ct(!0),r&&r(null)}),setTimeout(()=>{Ut.flushSync(()=>{Me([]),Fe(null),Kt(null),Ot(!1),Ct(!1)})},300)})},[Mt,r]),wa=I.useRef(0);I.useEffect(()=>{d!==void 0&&d>wa.current&&(wa.current=d,ft())},[d,ft]);const Ga=I.useCallback(u=>{if(re("SynergyGalaxy",`Wire lock triggered: ${u}`),!u){$(null),W(!1),fe.current=!1;return}let b=qe.find(B=>B.instanceId===u||B.id===u),k,M,V,me=null;if(re("SynergyGalaxy",`Found node: ${b?.id} (${qe.length} total)`),b)k=-b.x,M=-b.y,V=-b.z+400,me=b,re("SynergyGalaxy",`Zooming to: ${k}, ${M}, ${V}`);else{let B=Hs.current.find(L=>L.instanceId===u);if(B||(B=bs.current.find(L=>L.instanceId===u)),B){k=-B.x,M=-B.y,V=-B.z+400;const L=B.item||B.originalItem;if(!L){je("SynergyGalaxy","âš ï¸ Vault item missing data:",B);return}const O=B.instanceId?rt[B.instanceId]:void 0,N=P.getItem(L.itemHash),y=Qe(L.itemHash),w=N?.itemType===3,U=O?.damageType||N?.defaultDamageType,J=U?Ta[U]:void 0;me={x:B.x,y:B.y,z:B.z,id:`vault-${B.instanceId||L.itemHash}`,type:w?"weapon":"armor",hash:L.itemHash,instanceId:B.instanceId,bucketHash:N?.inventory?.bucketTypeHash||0,element:y,isEquipped:!1,isEmpty:!1,lodLevel:0,tierClass:Ks(L),power:O?.power,damageIconUrl:w&&J?$e(P.getDamageTypeIcon(J)||""):void 0,watermarkUrl:N?$e(N.iconWatermarkFeatured||N.iconWatermark):void 0,isLegacyWatermark:N?!N.iconWatermarkFeatured&&!!N.iconWatermark||zs(N.quality?.currentVersion):!1,isMasterwork:!!(L.state&&L.state&4),isCrafted:!!(L.state&&L.state&8),isEnhanced:!!(L.state&&L.state&8&&O?.gearTier&&O.gearTier>=2),tier:O?.gearTier,originalItem:L}}else return}qt.current={x:0,y:0},xt(k,M,V,600),me&&($(me),W(!0),fe.current=!0)},[qe,rt,Qe,xt]),Bt=I.useRef(null);I.useEffect(()=>{Bt.current=g},[g]);const vt=I.useCallback(async u=>{re("SynergyGalaxy",`Transfer item to: ${u}`);const b=Bt.current;if(!b?.instanceId||!b?.originalItem){de("SynergyGalaxy","Missing focusedNode or item data",{focusedNode:g,focusedNodeRef:Bt.current});return}const k=b.originalItem,M=b.instanceId,V=k.itemHash;re("SynergyGalaxy","Transfer request:",{itemInstanceId:M,itemHash:V,targetCharacterId:u,itemName:P.getItem(V)?.displayProperties?.name});try{const me=Zt([M],3,u),B=ss.some(N=>N.itemInstanceId===M);let L;for(const N in Pt)if(Pt[N].some(y=>y.itemInstanceId===M)){L=N;break}if(!L){for(const N in It)if(It[N].some(y=>y.itemInstanceId===M)){L=N;break}}const O=L?It[L]?.some(N=>N.itemInstanceId===M):!1;if(!B&&!L){de("SynergyGalaxy","Could not identify source character for transfer");return}if(O&&!B){if(re("SynergyGalaxy",`Item ${M} equipped, must unequip first`),!await ve.ensureItemUnequipped(L,M)){de("SynergyGalaxy","Failed to unequip: No replacement found"),alert("Cannot transfer equipped item. Please equip a different weapon first, or move a replacement from vault to your character.");return}re("SynergyGalaxy","âœ“ Item unequipped, refreshing profile"),await Ve.loadProfile(!0),re("SynergyGalaxy","â³ Waiting for Bungie sync..."),await new Promise(y=>setTimeout(y,1e3))}if(u==="vault"){re("SynergyGalaxy","ðŸ”„ Starting vault transfer...");const N=pt.smartTransfer(M,V,!0,L,me);Ut.flushSync(()=>{ae(w=>w+1)}),Ut.flushSync(()=>{ae(w=>w+2)}),re("SynergyGalaxy","Forced sync re-render, waiting for API");const y=await N;if(!y.success){de("SynergyGalaxy","Vault transfer failed:",y.error),j.getState().removeActiveTransfer(M,!1,!0);return}re("SynergyGalaxy","âœ“ Vault transfer complete")}else if(B)re("SynergyGalaxy","ðŸ”„ Starting vaultâ†’character transfer..."),await pt.smartTransfer(M,V,!1,u,me),re("SynergyGalaxy","âœ“ Vaultâ†’character complete, sync re-render"),Ut.flushSync(()=>{ae(N=>N+1)});else{re("SynergyGalaxy","ðŸ”„ Starting charâ†’char transfer (via vault)...");const N=await pt.smartTransfer(M,V,!0,L,me,{silent:!0});if(!N.success){de("SynergyGalaxy","Charâ†’Vault leg failed:",N.error),j.getState().removeActiveTransfer(M,!1,!0);return}re("SynergyGalaxy","âœ“ First leg (â†’vault) complete, sync re-render"),Ut.flushSync(()=>{ae(w=>w+1)});const y=await pt.smartTransfer(M,V,!1,u,me);if(!y.success){de("SynergyGalaxy","Vaultâ†’Char leg failed:",y.error),j.getState().removeActiveTransfer(M,!1,!0);return}re("SynergyGalaxy","âœ“ Second leg (â†’character) complete, sync re-render"),Ut.flushSync(()=>{ae(w=>w+1)})}ft(),re("SynergyGalaxy","âœ“ Transfer complete, refreshing profile"),await Ve.loadProfile(!0),j.getState().removeActiveTransfer(M),x(N=>{const y=new Set(N);return y.add(M),y}),setTimeout(()=>{x(N=>{const y=new Set(N);return y.delete(M),y})},2500),re("SynergyGalaxy","Final galaxy re-render"),ae(N=>N+1),re("SynergyGalaxy","Resetting view"),ft(),re("SynergyGalaxy","âœ… Transfer sequence completed!")}catch(me){de("SynergyGalaxy","Transfer failed:",me),j.getState().removeActiveTransfer(M,!1,!0),ae(B=>B+1)}},[g,ss,Vt,It,ft]),Yt=I.useCallback(async u=>{const b=Bt.current;if(!b?.instanceId||!b?.originalItem)return;const k=b.instanceId;ft();try{const M=ss.some(O=>O.itemInstanceId===k);let V;for(const O in Pt)if(Pt[O].some(N=>N.itemInstanceId===k)){V=O;break}if(!V){for(const O in It)if(It[O].some(N=>N.itemInstanceId===k)){V=O;break}}const me=M?"vault":V,B=Zt([k],5,u);re("SynergyGalaxy",`Starting unified move/equip for ${k} from ${me} to ${u}`);const L=await pt.moveItem(b.originalItem,me,u,B,{equip:!0,silent:!0});if(re("SynergyGalaxy","Unified move result:",L),L.success===!1){if(await Ve.loadProfile(!0),!(j.getState().characterEquipment[u]||[]).some(w=>w.itemInstanceId===k))throw new Error(L.error||"Equip failed");re("SynergyGalaxy",`Ghost success detected for equip of ${k}`)}await Ve.loadProfile(!0),j.getState().removeActiveTransfer(k),j.getState().removeActiveTransfer(k,!0),x(O=>{const N=new Set(O);return N.add(k),N}),setTimeout(()=>{x(O=>{const N=new Set(O);return N.delete(k),N})},2500),Ss.getState().triggerGlobalTransmat("success"),setTimeout(()=>j.getState().clearSuccessfulTransfer(k),2e3)}catch(M){de("SynergyGalaxy","Equip failed:",M),j.getState().removeActiveTransfer(k,!1,!0),ae(V=>V+1)}},[ss,Pt,It,ft,xt]),Ds=I.useCallback(u=>{if(g&&g.instanceId!==u.instanceId&&g.id!==u.id)return;if(ke){Se(u)&&Ga(u.instanceId||u.id);return}if(u.type==="subclass"||u.originalItem?.bucketHash===q.SUBCLASS){const B=u.originalItem;if(B){Ss.getState().setBuilderView("subclass",{hash:B.itemHash,itemInstanceId:B.itemInstanceId}),W(!1),fe.current=!1,$(null),Ke(),ie.current=null;return}}const b=u.instanceId||u.id;if(v&&g&&(g.instanceId===b||g.id===b)){if(u.originalItem){const{screenX:B,screenY:L,scale:O}=st(u.x,u.y,u.z),N={x:B+42*O+12,y:L};Dt(u.originalItem,u.instanceId?rt[u.instanceId]:void 0,void 0,!0,vt,Yt,!0,N,u.type==="subclass"),Pa()}return}if(W(!0),fe.current=!0,$(u),u.originalItem){const{screenX:B,screenY:L}=st(u.x,u.y,u.z),O={x:B,y:L};Dt(u.originalItem,u.instanceId?rt[u.instanceId]:void 0,void 0,!0,vt,Yt,!0,O,u.type==="subclass",()=>{},!1),ie.current=b}const M=-u.x-0,V=-u.y,me=-u.z+300;qt.current={x:0,y:0},Gt.current={x:0,y:0},xt(M,V,me,800)},[ke,Ke,v,g,Pa,rt,vt,Dt,xt]),zt=I.useCallback((u,b)=>{if(!ce.current||Pe.current)return;if(ke&&!v){ie.current&&(Ke(),ie.current=null);return}let k=null,M=null,V=1/0,me=null;const B=document.elementFromPoint(u,b),L=B?.closest(".galaxy-node");if(B&&B!==A.current&&B!==_.current&&!L){ie.current&&!v&&(Ke(),ie.current=null);return}if(L){const N=L.getAttribute("data-node-id"),y=qe.find(w=>w.id===N);y&&(k=L,M=y,V=0)}if(!M){const N=ce.current,y=_s.current;if(N){const w=u-N.left-y.centerX,U=b-N.top-y.centerY;qe.filter(ue=>ue.lodLevel<2).map(ue=>{const Te=st(ue.x,ue.y,ue.z);return{node:ue,projection:Te}}).filter(({projection:ue})=>{const Te=yt==="low"?-2500:yt==="medium"?-1e4:-25e3;return ue.finalZ<=990&&ue.finalZ>=Te}).sort((ue,Te)=>Te.projection.finalZ-ue.projection.finalZ).forEach(({node:ue,projection:Te})=>{const ye=ls.current.get(ue.id);if(!ye||ye.style.display==="none"||ye.style.opacity==="0")return;const{stageX:De,stageY:pe,scale:Re,finalZ:nt}=Te,Xe=Math.sqrt(Math.pow(w-De,2)+Math.pow(U-pe,2));let et=84*Re*.55;if(ie.current===ue.id&&(et*=1.3),et=Math.max(30,Math.min(120,et)),Xe<et){const dt=Xe/et-nt/500;dt<V&&(V=dt,k=ye,M=ue)}})}}if(!M&&La.current&&ce.current){const N=ce.current,y=u-N.left,w=b-N.top;let U=1/0;Hs.current.forEach(J=>{const te=Math.sqrt(Math.pow(J.px-y,2)+Math.pow(J.py-w,2)),le=Math.max(25,J.size+15);te<le&&te<U&&(U=te,me=J)})}if(k&&M){const N=M,y=N.originalItem,w=N.instanceId;if(ke){const U=k?M.instanceId||M.id:null;U!==cs&&bt(U),ie.current&&(Ke(),ie.current=null);return}if(Le.current&&(clearTimeout(Le.current),Le.current=null),ie.current!==N.id&&mt.current&&Rt.current.id!==N.id&&(clearTimeout(mt.current),mt.current=null),v&&g){const U=k.classList.contains("galaxy-focused-display"),J=w===g.instanceId;if(!U&&!J)return}if(y){const U=N.id,{screenX:J,screenY:te,scale:le}=st(N.x,N.y,N.z);if(isNaN(J)||isNaN(te)||isNaN(le))return;const ue=Math.round(J),Te=Math.round(te),ye=Math.abs(ue-Rt.current.x)>1||Math.abs(Te-Rt.current.y)>1,De=ie.current!==U;if(De||v&&ye)if(De&&!v){mt.current&&clearTimeout(mt.current);const pe=N.type==="subclass"&&N.isEquipped?0:N.type==="subclass"?50:150;mt.current=setTimeout(()=>{const Re=Qe(y.itemHash),nt=v?{x:ue,y:Te}:void 0;Dt(y,w?rt[w]:void 0,Re,v,vt,Yt,v,nt,N.type==="subclass",()=>{},!1),ie.current=U,Rt.current={id:U,x:ue,y:Te},mt.current=null},pe)}else{const pe=Qe(y.itemHash),Re=v?{x:ue,y:Te}:void 0;Dt(y,w?rt[w]:void 0,pe,v,vt,Yt,v,Re,N.type==="subclass",()=>{},!1),mt.current||(ie.current=U,Rt.current={id:U,x:ue,y:Te})}}}else if(me){const N=me,y=N.item,w=N.instanceId;if(ke)return;if(y){const U=w||`star-${y.itemHash}`,{screenX:J,screenY:te,scale:le}=st(N.x,N.y,N.z);if(isNaN(J)||isNaN(te)||isNaN(le))return;const ue=Math.round(J),Te=Math.round(te),ye=Math.abs(ue-Rt.current.x)>1||Math.abs(Te-Rt.current.y)>1;if(ie.current!==U||v&&ye){const pe=Qe(y.itemHash),Re=v?{x:ue,y:Te}:void 0;Dt(y,w&&rt[w]?rt[w]:void 0,pe,v,vt,Yt,v,Re,N.type==="subclass",()=>{},!1),ie.current=U,Rt.current={id:U,x:ue,y:Te}}}}else if(v&&g){if(ke){ie.current&&(Ke(),ie.current=null);return}const N=g.originalItem;if(N){const y=g.instanceId||g.id,{screenX:w,screenY:U,scale:J}=st(g.x,g.y,g.z);if(isNaN(w)||isNaN(U)||isNaN(J))return;const te=Math.round(w+42*J+12),le=Math.round(U),ue=Math.abs(te-Rt.current.x)>1||Math.abs(le-Rt.current.y)>1;if(ie.current!==y||ue){const ye={x:te,y:le};Dt(N,g.instanceId?rt[g.instanceId]:void 0,void 0,!0,vt,Yt,!0,ye,!1,()=>{},!1),ie.current=y,Rt.current={id:y,x:te,y:le}}}}else ie.current&&(mt.current&&(clearTimeout(mt.current),mt.current=null),Le.current||(Le.current=setTimeout(()=>{Ke(),ie.current=null,Rt.current={id:null,x:-1,y:-1},Le.current=null},150)))},[v,g,Dt,Ke,rt,Qe,ke,qe,vt,st,cs,yt]);I.useEffect(()=>()=>{Le.current&&clearTimeout(Le.current)},[]),I.useEffect(()=>{tt.current=zt},[zt]),I.useEffect(()=>{tt.current=zt},[zt]);const vs=I.useCallback(u=>{const b=u.clientX,k=u.clientY;if(ce.current){if(b>=ce.current.left&&b<=ce.current.right&&k>=ce.current.top&&k<=ce.current.bottom&&(oe.current||(oe.current=!0)),Be.current||zt(b,k),H.current&&!fe.current&&!Lt.current?.active&&!F.current&&C.current.x!==-1&&C.current.y!==-1){const M=b-C.current.x,V=k-C.current.y;We.current.x+=M,We.current.y+=V}if(K.current&&!fe.current&&!Lt.current?.active&&C.current.x!==-1&&C.current.y!==-1){const M=b-C.current.x,V=k-C.current.y,me=.3;jt.current.y+=M*me,jt.current.x+=V*me}C.current={x:b,y:k}}},[zt]),Fs=I.useCallback(u=>{if(Math.sqrt(Math.pow(u.clientX-D.current.x,2)+Math.pow(u.clientY-D.current.y,2))>5)return;const k=u.target,M=k.closest(".galaxy-node");if(!(M||k&&k!==A.current&&k!==_.current&&!M)&&ce.current&&a){const me=u.clientX-ce.current.left,B=u.clientY-ce.current.top,L=Hs.current.find(O=>Math.sqrt(Math.pow(O.px-me,2)+Math.pow(O.py-B,2))<Math.max(25,O.size+15));if(L){const O=L.item,N=L.instanceId?rt[L.instanceId]:void 0,y=P.getItem(O.itemHash),w=Qe(O.itemHash),U=y?.itemType===3,J=N?.damageType||y?.defaultDamageType,te=J?Ta[J]:void 0,le={x:L.x,y:L.y,z:L.z,id:`vault-${L.instanceId||O.itemHash}`,type:U?"weapon":"armor",hash:O.itemHash,instanceId:L.instanceId,bucketHash:y?.inventory?.bucketTypeHash||0,element:w,isEquipped:!1,isEmpty:!1,lodLevel:0,tierClass:Ks(O),power:N?.power,damageIconUrl:U&&te?$e(P.getDamageTypeIcon(te)||""):void 0,watermarkUrl:y?$e(y.iconWatermarkFeatured||y.iconWatermark):void 0,isLegacyWatermark:y?!y.iconWatermarkFeatured&&!!y.iconWatermark||zs(y.quality?.currentVersion):!1,isMasterwork:!!(O.state&&O.state&4),isCrafted:!!(O.state&&O.state&8),isEnhanced:!!(O.state&&O.state&8&&N?.gearTier&&N.gearTier>=2),tier:N?.gearTier,originalItem:O,iconUrl:$e(P.getItem(O.overrideStyleItemHash||O.itemHash)?.displayProperties?.icon||"")};Ds(le)}}},[Ds,Qe,a,ft,rt]),ks=I.useCallback(u=>{if(u.key==="Escape"){if(Ue){Tt(!1),ft();return}ft(),l?.();return}fe.current||Oe.current.add(u.key.toLowerCase())},[ft,l,Ue]);I.useEffect(()=>{h&&(h.current=ft)},[h,ft]);const ws=I.useCallback(u=>{fe.current||Oe.current.delete(u.key.toLowerCase())},[]),Gs=I.useCallback(u=>{if(!Ue){if(F.current&&(F.current=!1),ne.current&&(ne.current=!1),u.button===1){u.preventDefault(),K.current=!0;return}u.button===0&&(H.current=!0,D.current={x:u.clientX,y:u.clientY})}},[Ue]),xs=I.useCallback(u=>{if(u?.button===1){K.current=!1;return}H.current=!1,K.current=!1},[]),Lr=I.useCallback(u=>{if(v||Lt.current?.active||Ue)return;const b=ke?300:150,k=u.deltaY>0?-b:b,M=-2e6;We.current.z=Math.max(M,We.current.z+k)},[v,ke,Ue]),Hr=I.useCallback((u,b,k,M)=>{if(!ce.current)return null;const{centerX:V,centerY:me}=_s.current;let B;if(M&&(B=qe.find(O=>O.id===M||O.instanceId===M)),!B&&u){const O=u.toLowerCase(),N=O.match(/^(arc|solar|void|stasis|strand|prismatic)\s+subclass$/);if(N){const y=N[1];B=qe.find(w=>w.type!=="subclass"||!w.isEquipped?!1:w.element.toLowerCase()===y)}B||(B=qe.find(y=>{if(!y.hash)return!1;const U=P.getItem(y.hash)?.displayProperties?.name?.toLowerCase()||"";return U.includes(O)||O.includes(U)}))}if(B){if(ke&&B.id===it)return{x:V,y:me,scale:1.5,opacity:1,nodeId:B.id};const{screenX:N,screenY:y,scale:w,finalZ:U,isVisible:J}=st(B.x,B.y,B.z);if(!J)return null;let te=1;return U>850&&(te*=Math.max(0,1-(U-850)/145)),U<-5e3&&(te*=Math.max(0,1-(Math.abs(U)-5e3)/1e4)),{x:N,y,scale:w,opacity:te,nodeId:B.id}}let L;if(M&&(L=bs.current.find(O=>O.instanceId===M)),!L&&u){const O=u.toLowerCase();L=bs.current.find(N=>{if(!N.originalItem?.itemHash)return!1;const w=P.getItem(N.originalItem.itemHash)?.displayProperties?.name?.toLowerCase()||"";return w.includes(O)||O.includes(w)})}if(L){const{screenX:O,screenY:N,scale:y,finalZ:w,isVisible:U}=st(L.x,L.y,L.z);if(!U)return null;let J=1;return w>850&&(J*=Math.max(0,1-(w-850)/145)),w<-5e3&&(J*=Math.max(0,1-(Math.abs(w)-5e3)/1e4)),{x:O,y:N,scale:y,opacity:J,nodeId:L.instanceId}}return null},[qe,ke,it,he,st]),xa=I.useCallback(async(u,b)=>{if(b.preventDefault(),b.stopPropagation(),g||!u.originalItem||u.type!=="subclass"&&u.tierClass!=="exotic")return;Ke(),ie.current=null;const k=u.originalItem,M=P.getItem(k.itemHash);if(!M)return;const{characters:V,selectedCharacterId:me}=j.getState(),L=V.find(te=>te.characterId===me)?.classType??Y.Titan;Kt(u.id),Ot(!0),Ct(!1);const O=-u.x,N=-u.y,y=-u.z+300;if(xt(O,N,y,800),ce.current){const{screenX:te,screenY:le,scale:ue}=st(u.x,u.y,u.z);Fe({x:te,y:le,scale:ue})}if(u.type==="subclass"){const te=u.element,le=te.toLowerCase();ea(te);try{const ue=await Aa("subclass",le,L,{maxResults:Es,seed:gt});Me(Array.isArray(ue)?ue:[])}catch(ue){de("SynergyGalaxy","Failed to find synergies for subclass:",ue),Me([])}return}const w=u.type==="weapon",U=u.type==="armor";if(!w&&!U)return;const J=M.displayProperties?.name||"";if(J)try{const te=await Aa(w?"weapon":"armor",J,L,{maxResults:Es,seed:gt});Me(Array.isArray(te)?te:[]);const le=Qe(k.itemHash);ea(le)}catch(te){de("SynergyGalaxy","Failed to find synergies:",te),Me([])}},[Qe,ea,Es,gt,st,xt]),Mr=I.useCallback(async u=>{Ot(!1),Me([]),ft(),re("SynergyGalaxy","Equipping items for synergy:",u);const b=new Set,k=(B,L)=>qe.find(O=>O.type===L&&O.originalItem?.displayProperties?.name===B),M=k(u.armor,"armor"),V=k(u.weapon,"weapon");M?.instanceId&&b.add(M.instanceId),V?.instanceId&&b.add(V.instanceId);const me=qe.find(B=>B.type==="subclass"&&B.element?.toLowerCase()===u.subclassType?.toLowerCase());if(me?.instanceId&&b.add(me.instanceId),M?.instanceId&&V?.instanceId){const B=Vt||"",L={id:`synergy-${Date.now()}`,name:u.buildName,element:u.element.toLowerCase(),guardianClass:u.classType,exoticWeapon:{name:u.weapon,hash:V?.originalItem?.itemHash||0,slot:1},exoticArmor:{name:u.armor,hash:M?.originalItem?.itemHash||0,slot:0},items:[],armorMods:[],subclassConfig:{subclassHash:me?.originalItem?.itemHash||0}};V.instanceId;try{re("SynergyGalaxy","Calling equipBuild with template:",L);const{success:O,error:N}=await pt.equipBuild(L,B,void 0,!1,{silent:!1});O?(re("SynergyGalaxy","Equip success!"),Ss.getState().triggerGlobalTransmat("success"),Tt(!1),ps(null)):de("SynergyGalaxy","Equip failed:",N)}catch(O){de("SynergyGalaxy","Equip failed:",O)}}},[qe,Vt,ft]),br=I.useCallback(u=>{Pe.current!==u&&(Pe.current=u,u&&(Ke(),ie.current=null))},[Ke]),Pr=I.useCallback(u=>{ps(u)},[]),As=I.useCallback(()=>{if(A.current&&_.current){const u=A.current.getBoundingClientRect();ce.current=u;const b=_.current,k=window.devicePixelRatio||1;b.width=u.width*k,b.height=u.height*k,Ze.current={width:u.width,height:u.height};const M=b.getContext("2d");M&&M.scale(k,k)}},[]);I.useEffect(()=>{As()},[It,Pt,ss,Ls,As]),I.useEffect(()=>{At.current=u=>{if(ze.current=H.current,!fe.current&&!Lt.current?.active){const L=ut.current?45:25,O=document.activeElement;!(O&&(O.tagName==="INPUT"||O.tagName==="TEXTAREA"||O.isContentEditable))&&!Ue&&!ut.current&&((Oe.current.has("w")||Oe.current.has("s")||Oe.current.has("a")||Oe.current.has("d")||Oe.current.has("q")||Oe.current.has("e"))&&(ze.current=!0),Oe.current.has("w")&&(We.current.z+=L),Oe.current.has("s")&&(We.current.z-=L),Oe.current.has("a")&&(We.current.x+=L),Oe.current.has("d")&&(We.current.x-=L),Oe.current.has("q")&&(We.current.y+=L),Oe.current.has("e")&&(We.current.y-=L))}if(wt&&!fe.current&&!Lt.current?.active&&!ut.current){we.current+=3e-4*(u-(St.current||u));const N=Math.sin(we.current)*.15+Math.sin(we.current*.7)*.15*.5,y=Math.cos(we.current*.8)*.15*.7+Math.cos(we.current*.5)*.15*.3;if(Je.current.x+=N,Je.current.y+=y,We.current.x+=N,We.current.y+=y,ce.current&&C.current.x!==-1){const w=ce.current.left+ce.current.width/2,U=ce.current.top+ce.current.height/2,J=(C.current.x-w)/(ce.current.width/2),te=(C.current.y-U)/(ce.current.height/2),le=3,ue=te*le,Te=-J*le;jt.current.x+=(ue-jt.current.x)*.02,jt.current.y+=(Te-jt.current.y)*.02}}if(ce.current&&!fe.current&&!ut.current&&!ne.current){const L=ce.current.left+ce.current.width/2,O=ce.current.top+ce.current.height/2;if(qt.current.x=-(C.current.x-L)*1.5,qt.current.y=-(C.current.y-O)*1.5,oe.current){const{left:w,top:U,width:J,height:te}=ce.current,le=C.current.x,ue=C.current.y,Te=le-w,ye=w+J-le,De=ue-U,pe=U+te-ue,Re=Xe=>{const Ge=1-Math.max(0,Xe)/150;return Ge*Ge};(Te<150&&Te>-50||ye<150&&ye>-50||De<150&&De>-50||pe<150&&pe>-50)&&(ze.current=!0),Te<150&&Te>-50&&(We.current.x+=45*Re(Te)),ye<150&&ye>-50&&(We.current.x-=45*Re(ye)),De<150&&De>-50&&(We.current.y+=45*Re(De)),pe<150&&pe>-50&&(We.current.y-=45*Re(pe))}}else(fe.current||ut.current||ne.current)&&(qt.current={x:0,y:0},Gt.current={x:0,y:0});if(Lt.current?.active){const{startTime:L,duration:O,start:N,target:y}=Lt.current;if(!(typeof L=="number"&&!isNaN(L)&&typeof O=="number"&&!isNaN(O)&&O>0&&N&&typeof N.x=="number"&&!isNaN(N.x)&&y&&typeof y.x=="number"&&!isNaN(y.x)))je("SynergyGalaxy","âš ï¸ Invalid transition state, resetting:",Lt.current),Lt.current.active=!1;else{const U=u-L,J=Math.min(U/O,1),te=1-Math.pow(1-J,3);T.current={x:N.x+(y.x-N.x)*te,y:N.y+(y.y-N.y)*te,z:N.z+(y.z-N.z)*te},J>=1&&(T.current={...y},We.current={...y},Lt.current.active=!1)}}else{const O=T.current.x+(We.current.x-T.current.x)*.12,N=T.current.y+(We.current.y-T.current.y)*.12,y=T.current.z+(We.current.z-T.current.z)*.12;!isNaN(O)&&!isNaN(N)&&!isNaN(y)?(T.current.x=O,T.current.y=N,T.current.z=y):(je("SynergyGalaxy","âš ï¸ NaN in camera position, resetting:",{offset:T.current,targetOffset:We.current}),T.current={x:0,y:0,z:-200},We.current={x:0,y:0,z:-200});const w=Math.abs(T.current.x-We.current.x),U=Math.abs(T.current.y-We.current.y),J=Math.abs(T.current.z-We.current.z),te=w+U+J,le=ze.current&&te>.5;le!==Be.current&&(Be.current=le,le&&(Ke(),ie.current=null)),Gt.current.x+=(qt.current.x-Gt.current.x)*.1,Gt.current.y+=(qt.current.y-Gt.current.y)*.1}ka(jt.current.x,jt.current.y,u);const b=T.current.x,k=T.current.y;let M=!1;if(ce.current&&C.current.y>=0){const L=C.current.y-ce.current.top;L<150&&L>-50&&(M=!0)}const V=T.current.z>-50,me=Math.abs(b)>500||Math.abs(k)>500,B=!M&&(V||me);B!==Ha.current&&Ce(B),qe.forEach(L=>{const O=ls.current.get(L.id);if(!O)return;const N=Bt.current&&(Bt.current.id===L.id||Bt.current.instanceId&&L.instanceId&&Bt.current.instanceId===L.instanceId);let y=L.z+T.current.z;const w=L.isEquipped||L.type==="subclass",U=Se(L),J=Da.current.has(L.id);let te=!0;f.current==="subclass-only"?te=L.type==="subclass":f.current==="inventory-only"&&(te=L.type==="weapon"||L.type==="armor");const le=J&&te||U||N;if(!(U||w||y>(yt==="low"?-2500:yt==="medium"?-15e3:-4e4)&&y<1e3)){O.style.display="none",ie.current===L.id&&(Ke(),ie.current=null);return}if(!le)O.style.display="none",O.style.opacity="0",O.style.pointerEvents="none",O.classList.remove("galaxy-node--masterwork"),O.classList.add("galaxy-node--dimmed"),ie.current===L.id&&(Ke(),ie.current=null);else{O.classList.remove("galaxy-node--dimmed"),L.isMasterwork&&O.classList.add("galaxy-node--masterwork"),N&&(O.classList.add("galaxy-node--focused"),O.style.filter="none");const{stageX:ye,stageY:De,scale:pe,finalZ:Re,isVisible:nt}=st(L.x,L.y,L.z),Xe=nt||N&&Re<998;if(U&&ut.current&&L.id===_a.current){const dt=fe.current||ts.current;O.style.transform="translate3d(0px, 0px, 0px) scale(1.5)",O.style.display="block",dt?(O.style.zIndex="-99999",O.style.opacity="0.1",O.style.pointerEvents="none"):(O.style.zIndex="20000",O.style.opacity="1",O.style.pointerEvents="auto");return}let Ge=1;if(N)Ge=1;else if(Re>850&&(Ge*=Math.max(0,1-(Re-850)/145)),Re<-5e3){const et=yt==="low"?1500:yt==="medium"?1e4:3e4,dt=yt==="low"?1e3:yt==="medium"?5e3:1e4;Ge*=Math.max(0,1-(Math.abs(Re)-et)/dt)}if(Ma.current){const et=ts.current,dt=et&&(L.instanceId===et.armorInstanceId||L.instanceId===et.weaponInstanceId);if(N||dt)Ge=1;else{Ge=0,O.style.display="none";return}}if(O.style.display="block",O.style.opacity=Ge.toString(),O.style.pointerEvents=Ge>.05?"auto":"none",O.style.transform=`translate3d(${ye}px, ${De}px, 0px) scale(${pe})`,O.style.zIndex=N?"20000":Math.round(Re+1e4).toString(),Ge<.05){O.style.display="none",ie.current===L.id&&(Ke(),ie.current=null);return}if(ce.current){const dt=ce.current.width/2+300,Jt=ce.current.height/2+300;Math.abs(ye)>dt||Math.abs(De)>Jt||!Xe?(O.style.display="none",ie.current===L.id&&(Ke(),ie.current=null)):O.style.display="block"}}}),fe.current&&Bt.current?tt.current(-1,-1):!H.current&&oe.current&&C.current.x!==-1?tt.current(C.current.x,C.current.y):!fe.current&&!oe.current&&ie.current&&(Ke(),ie.current=null),_t.current++,u-St.current>1e3&&(z(Math.round(_t.current*1e3/(u-St.current))),St.current=u,_t.current=0)}},[qe,ka,As,he,Ke,st,Ce]);const na=I.useRef(ks),ia=I.useRef(ws),oa=I.useRef(Fs),ca=I.useRef(Gs),la=I.useRef(xs),ua=I.useRef(vs);I.useEffect(()=>{na.current=ks,ia.current=ws,oa.current=Fs,ca.current=Gs,la.current=xs,ua.current=vs,tt.current=zt},[ks,ws,Fs,Gs,xs,vs,zt]),I.useEffect(()=>{const u=O=>{At.current?.(O),ot.current=requestAnimationFrame(u)};As(),ot.current=requestAnimationFrame(u);const b=O=>ca.current(O),k=O=>la.current(O),M=O=>ua.current(O),V=O=>oa.current(O),me=O=>na.current(O),B=O=>ia.current(O),L=()=>As();return window.addEventListener("mousedown",b),window.addEventListener("mouseup",k),window.addEventListener("mousemove",M,{passive:!0}),window.addEventListener("click",V),window.addEventListener("keydown",me),window.addEventListener("keyup",B),window.addEventListener("resize",L),()=>{ot.current&&cancelAnimationFrame(ot.current),window.removeEventListener("mousedown",b),window.removeEventListener("mouseup",k),window.removeEventListener("mousemove",M),window.removeEventListener("click",V),window.removeEventListener("keydown",me),window.removeEventListener("keyup",B),window.removeEventListener("resize",L)}},[]),I.useEffect(()=>{const u=Et||v||g;let b;return u?(Cs(!0),document.documentElement.classList.add("global-ui-isolate")):b=setTimeout(()=>{Cs(!1),document.documentElement.classList.remove("global-ui-isolate")},150),()=>{b&&clearTimeout(b)}},[Et,v,g]);const da=I.useCallback(()=>{Oe.current.clear(),H.current=!1,D.current={x:-1,y:-1},C.current={x:-1,y:-1},ie.current&&!fe.current&&(Ke(),ie.current=null)},[Ke]);return I.useEffect(()=>{const u=()=>{oe.current=!1,C.current={x:-1,y:-1},ie.current&&!fe.current&&(Ke(),ie.current=null)};return window.addEventListener("blur",da),document.addEventListener("mouseleave",u),()=>{window.removeEventListener("blur",da),document.removeEventListener("mouseleave",u)}},[da,Ke]),ca.current=Gs,la.current=xs,ua.current=vs,oa.current=Fs,na.current=ks,ia.current=ws,S.jsxs("div",{ref:A,className:`synergy-galaxy-container ${v?"synergy-galaxy--locked":""} ${es?"is-isolating":""} ${Ue?"is-blackout-mode":""}`,onWheel:Lr,onMouseEnter:()=>{oe.current=!0},onMouseLeave:()=>{oe.current=!1},children:[S.jsx("div",{className:`synergy-blackout ${Ue?"synergy-blackout--active":""}`}),S.jsx("div",{className:"synergy-galaxy-vignette"}),S.jsx("div",{className:"synergy-galaxy-stars"}),S.jsx("canvas",{ref:_,className:"synergy-galaxy-canvas"}),S.jsxs("div",{ref:R,className:"synergy-galaxy-stage",children:[qe.filter(u=>u.lodLevel<2&&!Se(u)).map(u=>{const b=u.tierClass,k=u.isMasterwork,M=u.isEquipped,V=g?.id===u.id||g?.instanceId&&u.instanceId&&g.instanceId===u.instanceId,me=Ra(u,m.current,E.current,p.current,Qe);let B=!0;c==="subclass-only"?B=u.type==="subclass":c==="inventory-only"&&(B=u.type==="weapon"||u.type==="armor");const L=Se(u),O=me&&B||L||V,N=u.instanceId?j.getState().activeTransfers.has(u.instanceId):!1;let y=!1;const{successfulTransfers:w}=j.getState();u.instanceId&&w.has(u.instanceId)&&!u.id.startsWith("vault-")&&(y=!Array.from(w).some(te=>{if(te===u.instanceId)return!1;const le=qe.find(ue=>ue.instanceId===te);return!le||u.type==="weapon"?!1:u.type==="armor"&&le.type==="weapon"||u.type==="subclass"&&(le.type==="weapon"||le.type==="armor")}));let U=`element--${u.element}`;return u.type==="subclass"?U=`element--${u.element}`:c==="all"||c==="inventory-only"||!c?U=`node-tier--${b}`:U=`element--${u.element}`,S.jsxs("div",{ref:J=>{J?(J.__item=u.originalItem,J.__instanceId=u.instanceId,ls.current.set(u.id,J)):ls.current.delete(u.id)},className:`galaxy-node galaxy-node--${u.type} ${U} node-lod--${u.lodLevel} ${M?"galaxy-node--equipped":""} ${k&&O?"galaxy-node--masterwork":""} ${O?"":"galaxy-node--dimmed"} ${N?"transfer-active":""} ${y?"transfer-success":""} ${u.instanceId&&kt.has(u.instanceId)?"transmat-equip":""} ${V?"galaxy-node--focused galaxy-focused-display":""}`,style:{display:O?"block":"none",opacity:V?1:0,visibility:"visible",pointerEvents:"none"},onMouseEnter:()=>{if(!ke&&!v&&u.originalItem&&(!g||g.instanceId===u.instanceId)){let J;if(v){const{screenX:te,screenY:le}=st(u.x,u.y,u.z);J={x:te,y:le}}Dt(u.originalItem,u.instanceId?rt[u.instanceId]:void 0,void 0,v,vt,Yt,v,J,u.type==="subclass",()=>{},!1),ie.current=u.id}},onMouseLeave:()=>{v||(Ke(),ie.current=null)},onClick:()=>Ds(u),onContextMenu:J=>xa(u,J),children:[S.jsx("div",{className:"galaxy-node__icon-wrap",style:{pointerEvents:"auto"},children:$t&&u.hash&&S.jsxs(S.Fragment,{children:[S.jsx("img",{src:u.iconUrl||$e(P.getItem(u.hash)?.displayProperties?.icon||""),alt:u.id,className:"galaxy-node__icon",loading:"lazy",draggable:!1}),u.watermarkUrl&&S.jsx("img",{src:u.watermarkUrl,className:`galaxy-node__watermark ${u.isLegacyWatermark?"galaxy-node__watermark--legacy":"galaxy-node__watermark--featured"}`,alt:"",draggable:!1}),u.type!=="subclass"&&u.tierClass!=="exotic"&&u.tier!=null&&u.tier>0&&S.jsx("div",{className:"galaxy-node__tier-stars",children:S.jsx(ga,{tier:u.tier})}),u.power!=null&&u.power>0&&S.jsxs("div",{className:"galaxy-node__power",children:[u.damageIconUrl&&S.jsx("img",{src:u.damageIconUrl,className:"galaxy-node__damage-icon",alt:"",draggable:!1}),S.jsx("span",{className:"galaxy-node__power-value",children:u.power})]}),u.type==="weapon"&&(u.isCrafted||u.isEnhanced)&&S.jsx("div",{className:"galaxy-node__craft-status",children:u.isEnhanced?S.jsx("img",{src:$e("/img/destiny_content/items/enhanced-item-overlay.png"),className:"galaxy-node__enhanced-icon",alt:"Enhanced",draggable:!1}):u.isCrafted?S.jsx("img",{src:$e("/img/destiny_content/items/crafted-icon-overlay.png"),className:"galaxy-node__crafted-icon",alt:"Crafted",draggable:!1}):null})]})}),S.jsx("div",{className:"transmat-overlay"}),S.jsx("div",{className:"galaxy-node__glow"})]},u.id)}),g&&!qe.some(u=>u.id===g.id||u.instanceId&&g.instanceId&&u.instanceId===g.instanceId)&&!Se(g)&&(()=>{const{stageX:u,stageY:b,scale:k,isVisible:M}=st(g.x,g.y,g.z);return M?S.jsxs("div",{className:`galaxy-node galaxy-node--focused galaxy-focused-display galaxy-node--${g.type} element--${g.element} node-tier--${g.tierClass} node-lod--0 ${g.isMasterwork?"galaxy-node--masterwork":""}`,ref:V=>{V&&(V.__item=g.originalItem,V.__instanceId=g.instanceId)},style:{transform:`translate3d(${u}px, ${b}px, 0px) scale(${k})`,zIndex:2e4,display:"block",opacity:1,pointerEvents:"none"},onMouseEnter:()=>{if(!ke&&!v&&g.originalItem){const{screenX:V,screenY:me,scale:B}=st(g.x,g.y,g.z),L={x:V+42*B+12,y:me};Dt(g.originalItem,g.instanceId?rt[g.instanceId]:void 0,void 0,!0,vt,Yt,!0,L,g.type==="subclass",()=>{},!1),ie.current=g.id}},onMouseLeave:()=>{Ke(),ie.current=null},children:[S.jsxs("div",{className:"galaxy-node__icon-wrap",children:[S.jsx("img",{src:g.iconUrl||$e(P.getItem(g.hash)?.displayProperties?.icon||""),alt:"focused",className:"galaxy-node__icon",draggable:!1}),g.watermarkUrl&&S.jsx("img",{src:g.watermarkUrl,className:`galaxy-node__watermark ${g.isLegacyWatermark?"galaxy-node__watermark--legacy":"galaxy-node__watermark--featured"}`,alt:"",draggable:!1}),g.type!=="subclass"&&g.tierClass!=="exotic"&&g.tier!=null&&g.tier>0&&S.jsx("div",{className:"galaxy-node__tier-stars",children:S.jsx(ga,{tier:g.tier})}),g.power!=null&&g.power>0&&S.jsxs("div",{className:"galaxy-node__power",children:[g.damageIconUrl&&S.jsx("img",{src:g.damageIconUrl,className:"galaxy-node__damage-icon",alt:"",draggable:!1}),S.jsx("span",{className:"galaxy-node__power-value",children:g.power})]}),g.type==="weapon"&&(g.isCrafted||g.isEnhanced)&&S.jsx("div",{className:"galaxy-node__craft-status",children:g.isEnhanced?S.jsx("img",{src:$e("/img/destiny_content/items/enhanced-item-overlay.png"),className:"galaxy-node__enhanced-icon",alt:"Enhanced",draggable:!1}):g.isCrafted?S.jsx("img",{src:$e("/img/destiny_content/items/crafted-icon-overlay.png"),className:"galaxy-node__crafted-icon",alt:"Crafted",draggable:!1}):null})]}),S.jsx("div",{className:"transmat-overlay"}),S.jsx("div",{className:"galaxy-node__glow"})]}):null})()]}),ke&&S.jsx("div",{className:"synergy-galaxy-hud-layer",children:qe.filter(u=>Se(u)).map(u=>{const b=u.tierClass,k=u.isMasterwork,M=u.isEquipped,{activeTransfers:V,successfulTransfers:me}=j.getState(),B=u.instanceId?V.has(u.instanceId):!1,L=u.instanceId?me.has(u.instanceId):!1;let O=1,N="block";const y=es,w=g&&(g.instanceId===u.instanceId||g.id===u.id);if(w)O=1;else if(Et){const U=u.instanceId===Et.armorInstanceId,J=u.instanceId===Et.weaponInstanceId;U||J?O=1:(N="none",O=0)}else y&&(O=.05,u.type==="subclass"&&(N="none"));return S.jsxs("div",{ref:U=>{U?(U.__item=u.originalItem,U.__instanceId=u.instanceId,ls.current.set(u.id,U)):ls.current.delete(u.id)},className:`galaxy-node is-synced galaxy-node--${u.type} element--${u.element} node-tier--${b} node-lod--0 ${M?"galaxy-node--equipped":""} ${k?"galaxy-node--masterwork":""} ${B?"transfer-active":""} ${L?"transfer-success":""} ${u.instanceId&&kt.has(u.instanceId)?"transmat-equip":""} ${w?"galaxy-node--focused galaxy-focused-display":""}`,style:{display:N,opacity:O,pointerEvents:"auto",zIndex:B||L||u.instanceId&&kt.has(u.instanceId)?1e6:void 0},onClick:()=>Ds(u),onMouseEnter:()=>{bt(u.instanceId||u.id)},onMouseLeave:()=>{bt(null)},onContextMenu:U=>xa(u,U),children:[S.jsx("div",{className:"galaxy-node__icon-wrap",children:$t&&u.hash&&S.jsxs(S.Fragment,{children:[S.jsx("img",{src:u.iconUrl||$e(P.getItem(u.hash)?.displayProperties?.icon||""),alt:u.id,className:"galaxy-node__icon"}),u.watermarkUrl&&S.jsx("img",{src:u.watermarkUrl,className:`galaxy-node__watermark ${u.isLegacyWatermark?"galaxy-node__watermark--legacy":"galaxy-node__watermark--featured"}`,alt:""})]})}),S.jsx("div",{className:"transmat-overlay"}),S.jsx("div",{className:"galaxy-node__glow"})]},`hud-${u.id}`)})}),ke&&Ne.length>0&&S.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:2000000005,pointerEvents:"none"},children:S.jsx(Wn,{connections:Ne,sourcePosition:Ie,sourceNodeId:it,getItemPosition:Hr,itemInstances:rt,onWireHoverChange:br,onWireHover:Pr,onWireLock:Ga,onClose:_r,isExiting:Mt,hoveredNodeId:cs,onSynergyOverlayChange:(u,b)=>{Tt(u),i?.(u,b)},onEquipSynergy:Mr,forceCloseTrigger:d})}),S.jsx("div",{className:"synergy-galaxy-ui",style:{opacity:ct?0:1,pointerEvents:ct?"none":"auto",transition:"opacity 0.3s ease-out"},children:S.jsxs("div",{className:"synergy-galaxy-header",children:[Or&&S.jsx("div",{className:"synergy-galaxy-debug",children:S.jsxs("span",{className:"debug-fps",children:[ee," FPS"]})}),S.jsxs("div",{className:"synergy-galaxy-title-container",children:[S.jsx("h1",{className:"synergy-galaxy-title",children:"Synergy Galaxy"}),S.jsxs("button",{className:`synergy-galaxy-reload-btn ${Nr?"is-loading":""} ${ta?"is-stale":""}`,onClick:u=>{u.stopPropagation(),Ve.loadProfile(!0)},title:ta?"Data is stale. Click to refresh from Bungie.":"Reload Destiny Data","aria-label":"Reload",children:[S.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:S.jsx("path",{d:"M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16"})}),ta&&S.jsx("div",{className:"synergy-galaxy-stale-warning",children:S.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"#ff4444",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[S.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),S.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),S.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})})]})]})]})})]})}export{ri as $,ui as A,q as B,Mn as C,ya as D,G as E,ar as F,Y as G,oi as H,X as I,Q as J,s as K,Z as L,at as M,se as N,Ye as O,He as P,Ja as Q,er as R,mi as S,ii as T,on as U,Ln as V,Vs as W,be as X,ms as Y,ai as Z,Ia as _,Oa as a,di as a0,Ss as b,dn as c,re as d,On as e,Qs as f,$e as g,Ht as h,lt as i,ve as j,Ns as k,ge as l,P as m,de as n,xe as o,Ve as p,Ee as q,nn as r,ni as s,pt as t,j as u,Nn as v,je as w,ci as x,Zt as y,li as z};
//# sourceMappingURL=galaxy-CADwz3wb.js.map
