import{j as e}from"./markdown-DyKRzreE.js";import{i as z,d as Q,r as I}from"./react-vendor-BrsWO7iZ.js";import{n as F,m as N,G as P,L as d,r as X,u as Z,f as ee,v as se,F as G,D as q}from"./galaxy-DVJjGVLR.js";import{b as L}from"./build.service-CZ6lIic1.js";import{G as te}from"./GlassCard-BkPUaR69.js";import{r as ae}from"./utils-Cl4ySqJD.js";import{C as ne}from"./index-BJ86MllY.js";import"./builder-B7mi84rt.js";var ie=ae();const U=z(ie),V={exportBuilds:t=>{const l=t.map(p=>{const{template:a}=p,i=a.subclassConfig,n=y=>y?N.getName(y)||"Unknown":"",r=a.armorMods||[],o={Helmet:[],Arms:[],Chest:[],Legs:[],"Class Item":[]};r.forEach(y=>{const j=N.getItem(y);if(!j)return;const c=j.name,u=j.itemTypeDisplayName?.toLowerCase()||"";u.includes("helmet")?o.Helmet.push(c):u.includes("gauntlets")||u.includes("arms")?o.Arms.push(c):u.includes("chest")?o.Chest.push(c):u.includes("leg")?o.Legs.push(c):u.includes("class")?o["Class Item"].push(c):u.includes("general")&&o.Helmet.push(c)});const S=(y,j)=>{if(a.exoticWeapon&&a.exoticWeapon.slot===j)return a.exoticWeapon.name;const c=a.items?.find(u=>N.getItem(u.hash)?.bucketTypeHash===y);return c?n(c.hash):""},x=(y,j)=>{if(a.exoticArmor&&a.exoticArmor.slot===j)return a.exoticArmor.name;const c=a.items?.find(u=>N.getItem(u.hash)?.itemSubType===y);return c?n(c.hash):""};return{NAME:p.name,CLASS:N.getClassName(a.guardianClass),SUBCLASS:n(i?.subclassHash||0),SUPER:n(i?.superHash||0),GRENADE:n(i?.grenadeHash||0),MELEE:n(i?.meleeHash||0),"CLASS ABILITY":n(i?.classAbilityHash||0),"ASPECT 1":i?.aspects?.[0]?n(i.aspects[0]):"","ASPECT 2":i?.aspects?.[1]?n(i.aspects[1]):"","FRAGMENT 1":i?.fragments?.[0]?n(i.fragments[0]):"","FRAGMENT 2":i?.fragments?.[1]?n(i.fragments[1]):"","FRAGMENT 3":i?.fragments?.[2]?n(i.fragments[2]):"","FRAGMENT 4":i?.fragments?.[3]?n(i.fragments[3]):"","FRAGMENT 5":i?.fragments?.[4]?n(i.fragments[4]):"","KINETIC WEAPON":S(1498876634,d.Kinetic),"ENERGY WEAPON":S(2465295065,d.Energy),"POWER WEAPON":S(953998645,d.Power),HELMET:x(26,d.Helmet),ARMS:x(27,d.Arms),CHEST:x(28,d.Chest),LEGS:x(29,d.Legs),"CLASS ITEM":x(30,d.ClassItem),"HELMET MODS":o.Helmet.join(", "),"ARMS MODS":o.Arms.join(", "),"CHEST MODS":o.Chest.join(", "),"LEGS MODS":o.Legs.join(", "),"CLASS ITEM MODS":o["Class Item"].join(", ")}});return U.unparse(l)},importBuilds:async t=>new Promise((l,p)=>{U.parse(t,{header:!0,skipEmptyLines:!0,complete:a=>{const i=a.data,n=[];for(const r of i)try{const o=oe(r);o&&n.push(o)}catch(o){F("CSV","Failed to parse row:",r,o)}l(n)},error:a=>p(a)})})};function oe(t){const p={Titan:P.Titan,Hunter:P.Hunter,Warlock:P.Warlock}[t.CLASS]??P.Titan,a=M(t.SUBCLASS,p);if(!a)return null;const i=M(t.SUPER),n=M(t.GRENADE),r=M(t.MELEE),o=M(t["CLASS ABILITY"]),S=[];t["ASPECT 1"]&&S.push(M(t["ASPECT 1"])),t["ASPECT 2"]&&S.push(M(t["ASPECT 2"]));const x=[];["FRAGMENT 1","FRAGMENT 2","FRAGMENT 3","FRAGMENT 4","FRAGMENT 5"].forEach(E=>{const b=t[E];b&&x.push(M(b))});const y={subclassHash:a,superHash:i,grenadeHash:n,meleeHash:r,classAbilityHash:o,aspects:S.filter(E=>E>0),fragments:x.filter(E=>E>0)},j=[];let c={hash:0,name:"Unknown",slot:d.Kinetic},u={hash:0,name:"Unknown",slot:d.Helmet};[{name:t["KINETIC WEAPON"],bucket:1498876634},{name:t["ENERGY WEAPON"],bucket:2465295065},{name:t["POWER WEAPON"],bucket:953998645},{name:t.HELMET,bucket:3448274439},{name:t.ARMS,bucket:3551918588},{name:t.CHEST,bucket:14239492},{name:t.LEGS,bucket:20886954},{name:t["CLASS ITEM"],bucket:1585787867}].forEach(E=>{if(!E.name)return;const b=M(E.name);if(!b)return;const C=N.getItem(b);if(C?.tierType===6){if(C.itemType===3){let v=d.Energy;C.bucketTypeHash===1498876634&&(v=d.Kinetic),C.bucketTypeHash===2465295065&&(v=d.Energy),C.bucketTypeHash===953998645&&(v=d.Power),c={hash:b,name:C.name,slot:v}}else if(C.itemType===2){const H={3448274439:d.Helmet,3551918588:d.Arms,14239492:d.Chest,20886954:d.Legs}[C.bucketTypeHash||0]??d.Helmet;u={hash:b,name:C.name,slot:H}}}else j.push({hash:b,name:C?.name||E.name})});const w=[];["HELMET MODS","ARMS MODS","CHEST MODS","LEGS MODS","CLASS ITEM MODS"].forEach(E=>{const b=t[E];b&&b.split(",").map(v=>v.trim()).filter(v=>v.length>0).forEach(v=>{const H=M(v);H&&w.push(H)})});const k=N.getItem(a),$=k?.defaultDamageTypeHash?N.getDamageType(k.defaultDamageTypeHash)?.name.toLowerCase():"void";return{id:`imported-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:t.NAME||"Imported Build",element:$,guardianClass:p,exoticWeapon:c,exoticArmor:u,subclassConfig:y,armorMods:w,artifactPerks:[],items:j,playstyle:"Imported from CSV",difficulty:"intermediate"}}function M(t,l){if(!t)return 0;const p=N.searchItems(t,{limit:10,classType:l});if(p.length>0){const a=p.find(i=>i.name.toLowerCase()===t.toLowerCase());return a?a.hash:p[0].hash}return 0}function fe(){const t=Q(),{builds:l,isLoading:p}=X(),{selectedCharacterId:a}=Z(),{isAuthenticated:i}=ee(),{success:n,error:r}=se(),[o,S]=I.useState(null),[x,y]=I.useState(null),[j,c]=I.useState(!1),[u,D]=I.useState(null);I.useEffect(()=>{L.loadSavedBuilds()},[]);const w=async s=>{if(!a){r("Please select a character in the header first.");return}S(s.id);try{const m=await L.equip(s.template,a);m.success?(n(`Equipped ${s.name}!`),y(s),c(!0),setTimeout(()=>{t("/agent-wake")},1500)):r(m.error||"Failed to equip build.")}catch(m){F("SavedBuildsPage","Equip error:",m),r("Equip failed due to an error.")}finally{S(null)}},[W,k]=I.useState(!1),$=async s=>{if(a){k(!0);try{await new Promise(g=>setTimeout(g,2e3)),await L.snapshotToInGameSlot(a,s)?(c(!1),n(`Saved to In-Game Loadout Slot ${s+1}!`)):r("Failed to save loadout. Are you in an activity?")}catch{r("Snapshot failed.")}finally{k(!1)}}},E=s=>{D(s)},b=async()=>{u&&(await L.deleteBuild(u),n("Build deleted."),D(null))},C=async s=>{const m=q(s),g=await G.generateExoEngineLink(m);navigator.clipboard.writeText(g),n("ExoEngine Link copied to clipboard!")},v=s=>{const m=q(s),g=G.generateDIMCompatibleLink(m);navigator.clipboard.writeText(g),n("DIM Link copied to clipboard!")},H=()=>{if(l.length===0){r("No builds to export.");return}const s=l.map(f=>({name:f.name,template:f.template})),m=V.exportBuilds(s),g=new Blob([m],{type:"text/csv"}),T=window.URL.createObjectURL(g),h=document.createElement("a");h.href=T,h.download=`exo-loadouts-${new Date().toISOString().slice(0,10)}.csv`,h.click(),n(`Exported ${l.length} builds to CSV.`)},Y=async s=>{const m=s.target.files?.[0];if(!m)return;const g=new FileReader;g.onload=async T=>{const h=T.target?.result;if(h)try{const f=await V.importBuilds(h);if(f.length===0){r("No valid builds found in CSV.");return}let B=0;for(const R of f)await L.saveBuild(R,R.name),B++;n(`Successfully imported ${B} builds!`),L.loadSavedBuilds()}catch(f){F("SavedBuildsPage","Export error:",f),r("Failed to parse CSV.")}},g.readAsText(m),s.target.value=""},K=async s=>{const m=s.target.files?.[0];if(!m)return;const g=new FileReader;g.onload=async T=>{const h=T.target?.result;if(h)try{const f=JSON.parse(h),B=G.importDIMJson(f);if(B.length===0){r("No valid DIM loadouts found in this file.");return}let R=0;for(const _ of B){const J=G.convertToBuildTemplate(_);await L.saveBuild(J,_.name||"Imported DIM Build"),R++}n(`Successfully imported ${R} DIM builds!`),L.loadSavedBuilds()}catch(f){F("SavedBuildsPage","DIM Import error:",f),r("Failed to parse DIM JSON.")}},g.readAsText(m),s.target.value=""};return i?e.jsxs("div",{className:"saved-builds-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>t("/generator"),style:{marginBottom:"var(--space-md)"},children:"Generate Build"}),e.jsx("h1",{children:"Saved Builds"}),e.jsxs("p",{style:{color:"#ffffff"},children:["Your collection of custom and saved combat configurations (",l.length,")"]}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"btn btn-outline btn-sm",onClick:H,children:"Export CSV"}),e.jsxs("label",{className:"btn btn-outline btn-sm",children:["Import CSV",e.jsx("input",{id:"import-csv-input",name:"import-csv-input",type:"file",accept:".csv",style:{display:"none"},onChange:Y})]}),e.jsxs("label",{className:"btn btn-outline btn-sm",children:["Import DIM JSON",e.jsx("input",{id:"import-dim-input",name:"import-dim-input",type:"file",accept:".json",style:{display:"none"},onChange:K})]})]})]}),j&&e.jsx("div",{className:"snapshot-notice glass-panel",style:{marginBottom:"var(--space-xl)"},children:e.jsxs("div",{className:"snapshot-notice__content",children:[e.jsxs("h3",{children:["Build Initialized: ",x?.name]}),e.jsx("p",{children:"Gear & Subclass mapped. Snapshot to an in-game slot to save this configuration:"}),e.jsxs("div",{className:"snapshot-slots",children:[[0,1,2,3,4,5,6,7,8,9,10,11].map(s=>e.jsxs("button",{className:"btn btn-sm btn-ghost",onClick:()=>$(s),disabled:W,children:["Slot ",s+1]},s)),e.jsx("button",{className:"btn btn-sm btn-text",onClick:()=>c(!1),children:"Dismiss"})]})]})}),p?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Accessing vault..."})]}):l.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h2",{children:"No Builds Saved Yet"}),e.jsxs("p",{children:["Press ",e.jsx("span",{className:"key-cap",children:"D"})," while viewing an ExoEngine build to save it here."]})]}):e.jsx("div",{className:"builds-grid",children:l.map(s=>{const T=[2946726027,2603483315,3170703816,3893112950].includes(s.template.subclassConfig?.subclassHash||0)?"prismatic":s.template.element;return e.jsxs(te,{element:T,className:"saved-build-card",children:[e.jsxs("div",{className:"saved-build-card__header",children:[e.jsx("h3",{children:s.name}),e.jsx("span",{className:`badge badge-${String(T).toLowerCase()}`,children:String(T).charAt(0).toUpperCase()+String(T).slice(1)})]}),e.jsxs("div",{className:"saved-build-card__items",children:[e.jsxs("div",{className:"items-row",style:{marginBottom:"0.5rem"},children:[s.template.exoticWeapon&&e.jsx(A,{hash:s.template.exoticWeapon.hash,label:"Exotic Weapon"}),s.template.exoticArmor&&e.jsx(A,{hash:s.template.exoticArmor.hash,label:"Exotic Armor"})]}),e.jsxs("div",{className:"items-row",style:{marginBottom:"0.5rem"},children:[e.jsx(A,{hash:s.template.subclassConfig?.superHash||0,label:"Super"}),s.template.subclassConfig?.aspects?.map((h,f)=>e.jsx(A,{hash:h,label:`Aspect ${f+1}`},h))]}),e.jsxs("div",{className:"items-row",style:{marginBottom:"0.5rem"},children:[e.jsx(A,{hash:s.template.subclassConfig?.grenadeHash||0,label:"Grenade"}),e.jsx(A,{hash:s.template.subclassConfig?.meleeHash||0,label:"Melee"}),e.jsx(A,{hash:s.template.subclassConfig?.classAbilityHash||0,label:"Class Ability"})]}),(s.template.subclassConfig?.fragments?.length||0)>0&&e.jsx("div",{className:"items-row fragments-row",children:(s.template.subclassConfig?.fragments||[]).map((h,f)=>e.jsx(A,{hash:h,label:`Fragment ${f+1}`},h))}),s.template.armorMods&&s.template.armorMods.length>0&&e.jsxs("div",{className:"items-row mods-row",style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("span",{style:{fontSize:"0.65rem",color:"rgba(255,255,255,0.5)",marginRight:"0.5rem"},children:"MODS"}),s.template.armorMods.slice(0,6).map((h,f)=>e.jsx(A,{hash:h,label:`Mod ${f+1}`},`${h}-${f}`)),s.template.armorMods.length>6&&e.jsxs("span",{style:{fontSize:"0.65rem",color:"rgba(255,255,255,0.4)"},children:["+",s.template.armorMods.length-6]})]}),s.template.stats&&e.jsxs("div",{className:"saved-build-card__stats",style:{marginTop:"0.5rem",display:"flex",justifyContent:"space-between",padding:"0.5rem",background:"rgba(0,0,0,0.2)",borderRadius:"4px"},children:[e.jsx(O,{value:s.template.stats.resilience,label:"Health",icon:"resilience"}),e.jsx(O,{value:s.template.stats.recovery,label:"Recovery",icon:"recovery"}),e.jsx(O,{value:s.template.stats.discipline,label:"Grenade",icon:"discipline"}),e.jsx(O,{value:s.template.stats.strength,label:"Melee",icon:"strength"})]})]}),e.jsxs("div",{className:"saved-build-card__footer",children:[e.jsxs("div",{className:"footer-actions-row",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>w(s),disabled:o===s.id,children:o===s.id?"Equipping...":"Equip"}),e.jsx("button",{className:"btn btn-ghost btn-sm text-red",onClick:()=>E(s.id),children:"Delete"})]}),e.jsxs("div",{className:"footer-links-row",style:{marginTop:"0.5rem",display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"btn btn-xs btn-outline",onClick:()=>C(s.template),title:"Copy Exo Link",children:"Exo"}),e.jsx("button",{className:"btn btn-xs btn-outline",onClick:()=>v(s.template),title:"Copy to DIM Link",children:"DIM"})]})]})]},s.id)})}),e.jsx(ne,{isOpen:!!u,title:"DELETE BUILD?",message:"Are you sure you want to delete this recorded build? This action cannot be undone.",confirmText:"Delete",cancelText:"Keep",onConfirm:b,onCancel:()=>D(null),type:"danger"})]}):e.jsx("div",{className:"saved-builds-page",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h2",{children:"Login Required"}),e.jsx("p",{children:"You need to sign in with Bungie.net to see and manage your saved builds."})]})})}function A({hash:t,label:l}){const[p,a]=I.useState(null),[i,n]=I.useState(l);return I.useEffect(()=>{if(t){const r=N.getIcon(t);r&&a(r);const o=N.getFullDefinition(t);if(o){const S=o.name||"Unknown",x=o.description||"";n(x?`${S}
${x}`:S)}}},[t]),!t||!p?e.jsx("div",{className:"item-icon-placeholder",title:l,children:"?"}):e.jsx("div",{className:"item-icon-wrapper",title:i,children:e.jsx("img",{src:p,alt:l})})}function O({value:t,label:l,icon:p}){const a=Math.floor(t/10);return e.jsxs("div",{className:"stat-mini",title:`${l}: ${t}`,children:[e.jsx("span",{className:`stat-mini__icon stat-icon-${p}`}),e.jsxs("span",{className:"stat-mini__value",children:["T",a]})]})}export{fe as SavedBuildsPage,fe as default};
//# sourceMappingURL=SavedBuildsPage-CxjyDRuh.js.map
