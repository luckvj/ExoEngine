import{j as e}from"./markdown-DyKRzreE.js";import{r as h,a as Ye,d as Ze}from"./react-vendor-BrsWO7iZ.js";import{a as es,m as i,B as L,g as C,A as ss,u as Q,R as oe,C as as,D as Ce,F as ke,n as re,E as we,k as ts,r as ns,v as is,H as ls,I as Me}from"./galaxy-CADwz3wb.js";import{S as k,R as os}from"./builder-KXRIEMV5.js";import{C as cs}from"./index-dpLgvviA.js";/* empty css                             */import{Q as rs}from"./QuestSidebar-D5mCGK6w.js";import{b as ce}from"./build.service-Cqpku5ux.js";import"./utils-Cl4ySqJD.js";const ds={1:"kinetic",2:"arc",3:"solar",4:"void",6:"stasis",7:"strand"},Le=["Titan","Hunter","Warlock"];function ms({build:g,onEquip:E,onDelete:H,isEquipping:S=!1}){const[q,de]=h.useState(null),[z,me]=h.useState(null),[D,A]=h.useState(!1),[B,J]=h.useState(!1),[F,O]=h.useState(!0),[X,m]=h.useState(null),[G,ue]=h.useState({x:0,y:0}),[Y,T]=h.useState(!1),[W,he]=h.useState([]),[R,$]=h.useState(null),[Z,ee]=h.useState(null),{isLoaded:w}=es(),n=g.template,b=n?.originalLoadout,c=!!b,U=a=>{Z&&clearTimeout(Z),$(a);const t=setTimeout(()=>$(null),2500);ee(t)},[o,pe]=h.useState({aspects:[],fragments:[],weapons:[]}),s=h.useMemo(()=>{if(!c||!w)return null;const a=b,t=a.equipped?.find(r=>i.getItem(r.hash)?.inventory?.bucketTypeHash===L.SUBCLASS),p=t?i.getItem(t.hash):null,d=p?.talentGrid?.hudDamageType||3,l=ds[d]||n?.element||"solar",v=r=>{if(!t?.socketOverrides)return null;const f=t.socketOverrides[r];return f?i.getItem(f):null},I=v(0),P=v(1),N=v(2),M=v(3),xe=v(4),Se=[],_e=[];t?.socketOverrides&&Object.entries(t.socketOverrides).forEach(([r,f])=>{const be=parseInt(r),_=i.getItem(f);if(!_||be>=0&&be<=4)return;const Ie=(_.plug?.plugCategoryIdentifier||"").toLowerCase(),Ee=(_.itemTypeDisplayName||"").toLowerCase(),Xe=(_.displayProperties?.name||"").toLowerCase();Ie.includes("aspect")||Ee.includes("aspect")?Se.push({icon:C(_.displayProperties?.icon||"")||"",hash:_.hash}):(Ie.includes("fragment")||Ie.includes("facet")||Ee.includes("fragment")||Ee.includes("facet")||Xe.includes("facet of"))&&_e.push({icon:C(_.displayProperties?.icon||"")||"",hash:_.hash})});const De={super:N?C(N.displayProperties?.icon||""):void 0,superHash:N?.hash,jump:P?C(P.displayProperties?.icon||""):void 0,jumpHash:P?.hash,classAbility:I?C(I.displayProperties?.icon||""):void 0,classAbilityHash:I?.hash,melee:M?C(M.displayProperties?.icon||""):void 0,meleeHash:M?.hash,grenade:xe?C(xe.displayProperties?.icon||""):void 0,grenadeHash:xe?.hash,aspects:Se,fragments:_e},se=a.equipped?.find(r=>i.getItem(r.hash)?.inventory?.bucketTypeHash===L.HELMET),ae=a.equipped?.find(r=>i.getItem(r.hash)?.inventory?.bucketTypeHash===L.GAUNTLETS),te=a.equipped?.find(r=>i.getItem(r.hash)?.inventory?.bucketTypeHash===L.CHEST_ARMOR),ne=a.equipped?.find(r=>i.getItem(r.hash)?.inventory?.bucketTypeHash===L.LEG_ARMOR),ie=a.equipped?.find(r=>i.getItem(r.hash)?.inventory?.bucketTypeHash===L.CLASS_ARMOR),ye=a.equipped?.find(r=>i.getItem(r.hash)?.inventory?.bucketTypeHash===L.KINETIC_WEAPONS),ve=a.equipped?.find(r=>i.getItem(r.hash)?.inventory?.bucketTypeHash===L.ENERGY_WEAPONS),je=a.equipped?.find(r=>i.getItem(r.hash)?.inventory?.bucketTypeHash===L.POWER_WEAPONS),Ae=se?i.getItem(se.hash):null,Te=ae?i.getItem(ae.hash):null,He=te?i.getItem(te.hash):null,qe=ne?i.getItem(ne.hash):null,Pe=ie?i.getItem(ie.hash):null,ze=ye?i.getItem(ye.hash):null,Be=ve?i.getItem(ve.hash):null,Oe=je?i.getItem(je.hash):null,Ge={helmet:se,arms:ae,chest:te,legs:ne,classItem:ie},{modGroups:We,armorCosmetics:x}=ss(a,Ge),Re={ornament:x.helmet.ornament?i.getItem(x.helmet.ornament):null,shader:x.helmet.shader?i.getItem(x.helmet.shader):null},Ue={ornament:x.arms.ornament?i.getItem(x.arms.ornament):null,shader:x.arms.shader?i.getItem(x.arms.shader):null},Ve={ornament:x.chest.ornament?i.getItem(x.chest.ornament):null,shader:x.chest.shader?i.getItem(x.chest.shader):null},Fe={ornament:x.legs.ornament?i.getItem(x.legs.ornament):null,shader:x.legs.shader?i.getItem(x.legs.shader):null},$e={ornament:x.classItem.ornament?i.getItem(x.classItem.ornament):null,shader:x.classItem.shader?i.getItem(x.classItem.shader):null},Ke=p?C(p.screenshot||p.displayProperties?.icon||""):null,Qe=Q.getState().getAllInventory(),Ne=[],le=(r,f)=>{if(!r)return;Qe.some(_=>_.itemHash===r)||Ne.push({hash:r,name:f})};n?.exoticWeapon?.hash&&le(n.exoticWeapon.hash,n.exoticWeapon.name||"Exotic Weapon"),n?.exoticArmor?.hash&&le(n.exoticArmor.hash,n.exoticArmor.name||"Exotic Armor"),n?.items?.forEach(r=>le(r.hash,r.name||"Legendary Item")),a.equipped?.forEach(r=>{const f=i.getItem(r.hash);f&&[2,3].includes(f.itemType)&&le(r.hash,f.displayProperties?.name||"Item")});const Je=Array.from(new Set(Ne.map(r=>r.hash))).map(r=>Ne.find(f=>f.hash===r));return{elementName:l,className:Le[a.classType]||"Guardian",subclassDef:p,buildIcons:De,helmetDef:Ae,gauntletsDef:Te,chestDef:He,legsDef:qe,classItemDef:Pe,kineticDef:ze,energyDef:Be,powerDef:Oe,kinetic:ye,energy:ve,power:je,helmet:se,gauntlets:ae,chest:te,legs:ne,classItem:ie,helmetCosmetics:Re,gauntletsCosmetics:Ue,chestCosmetics:Ve,legsCosmetics:Fe,classItemCosmetics:$e,modGroups:We,bgImage:Ke,missingGear:Je}},[c,b,w,n]);h.useEffect(()=>{if(!w||!n)return;const a=Q.getState().getAllInventory(),t=[],p=(d,l)=>{if(!d)return;a.some(I=>I.itemHash===d)||t.some(I=>I.hash===d)||t.push({hash:d,name:l})};n?.exoticWeapon?.hash&&p(n.exoticWeapon.hash,n.exoticWeapon.name||"Exotic Weapon"),n?.exoticArmor?.hash&&p(n.exoticArmor.hash,n.exoticArmor.name||"Exotic Armor"),n?.items?.forEach(d=>p(d.hash,d.name||"Legendary Item")),b?.equipped&&b.equipped.forEach(d=>{const l=i.getItem(d.hash);l&&[2,3].includes(l.itemType)&&p(d.hash,l.displayProperties?.name||"Item")}),JSON.stringify(t)!==JSON.stringify(W)&&he(t)},[w,n,b]);const u=async()=>{try{let a;b?a=b:a=Ce(n);const t=await ke.generateExoEngineLink(a);await navigator.clipboard.writeText(t),U("Link copied to clipboard")}catch(a){re("Vault","Copy failed",a),U("Failed to copy link")}},j=async()=>{try{let a;b?a=b:a=Ce(n);const t=ke.generateDIMCompatibleLink(a);await navigator.clipboard.writeText(t),U("DIM link copied to clipboard")}catch(a){re("Vault","Copy failed",a),U("Failed to copy DIM link")}};h.useEffect(()=>{if(!D)return;const a=async t=>{const p=document.activeElement;p&&(p.tagName==="INPUT"||p.tagName==="TEXTAREA"||p.isContentEditable)||(t.key==="Control"&&O(l=>!l),t.key.toLowerCase()==="a"&&J(l=>!l),t.key.toLowerCase()==="f"&&(S||E?.(g)),t.key.toLowerCase()==="s"&&n?.source!=="exoengine"&&await u(),t.key.toLowerCase()==="g"&&n?.source!=="exoengine"&&await j(),t.key==="Escape"&&A(!1),t.key==="Delete"&&T(!0))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[D,S,g,E,H]),h.useEffect(()=>{if(!w||!n)return;async function a(){const t={aspects:[],fragments:[],weapons:[]},p=n.exoticWeapon?.hash||n.exoticArmor?.hash;if(p){const l=i.getItem(p);l?.screenshot&&de(l.screenshot),me(i.getIcon(p)||null)}const d=n.subclassConfig;if(d){if(d.superHash){const l=i.getIcon(d.superHash);l&&(t.super=l,t.superHash=d.superHash)}if(d.grenadeHash){const l=i.getIcon(d.grenadeHash);l&&(t.grenade=l,t.grenadeHash=d.grenadeHash)}if(d.meleeHash){const l=i.getIcon(d.meleeHash);l&&(t.melee=l,t.meleeHash=d.meleeHash)}if(d.classAbilityHash){const l=i.getIcon(d.classAbilityHash);l&&(t.classAbility=l,t.classAbilityHash=d.classAbilityHash)}d.aspects?.forEach(l=>{const v=i.getIcon(l);v&&t.aspects.push({icon:v,hash:l})}),d.fragments?.forEach(l=>{const v=i.getIcon(l);v&&t.fragments.push({icon:v,hash:l})})}if(n.exoticWeapon?.hash){const l=i.getIcon(n.exoticWeapon.hash);l&&t.weapons.push({icon:l,hash:n.exoticWeapon.hash,name:n.exoticWeapon.name})}if(n.exoticArmor?.hash){const l=i.getIcon(n.exoticArmor.hash);l&&(t.armor={icon:l,hash:n.exoticArmor.hash,name:n.exoticArmor.name})}pe(t)}a()},[n,w]);const y=n?.element?.toLowerCase()||"void",K=Le[n?.guardianClass]||"Guardian",ge=a=>{if(!D)return;const{clientX:t,clientY:p}=a,{innerWidth:d,innerHeight:l}=window,v=t/d-.5,I=p/l-.5;ue({x:v,y:I})},fe=(a,t=null,p=null)=>{const{mainStat:d,secondaryStat:l,others:v}=as(a),I=N=>{const M=N?i.getItem(N):null;return M?e.jsx("div",{className:"mod-pod cosmetic-pod",onMouseEnter:()=>m(N),onMouseLeave:()=>m(null),children:e.jsx("img",{src:C(M.displayProperties?.icon||""),alt:""})},N):e.jsx("div",{className:"mod-pod cosmetic-pod placeholder-pod"})},P=N=>{const M=i.getItem(N);return M?e.jsx("div",{className:"mod-pod",onMouseEnter:()=>m(N),onMouseLeave:()=>m(null),children:e.jsx("img",{src:C(M.displayProperties?.icon||""),alt:""})},N):null};return e.jsxs("div",{className:"armor-mods-pod-grid",children:[I(p?.hash),I(t?.hash),d&&P(d),l&&P(l),v.map(N=>P(N))]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`vault-card vault-card--horizontal vault-card--${y}`,onClick:()=>A(!0),children:[e.jsxs("div",{className:"vault-card__bg",children:[q?e.jsx("img",{src:q,alt:"",className:"vault-card__screenshot"}):e.jsx("div",{className:"vault-card__pattern",style:{backgroundImage:z?`url(${z})`:"none"}}),e.jsx("div",{className:"vault-card__vignette"}),e.jsx("div",{className:"vault-card__glow"})]}),e.jsxs("div",{className:"vault-card__content",children:[o.super&&e.jsxs("div",{className:"vault-card__super-icon",children:[e.jsx("img",{src:o.super,alt:"Super"}),e.jsx("span",{className:`vault-element-badge element-${y}`})]}),e.jsxs("div",{className:"vault-card__info",children:[e.jsx("h3",{className:"vault-card__title",children:g.name}),e.jsxs("span",{className:"vault-card__subtitle",children:[K," // ",n?.playstyle||"Custom Build"]})]})]}),e.jsxs("div",{className:"vault-card__nodes",children:[o.classAbility&&e.jsx(k,{type:"square",size:"small",icon:o.classAbility,element:y,status:"active"}),o.grenade&&e.jsx(k,{type:"square",size:"small",icon:o.grenade,element:y,status:"active"}),o.melee&&e.jsx(k,{type:"square",size:"small",icon:o.melee,element:y,status:"active"}),o.aspects.slice(0,2).map((a,t)=>e.jsx(k,{type:"square",size:"small",icon:a.icon,element:y,status:"active"},t)),e.jsx("div",{className:"fragment-row",children:o.fragments.slice(0,4).map((a,t)=>e.jsx("img",{src:a.icon,className:"fragment-icon-tiny",alt:""},t))})]}),e.jsxs("div",{className:"vault-card__actions",children:[e.jsxs("div",{className:"vault-card__exotics",children:[o.weapons[0]&&e.jsx("img",{src:o.weapons[0].icon,className:"exotic-icon-preview",title:o.weapons[0].name}),o.armor&&e.jsx("img",{src:o.armor.icon,className:"exotic-icon-preview",title:o.armor.name})]}),S&&e.jsx("div",{className:"spinner-mini"})]}),e.jsx("div",{className:"vault-card__timestamp",children:new Date(g.createdAt).toLocaleDateString()})]}),D&&Ye.createPortal(e.jsxs("div",{className:`dim-loadout-viewer synergy-build-overlay context-vault ${F?"":"synergy-build-overlay--ui-hidden"}`,"data-element":c?s?.elementName:y,onMouseMove:ge,style:{"--parallax-x":G.x,"--parallax-y":G.y},children:[R&&e.jsx("div",{className:"vault-service-alert animate-slide-up",children:e.jsxs("div",{className:"service-alert-content",children:[e.jsx("div",{className:"service-alert-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})})}),e.jsxs("div",{className:"service-alert-text",children:[e.jsx("span",{className:"alert-bold",children:"SERVICE ALERT"}),e.jsx("span",{className:"alert-message",children:R})]})]})}),W.length>0&&e.jsx("div",{className:"vault-missing-banner animate-slide-up",children:e.jsxs("div",{className:"missing-banner-content",children:[e.jsx("div",{className:"missing-banner-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:e.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})})}),e.jsxs("div",{className:"missing-banner-text",children:[e.jsx("span",{className:"missing-bold",children:"MISSING ITEMS"}),e.jsxs("span",{className:"missing-message",children:["Some items in this loadout were not found in your inventory: ",W.map(a=>a.name).join(", ")]})]})]})}),(c?s?.bgImage:q)&&e.jsxs("div",{className:"synergy-build-overlay__bg",children:[e.jsx("div",{className:"synergy-build-overlay__pattern"}),e.jsx("img",{src:c?s?.bgImage||"":q||"",alt:"",className:"synergy-build-overlay__screenshot"}),e.jsx("div",{className:"synergy-build-overlay__vignette"})]}),e.jsxs("div",{className:"synergy-build-overlay__header",children:[e.jsx("button",{className:"synergy-build-overlay__close",onClick:()=>A(!1),children:"âœ•"}),e.jsx("div",{className:"synergy-build-overlay__header-top-right",children:e.jsxs("div",{className:"synergy-build-overlay__title-area",children:[e.jsx("h1",{className:"synergy-build-overlay__title-large",children:g.name}),e.jsxs("div",{className:"synergy-build-overlay__subtitle-caps",children:[c?s?.className.toUpperCase():K.toUpperCase()," // ",c?s?.subclassDef?.displayProperties?.name?.toUpperCase()||"UNKNOWN SUBCLASS":n?.playstyle?.toUpperCase()||"CUSTOM BUILD"]})]})})]}),e.jsxs("div",{className:"synergy-build-overlay__content",children:[e.jsx("div",{className:"build-section build-section--super",children:(c?s?.buildIcons.super:o.super)&&e.jsx("div",{className:"super-node-large",children:e.jsx("img",{src:(c?s?.buildIcons.super:o.super)||"",alt:"Super Icon",onMouseEnter:()=>m((c?s?.buildIcons.superHash:o.superHash)||null),onMouseLeave:()=>m(null)})})}),e.jsxs("div",{className:"build-section--middle",children:[e.jsxs("div",{className:"build-section--middle__top-row",children:[e.jsxs("div",{className:"node-section section-abilities",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| ABILITIES"}),e.jsxs("div",{className:"node-section-content",children:[(c?s?.buildIcons.classAbility:o.classAbility)&&e.jsx(k,{type:"square",size:"normal",icon:(c?s?.buildIcons.classAbility:o.classAbility)||"",element:c?s?.elementName:y,status:"active",onMouseEnter:()=>m((c?s?.buildIcons.classAbilityHash:o.classAbilityHash)||null),onMouseLeave:()=>m(null)}),c&&s?.buildIcons.jump&&e.jsx(k,{type:"square",size:"normal",icon:s.buildIcons.jump,element:s.elementName,status:"active",onMouseEnter:()=>m(s?.buildIcons.jumpHash||null),onMouseLeave:()=>m(null)}),(c?s?.buildIcons.grenade:o.grenade)&&e.jsx(k,{type:"square",size:"normal",icon:(c?s?.buildIcons.grenade:o.grenade)||"",element:c?s?.elementName:y,status:"active",onMouseEnter:()=>m((c?s?.buildIcons.grenadeHash:o.grenadeHash)||null),onMouseLeave:()=>m(null)}),(c?s?.buildIcons.melee:o.melee)&&e.jsx(k,{type:"square",size:"normal",icon:(c?s?.buildIcons.melee:o.melee)||"",element:c?s?.elementName:y,status:"active",onMouseEnter:()=>m((c?s?.buildIcons.meleeHash:o.meleeHash)||null),onMouseLeave:()=>m(null)})]})]}),e.jsxs("div",{className:"node-section section-aspects",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| ASPECTS"}),e.jsx("div",{className:"node-section-content",children:(c?s?.buildIcons.aspects:o.aspects)?.map((a,t)=>e.jsx(k,{type:"square",size:"normal",icon:a.icon,element:c?s?.elementName:y,status:"active",onMouseEnter:()=>m(a.hash||null),onMouseLeave:()=>m(null)},t))||[]})]})]}),e.jsx("div",{className:"build-section--middle__bottom-row",children:e.jsxs("div",{className:"node-section section-fragments",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| FRAGMENTS"}),e.jsx("div",{className:"synergy-build-overlay__fragments-grid",children:(c?s?.buildIcons.fragments:o.fragments)?.map((a,t)=>e.jsx(k,{type:"square",size:"small",icon:a.icon,element:c?s?.elementName:y,status:"active",onMouseEnter:()=>m(a.hash||null),onMouseLeave:()=>m(null)},t))||[]})]})}),n?.stats&&e.jsxs("div",{className:"node-section section-stats",style:{marginTop:"20px"},children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| STATS"}),e.jsxs("div",{className:"stats-grid",style:{display:"flex",gap:"20px"},children:[e.jsx(V,{value:n.stats.mobility,label:"Mob",icon:"mobility"}),e.jsx(V,{value:n.stats.resilience,label:"Res",icon:"resilience"}),e.jsx(V,{value:n.stats.recovery,label:"Rec",icon:"recovery"}),e.jsx(V,{value:n.stats.discipline,label:"Dis",icon:"discipline"}),e.jsx(V,{value:n.stats.intellect,label:"Int",icon:"intellect"}),e.jsx(V,{value:n.stats.strength,label:"Str",icon:"strength"})]})]}),e.jsxs("div",{className:"node-section section-gear",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| LOADOUT & GEAR"}),e.jsxs("div",{className:"synergy-build-overlay__gear-horizontal-grid",children:[c?[{def:s?.kineticDef,item:s?.kinetic},{def:s?.energyDef,item:s?.energy},{def:s?.powerDef,item:s?.power}].map((a,t)=>a.def&&e.jsxs("div",{className:"gear-item-horizontal",onMouseEnter:()=>m(a.def?.hash||null),onMouseLeave:()=>m(null),children:[e.jsx(oe,{hash:a.def.hash,instance:a.item||{state:4}}),e.jsx("div",{className:"gear-item-info",children:e.jsx("span",{className:"build-item__label--compact",children:a.def.displayProperties?.name})})]},t)):o.weapons.map((a,t)=>e.jsxs("div",{className:"gear-item-horizontal",onMouseEnter:()=>m(a.hash),onMouseLeave:()=>m(null),children:[e.jsx(oe,{hash:a.hash,instance:{state:4}}),e.jsx("div",{className:"gear-item-info",children:e.jsx("span",{className:"build-item__label--compact",children:a.name})})]},t)),c&&s?[{def:s.helmetDef,group:s.modGroups.helmet,cosmetics:s.helmetCosmetics,itemData:s.helmet},{def:s.gauntletsDef,group:s.modGroups.arms,cosmetics:s.gauntletsCosmetics,itemData:s.gauntlets},{def:s.chestDef,group:s.modGroups.chest,cosmetics:s.chestCosmetics,itemData:s.chest},{def:s.legsDef,group:s.modGroups.legs,cosmetics:s.legsCosmetics,itemData:s.legs},{def:s.classItemDef,group:s.modGroups.classItem,cosmetics:s.classItemCosmetics,itemData:s.classItem}].map((a,t)=>a.def&&e.jsxs("div",{className:"gear-item-horizontal",onMouseEnter:()=>m(a.def?.hash||null),onMouseLeave:()=>m(null),children:[e.jsx(oe,{hash:a.def.hash,instance:a.itemData}),e.jsxs("div",{className:"gear-item-info",children:[e.jsx("span",{className:"build-item__label--compact",children:a.def.displayProperties?.name}),fe(a.group,a.cosmetics.ornament,a.cosmetics.shader)]})]},t)):o.armor&&e.jsxs("div",{className:"gear-item-horizontal",onMouseEnter:()=>m(o.armor?.hash||null),onMouseLeave:()=>m(null),children:[e.jsx(oe,{hash:o.armor.hash,instance:{state:4}}),e.jsx("div",{className:"gear-item-info",children:e.jsx("span",{className:"build-item__label--compact",children:o.armor.name})})]})]})]})]})]}),e.jsxs("div",{className:`synergy-build-overlay__lore-panel ${B?"synergy-build-overlay__lore-panel--open":""}`,children:[e.jsxs("div",{className:"lore-panel__header",children:[e.jsx("h2",{className:"lore-panel__title",children:g.name}),e.jsxs("div",{className:"lore-panel__subtitle",children:[c?s?.className:K," // ",c?s?.subclassDef?.displayProperties?.name:n?.playstyle||"Custom Build"]})]}),e.jsx("div",{className:"lore-panel__content",children:g.notes||b?.notes||"No description provided for this build."}),e.jsxs("div",{className:"lore-panel__meta",children:[e.jsxs("div",{className:"lore-panel__meta-item",children:[e.jsx("span",{className:"meta-label",children:"Saved"}),e.jsx("span",{className:"meta-value",children:new Date(g.createdAt).toLocaleDateString()})]}),g.tags&&g.tags.length>0&&e.jsxs("div",{className:"lore-panel__meta-item",children:[e.jsx("span",{className:"meta-label",children:"Tags"}),e.jsx("span",{className:"meta-value",children:g.tags.join(", ")})]}),n?.source&&e.jsxs("div",{className:"lore-panel__meta-item",children:[e.jsx("span",{className:"meta-label",children:"Source"}),e.jsx("span",{className:"meta-value",children:n.source.toUpperCase()})]})]})]}),e.jsxs("div",{className:"synergy-build-overlay__footer-bar",children:[e.jsxs("div",{className:"key-prompt",onClick:()=>{E?.(g),A(!1)},children:[e.jsx("span",{className:"key-cap",children:"F"}),e.jsx("span",{className:"key-label",children:"Equip Build"})]}),n?.source!=="exoengine"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"key-prompt",onClick:u,children:[e.jsx("span",{className:"key-cap",children:"S"}),e.jsx("span",{className:"key-label",children:"Copy ExoEngine Link"})]}),e.jsxs("div",{className:"key-prompt",onClick:j,children:[e.jsx("span",{className:"key-cap",children:"G"}),e.jsx("span",{className:"key-label",children:"Copy DIM Link"})]})]}),e.jsxs("div",{className:"key-prompt key-prompt--danger",onClick:()=>T(!0),children:[e.jsx("span",{className:"key-cap",children:"Del"}),e.jsx("span",{className:"key-label",children:"Delete"})]}),e.jsxs("div",{className:"key-prompt",onClick:()=>O(!F),children:[e.jsx("span",{className:"key-cap",children:"Ctrl"}),e.jsx("span",{className:"key-label",children:F?"Hide Menu":"Show Menu"})]}),e.jsxs("div",{className:"key-prompt",onClick:()=>A(!1),children:[e.jsx("span",{className:"key-cap",children:"Esc"}),e.jsx("span",{className:"key-label",children:"Close"})]})]}),X&&e.jsx(os,{item:{hash:X}}),e.jsx(cs,{isOpen:Y,title:"DELETE BUILD?",message:"Are you sure you want to delete this recorded build? This action cannot be undone.",confirmText:"Delete",cancelText:"Keep",onConfirm:()=>{T(!1),H?.(g.id),A(!1)},onCancel:()=>T(!1),type:"danger"})]}),document.body)]})}function V({value:g,label:E,icon:H}){const S=Math.floor(g/10);return e.jsxs("div",{className:"stat-item-display",title:`${E}: ${g}`,style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[e.jsx("div",{className:`stat-icon stat-icon-${H}`,style:{width:"24px",height:"24px",backgroundSize:"contain",backgroundRepeat:"no-repeat",filter:"brightness(1.5)"}}),e.jsxs("div",{style:{fontSize:"0.8rem",fontWeight:"bold"},children:["T",S]}),e.jsx("div",{style:{fontSize:"0.6rem",opacity:.6,textTransform:"uppercase"},children:E})]})}const Ns=()=>{const g=Ze(),[E,H]=h.useState(Object.values(we)),[S,q]=h.useState("all"),{ownedExpansions:de}=ts(),[z,me]=h.useState(de),[D,A]=h.useState(""),[B,J]=h.useState(null),[F,O]=h.useState(0),[X,m]=h.useState(""),{selectedCharacterId:G,characterEquipment:ue}=Q(),{builds:Y,isLoading:T}=ns(),{success:W,info:he,error:R}=is();h.useEffect(()=>{ce&&ce.loadSavedBuilds()},[]);const $=ue[G||""]||[],Z=h.useMemo(()=>ls($),[$]),ee={void:{primary:"#bf84ff",glow:"rgba(191, 132, 255, 0.5)"},solar:{primary:"#ff8c3a",glow:"rgba(255, 140, 58, 0.5)"},arc:{primary:"#7df9ff",glow:"rgba(125, 249, 255, 0.5)"},stasis:{primary:"#4d88ff",glow:"rgba(77, 136, 255, 0.5)"},strand:{primary:"#4aff9b",glow:"rgba(74, 255, 155, 0.5)"},prismatic:{primary:"#ff8df6",glow:"rgba(255, 141, 246, 0.5)"}},w=ee[Z]||ee.void,n=s=>{H(u=>u.includes(s)?u.filter(j=>j!==s):[...u,s])},b=s=>{s!==Me.BaseGame&&me(u=>u.includes(s)?u.filter(j=>j!==s):[...u,s])},c=h.useMemo(()=>Y.filter(s=>{const u=s.template;if(!u||S!=="all"&&u.guardianClass!==S||E.length>0&&!E.includes(u.element)||u.requiredExpansion&&!z.includes(u.requiredExpansion)&&u.requiredExpansion!==Me.BaseGame)return!1;if(D){const j=D.toLowerCase(),y=s.name.toLowerCase().includes(j),K=u.exoticWeapon?.name?.toLowerCase().includes(j),ge=u.exoticArmor?.name?.toLowerCase().includes(j),fe=s.tags?.some(a=>a.toLowerCase().includes(j));return y||K||ge||fe}return!0}),[Y,E,S,z,D]),U=async s=>{if(!B){if(!G){he("Please select a character first.");return}J(s.id),O(0),m("Initializing..."),Q.getState().setEquipping(!0);try{const u=await ce.equip(s.template,G,(j,y)=>{m(j),O(y),(j.includes("Equipping items")||y>=35)&&(g("/galaxy"),setTimeout(()=>{window.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape",bubbles:!0}))},100))});u.success?W(`Successfully equipped ${s.name}!`):R(u.error||"Failed to equip build.")}catch(u){re("LoadoutVaultPage","Equipment error:",u),R("An unexpected error occurred during equipment.")}finally{J(null),O(0),m(""),Q.getState().setEquipping(!1)}}},o=async s=>{try{await ce.deleteBuild(s),W("Build deleted successfully.")}catch(u){re("LoadoutVaultPage","Delete error:",u),R("Failed to delete build.")}},pe=s=>{s.loadout&&(sessionStorage.setItem("viewBuild",JSON.stringify(s)),g("/dim-loadout?fromVault=true"))};return e.jsxs("div",{className:"vault-page",style:{"--brand-primary":w.primary,"--brand-glow":w.glow},children:[e.jsx(rs,{selectedElements:E,onToggleElement:n,selectedClass:S,onSelectClass:q,selectedExpansions:z,onToggleExpansion:b}),e.jsxs("main",{className:"vault-content",children:[e.jsx("button",{className:"spin-button",onClick:()=>g("/generator"),style:{alignSelf:"flex-start",marginBottom:"var(--space-md)"},children:e.jsxs("span",{className:"spin-button__text",children:["Generate Build ",e.jsx("span",{style:{fontSize:"0.75em",opacity:.7},children:"(Beta)"})]})}),e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"Saved Builds"}),e.jsx("div",{className:"header-actions",style:{display:"flex",gap:"var(--space-md)"},children:e.jsxs("span",{className:"vault-results__count",style:{color:"#ffffff"},children:[c.length," builds saved"]})})]}),T&&e.jsxs("div",{className:"vault-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading saved builds..."})]}),!T&&c.length===0&&e.jsxs("div",{className:"vault-empty",children:[e.jsx("h3",{children:"No Builds Saved"}),e.jsxs("p",{children:["Press ",e.jsx("span",{className:"key-cap",children:"D"})," while viewing a DIM loadout or ExoEngine build to save it here."]}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{H(Object.values(we)),q("all"),A("")},style:{color:"#ffffff",background:"#000000",borderColor:"#ffffff"},children:"Clear Filters"})]}),!T&&c.length>0&&e.jsx("div",{className:"vault-grid",children:c.map(s=>e.jsx(ms,{build:s,onEquip:U,onDelete:o,onView:pe,isEquipping:B===s.id,equippingProgress:B===s.id?F:void 0,equippingStatus:B===s.id?X:void 0},s.id))}),e.jsx("div",{style:{height:"100px"}})]})]})};export{Ns as default};
//# sourceMappingURL=LoadoutVaultPage-EmGoHPTn.js.map
