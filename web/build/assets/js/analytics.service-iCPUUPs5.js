import{o as p}from"./galaxy-DVJjGVLR.js";import"./markdown-DyKRzreE.js";import"./react-vendor-BrsWO7iZ.js";import"./builder-B7mi84rt.js";import"./utils-Cl4ySqJD.js";class l{usageStats={loadoutEquips:{},itemEquips:{},lastEquipped:{}};performanceMetrics={apiCalls:[],transferStats:{total:0,successful:0,failed:0}};async init(){const t=await p.getSetting("usage_stats");t&&(this.usageStats=t)}trackLoadoutEquip(t){this.usageStats.loadoutEquips[t]=(this.usageStats.loadoutEquips[t]||0)+1,this.persistUsageStats()}trackItemEquip(t){this.usageStats.itemEquips[t]=(this.usageStats.itemEquips[t]||0)+1,this.usageStats.lastEquipped[t]=Date.now(),this.persistUsageStats()}trackApiCall(t,e,s){this.performanceMetrics.apiCalls.push({endpoint:t,duration:e,success:s,timestamp:Date.now()}),this.performanceMetrics.apiCalls.length>1e3&&(this.performanceMetrics.apiCalls=this.performanceMetrics.apiCalls.slice(-1e3))}trackTransfer(t){this.performanceMetrics.transferStats.total++,t?this.performanceMetrics.transferStats.successful++:this.performanceMetrics.transferStats.failed++}getMostUsedLoadouts(t=10){return Object.entries(this.usageStats.loadoutEquips).map(([e,s])=>({id:e,count:s})).sort((e,s)=>s.count-e.count).slice(0,t)}getMostEquippedItems(t=10){return Object.entries(this.usageStats.itemEquips).map(([e,s])=>({instanceId:e,count:s})).sort((e,s)=>s.count-e.count).slice(0,t)}getApiPerformance(){const t=this.performanceMetrics.apiCalls.filter(r=>r.success).map(r=>r.duration).sort((r,u)=>r-u);if(t.length===0)return{avgDuration:0,p50:0,p95:0,p99:0,successRate:0};const e=t.reduce((r,u)=>r+u,0)/t.length,s=t[Math.floor(t.length*.5)],a=t[Math.floor(t.length*.95)],i=t[Math.floor(t.length*.99)],n=this.performanceMetrics.apiCalls.length,o=this.performanceMetrics.apiCalls.filter(r=>r.success).length,c=n>0?o/n*100:0;return{avgDuration:Math.round(e),p50:Math.round(s),p95:Math.round(a),p99:Math.round(i),successRate:Math.round(c*100)/100}}getTransferStats(){const{total:t,successful:e}=this.performanceMetrics.transferStats;return{total:t,successRate:t>0?Math.round(e/t*100*100)/100:0}}findDuplicates(t){const e=new Map;for(const s of t){const a=`${s.itemHash}`,i=e.get(a)||[];s.itemInstanceId&&i.push(s.itemInstanceId),e.set(a,i)}return Array.from(e.entries()).filter(([s,a])=>a.length>1).map(([s,a])=>({hash:parseInt(s),count:a.length,instances:a})).sort((s,a)=>a.count-s.count)}getVaultBreakdown(t){const e=[1498876634,2465295065,953998645],s=[3448274439,3551918588,14239492,20886954,1585787867],a=t.filter(c=>e.includes(c.bucketHash)).length,i=t.filter(c=>s.includes(c.bucketHash)).length,n=t.length,o=500;return{weapons:a,armor:i,total:n,capacity:o,usagePercent:Math.round(n/o*100*100)/100}}async persistUsageStats(){await p.setSetting("usage_stats",this.usageStats)}exportData(){return JSON.stringify({usage:this.usageStats,performance:this.performanceMetrics,exportedAt:Date.now()},null,2)}async clearData(){this.usageStats={loadoutEquips:{},itemEquips:{},lastEquipped:{}},this.performanceMetrics={apiCalls:[],transferStats:{total:0,successful:0,failed:0}},await p.setSetting("usage_stats",this.usageStats)}}const M=new l;export{M as analyticsService};
//# sourceMappingURL=analytics.service-iCPUUPs5.js.map
