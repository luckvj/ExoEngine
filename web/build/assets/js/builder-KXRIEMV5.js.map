{"version":3,"file":"builder-KXRIEMV5.js","sources":["../../../../src/assets/mouse-left-plain.png","../../../../src/assets/mouse-right-plain.png","../../../../src/services/artifact.service.ts","../../../../src/components/builder/TransferMenu.tsx","../../../../src/components/common/SimpleTooltip.tsx","../../../../src/components/builder/RichTooltip.tsx","../../../../src/components/builder/SubclassNode.tsx","../../../../src/components/builder/BuilderContainer.tsx"],"sourcesContent":["export default \"__VITE_ASSET__Bz5iC77x__\"","export default \"__VITE_ASSET__CQWfHdol__\"","// Artifact Service - Processes seasonal artifact data for anti-champion mods\r\n// Used by the Agent to recommend weapons based on unlocked artifact perks\r\n\r\nimport { useProfileStore } from '../store';\r\nimport { manifestService } from './bungie/manifest.service';\r\nimport type { ChampionType } from './activity.service';\r\nimport { debugLog } from '../utils/logger';\r\n\r\nexport interface ArtifactPerk {\r\n    hash: number;\r\n    name: string;\r\n    description: string;\r\n    icon?: string;\r\n    isActive: boolean;\r\n}\r\n\r\nexport interface AntiChampionMod {\r\n    hash: number;\r\n    name: string;\r\n    championType: ChampionType;\r\n    weaponTypes: string[];\r\n    icon?: string;\r\n}\r\n\r\n// Keywords for detecting anti-champion mods and weapon types\r\nconst ANTI_CHAMPION_PATTERNS: Record<ChampionType, RegExp> = {\r\n    barrier: /anti[- ]?barrier|pierce[s]? barrier/i,\r\n    overload: /overload|disrupts? overload/i,\r\n    unstoppable: /unstoppable|stagger[s]? unstoppable/i,\r\n};\r\n\r\n// Weapon type keywords to extract from mod descriptions\r\nconst WEAPON_TYPE_KEYWORDS = [\r\n    'auto rifle', 'auto rifles',\r\n    'scout rifle', 'scout rifles',\r\n    'pulse rifle', 'pulse rifles',\r\n    'hand cannon', 'hand cannons',\r\n    'submachine gun', 'submachine guns', 'smg', 'smgs',\r\n    'sidearm', 'sidearms',\r\n    'bow', 'bows',\r\n    'sniper rifle', 'sniper rifles', 'sniper',\r\n    'shotgun', 'shotguns',\r\n    'fusion rifle', 'fusion rifles',\r\n    'linear fusion rifle', 'linear fusion rifles', 'linear fusion', 'lfr',\r\n    'trace rifle', 'trace rifles',\r\n    'grenade launcher', 'grenade launchers', 'gl',\r\n    'rocket launcher', 'rocket launchers', 'rockets',\r\n    'sword', 'swords',\r\n    'machine gun', 'machine guns', 'lmg',\r\n    'glaive', 'glaives',\r\n    // Ability-based anti-champion sources\r\n    'kinetic', 'melee', 'finisher', 'grenade',\r\n];\r\n\r\n// Normalize weapon types to canonical names (include BOTH singular and plural)\r\nconst WEAPON_TYPE_NORMALIZE: Record<string, string> = {\r\n    // Singular forms\r\n    'auto rifle': 'Auto Rifle',\r\n    'scout rifle': 'Scout Rifle',\r\n    'pulse rifle': 'Pulse Rifle',\r\n    'hand cannon': 'Hand Cannon',\r\n    'submachine gun': 'SMG',\r\n    'sidearm': 'Sidearm',\r\n    'bow': 'Bow',\r\n    'sniper rifle': 'Sniper Rifle',\r\n    'sniper': 'Sniper Rifle',\r\n    'shotgun': 'Shotgun',\r\n    'fusion rifle': 'Fusion Rifle',\r\n    'linear fusion rifle': 'Linear Fusion Rifle',\r\n    'trace rifle': 'Trace Rifle',\r\n    'grenade launcher': 'Grenade Launcher',\r\n    'rocket launcher': 'Rocket Launcher',\r\n    'sword': 'Sword',\r\n    'machine gun': 'Machine Gun',\r\n    'glaive': 'Glaive',\r\n    // Plural forms\r\n    'auto rifles': 'Auto Rifle',\r\n    'scout rifles': 'Scout Rifle',\r\n    'pulse rifles': 'Pulse Rifle',\r\n    'hand cannons': 'Hand Cannon',\r\n    'submachine guns': 'SMG',\r\n    'smg': 'SMG',\r\n    'smgs': 'SMG',\r\n    'sidearms': 'Sidearm',\r\n    'bows': 'Bow',\r\n    'sniper rifles': 'Sniper Rifle',\r\n    'shotguns': 'Shotgun',\r\n    'fusion rifles': 'Fusion Rifle',\r\n    'linear fusion rifles': 'Linear Fusion Rifle',\r\n    'linear fusion': 'Linear Fusion Rifle',\r\n    'lfr': 'Linear Fusion Rifle',\r\n    'trace rifles': 'Trace Rifle',\r\n    'grenade launchers': 'Grenade Launcher',\r\n    'gl': 'Grenade Launcher',\r\n    'rocket launchers': 'Rocket Launcher',\r\n    'rockets': 'Rocket Launcher',\r\n    'swords': 'Sword',\r\n    'machine guns': 'Machine Gun',\r\n    'lmg': 'Machine Gun',\r\n    'glaives': 'Glaive',\r\n    // Ability-based\r\n    'kinetic': 'Kinetic Weapons/Abilities',\r\n    'melee': 'Melee Abilities',\r\n    'finisher': 'Finishers',\r\n    'grenade': 'Grenade Abilities',\r\n};\r\n\r\nclass ArtifactService {\r\n    /**\r\n     * Get all active artifact perks for the current character\r\n     */\r\n    getActiveArtifactPerks(): ArtifactPerk[] {\r\n        const store = useProfileStore.getState();\r\n        const selectedCharacterId = store.selectedCharacterId;\r\n        const progressions = store.characterProgressions;\r\n\r\n        if (!selectedCharacterId || !progressions?.[selectedCharacterId]) {\r\n            debugLog('Artifact', 'No selected character or progressions found');\r\n            return [];\r\n        }\r\n\r\n        const seasonalArtifact = progressions[selectedCharacterId]?.seasonalArtifact;\r\n        if (!seasonalArtifact?.tiers) {\r\n            debugLog('Artifact', 'No seasonal artifact data found');\r\n            return [];\r\n        }\r\n\r\n        const activePerks: ArtifactPerk[] = [];\r\n\r\n        for (const tier of seasonalArtifact.tiers) {\r\n            for (const item of tier.items) {\r\n                if (item.isActive) {\r\n                    // Use getFullDefinition for proper type handling\r\n                    const perkDef = manifestService.getFullDefinition(item.itemHash);\r\n                    if (perkDef?.name) {\r\n                        activePerks.push({\r\n                            hash: item.itemHash,\r\n                            name: perkDef.name || 'Unknown Perk',\r\n                            description: perkDef.description || '',\r\n                            icon: perkDef.icon,\r\n                            isActive: true,\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return activePerks;\r\n    }\r\n\r\n    /**\r\n     * Get anti-champion mods from active artifact perks\r\n     */\r\n    getAntiChampionMods(): AntiChampionMod[] {\r\n        const activePerks = this.getActiveArtifactPerks();\r\n        const antiChampionMods: AntiChampionMod[] = [];\r\n\r\n        for (const perk of activePerks) {\r\n            const searchText = `${perk.name} ${perk.description}`;\r\n\r\n            // Check which champion type this mod targets\r\n            for (const [championType, pattern] of Object.entries(ANTI_CHAMPION_PATTERNS)) {\r\n                if (pattern.test(searchText)) {\r\n                    const weaponTypes = this.extractWeaponTypes(searchText);\r\n\r\n                    antiChampionMods.push({\r\n                        hash: perk.hash,\r\n                        name: perk.name,\r\n                        championType: championType as ChampionType,\r\n                        weaponTypes,\r\n                        icon: perk.icon,\r\n                    });\r\n                    break; // A mod typically only targets one champion type\r\n                }\r\n            }\r\n        }\r\n\r\n        return antiChampionMods;\r\n    }\r\n\r\n    /**\r\n     * Extract weapon types mentioned in a mod description\r\n     */\r\n    private extractWeaponTypes(text: string): string[] {\r\n        const lowerText = text.toLowerCase();\r\n        const foundTypes: Set<string> = new Set();\r\n\r\n        for (const keyword of WEAPON_TYPE_KEYWORDS) {\r\n            if (lowerText.includes(keyword)) {\r\n                const normalized = WEAPON_TYPE_NORMALIZE[keyword] ||\r\n                    keyword.charAt(0).toUpperCase() + keyword.slice(1);\r\n                foundTypes.add(normalized);\r\n            }\r\n        }\r\n\r\n        return Array.from(foundTypes);\r\n    }\r\n\r\n    /**\r\n     * Get recommended weapon types for specific champion types\r\n     */\r\n    getRecommendedWeapons(championTypes: ChampionType[]): Map<ChampionType, string[]> {\r\n        const antiChampionMods = this.getAntiChampionMods();\r\n        const recommendations = new Map<ChampionType, string[]>();\r\n\r\n        for (const championType of championTypes) {\r\n            const relevantMods = antiChampionMods.filter(mod => mod.championType === championType);\r\n            const weaponTypes = relevantMods.flatMap(mod => mod.weaponTypes);\r\n\r\n            // Deduplicate\r\n            const uniqueWeapons = Array.from(new Set(weaponTypes));\r\n            recommendations.set(championType, uniqueWeapons);\r\n        }\r\n\r\n        return recommendations;\r\n    }\r\n\r\n    /**\r\n     * Format anti-champion mods for display\r\n     */\r\n    formatAntiChampionMods(mods: AntiChampionMod[]): string {\r\n        if (mods.length === 0) {\r\n            return 'No anti-champion mods unlocked in your artifact.';\r\n        }\r\n\r\n        return mods\r\n            .map(mod => {\r\n                const weapons = mod.weaponTypes.length > 0\r\n                    ? mod.weaponTypes.join(', ')\r\n                    : 'Unknown weapons';\r\n                return `${mod.championType.charAt(0).toUpperCase() + mod.championType.slice(1)}: ${mod.name} (${weapons})`;\r\n            })\r\n            .join('\\n');\r\n    }\r\n\r\n    /**\r\n     * Get champion icon URLs for display\r\n     */\r\n    getChampionIcons(): Record<ChampionType, string | undefined> {\r\n        return {\r\n            barrier: manifestService.getChampionIcon('barrier'),\r\n            overload: manifestService.getChampionIcon('overload'),\r\n            unstoppable: manifestService.getChampionIcon('unstoppable'),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Format mods with icon URLs included in the response\r\n     */\r\n    formatAntiChampionModsWithIcons(mods: AntiChampionMod[]): Array<{\r\n        championType: ChampionType;\r\n        name: string;\r\n        weapons: string;\r\n        icon?: string;\r\n    }> {\r\n        const icons = this.getChampionIcons();\r\n\r\n        return mods.map(mod => ({\r\n            championType: mod.championType,\r\n            name: mod.name,\r\n            weapons: mod.weaponTypes.length > 0 ? mod.weaponTypes.join(', ') : 'Unknown',\r\n            icon: icons[mod.championType]\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Check if player has a mod to counter a specific champion type\r\n     */\r\n    hasModFor(championType: ChampionType): boolean {\r\n        const mods = this.getAntiChampionMods();\r\n        return mods.some(mod => mod.championType === championType);\r\n    }\r\n\r\n    /**\r\n     * Get missing champion coverage\r\n     */\r\n    getMissingCoverage(requiredChampions: ChampionType[]): ChampionType[] {\r\n        return requiredChampions.filter(c => !this.hasModFor(c));\r\n    }\r\n}\r\n\r\nexport const artifactService = new ArtifactService();\r\n","import { useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { useProfileStore } from '../../store';\r\nimport { manifestService } from '../../services/bungie/manifest.service';\r\nimport { getBungieUrl } from '../../utils/url-helper';\r\nimport './TransferMenu.css';\r\n\r\ninterface TransferMenuProps {\r\n    targetElement: HTMLElement | null;\r\n    onTransfer: (characterId: string) => void;\r\n    onEquip: (characterId: string) => void;\r\n    onClose: () => void;\r\n    showVault?: boolean;\r\n    itemInstanceId?: string;\r\n    itemClass?: number;\r\n}\r\n\r\nconst CLASS_NAMES: Record<number, string> = {\r\n    0: 'Titan',\r\n    1: 'Hunter',\r\n    2: 'Warlock',\r\n};\r\n\r\nexport function TransferMenu({ targetElement, onTransfer, onEquip, onClose, showVault = true, itemInstanceId, itemClass }: TransferMenuProps) {\r\n    const { characters, selectedCharacterId, characterEquipment } = useProfileStore();\r\n    const [hoveredCharacterId, setHoveredCharacterId] = useState<string | null>(null);\r\n    const [tooltipText, setTooltipText] = useState<string | null>(null);\r\n    const [tooltipPosition, setTooltipPosition] = useState<{ x: number; y: number } | null>(null);\r\n\r\n    if (!targetElement) {\r\n        return null;\r\n    }\r\n\r\n    const rect = targetElement.getBoundingClientRect();\r\n\r\n    // Position menu to the top-right of the tooltip\r\n    const menuStyle: React.CSSProperties = {\r\n        position: 'fixed',\r\n        top: `${rect.top}px`,\r\n        left: `${rect.right + 16}px`, // 16px gap from tooltip\r\n        zIndex: 100000,\r\n    };\r\n\r\n    const handleCharacterClick = (characterId: string) => {\r\n        onTransfer(characterId);\r\n        onClose();\r\n    };\r\n\r\n    const handleMouseEnterCharacter = (characterId: string, text: string, e: React.MouseEvent) => {\r\n        setHoveredCharacterId(characterId);\r\n        setTooltipText(text);\r\n        const rect = (e.currentTarget as HTMLElement).getBoundingClientRect();\r\n        setTooltipPosition({\r\n            x: rect.left + rect.width / 2,\r\n            y: rect.bottom + 8\r\n        });\r\n    };\r\n\r\n    const handleMouseLeaveCharacter = () => {\r\n        setHoveredCharacterId(null);\r\n        setTooltipText(null);\r\n        setTooltipPosition(null);\r\n    };\r\n\r\n\r\n    return createPortal(\r\n        <div className=\"transfer-menu-overlay\">\r\n            <div\r\n                className=\"transfer-menu-container\"\r\n                style={menuStyle}\r\n            >\r\n                {/* Connecting Line */}\r\n                <svg\r\n                    className=\"transfer-menu-connector\"\r\n                    width=\"16\"\r\n                    height=\"100%\"\r\n                    style={{\r\n                        position: 'absolute',\r\n                        left: '-16px',\r\n                        top: 0,\r\n                        pointerEvents: 'none',\r\n                    }}\r\n                >\r\n                    <line\r\n                        x1=\"0\"\r\n                        y1=\"24\"\r\n                        x2=\"16\"\r\n                        y2=\"24\"\r\n                        stroke=\"rgba(255, 255, 255, 0.2)\"\r\n                        strokeWidth=\"1\"\r\n                    />\r\n                </svg>\r\n\r\n                <div className=\"transfer-menu-wrapper\">\r\n                    <div className=\"transfer-menu-header\">\r\n                        <h3>SEND TO</h3>\r\n                    </div>\r\n\r\n                    <div className=\"transfer-menu-body\">\r\n                        {characters.map((character) => {\r\n                            const isSelected = character.characterId === selectedCharacterId;\r\n                            const isHovered = hoveredCharacterId === `transfer-${character.characterId}`;\r\n                            const className = CLASS_NAMES[character.classType] || 'Guardian';\r\n                            const tooltipLabel = `${className} - Power ${character.light || '---'}${isSelected ? ' (Current)' : ''}`;\r\n\r\n                            return (\r\n                                <div\r\n                                    key={character.characterId}\r\n                                    className={`transfer-menu-character ${isSelected ? 'selected' : ''} ${isHovered ? 'hovered' : ''}`}\r\n                                    onClick={() => handleCharacterClick(character.characterId)}\r\n                                    onMouseEnter={(e) => handleMouseEnterCharacter(`transfer-${character.characterId}`, tooltipLabel, e)}\r\n                                    onMouseLeave={handleMouseLeaveCharacter}\r\n                                >\r\n                                    <div className={`transfer-menu-character-icon transfer-menu-character-icon--${className.toLowerCase()}`}>\r\n                                        <img\r\n                                            src={getBungieUrl(manifestService.getClassIcon(character.classType))}\r\n                                            alt={className}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n\r\n                        {showVault && (\r\n                            <div\r\n                                className={`transfer-menu-character ${hoveredCharacterId === 'vault' ? 'hovered' : ''}`}\r\n                                onClick={() => handleCharacterClick('vault')}\r\n                                onMouseEnter={(e) => handleMouseEnterCharacter('vault', 'Vault', e)}\r\n                                onMouseLeave={handleMouseLeaveCharacter}\r\n                            >\r\n                                <div className=\"transfer-menu-character-icon transfer-menu-character-icon--vault\">\r\n                                    V\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"transfer-menu-header\" style={{ marginTop: '12px' }}>\r\n                        <h3>EQUIP</h3>\r\n                    </div>\r\n\r\n                    <div className=\"transfer-menu-body\">\r\n                        {characters.filter(c => itemClass === 3 || itemClass === undefined || c.classType === itemClass).map((character) => {\r\n                            const isSelected = character.characterId === selectedCharacterId;\r\n                            const isEquipped = itemInstanceId ? characterEquipment[character.characterId]?.some(i => i.itemInstanceId === itemInstanceId) : false;\r\n                            const isHovered = hoveredCharacterId === `equip-${character.characterId}`;\r\n                            const className = CLASS_NAMES[character.classType] || 'Guardian';\r\n                            const tooltipLabel = isEquipped ? `${className} - Already Equipped` : `Equip on ${className}`;\r\n\r\n                            return (\r\n                                <div\r\n                                    key={character.characterId}\r\n                                    className={`transfer-menu-character ${isSelected ? 'selected' : ''} ${isEquipped ? 'active' : ''} ${isHovered ? 'hovered' : ''}`}\r\n                                    onClick={() => {\r\n                                        if (!isEquipped) {\r\n                                            onEquip(character.characterId);\r\n                                        }\r\n                                        onClose();\r\n                                    }}\r\n                                    onMouseEnter={(e) => handleMouseEnterCharacter(`equip-${character.characterId}`, tooltipLabel, e)}\r\n                                    onMouseLeave={handleMouseLeaveCharacter}\r\n                                >\r\n                                    <div className={`transfer-menu-character-icon transfer-menu-character-icon--${className.toLowerCase()}`}>\r\n                                        <img\r\n                                            src={getBungieUrl(manifestService.getClassIcon(character.classType))}\r\n                                            alt={className}\r\n                                        />\r\n                                    </div>\r\n                                    {isEquipped && <div className=\"transfer-menu-equipped-indicator\" title=\"Already Equipped\">E</div>}\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Plain text tooltip */}\r\n            {tooltipText && tooltipPosition && (\r\n                <div\r\n                    className=\"transfer-menu-plain-tooltip\"\r\n                    style={{\r\n                        position: 'fixed',\r\n                        left: `${tooltipPosition.x}px`,\r\n                        top: `${tooltipPosition.y}px`,\r\n                        transform: 'translateX(-50%)',\r\n                        color: 'white',\r\n                        fontSize: '12px',\r\n                        fontWeight: 400,\r\n                        whiteSpace: 'nowrap',\r\n                        pointerEvents: 'none',\r\n                        zIndex: 100001,\r\n                        textShadow: '0 1px 3px rgba(0, 0, 0, 0.8)'\r\n                    }}\r\n                >\r\n                    {tooltipText}\r\n                </div>\r\n            )}\r\n        </div>,\r\n        document.body\r\n    );\r\n}\r\n","import React, { useState, useRef, useEffect } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport './SimpleTooltip.css';\r\n\r\ninterface SimpleTooltipProps {\r\n  text: string;\r\n  children: React.ReactElement;\r\n  delay?: number;\r\n  position?: 'top' | 'bottom' | 'left' | 'right';\r\n}\r\n\r\n/**\r\n * Simple text-only tooltip replacement for browser's native title attribute\r\n * Styled with clean white text matching the Send To buttons\r\n */\r\nexport function SimpleTooltip({ text, children, delay = 500, position = 'top' }: SimpleTooltipProps) {\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [coords, setCoords] = useState({ x: 0, y: 0 });\r\n  const timeoutRef = useRef<number | null>(null);\r\n  const triggerRef = useRef<HTMLDivElement>(null);\r\n\r\n  const showTooltip = () => {\r\n    timeoutRef.current = window.setTimeout(() => {\r\n      if (triggerRef.current) {\r\n        const rect = triggerRef.current.getBoundingClientRect();\r\n        let x = rect.left + rect.width / 2;\r\n        let y = rect.top;\r\n\r\n        switch (position) {\r\n          case 'bottom':\r\n            y = rect.bottom;\r\n            break;\r\n          case 'left':\r\n            x = rect.left;\r\n            y = rect.top + rect.height / 2;\r\n            break;\r\n          case 'right':\r\n            x = rect.right;\r\n            y = rect.top + rect.height / 2;\r\n            break;\r\n          case 'top':\r\n          default:\r\n            y = rect.top;\r\n            break;\r\n        }\r\n\r\n        setCoords({ x, y });\r\n        setIsVisible(true);\r\n      }\r\n    }, delay);\r\n  };\r\n\r\n  const hideTooltip = () => {\r\n    if (timeoutRef.current) {\r\n      clearTimeout(timeoutRef.current);\r\n      timeoutRef.current = null;\r\n    }\r\n    setIsVisible(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Clone the child element and add mouse event handlers\r\n  const childWithHandlers = React.cloneElement(children as React.ReactElement<any>, {\r\n    onMouseEnter: (e: React.MouseEvent) => {\r\n      showTooltip();\r\n      if ((children as any).props?.onMouseEnter) {\r\n        (children as any).props.onMouseEnter(e);\r\n      }\r\n    },\r\n    onMouseLeave: (e: React.MouseEvent) => {\r\n      hideTooltip();\r\n      if ((children as any).props?.onMouseLeave) {\r\n        (children as any).props.onMouseLeave(e);\r\n      }\r\n    },\r\n  });\r\n\r\n\r\n  return (\r\n    <>\r\n      {childWithHandlers}\r\n      {isVisible && text && createPortal(\r\n        <div\r\n          className={`simple-tooltip simple-tooltip--${position}`}\r\n          style={{\r\n            left: `${coords.x}px`,\r\n            top: `${coords.y}px`,\r\n          }}\r\n        >\r\n          {text}\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </>\r\n  );\r\n}\r\n","import { useMemo, useEffect, useRef, useState, type CSSProperties, memo } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { useLocation } from 'react-router-dom';\r\nimport DOMPurify from 'dompurify';\r\nimport { manifestService } from '../../services/bungie/manifest.service';\r\nimport { clarityService } from '../../services/bungie/clarity.service';\r\n\r\nimport { useManifestStore, useProfileStore } from '../../store';\r\nimport { getBungieUrl } from '../../utils/url-helper';\r\nimport { artifactService } from '../../services/artifact.service';\r\nimport MouseLeftIcon from '../../assets/mouse-left-plain.png';\r\nimport MouseRightIcon from '../../assets/mouse-right-plain.png';\r\nimport { TransferMenu } from './TransferMenu';\r\nimport { transferService } from '../../services/bungie/transfer.service';\r\nimport './RichTooltip.css';\r\nimport { SimpleTooltip } from '../common/SimpleTooltip';\r\n\r\nconst LockIcon = ({ size = 22 }: { size?: number }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#000000\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" style={{ display: 'block' }}>\r\n        {/* Lock body with keyhole */}\r\n        <rect className=\"lock-body\" x=\"5\" y=\"11\" width=\"14\" height=\"10\" rx=\"2\" ry=\"2\" fill=\"#000000\" />\r\n        {/* Shackle - closed position */}\r\n        <path className=\"lock-shackle\" d=\"M8 11V7a4 4 0 0 1 8 0v4\" stroke=\"#000000\" strokeWidth=\"2.5\" fill=\"none\" />\r\n        {/* Keyhole */}\r\n        <circle cx=\"12\" cy=\"15\" r=\"1.5\" fill=\"#ffffff\" />\r\n        <path d=\"M12 16.5v1.5\" stroke=\"#ffffff\" strokeWidth=\"1.5\" />\r\n    </svg>\r\n);\r\n\r\nconst UnlockIcon = ({ size = 22 }: { size?: number }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#000000\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" style={{ display: 'block' }}>\r\n        {/* Lock body with keyhole */}\r\n        <rect className=\"lock-body\" x=\"5\" y=\"11\" width=\"14\" height=\"10\" rx=\"2\" ry=\"2\" fill=\"#000000\" />\r\n        {/* Shackle - open position (rotated to the right) */}\r\n        <path className=\"lock-shackle\" d=\"M8 11V7a4 4 0 0 1 8 0v1\" stroke=\"#000000\" strokeWidth=\"2.5\" fill=\"none\" />\r\n        {/* Keyhole */}\r\n        <circle cx=\"12\" cy=\"15\" r=\"1.5\" fill=\"#ffffff\" />\r\n        <path d=\"M12 16.5v1.5\" stroke=\"#ffffff\" strokeWidth=\"1.5\" />\r\n    </svg>\r\n);\r\n\r\ninterface RichTooltipProps {\r\n    item: any;\r\n    instance?: any;\r\n    characterStats?: any;\r\n    isEquipped?: boolean;\r\n    overrideElement?: 'void' | 'solar' | 'arc' | 'stasis' | 'strand' | 'prismatic';\r\n    inline?: boolean;\r\n    followMouse?: boolean;\r\n    fixedPosition?: { x: number; y: number };\r\n    isFocused?: boolean; // True when zoomed in on the item\r\n    onTransfer?: (characterId: string) => void; // Callback for transfer action\r\n    onEquip?: (characterId: string) => void; // Callback for equip action\r\n    externalShowTransferMenu?: boolean; // External control for showing transfer menu\r\n    onClick?: () => void; // Generic click handler (used for synergy confirm)\r\n    hideZoomButtons?: boolean; // Hide the zoom in/out buttons\r\n    hideStats?: boolean; // New prop to hide investment/character stats\r\n    clickActionLabel?: string; // Custom label for the left-click action (e.g. \"Confirm Synergy\")\r\n    hideSynergizeAction?: boolean; // Hide the right-click synergize action\r\n    onRightClick?: () => void; // Right-click handler (used for synergize)\r\n}\r\n\r\n// Stat Hash Mappings\r\nconst ARMOR_STAT_MAP: Record<number, string> = {\r\n    392767087: 'Health',\r\n    4244567218: 'Melee',\r\n    1735777505: 'Grenade',\r\n    144602215: 'Super',\r\n    1943323491: 'Class',\r\n    2996146975: 'Weapons',\r\n};\r\n\r\nconst WEAPON_STAT_PRIORITY = [\r\n    4043523819, // Impact\r\n    3614673599, // Blast Radius\r\n    2523465841, // Velocity\r\n    1240592695, // Range\r\n    155624089,  // Stability\r\n    943549884,  // Handling\r\n    4188031367, // Reload Speed\r\n    1345609583, // Aim Assist\r\n    3555269338, // Zoom\r\n    2714457168, // Airborne Effectiveness\r\n    2715839340, // Recoil Direction\r\n    4284893193, // Rounds Per Minute\r\n    3871231066, // Magazine\r\n    447667954,  // Draw Time\r\n    2961396640, // Charge Time\r\n    2837207746, // Swing Speed\r\n    2762071195, // Guard Efficiency\r\n    209426660,  // Guard Resistance\r\n    3736848092, // Guard Endurance\r\n    3022301683, // Charge Rate\r\n    925767036,  // Ammo Capacity\r\n    1480404414, // Attack (if present)\r\n];\r\n\r\n\r\n\r\nconst WEAPON_STAT_MAP: Record<number, string> = {\r\n    4043523819: 'impact',\r\n    1240592695: 'range',\r\n    155624089: 'stability',\r\n    943549884: 'handling',\r\n    4188031367: 'reloadSpeed',\r\n    1345609583: 'aimAssist',\r\n    3555269338: 'zoom',\r\n    2714457168: 'airborne',\r\n    2715839340: 'recoilDirection',\r\n    4284893193: 'rpm',\r\n    3871231066: 'magazine',\r\n    447667954: 'drawTime',\r\n    2961396640: 'chargeTime',\r\n    3614673599: 'blastRadius',\r\n    2523465841: 'velocity',\r\n    2837207746: 'swingSpeed',\r\n    2762071195: 'guardEfficiency',\r\n    209426660: 'guardResistance',\r\n    3736848092: 'guardEndurance',\r\n    3022301683: 'chargeRate',\r\n    925767036: 'ammoCapacity',\r\n};\r\n\r\n// Stats that should ONLY be numeric (no bars)\r\nconst NUMERIC_ONLY_STATS = [\r\n    3555269338, // Zoom\r\n    4284893193, // Rounds Per Minute\r\n    2715839340, // Recoil Direction\r\n    3871231066, // Magazine\r\n    447667954,  // Draw Time\r\n    2961396640, // Charge Time\r\n];\r\n\r\n\r\nconst formatDescription = (description?: string) => {\r\n    if (!description) return null;\r\n    return description.split('\\n').map((line, i) => {\r\n        const trimmed = line.trim();\r\n        if (trimmed.startsWith('•')) {\r\n            return (\r\n                <div key={i} className=\"rich-tooltip-description-bullet\">\r\n                    <span className=\"bullet-char\">•</span>\r\n                    <span className=\"bullet-content\">{trimmed.substring(1).trim()}</span>\r\n                </div>\r\n            );\r\n        }\r\n        return <div key={i} className=\"rich-tooltip-description-line\">{line}</div>;\r\n    });\r\n};\r\n\r\nexport const RichTooltip = memo(function RichTooltip({\r\n    item,\r\n    instance,\r\n    characterStats,\r\n    overrideElement,\r\n    inline = false,\r\n    followMouse = true,\r\n    fixedPosition,\r\n    isFocused = false,\r\n    onTransfer,\r\n    onEquip,\r\n    externalShowTransferMenu = false,\r\n    onClick,\r\n    hideZoomButtons = false,\r\n    hideStats = false,\r\n    clickActionLabel,\r\n    hideSynergizeAction = false,\r\n    onRightClick,\r\n}: RichTooltipProps) {\r\n    const { isLoaded: manifestLoaded } = useManifestStore();\r\n    const location = useLocation();\r\n    const isLoadoutViewer = location.pathname.includes('/dim-loadout') ||\r\n        location.pathname.includes('/loadout-viewer') ||\r\n        location.pathname.includes('/loadout/') ||\r\n        location.pathname.includes('/builds') ||\r\n        location.pathname.includes('/saved-builds') ||\r\n        location.pathname.includes('/optimizer');\r\n    const isGalaxyView = location.pathname.includes('/builder') || location.pathname.includes('/galaxy');\r\n    const tooltipRef = useRef<HTMLDivElement>(null);\r\n    const [showTransferMenu, setShowTransferMenu] = useState(false);\r\n    const [lockAnimating, setLockAnimating] = useState<'locking' | 'unlocking' | null>(null);\r\n    const [style, setStyle] = useState<CSSProperties>({\r\n        position: 'fixed',\r\n        transition: 'opacity 0.05s ease-out',\r\n        opacity: 0,\r\n        minWidth: '320px',\r\n        pointerEvents: 'none', // Start with none to prevent accidental interactions\r\n        left: '-1000px', // Start off-screen\r\n        top: '-1000px'\r\n    });\r\n\r\n    // Open transfer menu when externally triggered\r\n    useEffect(() => {\r\n        if (externalShowTransferMenu) {\r\n            setShowTransferMenu(true);\r\n        }\r\n    }, [externalShowTransferMenu]);\r\n\r\n    // Close transfer menu when clicking outside\r\n    useEffect(() => {\r\n        if (!showTransferMenu) return;\r\n\r\n        const handleOutsideClick = (e: MouseEvent) => {\r\n            const target = e.target as HTMLElement;\r\n            // Don't close if clicking on the menu itself or the lock icon\r\n            if (!target.closest('.transfer-menu-container') && !target.closest('.rich-tooltip-lock-icon')) {\r\n                setShowTransferMenu(false);\r\n            }\r\n        };\r\n\r\n        // Add slight delay to avoid closing immediately\r\n        const timeoutId = setTimeout(() => {\r\n            document.addEventListener('click', handleOutsideClick);\r\n        }, 100);\r\n\r\n        return () => {\r\n            clearTimeout(timeoutId);\r\n            document.removeEventListener('click', handleOutsideClick);\r\n        };\r\n    }, [showTransferMenu]);\r\n\r\n    const def = useMemo(() => {\r\n        if (!manifestLoaded) {\r\n            return;\r\n        }\r\n        const hash = item?.itemHash || item?.hash;\r\n        const result = hash ? manifestService.getItem(hash) : undefined;\r\n        return result;\r\n    }, [item, manifestLoaded]);\r\n\r\n    // DIM Standard: Community Description Integration\r\n    const clarityData = useMemo(() => {\r\n        if (!def) return null;\r\n\r\n        // 1. Get description for the item itself (e.g. Exotic Intrinsic)\r\n        const itemDesc = clarityService.getRichData(def.hash);\r\n\r\n        // 2. Get descriptions for key plugs (traits/perks)\r\n        const perkDescs: Record<number, any> = {};\r\n        if (instance?.sockets) {\r\n            instance.sockets.forEach((s: any) => {\r\n                if (s.plugHash) {\r\n                    const data = clarityService.getRichData(s.plugHash);\r\n                    if (data) perkDescs[s.plugHash] = data;\r\n                }\r\n            });\r\n        }\r\n\r\n        return { itemDesc, perkDescs };\r\n    }, [def, instance]);\r\n\r\n    // Log when component renders (only when focused with transfer capability)\r\n    useEffect(() => {\r\n        if (isFocused && onTransfer) {\r\n        }\r\n    }, [isFocused, onTransfer, item, def]);\r\n\r\n    useEffect(() => {\r\n        if (inline || !followMouse) {\r\n            if (fixedPosition) {\r\n                setStyle(prev => ({\r\n                    ...prev,\r\n                    position: 'fixed',\r\n                    left: `${fixedPosition.x}px`,\r\n                    top: `${fixedPosition.y}px`,\r\n                    opacity: 1\r\n                }));\r\n            } else if (inline) {\r\n                setStyle(prev => ({\r\n                    ...prev,\r\n                    position: 'relative',\r\n                    left: undefined,\r\n                    top: undefined,\r\n                    opacity: 1,\r\n                    zIndex: 1\r\n                }));\r\n            } else {\r\n                // If not inline and no fixed position, but followMouse is false,\r\n                // we assume it's being positioned by a parent (like TooltipManager).\r\n                // We must set opacity to 1 and position to relative so it fits the parent.\r\n                setStyle(prev => ({\r\n                    ...prev,\r\n                    position: 'relative',\r\n                    opacity: 1,\r\n                    zIndex: 1 // Lower z-index for inline/contained tooltips\r\n                }));\r\n            }\r\n            return;\r\n        }\r\n\r\n        let initialPositionSet = false;\r\n\r\n        const handleMouseMove = (e: MouseEvent) => {\r\n            if (!tooltipRef.current || !followMouse) return;\r\n\r\n            const paddingX = 25;\r\n            const paddingY = -25; // Shifted up\r\n            const minTopMargin = 180; // Keep tooltip below emblem area\r\n\r\n            const width = tooltipRef.current.offsetWidth;\r\n            const height = tooltipRef.current.offsetHeight;\r\n\r\n            let x = e.clientX + paddingX;\r\n            // Always start below the emblem area\r\n            let y = Math.max(minTopMargin, e.clientY + paddingY);\r\n\r\n            if (x + width > window.innerWidth - 20) {\r\n                x = e.clientX - width - paddingX;\r\n            }\r\n\r\n            // If tooltip would go below screen, clamp it (never flip above minTopMargin)\r\n            if (y + height > window.innerHeight - 150) {\r\n                y = window.innerHeight - height - 150;\r\n            }\r\n\r\n            x = Math.max(10, x);\r\n            // Final clamp - ALWAYS stay below minTopMargin\r\n            y = Math.max(minTopMargin, y);\r\n\r\n            if (tooltipRef.current) {\r\n                tooltipRef.current.style.left = `${x}px`;\r\n                tooltipRef.current.style.top = `${y}px`;\r\n                tooltipRef.current.style.opacity = '1';\r\n                tooltipRef.current.style.pointerEvents = isFocused ? 'auto' : 'none';\r\n                tooltipRef.current.style.cursor = (isFocused && onTransfer) ? 'pointer' : 'default';\r\n            }\r\n\r\n            initialPositionSet = true;\r\n        };\r\n\r\n        // Capture current mouse position and show tooltip immediately\r\n        const setInitialPosition = () => {\r\n            if (!tooltipRef.current || initialPositionSet) return;\r\n\r\n            // Get current mouse position from document\r\n            const mouseX = (window as any).mouseX || window.innerWidth / 2;\r\n            const mouseY = (window as any).mouseY || window.innerHeight / 2;\r\n\r\n            handleMouseMove(new MouseEvent('mousemove', {\r\n                clientX: mouseX,\r\n                clientY: mouseY\r\n            }));\r\n        };\r\n\r\n        // Set position immediately with minimal delay\r\n        setInitialPosition();\r\n        requestAnimationFrame(setInitialPosition);\r\n\r\n        // Track global mouse position\r\n        const trackMouse = (e: MouseEvent) => {\r\n            (window as any).mouseX = e.clientX;\r\n            (window as any).mouseY = e.clientY;\r\n        };\r\n\r\n        window.addEventListener('mousemove', handleMouseMove);\r\n        window.addEventListener('mousemove', trackMouse);\r\n\r\n        return () => {\r\n            window.removeEventListener('mousemove', handleMouseMove);\r\n            window.removeEventListener('mousemove', trackMouse);\r\n        };\r\n    }, [fixedPosition, followMouse, inline, isFocused]);\r\n\r\n    // HOOKS MUST BE AT THE TOP\r\n    const isWeapon = def?.itemType === 3;\r\n    const isMod = def?.itemType === 19 || def?.itemType === 24;\r\n    const tier = def?.inventory?.tierType === 6 ? 'exotic' :\r\n        def?.inventory?.tierType === 5 ? 'legendary' :\r\n            def?.inventory?.tierType === 4 ? 'rare' : 'common';\r\n\r\n\r\n    const weaponSocketBonuses = useMemo(() => {\r\n        const bonuses: { yellow: Record<number, number>, red: Record<number, number> } = { yellow: {}, red: {} };\r\n        if (!def || !isWeapon || !instance?.sockets) return bonuses;\r\n\r\n        instance.sockets.forEach((s: any) => {\r\n            const plug = manifestService.getItem(s.plugHash);\r\n            if (!plug || !plug.investmentStats) return;\r\n\r\n            const category = plug.plug?.plugCategoryIdentifier?.toLowerCase() || '';\r\n            const name = plug.displayProperties?.name?.toLowerCase() || '';\r\n\r\n            const isMW = category.includes('masterworks') ||\r\n                category.includes('catalyst') ||\r\n                category.includes('exotic_masterwork') ||\r\n                name.includes('masterwork') ||\r\n                name.includes('catalyst');\r\n\r\n            plug.investmentStats.forEach((stat: any) => {\r\n                if (stat.value > 0) {\r\n                    if (isMW) {\r\n                        bonuses.yellow[stat.statTypeHash] = (bonuses.yellow[stat.statTypeHash] || 0) + stat.value;\r\n                    }\r\n                } else if (stat.value < 0) {\r\n                    bonuses.red[stat.statTypeHash] = (bonuses.red[stat.statTypeHash] || 0) + Math.abs(stat.value);\r\n                }\r\n            });\r\n        });\r\n        return bonuses;\r\n    }, [def, instance, isWeapon]);\r\n\r\n    const armorSocketBonuses = useMemo(() => {\r\n        const bonuses: { yellow: Record<number, number>, blue: Record<number, number>, red: Record<number, number> } = { yellow: {}, blue: {}, red: {} };\r\n        if (!def || isWeapon || !instance?.sockets) return bonuses;\r\n\r\n        const isMasterworked = !!(item?.state && (item.state & 4));\r\n\r\n        // 1. Standard Masterwork (+2 to all 6 core stats)\r\n        if (isMasterworked) {\r\n            Object.keys(ARMOR_STAT_MAP).forEach(hash => {\r\n                bonuses.yellow[Number(hash)] = 2;\r\n            });\r\n        }\r\n\r\n        instance.sockets.forEach((s: any) => {\r\n            const plug = manifestService.getItem(s.plugHash);\r\n            if (!plug || !plug.investmentStats) return;\r\n\r\n            const category = plug.plug?.plugCategoryIdentifier?.toLowerCase() || '';\r\n            // For exotic armor, socket 0, 1, 2, 3 are mods (blue), socket 11 is exotic intrinsic (yellow)\r\n            // For legendary armor, sockets 1, 2, 3, 11 are mods (blue)\r\n            const modSockets = tier === 'exotic' ? [0, 1, 2, 3] : [1, 2, 3, 11];\r\n            const isMod = category.includes('mod') || modSockets.includes(s.socketIndex);\r\n\r\n            // 2. Exotic Intrinsic Bonuses (Winter's Guile +30, etc) - Stays Yellow\r\n            // Socket 11 for exotic armor, socket 10 for other cases\r\n            const isExoticIntrinsic = tier === 'exotic' && (s.socketIndex === 10 || s.socketIndex === 11);\r\n\r\n            plug.investmentStats.forEach((stat: any) => {\r\n                if (stat.value > 0) {\r\n                    if (isExoticIntrinsic && stat.value > 2) {\r\n                        bonuses.yellow[stat.statTypeHash] = (bonuses.yellow[stat.statTypeHash] || 0) + stat.value;\r\n                    } else if (isMod) {\r\n                        bonuses.blue[stat.statTypeHash] = (bonuses.blue[stat.statTypeHash] || 0) + stat.value;\r\n                    }\r\n                } else if (stat.value < 0) {\r\n                    // Penalty (Tier 6 mods) - Stays Red\r\n                    bonuses.red[stat.statTypeHash] = (bonuses.red[stat.statTypeHash] || 0) + Math.abs(stat.value);\r\n                }\r\n            });\r\n        });\r\n\r\n        return bonuses;\r\n    }, [def, instance, isWeapon, tier, item?.state]);\r\n\r\n    // 3. Stats logic\r\n    const allStats = useMemo(() => {\r\n        if (!def) return [];\r\n        // Armor stats are in instance.stats (an object), weapon stats are in def.stats correctly handled by weaponStats mapping\r\n        const statsSource = isWeapon ? def.stats?.stats : (instance as any)?.stats;\r\n        if (!statsSource) return [];\r\n\r\n        let sourceEntries: any[];\r\n        if (isWeapon) {\r\n            sourceEntries = Object.entries(statsSource);\r\n        } else {\r\n            // Convert ArmorStats object { mobility, resilience, ... } to array of { statHash, value }\r\n            sourceEntries = [\r\n                { statHash: 2996146975, value: (statsSource as any).mobility },\r\n                { statHash: 392767087, value: (statsSource as any).resilience },\r\n                { statHash: 1943323491, value: (statsSource as any).recovery },\r\n                { statHash: 1735777505, value: (statsSource as any).discipline },\r\n                { statHash: 144602215, value: (statsSource as any).intellect },\r\n                { statHash: 4244567218, value: (statsSource as any).strength }\r\n            ];\r\n        }\r\n\r\n        return (sourceEntries as any[]).map((entry: any) => {\r\n            let hash: number;\r\n            let statDef: any;\r\n\r\n            if (isWeapon) {\r\n                hash = Number(entry[0]);\r\n                statDef = entry[1];\r\n            } else {\r\n                hash = entry.statHash;\r\n                statDef = entry;\r\n            }\r\n\r\n            const statInfo = manifestService.getStat(hash);\r\n            const isSword = def.itemSubType === 10 || def.itemTypeDisplayName?.toLowerCase().includes('sword');\r\n\r\n            if (!statInfo || !statInfo.name ||\r\n                (statInfo as any).hash === 1845991845 || // Power\r\n                (statInfo as any).hash === 1480404490 || // Power\r\n                (statInfo as any).hash === 3871231033 || // Attack\r\n                (statInfo as any).hash === 1935470627 || // Attack\r\n                statInfo.name.toLowerCase() === 'attack' ||\r\n                statInfo.name.toLowerCase() === 'power' ||\r\n                (isSword && (\r\n                    statInfo.name.toLowerCase() === 'stability' ||\r\n                    statInfo.name.toLowerCase() === 'guard efficiency' ||\r\n                    statInfo.name.toLowerCase() === 'ammo generation' ||\r\n                    (statInfo as any).hash === 155624089 || // Stability\r\n                    (statInfo as any).hash === 2762071195   // Guard Efficiency\r\n                ))\r\n            ) {\r\n                return null;\r\n            }\r\n\r\n            let totalValue = statDef.value;\r\n            if (instance) {\r\n                if (isWeapon && (instance as any).weaponStats) {\r\n                    const key = WEAPON_STAT_MAP[hash];\r\n                    if (key && (instance as any).weaponStats[key] !== undefined) {\r\n                        totalValue = (instance as any).weaponStats[key];\r\n                    }\r\n                }\r\n            }\r\n\r\n            const yellowVal = isWeapon ? (weaponSocketBonuses.yellow[hash] || 0) : (armorSocketBonuses.yellow[hash] || 0);\r\n            const blueVal = isWeapon ? 0 : (armorSocketBonuses.blue[hash] || 0);\r\n            const redVal = isWeapon ? (weaponSocketBonuses.red[hash] || 0) : (armorSocketBonuses.red[hash] || 0);\r\n\r\n            // Base = Total - Positive Bonuses\r\n            const whiteValue = Math.max(0, totalValue - yellowVal - blueVal);\r\n\r\n            return {\r\n                hash,\r\n                name: statInfo.name,\r\n                value: totalValue,\r\n                whiteValue,\r\n                yellowValue: yellowVal,\r\n                blueValue: blueVal,\r\n                redValue: redVal\r\n            };\r\n        }).filter(Boolean).sort((a: any, b: any) => {\r\n            if (isWeapon) {\r\n                const indexA = WEAPON_STAT_PRIORITY.indexOf(a.hash);\r\n                const indexB = WEAPON_STAT_PRIORITY.indexOf(b.hash);\r\n                if (indexA !== -1 && indexB !== -1) return indexA - indexB;\r\n                if (indexA !== -1) return -1;\r\n                if (indexB !== -1) return 1;\r\n            } else {\r\n                const armorOrder = [2996146975, 392767087, 1943323491, 1735777505, 144602215, 4244567218];\r\n                return armorOrder.indexOf(a.hash) - armorOrder.indexOf(b.hash);\r\n            }\r\n            return 0;\r\n        });\r\n    }, [def, instance, isWeapon, weaponSocketBonuses, armorSocketBonuses]);\r\n\r\n    const socketPlugs = useMemo(() => {\r\n        if (!def?.sockets?.socketEntries) return [];\r\n\r\n        return def.sockets.socketEntries.map((socket: any, index: number) => {\r\n            let activePlugHash = socket.singleInitialItemHash;\r\n            if (instance?.sockets) {\r\n                const instanceSocket = instance.sockets.find((s: any) => s.socketIndex === index);\r\n                if (instanceSocket?.plugHash) activePlugHash = instanceSocket.plugHash;\r\n            }\r\n            if (!activePlugHash) return null;\r\n\r\n            const plugDef = manifestService.getItem(activePlugHash);\r\n            if (!plugDef) return null;\r\n\r\n            return {\r\n                index,\r\n                hash: activePlugHash,\r\n                name: plugDef.displayProperties?.name,\r\n                icon: plugDef.displayProperties?.icon,\r\n                description: plugDef.displayProperties?.description,\r\n                investmentStats: plugDef.investmentStats,\r\n                plugCategoryIdentifier: plugDef.plug?.plugCategoryIdentifier,\r\n                isIntrinsic: index === 0, // Default assumption\r\n                isEnhanced: plugDef.plug?.plugCategoryIdentifier?.includes('enhanced') ||\r\n                    plugDef.displayProperties?.name?.toLowerCase().includes('enhanced') ||\r\n                    plugDef.inventory?.tierType === 6\r\n            };\r\n        }).filter(Boolean);\r\n    }, [def, instance]);\r\n\r\n    // Extract equipped mods for armor items (sockets that contain actual mods)\r\n    const armorModSockets = useMemo(() => {\r\n        if (!def || isWeapon || !instance?.sockets) return [];\r\n\r\n        // For exotic armor, mod slots are typically 0-3\r\n        // For legendary armor, mod slots are typically 1-3 and 11\r\n        const modSlotIndices = tier === 'exotic' ? [0, 1, 2, 3] : [1, 2, 3, 11];\r\n\r\n        return instance.sockets\r\n            .filter((s: any) => modSlotIndices.includes(s.socketIndex) && s.plugHash)\r\n            .map((s: any) => {\r\n                const plugDef = manifestService.getItem(s.plugHash);\r\n                if (!plugDef) return null;\r\n\r\n                const category = plugDef.plug?.plugCategoryIdentifier?.toLowerCase() || '';\r\n                const name = plugDef.displayProperties?.name || '';\r\n\r\n                // Skip empty mod slots and intrinsic perks\r\n                if (!name ||\r\n                    name.toLowerCase().includes('empty') ||\r\n                    category.includes('intrinsic') ||\r\n                    category.includes('armor_skins')) {\r\n                    return null;\r\n                }\r\n\r\n                // Only include actual mods (armor mods, general mods, etc.)\r\n                const isMod = category.includes('mod') ||\r\n                    category.includes('enhancements') ||\r\n                    plugDef.itemType === 19; // Mod item type\r\n\r\n                if (!isMod) return null;\r\n\r\n                return {\r\n                    socketIndex: s.socketIndex,\r\n                    hash: s.plugHash,\r\n                    name: name,\r\n                    icon: plugDef.displayProperties?.icon,\r\n                    description: plugDef.displayProperties?.description\r\n                };\r\n            })\r\n            .filter(Boolean);\r\n    }, [def, instance, isWeapon, tier]);\r\n\r\n    // CONDITIONAL RETURNS NOW GO HERE\r\n    if (!def) return null;\r\n\r\n    const plugCategory = def.plug?.plugCategoryIdentifier || '';\r\n    const isSubclassAbility = !!(\r\n        plugCategory &&\r\n        /super|grenade|melee|movement|class_abilities|aspects|fragments|facets|whisper/i.test(plugCategory)\r\n    ) || def.itemType === 20; // Removed itemType 19 (mods) from subclass ability check\r\n\r\n    const itemType = def.itemTypeDisplayName || 'Unknown';\r\n\r\n\r\n\r\n    // Render subclass tooltip for subclasses\r\n    if (def.itemType === 16) {\r\n        const element = getAbilityElement(def);\r\n        const icon = def.displayProperties?.icon ? getBungieUrl(def.displayProperties.icon) : null;\r\n        const name = def.displayProperties?.name || 'Unknown';\r\n        const typeDisplay = def.itemTypeDisplayName || 'Subclass';\r\n        const flavorText = def.displayProperties?.description;\r\n\r\n        // Find the Super in sockets\r\n        let superName = '';\r\n        let superDesc = '';\r\n        if (instance?.sockets) {\r\n            const superSocket = instance.sockets.find((s: any) => {\r\n                if (!s.plugHash) return false;\r\n                const plug = manifestService.getItem(s.plugHash);\r\n                return plug?.plug?.plugCategoryIdentifier?.toLowerCase().includes('super');\r\n            });\r\n            if (superSocket?.plugHash) {\r\n                const plug = manifestService.getItem(superSocket.plugHash);\r\n                superName = plug?.displayProperties?.name || '';\r\n                superDesc = plug?.displayProperties?.description || '';\r\n            }\r\n        }\r\n\r\n        // Stat mapping for the 6 core stats\r\n        const SUBCLASS_STAT_ORDER = [\r\n            { hash: 2996146975, name: 'Weapons' }, // Mobility\r\n            { hash: 392767087, name: 'Health' },  // Resilience\r\n            { hash: 1943323491, name: 'Class' },   // Recovery\r\n            { hash: 1735777505, name: 'Grenade' }, // Discipline\r\n            { hash: 144602215, name: 'Super' },    // Intellect\r\n            { hash: 4244567218, name: 'Melee' },   // Strength\r\n        ];\r\n\r\n        const subclassContent = (\r\n            <div className=\"rich-tooltip-container\" ref={tooltipRef} style={style}>\r\n                <div className={`rich-tooltip-wrapper rich-tooltip-frame ${tier} subclass-${element}`}>\r\n                    <div className=\"rich-tooltip-header\">\r\n                        <div className=\"rich-tooltip-header-top\">\r\n                            <div className=\"subclass-tooltip-header-left\">\r\n                                <div className=\"rich-tooltip-name\">{name}</div>\r\n                                <div className=\"rich-tooltip-subtitle\">{typeDisplay}</div>\r\n                            </div>\r\n                            {icon && <img src={icon} alt=\"\" className=\"subclass-tooltip-icon\" />}\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"rich-tooltip-main\">\r\n                        {flavorText && (\r\n                            <div className=\"subclass-tooltip-flavor\">\r\n                                <em>{flavorText}</em>\r\n                            </div>\r\n                        )}\r\n\r\n                        {!hideStats && (\r\n                            <div className=\"subclass-tooltip-stats\">\r\n                                {SUBCLASS_STAT_ORDER.map(stat => {\r\n                                    const val = characterStats?.[stat.name.toLowerCase()] || (instance as any)?.stats?.[stat.name.toLowerCase()] || 0;\r\n                                    return (\r\n                                        <div key={stat.hash} className=\"subclass-tooltip-stat-row\">\r\n                                            <span className=\"subclass-tooltip-stat-label\">{stat.name}</span>\r\n                                            <div className=\"subclass-tooltip-stat-bar-outer\">\r\n                                                <div\r\n                                                    className=\"subclass-tooltip-stat-bar-inner\"\r\n                                                    style={{ width: `${Math.min(100, (val / 100) * 100)}%` }}\r\n                                                />\r\n                                            </div>\r\n                                            <span className=\"subclass-tooltip-stat-value\">{val}</span>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        )}\r\n\r\n                        {superName && (\r\n                            <div className=\"subclass-tooltip-super\">\r\n                                <div className=\"subclass-tooltip-super-name\">{superName}</div>\r\n                                <div className=\"subclass-tooltip-super-desc\">{superDesc}</div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                    {!isLoadoutViewer && (!hideZoomButtons || clickActionLabel || (onRightClick && !hideSynergizeAction)) && (\r\n                        <div className=\"rich-tooltip-footer\">\r\n                            {clickActionLabel ? (\r\n                                <div\r\n                                    className=\"rich-tooltip-control\"\r\n                                    onClick={(e) => {\r\n                                        if (onClick) {\r\n                                            e.stopPropagation();\r\n                                            e.preventDefault();\r\n                                            onClick();\r\n                                        }\r\n                                    }}\r\n                                    style={{\r\n                                        pointerEvents: 'auto',\r\n                                        cursor: 'pointer'\r\n                                    }}\r\n                                >\r\n                                    <img src={MouseLeftIcon} className=\"rich-tooltip-mouse-icon\" alt=\"L\" />\r\n                                    <span>{clickActionLabel}</span>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"rich-tooltip-control\">\r\n                                    <img src={MouseLeftIcon} alt=\"\" className=\"rich-tooltip-mouse-icon\" />\r\n                                    <span>Edit</span>\r\n                                </div>\r\n                            )}\r\n                            {onRightClick && !hideSynergizeAction && (\r\n                                <div\r\n                                    className=\"rich-tooltip-control\"\r\n                                    onContextMenu={(e) => {\r\n                                        if (onRightClick) {\r\n                                            e.stopPropagation();\r\n                                            e.preventDefault();\r\n                                            onRightClick();\r\n                                        }\r\n                                    }}\r\n                                    style={{\r\n                                        pointerEvents: 'auto',\r\n                                        cursor: 'pointer'\r\n                                    }}\r\n                                >\r\n                                    <img src={MouseRightIcon} className=\"rich-tooltip-mouse-icon\" alt=\"R\" />\r\n                                    <span>Synergize</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n        return inline ? subclassContent : createPortal(subclassContent, document.body);\r\n    }\r\n\r\n    // Render ability tooltip for subclass abilities\r\n    if (isSubclassAbility) {\r\n        const abilityElement = overrideElement || getAbilityElement(def);\r\n        // Resolve icon URL — manifest returns full URLs from getItem()\r\n        const rawIcon = def.displayProperties?.icon || '';\r\n        const abilityIcon = rawIcon.startsWith('http') ? rawIcon : rawIcon ? getBungieUrl(rawIcon) : null;\r\n        const abilityName = def.displayProperties?.name || 'Unknown';\r\n        const abilityType = def.itemTypeDisplayName || plugCategory.replace(/_/g, ' ').replace(/\\b\\w/g, (c: string) => c.toUpperCase()) || 'Ability';\r\n\r\n        // Description Fallback: Try item -> sandbox perks -> socket entries\r\n        let abilityDesc = def.displayProperties?.description;\r\n        if (!abilityDesc && def.perks?.length) {\r\n            abilityDesc = def.perks.map((p: any) => {\r\n                if (!p.perkHash) return null;\r\n                const perk = manifestService.getPerk(p.perkHash);\r\n                return perk?.description;\r\n            }).filter(Boolean).join('\\n');\r\n        }\r\n        if (!abilityDesc && def.sockets?.socketEntries) {\r\n            // Some fragments hide their description in a socket (usually the first non-empty/non-reusable one)\r\n            const descSocket = def.sockets.socketEntries.find((s: any) => {\r\n                if (!s.singleInitialItemHash) return false;\r\n                const plug = manifestService.getItem(s.singleInitialItemHash);\r\n                return plug?.displayProperties?.description && plug.displayProperties.description.length > 5;\r\n            });\r\n            if (descSocket) {\r\n                const plug = manifestService.getItem(descSocket.singleInitialItemHash);\r\n                abilityDesc = plug?.displayProperties?.description || '';\r\n            }\r\n        }\r\n        abilityDesc = abilityDesc || '';\r\n\r\n        // Content Cleanup: Deduplicate stats in description\r\n        // Remove lines that look like \"+10 Capability\" or \"-10 Capability\" from the text\r\n        // because we show them in the dedicated stats section.\r\n        if (abilityDesc) {\r\n            abilityDesc = abilityDesc.split('\\n')\r\n                .filter(line => !/^[\\+\\-]\\d+\\s/.test(line.trim()))\r\n                .join('\\n')\r\n                .trim();\r\n        }\r\n\r\n        // Element icon from Bungie API\r\n        const elementIcon = manifestService.getDamageTypeIcon(abilityElement as any);\r\n        const elementIconUrl = elementIcon ? (elementIcon.startsWith('http') ? elementIcon : getBungieUrl(elementIcon)) : null;\r\n\r\n        // Stat bonuses for fragments/aspects\r\n        const statBonuses = (def.investmentStats || []).filter((s: any) => s.value !== 0);\r\n        const statBonusEntries = statBonuses.map((s: any) => {\r\n            const statInfo = manifestService.getStat(s.statTypeHash);\r\n            // Filter out \"Fragment Cost\" (redundant internal stat)\r\n            if (statInfo?.name === 'Fragment Cost') return null;\r\n\r\n            const iconUrl = statInfo?.icon ? (statInfo.icon.startsWith('http') ? statInfo.icon : getBungieUrl(statInfo.icon)) : null;\r\n\r\n            return statInfo?.name ? {\r\n                name: statInfo.name,\r\n                value: s.value,\r\n                hash: s.statTypeHash,\r\n                icon: iconUrl\r\n            } : null;\r\n        }).filter(Boolean) as Array<{ name: string; value: number; hash: number; icon: string | null }>;\r\n\r\n        const abilityContent = (\r\n            <div className=\"rich-tooltip-container\" ref={tooltipRef} style={style}>\r\n                <div className={`rich-tooltip-wrapper rich-tooltip-frame ability-${abilityElement}`}>\r\n                    <div className=\"rich-tooltip-header\">\r\n                        <div className=\"rich-tooltip-header-top\">\r\n                            {abilityIcon && <img src={abilityIcon} alt=\"\" className=\"rich-tooltip-header-ability-icon\" />}\r\n                            <div>\r\n                                <div className=\"rich-tooltip-name\">{abilityName}</div>\r\n                                <div className=\"rich-tooltip-subtitle\">\r\n                                    <div className=\"rich-tooltip-subtitle-row\">\r\n                                        {elementIconUrl && <img src={elementIconUrl} alt=\"\" className=\"rich-tooltip-element-icon-sm\" />}\r\n                                        <span>{abilityType}</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"rich-tooltip-main\">\r\n                        {abilityDesc && (\r\n                            <div className=\"rich-tooltip-ability-description\">{abilityDesc}</div>\r\n                        )}\r\n                        {!hideStats && statBonusEntries.length > 0 && (\r\n                            <div className=\"rich-tooltip-ability-stats\">\r\n                                {statBonusEntries.map((s, i) => (\r\n                                    <div key={i} className={`rich-tooltip-ability-stat-row ${s.value > 0 ? 'positive' : 'negative'}`}>\r\n                                        <div className=\"rich-tooltip-ability-stat-left\">\r\n                                            {s.icon && <img src={s.icon} alt=\"\" className=\"rich-tooltip-ability-stat-icon\" />}\r\n                                            <span className=\"rich-tooltip-ability-stat-value\">\r\n                                                {s.value > 0 ? '+' : ''}{s.value}\r\n                                            </span>\r\n                                        </div>\r\n                                        <span className=\"rich-tooltip-ability-stat-name\">{s.name}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n        return inline ? abilityContent : createPortal(abilityContent, document.body);\r\n    }\r\n\r\n    // 1. Core Definitions - Already handled above\r\n\r\n    // Ammo Info\r\n\r\n\r\n    // 2. Power & Damage\r\n    const power = instance?.power || 0;\r\n    const damageType = instance?.damageType || def?.defaultDamageType || 1;\r\n    const damageTypeClass = getDamageTypeClass(damageType);\r\n\r\n    const barStats = allStats.filter(s => !NUMERIC_ONLY_STATS.includes(s!.hash));\r\n    const numericStats = allStats.filter(s => NUMERIC_ONLY_STATS.includes(s!.hash));\r\n\r\n\r\n\r\n    // 4. Perks\r\n    // Unified Perk Logic\r\n    const gearTier = (instance as any)?.gearTier || 0;\r\n\r\n    const intrinsic0 = socketPlugs.find((s: any) => s.index === 0);\r\n\r\n    let armorExoticIntrinsic: any = null;\r\n    let weaponIntrinsic: any = null;\r\n\r\n    const filterPlugs = (plugs: any[]) => plugs.filter(s => s && !s.name?.toLowerCase().includes('empty') && !s.name?.toLowerCase().includes('deprecated'));\r\n\r\n    if (!isWeapon) {\r\n        if (tier === 'exotic') {\r\n            // Exotic: socket 11 at bottom\r\n            armorExoticIntrinsic = filterPlugs([socketPlugs.find((s: any) => s.index === 11)])[0];\r\n        }\r\n    } else {\r\n        weaponIntrinsic = intrinsic0;\r\n    }\r\n    const itemName = (def.displayProperties?.name || '').toLowerCase();\r\n    const isErgoSum = itemName.includes('ergo sum');\r\n\r\n    const unfilteredTrait1 = socketPlugs.find((s: any) => s.index === 3);\r\n    const unfilteredTrait2 = socketPlugs.find((s: any) => s.index === 4);\r\n\r\n    // Explicitly hide socket 3 for Ergo Sum as requested\r\n    const trait1 = isErgoSum ? null : filterPlugs([unfilteredTrait1])[0];\r\n    const trait2 = filterPlugs([unfilteredTrait2])[0];\r\n\r\n    // Ergo Sum specific \"Debug\" / Exotic Trait sockets (usually index 6 or 7 for its unique random rolls)\r\n    const unfilteredExoticTrait = isErgoSum ? (socketPlugs.find((s: any) => s.index === 6) || socketPlugs.find((s: any) => s.index === 7)) : null;\r\n    // For Ergo Sum, we explicitly WANT to see the \"debug\" sockets (damage mods/frames) even if they are labeled as deprecated\r\n    const weaponExoticTrait = isErgoSum ? unfilteredExoticTrait : filterPlugs([unfilteredExoticTrait])[0];\r\n\r\n    // 5. Build Content\r\n    const flavorText = def.flavorText;\r\n    const damageIcon = manifestService.getDamageTypeIcon(damageTypeClass as any);\r\n\r\n    // 6. Objective Info\r\n    const pveTracker = (instance as any)?.objectives?.find((o: any) => o.objectiveHash === 90275515 || o.objectiveHash === 2579044636 || o.objectiveHash === 73837075 || o.objectiveHash === 3387796140);\r\n    const pvpTracker = (instance as any)?.objectives?.find((o: any) => o.objectiveHash === 1501870536 || o.objectiveHash === 2439952408 || o.objectiveHash === 74070459 || o.objectiveHash === 890482414 || o.objectiveHash === 2109364169);\r\n\r\n    // Check slot 9 for kill tracker plug (common location for kill trackers)\r\n    let slot9Tracker = null;\r\n    if (isWeapon && instance?.sockets) {\r\n        const slot9Socket = instance.sockets.find((s: any) => s.socketIndex === 9);\r\n        if (slot9Socket?.plugHash) {\r\n            const slot9Plug = manifestService.getItem(slot9Socket.plugHash);\r\n            // Check if this plug has objectives (kill tracker data)\r\n            if (slot9Plug?.plug && (slot9Plug.plug as any).plugObjectives) {\r\n                const trackerObjective = (slot9Plug.plug as any).plugObjectives.find((obj: any) =>\r\n                    obj.objectiveHash === 90275515 || // PvE Tracker\r\n                    obj.objectiveHash === 1501870536 || // PvP Tracker\r\n                    obj.objectiveHash === 2579044636 || // Another PvE variant\r\n                    obj.objectiveHash === 2439952408 || // Another PvP variant\r\n                    obj.objectiveHash === 373673523    // Generic tracker\r\n                );\r\n                if (trackerObjective) {\r\n                    // Find the actual progress from instance objectives\r\n                    const progressData = (instance as any)?.objectives?.find((o: any) => o.objectiveHash === trackerObjective.objectiveHash);\r\n                    if (progressData) {\r\n                        slot9Tracker = progressData;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    const killTracker = pveTracker || pvpTracker || slot9Tracker || (instance as any)?.objectives?.find((o: any) => o.visible || o.objectiveHash === 373673523);\r\n    const killCount = killTracker ? killTracker.progress?.toLocaleString() : null;\r\n    const trackerLabel = pvpTracker ? 'Guardians Defeated' : (pveTracker ? 'Combatants Defeated' : 'Enemies Defeated');\r\n\r\n    const isMasterwork = !!(item?.state && (item.state & 4)) || tier === 'exotic';\r\n    const isCrafted = !!(item?.state && (item.state & 8));\r\n    const isEnhancedLegendary = gearTier >= 2 && gearTier <= 5;\r\n\r\n    const shouldShowTraitGlow = (t: any) => {\r\n        if (!isWeapon) {\r\n            // Only socket 11 on Exotics gets the golden glow\r\n            return tier === 'exotic' && t.index === 11;\r\n        }\r\n        // Legendary weapons get the glow if explicitly enhanced, crafted, or Tier 2-5\r\n        return (t as any)?.isEnhanced || isCrafted || isEnhancedLegendary;\r\n    };\r\n\r\n    // Header effects (glow and yellow bar) only for Masterworked items\r\n    const showMasterworkEffects = isMasterwork;\r\n    const showGlow = isMasterwork;\r\n\r\n\r\n\r\n    // Low-level Energy info (Capacity)\r\n    const energyCapacity = (instance as any)?.energy?.energyCapacity || 0;\r\n    // For armor, damageIcon is usually the element icon (Solar, Void, etc.)\r\n\r\n    const isHighPower = power >= 200;\r\n\r\n\r\n\r\n    // Determine Armor Archetype (From Index 6)\r\n    let archetypeLabel = null;\r\n    let archetypeIcon = null;\r\n\r\n    if (!isWeapon) {\r\n        // User requested: Index 6 is location. Only show if it is explicitly an armor archetype.\r\n        const archetypePlug = socketPlugs.find((s: any) => s.index === 6);\r\n\r\n        if (archetypePlug && archetypePlug.plugCategoryIdentifier?.includes('archetype')) {\r\n            archetypeLabel = archetypePlug.name;\r\n            if (archetypePlug.icon) {\r\n                archetypeIcon = getBungieUrl(archetypePlug.icon);\r\n            }\r\n        }\r\n    }\r\n\r\n    // RENDER VIA PORTAL TO BODY\r\n    const content = (\r\n        <div\r\n            className={`rich-tooltip-container ${isGalaxyView ? 'galaxy-view' : ''}`}\r\n            ref={tooltipRef}\r\n            style={{\r\n                ...style,\r\n                pointerEvents: (isFocused || onClick) ? 'auto' : 'none',\r\n                cursor: (onClick || (isFocused && onTransfer)) ? 'pointer' : 'default'\r\n            }}\r\n            onMouseDown={(e) => {\r\n                // Prevent 3D controls from catching this event and interpreting it as a camera drag\r\n                e.stopPropagation();\r\n            }}\r\n            onClick={(e) => {\r\n                if (onClick) {\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n                    onClick();\r\n                } else if (isFocused && onTransfer) {\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n                    setShowTransferMenu(true);\r\n                }\r\n            }}\r\n        >\r\n            <div className={`rich-tooltip-wrapper rich-tooltip-frame ${tier} ${isMod ? 'mod-grey' : ''}`}>\r\n                <div className=\"rich-tooltip-header\">\r\n                    {showMasterworkEffects && <div className=\"rich-tooltip-masterwork-bar\" />}\r\n                    {showGlow && <div className=\"rich-tooltip-header-glow\" />}\r\n                    <div className=\"rich-tooltip-header-top\">\r\n                        <div className=\"rich-tooltip-name\">{def.displayProperties?.name}</div>\r\n                    </div>\r\n                    <div className=\"rich-tooltip-subtitle\">\r\n                        <div className=\"rich-tooltip-subtitle-row\">\r\n                            <span>{itemType}</span>\r\n                            <div className=\"rich-tooltip-subtitle-icons\">\r\n                                <span className={`rich-tooltip-tier-text ${tier}`}>{tier}</span>\r\n                                {instance && item.itemInstanceId && (\r\n                                    <SimpleTooltip text={(instance.state & 1) ? 'Unlock Item' : 'Lock Item'} delay={300}>\r\n                                        <div\r\n                                            className={`rich-tooltip-lock-icon ${(instance.state & 1) ? 'locked' : 'unlocked'} ${lockAnimating || ''}`}\r\n                                            style={{ pointerEvents: 'auto', zIndex: 100001, position: 'relative' }}\r\n                                            onClick={async (e) => {\r\n                                                e.stopPropagation();\r\n                                                const isCurrentlyLocked = (instance.state & 1) === 1;\r\n                                                const newState = !isCurrentlyLocked;\r\n\r\n                                                // Trigger animation\r\n                                                setLockAnimating(newState ? 'locking' : 'unlocking');\r\n\r\n                                                // Determine character ID accurately (source character)\r\n                                                // Fallback to selected character if not available\r\n                                                const characterId = item.characterId || useProfileStore.getState().selectedCharacterId;\r\n\r\n                                                if (!characterId || !item.itemInstanceId) {\r\n                                                    setLockAnimating(null);\r\n                                                    return;\r\n                                                }\r\n\r\n                                                // Call Bungie API to lock/unlock\r\n                                                const success = await transferService.setItemLockState(item.itemInstanceId, characterId, newState);\r\n\r\n                                                // Clear animation after it completes\r\n                                                setTimeout(() => {\r\n                                                    setLockAnimating(null);\r\n                                                }, 500);\r\n\r\n                                                if (success) {\r\n                                                    // Update local state\r\n                                                    if (newState) {\r\n                                                        instance.state |= 1; // Set lock bit\r\n                                                    } else {\r\n                                                        instance.state &= ~1; // Clear lock bit\r\n                                                    }\r\n                                                }\r\n                                            }}\r\n                                        >\r\n                                            {(instance.state & 1) ? <LockIcon size={14} /> : <UnlockIcon size={14} />}\r\n                                        </div>\r\n                                    </SimpleTooltip>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"rich-tooltip-main\">\r\n                    {power > 0 && (\r\n                        <div className=\"rich-tooltip-power-section\">\r\n                            <div className=\"rich-tooltip-power-left\">\r\n                                {isWeapon && damageIcon && (\r\n                                    <img src={getBungieUrl(damageIcon)} alt=\"\" className=\"rich-tooltip-damage-type-icon\" />\r\n                                )}\r\n                                <span className={`rich-tooltip-power-value ${isHighPower ? 'power-blue' : ''}`}>\r\n                                    {power}{isHighPower ? '+' : ''}\r\n                                </span>\r\n                                <span className=\"rich-tooltip-power-label\">\r\n                                    {isWeapon ? 'Attack' : 'Defense'}\r\n                                    {isWeapon && (() => {\r\n                                        // Ammo Type Logic\r\n                                        const ammoType = def.equippingBlock?.ammoType; // 1: Primary, 2: Special, 3: Heavy\r\n                                        let ammoLabel = '';\r\n                                        let ammoClass = '';\r\n                                        let ammoIcon = '';\r\n\r\n                                        if (ammoType === 1) {\r\n                                            ammoLabel = 'PRIMARY';\r\n                                            ammoClass = 'ammo-primary';\r\n                                            ammoIcon = '/common/destiny2_content/icons/99f3733354862047493d8550e46a45ec.png';\r\n                                        }\r\n                                        else if (ammoType === 2) {\r\n                                            ammoLabel = 'SPECIAL';\r\n                                            ammoClass = 'ammo-special';\r\n                                            ammoIcon = '/common/destiny2_content/icons/d920203c4fd4571ae7f39eb5249eaecb.png';\r\n                                        }\r\n                                        else if (ammoType === 3) {\r\n                                            ammoLabel = 'HEAVY';\r\n                                            ammoClass = 'ammo-heavy';\r\n                                            ammoIcon = '/common/destiny2_content/icons/78ef0e2b281de7b60c48920223e0f9b1.png';\r\n                                        }\r\n\r\n                                        const renderAmmo = ammoLabel && (\r\n                                            <>\r\n                                                <div className=\"rich-tooltip-power-separator\">|</div>\r\n                                                <div className={`rich-tooltip-ammo-pill ${ammoClass}`}>\r\n                                                    {ammoIcon && <img src={getBungieUrl(ammoIcon)} className=\"rich-tooltip-ammo-icon\" alt=\"\" />}\r\n                                                    {ammoLabel}\r\n                                                </div>\r\n                                            </>\r\n                                        );\r\n\r\n                                        const breakers = new Map<number, { bId: number, icon?: string, name?: string, isIntrinsic: boolean }>();\r\n                                        let hasIntrinsic = false;\r\n\r\n                                        // 1. Check item definition (intrinsic coverage)\r\n                                        // Manual Overrides for specific weapons requested by user\r\n                                        const itemName = (def.displayProperties?.name || '').toLowerCase();\r\n                                        if (itemName.includes(\"slayer's fang\")) {\r\n                                            breakers.set(2, { bId: 2, isIntrinsic: true }); // Overload\r\n                                            hasIntrinsic = true;\r\n                                        }\r\n\r\n                                        if (def.breakerType || def.breakerTypeHash) {\r\n                                            const bId = def.breakerType || def.breakerTypeHash;\r\n                                            breakers.set(bId, { bId, isIntrinsic: true });\r\n                                            hasIntrinsic = true;\r\n                                        }\r\n\r\n                                        // 2. Check ALL sockets for intrinsic champion perks (not just active plugs)\r\n                                        if (def.sockets?.socketEntries) {\r\n                                            for (const socket of def.sockets.socketEntries) {\r\n                                                // Check single initial item (intrinsic perk)\r\n                                                if (socket.singleInitialItemHash) {\r\n                                                    const plugDef = manifestService.getItem(socket.singleInitialItemHash);\r\n                                                    if (plugDef?.breakerType || plugDef?.breakerTypeHash) {\r\n                                                        const bId = plugDef.breakerType || plugDef.breakerTypeHash;\r\n                                                        breakers.set(bId, { bId, isIntrinsic: true });\r\n                                                        hasIntrinsic = true;\r\n                                                    }\r\n                                                    // Also check traitIds for champion mods (some exotics store it here)\r\n                                                    if (plugDef?.traitIds && Array.isArray(plugDef.traitIds)) {\r\n                                                        for (const traitId of plugDef.traitIds) {\r\n                                                            const traitLower = traitId.toLowerCase();\r\n                                                            let bId = 0;\r\n                                                            if (traitLower.includes('barrier')) bId = 1;\r\n                                                            else if (traitLower.includes('overload')) bId = 2;\r\n                                                            else if (traitLower.includes('unstoppable')) bId = 3;\r\n\r\n                                                            if (bId > 0) {\r\n                                                                breakers.set(bId, { bId, isIntrinsic: true });\r\n                                                                hasIntrinsic = true;\r\n                                                            }\r\n                                                        }\r\n                                                    }\r\n                                                }\r\n                                                // Also check reusable plug items\r\n                                                if (socket.reusablePlugItems) {\r\n                                                    for (const plug of socket.reusablePlugItems) {\r\n                                                        const plugDef = manifestService.getItem(plug.plugItemHash);\r\n                                                        if (plugDef?.breakerType || plugDef?.breakerTypeHash) {\r\n                                                            const bId = plugDef.breakerType || plugDef.breakerTypeHash;\r\n                                                            breakers.set(bId, { bId, isIntrinsic: true });\r\n                                                            hasIntrinsic = true;\r\n                                                        }\r\n                                                        // Check traitIds here too\r\n                                                        if (plugDef?.traitIds && Array.isArray(plugDef.traitIds)) {\r\n                                                            for (const traitId of plugDef.traitIds) {\r\n                                                                const traitLower = traitId.toLowerCase();\r\n                                                                let bId = 0;\r\n                                                                if (traitLower.includes('barrier')) bId = 1;\r\n                                                                else if (traitLower.includes('overload')) bId = 2;\r\n                                                                else if (traitLower.includes('unstoppable')) bId = 3;\r\n\r\n                                                                if (bId > 0) {\r\n                                                                    breakers.set(bId, { bId, isIntrinsic: true });\r\n                                                                    hasIntrinsic = true;\r\n                                                                }\r\n                                                            }\r\n                                                        }\r\n                                                    }\r\n                                                }\r\n                                            }\r\n                                        }\r\n\r\n                                        // 3. Check active instance sockets (equipped mods)\r\n                                        if (instance?.sockets) {\r\n                                            for (const s of instance.sockets) {\r\n                                                if (!s.plugHash) continue;\r\n                                                const plugDef = manifestService.getItem(s.plugHash);\r\n                                                if (plugDef?.breakerType || plugDef?.breakerTypeHash) {\r\n                                                    const bId = plugDef.breakerType || plugDef.breakerTypeHash;\r\n                                                    // Only mark as intrinsic if not already set by artifact\r\n                                                    if (!breakers.has(bId) || breakers.get(bId)?.isIntrinsic) {\r\n                                                        breakers.set(bId, { bId, isIntrinsic: true });\r\n                                                        hasIntrinsic = true;\r\n                                                    }\r\n                                                }\r\n                                            }\r\n                                        }\r\n\r\n                                        // 4. Check Artifact (seasonal passive coverage) - ONLY if no intrinsic\r\n                                        if (!hasIntrinsic) {\r\n                                            const activeMods = artifactService.getAntiChampionMods();\r\n                                            const typeName = (def.itemTypeDisplayName || '').toLowerCase();\r\n                                            const categoryHashes = def.itemCategoryHashes || [];\r\n\r\n                                            // Category hash constants (from Bungie API)\r\n                                            const HAND_CANNON = 6;\r\n                                            const PULSE_RIFLE = 7;\r\n                                            const SCOUT_RIFLE = 8;\r\n                                            const AUTO_RIFLE = 5;\r\n                                            const SWORD = 54;\r\n\r\n                                            activeMods.forEach(mod => {\r\n                                                const modNameLower = mod.name.toLowerCase();\r\n                                                let matches = false;\r\n\r\n                                                // Precise weapon type matching\r\n                                                if (modNameLower.includes('pulse') && categoryHashes.includes(PULSE_RIFLE)) {\r\n                                                    matches = true;\r\n                                                } else if (modNameLower.includes('hand cannon') && categoryHashes.includes(HAND_CANNON)) {\r\n                                                    matches = true;\r\n                                                } else if (modNameLower.includes('scout') && categoryHashes.includes(SCOUT_RIFLE)) {\r\n                                                    matches = true;\r\n                                                } else if (modNameLower.includes('auto') && !modNameLower.includes('automatic') && categoryHashes.includes(AUTO_RIFLE)) {\r\n                                                    matches = true;\r\n                                                } else if (modNameLower.includes('sword') && categoryHashes.includes(SWORD)) {\r\n                                                    matches = true;\r\n                                                } else {\r\n                                                    // Fallback to generic type match\r\n                                                    matches = mod.weaponTypes.some(wt => {\r\n                                                        const wtLower = wt.toLowerCase();\r\n                                                        return typeName.includes(wtLower) && typeName === wtLower;\r\n                                                    });\r\n                                                }\r\n\r\n                                                if (matches) {\r\n                                                    let bId = 0;\r\n                                                    if (mod.championType === 'barrier') bId = 1;\r\n                                                    else if (mod.championType === 'overload') bId = 2;\r\n                                                    else if (mod.championType === 'unstoppable') bId = 3;\r\n\r\n                                                    if (bId > 0) {\r\n                                                        breakers.set(bId, { bId, icon: mod.icon, name: mod.name, isIntrinsic: false });\r\n                                                    }\r\n                                                }\r\n                                            });\r\n                                        }\r\n\r\n                                        const championIconOverrides: Record<number, string> = {\r\n                                            1: '/common/destiny2_content/icons/2ee146c19b93b88d2c7857005fc9a8c3.png', // Barrier\r\n                                            2: '/common/destiny2_content/icons/f5b9dd270a544afaf2b9a726b1296501.png', // Overload\r\n                                        };\r\n\r\n                                        const breakersElements = breakers.size > 0 ? Array.from(breakers.values()).map(info => {\r\n                                            const breakerDef = manifestService.getBreakerType(info.bId);\r\n                                            // Priority: mod icon (artifact/seasonal) > override icon (intrinsic) > breaker def icon\r\n                                            let iconUrl: string | undefined;\r\n                                            if (info.icon) {\r\n                                                // Use artifact/mod icon if provided (legendaries with seasonal mods)\r\n                                                iconUrl = info.icon;\r\n                                            } else if (info.isIntrinsic && championIconOverrides[info.bId]) {\r\n                                                // Use override for intrinsic champion coverage\r\n                                                iconUrl = championIconOverrides[info.bId];\r\n                                            } else {\r\n                                                // Fallback to breaker def\r\n                                                iconUrl = breakerDef?.icon;\r\n                                            }\r\n                                            const displayName = info.name || breakerDef?.name;\r\n\r\n                                            if (iconUrl) {\r\n                                                return (\r\n                                                    <img\r\n                                                        key={`champ-${info.bId}`}\r\n                                                        src={getBungieUrl(iconUrl)}\r\n                                                        alt={displayName}\r\n                                                        className=\"rich-tooltip-champion-icon\"\r\n                                                        title={displayName}\r\n                                                    />\r\n                                                );\r\n                                            }\r\n                                            return null;\r\n                                        }) : null;\r\n\r\n                                        return (\r\n                                            <>\r\n                                                {breakersElements}\r\n                                                {renderAmmo}\r\n                                            </>\r\n                                        );\r\n                                    })()}\r\n                                </span>\r\n                            </div>\r\n\r\n                            {/* Armor: Priority to Archetype (Index 6), Fallback to Energy */}\r\n                            {!isWeapon && (\r\n                                <>\r\n                                    {archetypeLabel ? (\r\n                                        <>\r\n                                            <div className=\"rich-tooltip-power-separator\">|</div>\r\n                                            <div className=\"rich-tooltip-energy-block\">\r\n                                                {archetypeIcon && <img src={archetypeIcon} className=\"rich-tooltip-energy-icon\" alt=\"\" />}\r\n                                                <span className=\"rich-tooltip-energy-label\" style={{ fontWeight: 700, color: '#fff' }}>{archetypeLabel}</span>\r\n                                            </div>\r\n                                        </>\r\n                                    ) : (\r\n                                        energyCapacity > 0 && (\r\n                                            <>\r\n                                                <div className=\"rich-tooltip-power-separator\">|</div>\r\n                                                <div className=\"rich-tooltip-energy-block\">\r\n                                                    {damageIcon && <img src={getBungieUrl(damageIcon)} className=\"rich-tooltip-energy-icon\" alt=\"\" />}\r\n                                                    <span className=\"rich-tooltip-energy-value\">{energyCapacity}</span>\r\n                                                    <span className=\"rich-tooltip-energy-label\">Energy</span>\r\n                                                </div>\r\n                                            </>\r\n                                        )\r\n                                    )}\r\n                                </>\r\n                            )}\r\n\r\n\r\n                        </div>\r\n                    )}\r\n\r\n                    {(killCount || (isWeapon && killTracker)) && (\r\n                        <div className=\"rich-tooltip-tracker\">\r\n                            <div className=\"rich-tooltip-tracker-label\">\r\n                                <img src={getBungieUrl('/common/destiny2_content/icons/683fd58d087968494b8e64c29a50123e.png')} className=\"rich-tooltip-tracker-icon\" alt=\"\" />\r\n                                <span>{killCount ? trackerLabel : 'Kill Tracker'}</span>\r\n                            </div>\r\n                            {killCount && <span className=\"rich-tooltip-tracker-value\">{killCount}</span>}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Stats */}\r\n                    {barStats.length > 0 && (\r\n                        <div className=\"rich-tooltip-stats\">\r\n                            {barStats.map((stat: any) => (\r\n                                <div key={stat.hash} className=\"rich-tooltip-stat-row\">\r\n                                    <span className=\"rich-tooltip-stat-name\">{stat.name}</span>\r\n                                    <div className=\"rich-tooltip-stat-bar-outer\">\r\n                                        {/* 1. Base / White Bar */}\r\n                                        <div\r\n                                            className=\"rich-tooltip-stat-bar-inner\"\r\n                                            style={{\r\n                                                width: `${Math.max(0, Math.min(stat.whiteValue * (isWeapon ? 1 : 2), 100))}%`,\r\n                                                zIndex: 4\r\n                                            }}\r\n                                        />\r\n\r\n                                        {/* 2. Yellow Bonus (MW/Exotic) */}\r\n                                        {stat.yellowValue > 0 && (\r\n                                            <div\r\n                                                className=\"rich-tooltip-stat-bar-bonus-mw\"\r\n                                                style={{\r\n                                                    left: `${Math.max(0, Math.min(stat.whiteValue * (isWeapon ? 1 : 2), 100))}%`,\r\n                                                    width: `${Math.max(0, Math.min(stat.yellowValue, stat.value - stat.whiteValue) * (isWeapon ? 1 : 2))}%`,\r\n                                                    zIndex: 3\r\n                                                }}\r\n                                            />\r\n                                        )}\r\n\r\n                                        {/* 3. Blue Bonus (Mods) */}\r\n                                        {stat.blueValue > 0 && (\r\n                                            <div\r\n                                                className=\"rich-tooltip-stat-bar-bonus-mod\"\r\n                                                style={{\r\n                                                    left: `${Math.max(0, Math.min((stat.whiteValue + Math.min(stat.yellowValue, stat.value - stat.whiteValue)) * (isWeapon ? 1 : 2), 100))}%`,\r\n                                                    width: `${Math.max(0, Math.min(stat.blueValue, stat.value - (stat.whiteValue + Math.min(stat.yellowValue, stat.value - stat.whiteValue))) * (isWeapon ? 1 : 2))}%`,\r\n                                                    zIndex: 2\r\n                                                }}\r\n                                            />\r\n                                        )}\r\n\r\n                                        {/* 4. Red Penalty (Lost Stat) */}\r\n                                        {stat.redValue > 0 && (\r\n                                            <div\r\n                                                className=\"rich-tooltip-stat-bar-penalty\"\r\n                                                style={{\r\n                                                    left: `${Math.max(0, Math.min(stat.value * (isWeapon ? 1 : 2), 100))}%`,\r\n                                                    width: `${Math.min(stat.redValue * (isWeapon ? 1 : 2), 100 - (stat.value * (isWeapon ? 1 : 2)))}%`,\r\n                                                    zIndex: 1\r\n                                                }}\r\n                                            />\r\n                                        )}\r\n\r\n                                        <span className={`rich-tooltip-stat-value ${stat.yellowValue > 0 ? 'masterwork' : ''} ${stat.blueValue > 0 ? 'mod' : ''}`}>\r\n                                            {stat.value}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n\r\n\r\n\r\n                    {/* Armor Mod Sockets */}\r\n                    {!isWeapon && armorModSockets.length > 0 && (\r\n                        <div className=\"rich-tooltip-mod-sockets\">\r\n                            <div className=\"rich-tooltip-mod-sockets-label\">Mods</div>\r\n                            <div className=\"rich-tooltip-mod-sockets-list\">\r\n                                {armorModSockets.map((mod: any) => (\r\n                                    <div\r\n                                        key={mod.hash}\r\n                                        className=\"rich-tooltip-mod-socket-item\"\r\n                                    >\r\n                                        {mod.icon && (\r\n                                            <img\r\n                                                src={getBungieUrl(mod.icon)}\r\n                                                alt={mod.name}\r\n                                                className=\"rich-tooltip-mod-socket-icon\"\r\n                                            />\r\n                                        )}\r\n                                        <span className=\"rich-tooltip-mod-socket-name\">{mod.name}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Exotic Armor Intrinsic Section (at top) */}\r\n                    {!isWeapon && armorExoticIntrinsic && (\r\n                        <div className=\"rich-tooltip-exotic-perk enhanced-trait\" style={{ marginBottom: '16px' }}>\r\n                            <div className=\"rich-tooltip-perk-header\">\r\n                                {armorExoticIntrinsic.icon && <img src={getBungieUrl(armorExoticIntrinsic.icon)} className=\"rich-tooltip-perk-icon\" alt=\"\" />}\r\n                                <div className=\"rich-tooltip-perk-name enhanced\" style={{ fontSize: '15px' }}>\r\n                                    {armorExoticIntrinsic.name}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"rich-tooltip-perk-description\">\r\n                                {clarityData?.perkDescs[armorExoticIntrinsic.hash]?.description ? (\r\n                                    <div className=\"clarity-description\" dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(clarityData.perkDescs[armorExoticIntrinsic.hash].description) }} />\r\n                                ) : (\r\n                                    formatDescription(armorExoticIntrinsic.description)\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Numeric Stats Section (RPM, Recoil, Magazine, Zoom) */}\r\n                    {numericStats.length > 0 && (\r\n                        <div className=\"rich-tooltip-numeric-stats\">\r\n                            {numericStats.map((stat: any) => (\r\n                                <div key={stat.hash} className=\"rich-tooltip-numeric-row\">\r\n                                    <span className=\"rich-tooltip-numeric-label\">{stat.name}</span>\r\n                                    <span className=\"rich-tooltip-numeric-value\">{stat.value}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n\r\n\r\n\r\n                    {/* Weapon Intrinsic (Frames) */}\r\n                    {isWeapon && weaponIntrinsic && (\r\n                        <div className={`rich-tooltip-exotic-perk ${weaponIntrinsic.isEnhanced || tier === 'exotic' ? 'enhanced-trait' : ''}`}>\r\n                            <div className=\"rich-tooltip-perk-header\">\r\n                                {weaponIntrinsic.icon && <img src={getBungieUrl(weaponIntrinsic.icon)} className=\"rich-tooltip-perk-icon\" alt=\"\" />}\r\n                                <div className=\"rich-tooltip-perk-name\">{weaponIntrinsic.name}</div>\r\n                            </div>\r\n                            <div className=\"rich-tooltip-perk-description\">\r\n                                {clarityData?.perkDescs[weaponIntrinsic.hash]?.description ? (\r\n                                    <div className=\"clarity-description\" dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(clarityData.perkDescs[weaponIntrinsic.hash].description) }} />\r\n                                ) : (\r\n                                    formatDescription(weaponIntrinsic.description)\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    {/* Legendary Weapon Traits */}\r\n                    {tier === 'legendary' && isWeapon && (trait1 || trait2) && (\r\n                        <div className=\"rich-tooltip-legendary-perks\">\r\n                            {trait1 && (\r\n                                <div className={`rich-tooltip-perk-row ${shouldShowTraitGlow(trait1) ? 'enhanced-trait' : ''}`}>\r\n                                    {trait1.icon && <img src={getBungieUrl(trait1.icon)} className=\"rich-tooltip-perk-icon-small\" alt=\"\" />}\r\n                                    <div className=\"rich-tooltip-perk-info\">\r\n                                        <div className={`rich-tooltip-perk-name-small ${shouldShowTraitGlow(trait1) ? 'enhanced' : ''}`}>{trait1.name}</div>\r\n                                        <div className=\"rich-tooltip-perk-description-small\">\r\n                                            {clarityData?.perkDescs[trait1.hash]?.description ? (\r\n                                                <div className=\"clarity-description\" dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(clarityData.perkDescs[trait1.hash].description) }} />\r\n                                            ) : (\r\n                                                formatDescription(trait1.description)\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                            {trait2 && (\r\n                                <div className={`rich-tooltip-perk-row ${shouldShowTraitGlow(trait2) ? 'enhanced-trait' : ''}`}>\r\n                                    {trait2.icon && <img src={getBungieUrl(trait2.icon)} className=\"rich-tooltip-perk-icon-small\" alt=\"\" />}\r\n                                    <div className=\"rich-tooltip-perk-info\">\r\n                                        <div className={`rich-tooltip-perk-name-small ${shouldShowTraitGlow(trait2) ? 'enhanced' : ''}`}>{trait2.name}</div>\r\n                                        <div className=\"rich-tooltip-perk-description-small\">\r\n                                            {clarityData?.perkDescs[trait2.hash]?.description ? (\r\n                                                <div className=\"clarity-description\" dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(clarityData.perkDescs[trait2.hash].description) }} />\r\n                                            ) : (\r\n                                                formatDescription(trait2.description)\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Main Trait Section (for Exotic Weapons) */}\r\n                    {tier === 'exotic' && isWeapon && trait1 && (\r\n                        <div className=\"rich-tooltip-exotic-perk enhanced-trait\">\r\n                            <div className=\"rich-tooltip-perk-header\">\r\n                                {trait1.icon && <img src={getBungieUrl(trait1.icon)} className=\"rich-tooltip-perk-icon\" alt=\"\" />}\r\n                                <div className=\"rich-tooltip-perk-name\">{trait1.name}</div>\r\n                            </div>\r\n                            <div className=\"rich-tooltip-perk-description\">\r\n                                {clarityData?.perkDescs[trait1.hash]?.description ? (\r\n                                    <div className=\"clarity-description\" dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(clarityData.perkDescs[trait1.hash].description) }} />\r\n                                ) : (\r\n                                    trait1.description\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Ergo Sum Extra \"Debug\" Trait */}\r\n                    {weaponExoticTrait && (\r\n                        <div className=\"rich-tooltip-exotic-perk enhanced-trait\" style={{ borderTop: '1px solid rgba(255,255,255,0.1)', paddingTop: '8px' }}>\r\n                            <div className=\"rich-tooltip-perk-header\">\r\n                                {weaponExoticTrait.icon && <img src={getBungieUrl(weaponExoticTrait.icon)} className=\"rich-tooltip-perk-icon\" alt=\"\" />}\r\n                                <div className=\"rich-tooltip-perk-name\">{weaponExoticTrait.name}</div>\r\n                            </div>\r\n                            <div className=\"rich-tooltip-perk-description\">{weaponExoticTrait.description}</div>\r\n                        </div>\r\n                    )}\r\n\r\n\r\n\r\n                    {/* Mod Description */}\r\n                    {isMod && (() => {\r\n                        let modDescription = def.displayProperties?.description;\r\n                        let isSynthesized = false;\r\n\r\n                        // If no description, try to get it from perks\r\n                        if (!modDescription && def.perks?.length > 0) {\r\n                            const perkDescriptions: string[] = [];\r\n                            def.perks.forEach((perk: any) => {\r\n                                if (perk.perkHash) {\r\n                                    const perkDef = manifestService.getPerk(perk.perkHash);\r\n                                    if (perkDef?.description) {\r\n                                        perkDescriptions.push(perkDef.description);\r\n                                    }\r\n                                }\r\n                            });\r\n                            if (perkDescriptions.length > 0) {\r\n                                modDescription = perkDescriptions.join('\\n\\n');\r\n                            }\r\n                        }\r\n\r\n                        // If no description but has investmentStats, synthesize one for stat mods\r\n                        if (!modDescription && def.investmentStats?.length > 0) {\r\n                            const statModDescriptions: string[] = [];\r\n                            const statDescriptions: string[] = [];\r\n\r\n                            def.investmentStats.forEach((stat: any) => {\r\n                                // Only show significant stat bonuses (5 or more)\r\n                                // This filters out the +3 cost values\r\n                                if (Math.abs(stat.value) >= 5) {\r\n                                    const statInfo = manifestService.getStat(stat.statTypeHash);\r\n\r\n                                    if (statInfo?.name && statInfo?.icon) {\r\n                                        const value = stat.value;\r\n                                        const sign = value > 0 ? '+' : '';\r\n                                        const iconUrl = getBungieUrl(statInfo.icon);\r\n\r\n                                        // Format with inline icon: \"+10 [icon] Melee\" - all in one line\r\n                                        statModDescriptions.push(`<span style=\"white-space: nowrap; display: inline-flex; align-items: center;\">${sign}${value}<img src=\"${iconUrl}\" style=\"width: 16px; height: 16px; display: inline-block; margin-left: 16px; margin-right: 6px;\" alt=\"\" />${statInfo.name}</span>`);\r\n\r\n                                        // Add description if available\r\n                                        if (statInfo.description) {\r\n                                            statDescriptions.push(statInfo.description);\r\n                                        }\r\n                                    }\r\n                                }\r\n                            });\r\n\r\n                            if (statModDescriptions.length > 0) {\r\n                                // Join stats directly with space separator - all inline\r\n                                const parts = [statModDescriptions.join(' ')];\r\n                                if (statDescriptions.length > 0) {\r\n                                    parts.push('<br/><span style=\"font-style: italic; opacity: 0.8;\">' + statDescriptions.join(' ') + '</span>');\r\n                                }\r\n                                modDescription = parts.join('');\r\n                                isSynthesized = true; // Use dangerouslySetInnerHTML for HTML\r\n                            }\r\n                        }\r\n\r\n                        if (!modDescription) return null;\r\n\r\n                        // If synthesized, use dangerouslySetInnerHTML; otherwise use formatDescription\r\n                        return isSynthesized ? (\r\n                            <div\r\n                                className=\"rich-tooltip-perk-description\"\r\n                                style={{ marginTop: '12px' }}\r\n                                /* SECURITY: Content is sanitized via DOMPurify to prevent XSS from synthesized stat descriptions */\r\n                                dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(modDescription) }}\r\n                            />\r\n                        ) : (\r\n                            <div className=\"rich-tooltip-perk-description\" style={{ marginTop: '12px' }}>\r\n                                {formatDescription(modDescription)}\r\n                            </div>\r\n                        );\r\n                    })()}\r\n\r\n                    {flavorText && !isMod && (\r\n                        <div className=\"rich-tooltip-flavor\">\r\n                            {flavorText}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {!isLoadoutViewer && (!hideZoomButtons || clickActionLabel || (tier === 'exotic' && isGalaxyView && onRightClick && !hideSynergizeAction)) && (\r\n                    <div className=\"rich-tooltip-footer\">\r\n                        {clickActionLabel ? (\r\n                            <div\r\n                                className=\"rich-tooltip-control\"\r\n                                onClick={(e) => {\r\n                                    if (onClick) {\r\n                                        e.stopPropagation();\r\n                                        e.preventDefault();\r\n                                        onClick();\r\n                                    }\r\n                                }}\r\n                                style={{\r\n                                    pointerEvents: 'auto',\r\n                                    cursor: 'pointer'\r\n                                }}\r\n                            >\r\n                                <img src={MouseLeftIcon} className=\"rich-tooltip-mouse-icon\" alt=\"L\" />\r\n                                <span>{clickActionLabel}</span>\r\n                            </div>\r\n                        ) : (\r\n                            <div\r\n                                className=\"rich-tooltip-control\"\r\n                                onClick={(e) => {\r\n                                    if (isFocused && onTransfer) {\r\n                                        e.stopPropagation();\r\n                                        e.preventDefault();\r\n                                        setShowTransferMenu(true);\r\n                                    }\r\n                                }}\r\n                                style={{\r\n                                    pointerEvents: isFocused ? 'auto' : 'none',\r\n                                    cursor: (isFocused && onTransfer) ? 'pointer' : 'default'\r\n                                }}\r\n                            >\r\n                                <img src={MouseLeftIcon} className=\"rich-tooltip-mouse-icon\" alt=\"L\" />\r\n                                <span>{isFocused ? (isWeapon ? 'Transmat Weapon' : 'Transmat Armor') : 'Zoom'}</span>\r\n                            </div>\r\n                        )}\r\n                        {tier === 'exotic' && isGalaxyView && onRightClick && !hideSynergizeAction && (\r\n                            <div\r\n                                className=\"rich-tooltip-control\"\r\n                                onContextMenu={(e) => {\r\n                                    if (onRightClick) {\r\n                                        e.stopPropagation();\r\n                                        e.preventDefault();\r\n                                        onRightClick();\r\n                                    }\r\n                                }}\r\n                                style={{\r\n                                    pointerEvents: 'auto',\r\n                                    cursor: 'pointer'\r\n                                }}\r\n                            >\r\n                                <img src={MouseRightIcon} className=\"rich-tooltip-mouse-icon\" alt=\"R\" />\r\n                                <span>Synergize</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {showTransferMenu && isFocused && onTransfer && (\r\n                    <TransferMenu\r\n                        targetElement={tooltipRef.current}\r\n                        onTransfer={(characterId) => {\r\n                            onTransfer(characterId);\r\n                            setShowTransferMenu(false);\r\n                        }}\r\n                        onEquip={(characterId) => {\r\n                            if (onEquip) {\r\n                                onEquip(characterId);\r\n                            }\r\n                            setShowTransferMenu(false);\r\n                        }}\r\n                        onClose={() => {\r\n                            setShowTransferMenu(false);\r\n                        }}\r\n                        showVault={item.location !== 'vault'}\r\n                        itemInstanceId={item.itemInstanceId}\r\n                        itemClass={def?.classType}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    return inline ? content : createPortal(content, document.body);\r\n});\r\n\r\nfunction getDamageTypeClass(damageType: number): string {\r\n    switch (damageType) {\r\n        case 1: return 'kinetic';\r\n        case 2: return 'arc';\r\n        case 3: return 'solar';\r\n        case 4: return 'void';\r\n        case 6: return 'stasis';\r\n        case 7: return 'strand';\r\n        default: return 'kinetic';\r\n    }\r\n}\r\n\r\nfunction getAbilityElement(def: any): string {\r\n    const cat = (def.plug?.plugCategoryIdentifier || '').toLowerCase();\r\n    // Use word boundary regex to avoid partial matches (e.g., 'void' in 'devoid')\r\n    if (/\\bvoid\\b/.test(cat)) return 'void';\r\n    if (/\\bsolar\\b/.test(cat) || /\\bthermal\\b/.test(cat)) return 'solar';\r\n    if (/\\barc\\b/.test(cat)) return 'arc';\r\n    if (/\\bstasis\\b/.test(cat)) return 'stasis';\r\n    if (/\\bstrand\\b/.test(cat)) return 'strand';\r\n    if (/\\bprismatic\\b/.test(cat) || cat.includes('facet')) return 'prismatic';\r\n\r\n    // Check defaultDamageType first (most reliable for subclasses)\r\n    if (def.defaultDamageType) {\r\n        switch (def.defaultDamageType) {\r\n            case 2: return 'arc';\r\n            case 3: return 'solar';\r\n            case 4: return 'void';\r\n            case 6: return 'stasis';\r\n            case 7: return 'strand';\r\n            case 8: return 'prismatic';\r\n        }\r\n    }\r\n\r\n    // Check talentGrid.hudDamageType as fallback\r\n    if (def.talentGrid?.hudDamageType) {\r\n        switch (def.talentGrid.hudDamageType) {\r\n            case 2: return 'arc';\r\n            case 3: return 'solar';\r\n            case 4: return 'void';\r\n            case 6: return 'stasis';\r\n            case 7: return 'strand';\r\n            case 8: return 'prismatic';\r\n        }\r\n    }\r\n\r\n    // Name-based detection as last resort\r\n    const name = (def.displayProperties?.name || '').toLowerCase();\r\n    // Use word boundary regex to avoid partial matches\r\n    if (/\\bprismatic\\b/.test(name)) return 'prismatic';\r\n    if (/\\bsolar\\b/.test(name) || /\\bdawn\\b/.test(name) || /\\bgunslinger\\b/.test(name) || /\\bfire\\b/.test(name)) return 'solar';\r\n    if (/\\bvoid\\b/.test(name) || /\\bnight\\b/.test(name) || /\\bvoidwalker\\b/.test(name) || /\\bsentinel\\b/.test(name)) return 'void';\r\n    if (/\\barc\\b/.test(name) || /\\bstorm\\b/.test(name) || /\\bstriker\\b/.test(name) || /\\bstrider\\b/.test(name)) return 'arc';\r\n    if (/\\bstasis\\b/.test(name) || /\\bshade\\b/.test(name) || /\\brevenant\\b/.test(name) || /\\bbehemoth\\b/.test(name)) return 'stasis';\r\n    if (/\\bstrand\\b/.test(name) || /\\bbrood\\b/.test(name) || /\\bthread\\b/.test(name) || /\\bberserk\\b/.test(name)) return 'strand';\r\n\r\n    return 'void';\r\n}\r\n","import type { CSSProperties, ReactNode } from 'react';\r\nimport { useProfileStore } from '../../store';\r\nimport '../../styles/TransmatEffect.css';\r\nimport './SubclassNode.css';\r\n\r\ninterface SubclassNodeProps {\r\n    type: 'diamond' | 'square' | 'round';\r\n    size?: 'normal' | 'large' | 'small';\r\n    label?: string;\r\n    icon?: string;\r\n    status?: 'active' | 'locked' | 'empty';\r\n    element?: 'void' | 'solar' | 'arc' | 'stasis' | 'strand' | 'prismatic';\r\n    onClick?: () => void;\r\n    onMouseEnter?: () => void;\r\n    onMouseLeave?: () => void;\r\n    onContextMenu?: (e: React.MouseEvent) => void;\r\n    style?: CSSProperties;\r\n    children?: ReactNode;\r\n    noBorder?: boolean;\r\n    itemId?: string;\r\n    itemHash?: number;\r\n}\r\n\r\nexport function SubclassNode({\r\n    type,\r\n    size = 'normal',\r\n    label,\r\n    icon,\r\n    status = 'empty',\r\n    element = 'void',\r\n    onClick,\r\n    onMouseEnter,\r\n    onMouseLeave,\r\n    onContextMenu,\r\n    style,\r\n    children,\r\n    noBorder,\r\n    itemId,\r\n    itemHash\r\n}: SubclassNodeProps) {\r\n    const sizeClass = size === 'large' ? 'subclass-node--large' : (size === 'small' ? 'subclass-node--small' : '');\r\n\r\n    // Ensure we always have a valid ID for synergy web connections\r\n    const effectiveItemId = itemId || itemHash?.toString();\r\n\r\n    const { activeTransfers, successfulTransfers } = useProfileStore();\r\n    const isTransferring = effectiveItemId && activeTransfers.has(effectiveItemId);\r\n    const isSuccess = effectiveItemId && successfulTransfers.has(effectiveItemId);\r\n\r\n    return (\r\n        <div\r\n            className={`subclass-node-container ${type} ${sizeClass} ${noBorder ? 'no-border' : ''} ${isTransferring ? 'transfer-active' : ''} ${isSuccess ? 'transfer-success' : ''}`}\r\n            style={style}\r\n            data-item-id={effectiveItemId}\r\n            data-item-hash={itemHash}\r\n        >\r\n            <button\r\n                className={`subclass-node subclass-node--${type} ${sizeClass} subclass-node--${status} element-${element} ${noBorder ? 'subclass-node--no-border' : ''}`}\r\n                onClick={onClick}\r\n                onMouseEnter={onMouseEnter}\r\n                onMouseLeave={onMouseLeave}\r\n                onContextMenu={onContextMenu}\r\n                aria-label={label}\r\n            >\r\n                <div className=\"subclass-node__inner\">\r\n                    {icon && <img src={icon} alt=\"\" className=\"subclass-node__icon\" />}\r\n                    {children}\r\n                </div>\r\n\r\n                {/* Diamond Border SVG for cleaner lines than CSS borders */}\r\n                {type === 'diamond' && !noBorder && (\r\n                    <svg className=\"subclass-node__border\" viewBox=\"0 0 100 100\">\r\n                        <path d=\"M50 0 L100 50 L50 100 L0 50 Z\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" />\r\n                    </svg>\r\n                )}\r\n            </button>\r\n            {label && <span className=\"subclass-node__label\">{label}</span>}\r\n        </div>\r\n    );\r\n}\r\n","import { type ReactNode, forwardRef, useEffect } from 'react';\r\nimport { useProfileStore, useManifestStore, useUIStore } from '../../store';\r\nimport { manifestService } from '../../services/bungie/manifest.service';\r\nimport { getBungieUrl } from '../../utils/url-helper';\r\nimport { SubclassNode } from './SubclassNode';\r\nimport { RichTooltip } from './RichTooltip';\r\nimport { BUCKET_HASHES } from '../../config/bungie.config';\r\nimport { getEquippedItem } from '../../utils/character-helpers';\r\nimport './BuilderContainer.css';\r\n\r\ninterface BuilderContainerProps {\r\n  children: ReactNode;\r\n  onSubclassClick: (itemHash: number, itemInstanceId?: string) => void;\r\n  hoveredSubclass: { item: any; instance?: any } | null;\r\n  setHoveredSubclass: (value: { item: any; instance?: any } | null) => void;\r\n  onSubclassDataReady?: (subclass: any, instance: any) => void;\r\n}\r\n\r\nexport const BuilderContainer = forwardRef<HTMLDivElement, BuilderContainerProps>(\r\n  function BuilderContainer({\r\n    children,\r\n    onSubclassClick,\r\n    hoveredSubclass,\r\n    setHoveredSubclass,\r\n    onSubclassDataReady\r\n  }, ref) {\r\n    const { isLoaded: manifestLoaded } = useManifestStore();\r\n    const { hideGlobalUI } = useUIStore();\r\n    const {\r\n      selectedCharacterId,\r\n      characterEquipment,\r\n      itemInstances,\r\n    } = useProfileStore();\r\n\r\n    const equipment = characterEquipment[selectedCharacterId || ''] || [];\r\n\r\n    // --- Subclass Logic ---\r\n    const equippedSubclass = getEquippedItem(equipment, BUCKET_HASHES.SUBCLASS);\r\n    const scDef = manifestLoaded && equippedSubclass ? manifestService.getItem(equippedSubclass.itemHash) : undefined;\r\n    const scIcon = scDef?.displayProperties?.icon ? getBungieUrl(scDef.displayProperties.icon) : undefined;\r\n\r\n    // Helper to get element from itemHash\r\n    const getElement = (hash: number): string => {\r\n      if (!manifestLoaded) return 'void';\r\n      const def = manifestService.getItem(hash);\r\n      if (def?.talentGrid?.hudDamageType === 2) return 'arc';\r\n      if (def?.talentGrid?.hudDamageType === 3) return 'solar';\r\n      if (def?.talentGrid?.hudDamageType === 4) return 'void';\r\n      if (def?.talentGrid?.hudDamageType === 6) return 'stasis';\r\n      if (def?.talentGrid?.hudDamageType === 7) return 'strand';\r\n      const name = def?.displayProperties?.name?.toLowerCase() || '';\r\n      if (name.includes('prismatic')) return 'prismatic';\r\n      return 'kinetic';\r\n    };\r\n\r\n    // Notify parent when subclass data is ready\r\n    useEffect(() => {\r\n      if (equippedSubclass && onSubclassDataReady) {\r\n        const instance = equippedSubclass.itemInstanceId ? itemInstances[equippedSubclass.itemInstanceId] : undefined;\r\n        onSubclassDataReady(equippedSubclass, instance);\r\n      }\r\n    }, [equippedSubclass?.itemHash, equippedSubclass?.itemInstanceId, onSubclassDataReady]);\r\n\r\n    return (\r\n      <div ref={ref} className=\"builder-container\">\r\n        {/* Subclass Selector - Positioned at top - Hidden when away from orbit */}\r\n        {manifestLoaded && equippedSubclass && !hideGlobalUI && (\r\n          <div className=\"builder-container__subclass-bar\">\r\n\r\n            {/* Main Active Subclass */}\r\n            <div className={`builder-container__subclass-equipped element-${getElement(equippedSubclass.itemHash)}`}>\r\n              <SubclassNode\r\n                type={(equippedSubclass && getElement(equippedSubclass.itemHash) === 'prismatic') ? 'round' : 'diamond'}\r\n                size=\"small\"\r\n                status=\"active\"\r\n                element={equippedSubclass ? getElement(equippedSubclass.itemHash) as any : 'void'}\r\n                icon={scIcon}\r\n                noBorder={true}\r\n                itemId={equippedSubclass?.itemInstanceId}\r\n                itemHash={equippedSubclass?.itemHash}\r\n                onClick={() => onSubclassClick(equippedSubclass.itemHash, equippedSubclass.itemInstanceId)}\r\n                onMouseEnter={() => setHoveredSubclass({ item: equippedSubclass, instance: equippedSubclass.itemInstanceId ? itemInstances[equippedSubclass.itemInstanceId] : undefined })}\r\n                onMouseLeave={() => setHoveredSubclass(null)}\r\n              />\r\n            </div>\r\n\r\n            {/* Subclass Tooltip */}\r\n            {hoveredSubclass && (\r\n              <div className=\"builder-container__subclass-tooltip\">\r\n                <RichTooltip\r\n                  item={hoveredSubclass.item}\r\n                  instance={hoveredSubclass.instance}\r\n                  hideStats={true}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Main Content */}\r\n        <div className=\"builder-container__content\">\r\n          {children}\r\n        </div>\r\n      </div>\r\n    );\r\n  });\r\n"],"names":["MouseLeftIcon","MouseRightIcon","ANTI_CHAMPION_PATTERNS","WEAPON_TYPE_KEYWORDS","WEAPON_TYPE_NORMALIZE","ArtifactService","store","useProfileStore","selectedCharacterId","progressions","debugLog","seasonalArtifact","activePerks","tier","item","perkDef","manifestService","antiChampionMods","perk","searchText","championType","pattern","weaponTypes","text","lowerText","foundTypes","keyword","normalized","championTypes","recommendations","mod","uniqueWeapons","mods","weapons","icons","requiredChampions","c","artifactService","CLASS_NAMES","TransferMenu","targetElement","onTransfer","onEquip","onClose","showVault","itemInstanceId","itemClass","characters","characterEquipment","hoveredCharacterId","setHoveredCharacterId","useState","tooltipText","setTooltipText","tooltipPosition","setTooltipPosition","rect","menuStyle","handleCharacterClick","characterId","handleMouseEnterCharacter","e","handleMouseLeaveCharacter","createPortal","jsxs","jsx","character","isSelected","isHovered","className","tooltipLabel","getBungieUrl","isEquipped","i","SimpleTooltip","children","delay","position","isVisible","setIsVisible","coords","setCoords","timeoutRef","useRef","triggerRef","showTooltip","x","y","hideTooltip","useEffect","childWithHandlers","React","Fragment","LockIcon","size","UnlockIcon","ARMOR_STAT_MAP","WEAPON_STAT_PRIORITY","WEAPON_STAT_MAP","NUMERIC_ONLY_STATS","formatDescription","description","line","trimmed","RichTooltip","memo","instance","characterStats","overrideElement","inline","followMouse","fixedPosition","isFocused","externalShowTransferMenu","onClick","hideZoomButtons","hideStats","clickActionLabel","hideSynergizeAction","onRightClick","manifestLoaded","useManifestStore","location","useLocation","isLoadoutViewer","isGalaxyView","tooltipRef","showTransferMenu","setShowTransferMenu","lockAnimating","setLockAnimating","style","setStyle","handleOutsideClick","target","timeoutId","def","useMemo","hash","clarityData","itemDesc","clarityService","perkDescs","s","data","prev","initialPositionSet","handleMouseMove","paddingX","paddingY","minTopMargin","width","height","setInitialPosition","mouseX","mouseY","trackMouse","isWeapon","isMod","weaponSocketBonuses","bonuses","plug","category","name","isMW","stat","armorSocketBonuses","modSockets","isExoticIntrinsic","allStats","statsSource","sourceEntries","entry","statDef","statInfo","isSword","totalValue","key","yellowVal","blueVal","redVal","whiteValue","b","indexA","indexB","armorOrder","socketPlugs","socket","index","activePlugHash","instanceSocket","plugDef","armorModSockets","modSlotIndices","plugCategory","isSubclassAbility","itemType","element","getAbilityElement","icon","typeDisplay","flavorText","superName","superDesc","superSocket","SUBCLASS_STAT_ORDER","subclassContent","val","abilityElement","rawIcon","abilityIcon","abilityName","abilityType","abilityDesc","p","descSocket","elementIcon","elementIconUrl","statBonusEntries","iconUrl","abilityContent","power","damageType","damageTypeClass","getDamageTypeClass","barStats","numericStats","gearTier","intrinsic0","armorExoticIntrinsic","weaponIntrinsic","filterPlugs","plugs","isErgoSum","unfilteredTrait1","unfilteredTrait2","trait1","trait2","unfilteredExoticTrait","weaponExoticTrait","damageIcon","pveTracker","o","pvpTracker","slot9Tracker","slot9Socket","slot9Plug","trackerObjective","obj","progressData","killTracker","killCount","trackerLabel","isMasterwork","isCrafted","isEnhancedLegendary","shouldShowTraitGlow","t","showMasterworkEffects","showGlow","energyCapacity","isHighPower","archetypeLabel","archetypeIcon","archetypePlug","content","newState","success","transferService","ammoType","ammoLabel","ammoClass","ammoIcon","renderAmmo","breakers","hasIntrinsic","bId","traitId","traitLower","activeMods","typeName","categoryHashes","HAND_CANNON","PULSE_RIFLE","SCOUT_RIFLE","AUTO_RIFLE","SWORD","modNameLower","matches","wt","wtLower","championIconOverrides","breakersElements","info","breakerDef","displayName","DOMPurify","modDescription","isSynthesized","perkDescriptions","statModDescriptions","statDescriptions","value","sign","parts","cat","SubclassNode","type","label","status","onMouseEnter","onMouseLeave","onContextMenu","noBorder","itemId","itemHash","sizeClass","effectiveItemId","activeTransfers","successfulTransfers","isTransferring","isSuccess","BuilderContainer","forwardRef","onSubclassClick","hoveredSubclass","setHoveredSubclass","onSubclassDataReady","ref","hideGlobalUI","useUIStore","itemInstances","equipment","equippedSubclass","getEquippedItem","BUCKET_HASHES","scDef","scIcon","getElement"],"mappings":"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"}