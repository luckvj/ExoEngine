import{j as e}from"./markdown-DyKRzreE.js";import{r as w,a as de,R as ds,u as ps}from"./react-vendor-BrsWO7iZ.js";import{u as pe,d as Oe,m as b,g as S,a as Xe,c as Be,t as us,b as hs,e as ms,B as fs}from"./galaxy-DVJjGVLR.js";import{a as oe}from"./utils-Cl4ySqJD.js";const ve="/assets/images/mouse-left-plain-_Rb1wsLk.png",Ue="/assets/images/mouse-right-plain-tscY1HQ0.png",gs={barrier:/anti[- ]?barrier|pierce[s]? barrier/i,overload:/overload|disrupts? overload/i,unstoppable:/unstoppable|stagger[s]? unstoppable/i},vs=["auto rifle","auto rifles","scout rifle","scout rifles","pulse rifle","pulse rifles","hand cannon","hand cannons","submachine gun","submachine guns","smg","smgs","sidearm","sidearms","bow","bows","sniper rifle","sniper rifles","sniper","shotgun","shotguns","fusion rifle","fusion rifles","linear fusion rifle","linear fusion rifles","linear fusion","lfr","trace rifle","trace rifles","grenade launcher","grenade launchers","gl","rocket launcher","rocket launchers","rockets","sword","swords","machine gun","machine guns","lmg","glaive","glaives","kinetic","melee","finisher","grenade"],xs={"auto rifle":"Auto Rifle","scout rifle":"Scout Rifle","pulse rifle":"Pulse Rifle","hand cannon":"Hand Cannon","submachine gun":"SMG",sidearm:"Sidearm",bow:"Bow","sniper rifle":"Sniper Rifle",sniper:"Sniper Rifle",shotgun:"Shotgun","fusion rifle":"Fusion Rifle","linear fusion rifle":"Linear Fusion Rifle","trace rifle":"Trace Rifle","grenade launcher":"Grenade Launcher","rocket launcher":"Rocket Launcher",sword:"Sword","machine gun":"Machine Gun",glaive:"Glaive","auto rifles":"Auto Rifle","scout rifles":"Scout Rifle","pulse rifles":"Pulse Rifle","hand cannons":"Hand Cannon","submachine guns":"SMG",smg:"SMG",smgs:"SMG",sidearms:"Sidearm",bows:"Bow","sniper rifles":"Sniper Rifle",shotguns:"Shotgun","fusion rifles":"Fusion Rifle","linear fusion rifles":"Linear Fusion Rifle","linear fusion":"Linear Fusion Rifle",lfr:"Linear Fusion Rifle","trace rifles":"Trace Rifle","grenade launchers":"Grenade Launcher",gl:"Grenade Launcher","rocket launchers":"Rocket Launcher",rockets:"Rocket Launcher",swords:"Sword","machine guns":"Machine Gun",lmg:"Machine Gun",glaives:"Glaive",kinetic:"Kinetic Weapons/Abilities",melee:"Melee Abilities",finisher:"Finishers",grenade:"Grenade Abilities"};class ys{getActiveArtifactPerks(){const o=pe.getState(),t=o.selectedCharacterId,h=o.characterProgressions;if(!t||!h?.[t])return Oe("Artifact","No selected character or progressions found"),[];const N=h[t]?.seasonalArtifact;if(!N?.tiers)return Oe("Artifact","No seasonal artifact data found"),[];const k=[];for(const H of N.tiers)for(const T of H.items)if(T.isActive){const g=b.getFullDefinition(T.itemHash);g?.name&&k.push({hash:T.itemHash,name:g.name||"Unknown Perk",description:g.description||"",icon:g.icon,isActive:!0})}return k}getAntiChampionMods(){const o=this.getActiveArtifactPerks(),t=[];for(const h of o){const N=`${h.name} ${h.description}`;for(const[k,H]of Object.entries(gs))if(H.test(N)){const T=this.extractWeaponTypes(N);t.push({hash:h.hash,name:h.name,championType:k,weaponTypes:T,icon:h.icon});break}}return t}extractWeaponTypes(o){const t=o.toLowerCase(),h=new Set;for(const N of vs)if(t.includes(N)){const k=xs[N]||N.charAt(0).toUpperCase()+N.slice(1);h.add(k)}return Array.from(h)}getRecommendedWeapons(o){const t=this.getAntiChampionMods(),h=new Map;for(const N of o){const H=t.filter(g=>g.championType===N).flatMap(g=>g.weaponTypes),T=Array.from(new Set(H));h.set(N,T)}return h}formatAntiChampionMods(o){return o.length===0?"No anti-champion mods unlocked in your artifact.":o.map(t=>{const h=t.weaponTypes.length>0?t.weaponTypes.join(", "):"Unknown weapons";return`${t.championType.charAt(0).toUpperCase()+t.championType.slice(1)}: ${t.name} (${h})`}).join(`
`)}getChampionIcons(){return{barrier:b.getChampionIcon("barrier"),overload:b.getChampionIcon("overload"),unstoppable:b.getChampionIcon("unstoppable")}}formatAntiChampionModsWithIcons(o){const t=this.getChampionIcons();return o.map(h=>({championType:h.championType,name:h.name,weapons:h.weaponTypes.length>0?h.weaponTypes.join(", "):"Unknown",icon:t[h.championType]}))}hasModFor(o){return this.getAntiChampionMods().some(h=>h.championType===o)}getMissingCoverage(o){return o.filter(t=>!this.hasModFor(t))}}const bs=new ys,ze={0:"Titan",1:"Hunter",2:"Warlock"};function js({targetElement:x,onTransfer:o,onEquip:t,onClose:h,showVault:N=!0,itemInstanceId:k,itemClass:H}){const{characters:T,selectedCharacterId:g,characterEquipment:P}=pe(),[B,U]=w.useState(null),[E,u]=w.useState(null),[R,C]=w.useState(null);if(!x)return null;const $=x.getBoundingClientRect(),W={position:"fixed",top:`${$.top}px`,left:`${$.right+16}px`,zIndex:1e5},O=y=>{o(y),h()},G=(y,M,z)=>{U(y),u(M);const D=z.currentTarget.getBoundingClientRect();C({x:D.left+D.width/2,y:D.bottom+8})},K=()=>{U(null),u(null),C(null)};return de.createPortal(e.jsxs("div",{className:"transfer-menu-overlay",children:[e.jsxs("div",{className:"transfer-menu-container",style:W,children:[e.jsx("svg",{className:"transfer-menu-connector",width:"16",height:"100%",style:{position:"absolute",left:"-16px",top:0,pointerEvents:"none"},children:e.jsx("line",{x1:"0",y1:"24",x2:"16",y2:"24",stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:"1"})}),e.jsxs("div",{className:"transfer-menu-wrapper",children:[e.jsx("div",{className:"transfer-menu-header",children:e.jsx("h3",{children:"SEND TO"})}),e.jsxs("div",{className:"transfer-menu-body",children:[T.map(y=>{const M=y.characterId===g,z=B===`transfer-${y.characterId}`,D=ze[y.classType]||"Guardian",Q=`${D} - Power ${y.light||"---"}${M?" (Current)":""}`;return e.jsx("div",{className:`transfer-menu-character ${M?"selected":""} ${z?"hovered":""}`,onClick:()=>O(y.characterId),onMouseEnter:se=>G(`transfer-${y.characterId}`,Q,se),onMouseLeave:K,children:e.jsx("div",{className:`transfer-menu-character-icon transfer-menu-character-icon--${D.toLowerCase()}`,children:e.jsx("img",{src:S(b.getClassIcon(y.classType)),alt:D})})},y.characterId)}),N&&e.jsx("div",{className:`transfer-menu-character ${B==="vault"?"hovered":""}`,onClick:()=>O("vault"),onMouseEnter:y=>G("vault","Vault",y),onMouseLeave:K,children:e.jsx("div",{className:"transfer-menu-character-icon transfer-menu-character-icon--vault",children:"V"})})]}),e.jsx("div",{className:"transfer-menu-header",style:{marginTop:"12px"},children:e.jsx("h3",{children:"EQUIP"})}),e.jsx("div",{className:"transfer-menu-body",children:T.filter(y=>H===3||H===void 0||y.classType===H).map(y=>{const M=y.characterId===g,z=k?P[y.characterId]?.some(te=>te.itemInstanceId===k):!1,D=B===`equip-${y.characterId}`,Q=ze[y.classType]||"Guardian",se=z?`${Q} - Already Equipped`:`Equip on ${Q}`;return e.jsxs("div",{className:`transfer-menu-character ${M?"selected":""} ${z?"active":""} ${D?"hovered":""}`,onClick:()=>{z||t(y.characterId),h()},onMouseEnter:te=>G(`equip-${y.characterId}`,se,te),onMouseLeave:K,children:[e.jsx("div",{className:`transfer-menu-character-icon transfer-menu-character-icon--${Q.toLowerCase()}`,children:e.jsx("img",{src:S(b.getClassIcon(y.classType)),alt:Q})}),z&&e.jsx("div",{className:"transfer-menu-equipped-indicator",title:"Already Equipped",children:"E"})]},y.characterId)})})]})]}),E&&R&&e.jsx("div",{className:"transfer-menu-plain-tooltip",style:{position:"fixed",left:`${R.x}px`,top:`${R.y}px`,transform:"translateX(-50%)",color:"white",fontSize:"12px",fontWeight:400,whiteSpace:"nowrap",pointerEvents:"none",zIndex:100001,textShadow:"0 1px 3px rgba(0, 0, 0, 0.8)"},children:E})]}),document.body)}function ks({text:x,children:o,delay:t=500,position:h="top"}){const[N,k]=w.useState(!1),[H,T]=w.useState({x:0,y:0}),g=w.useRef(null),P=w.useRef(null),B=()=>{g.current=window.setTimeout(()=>{if(P.current){const u=P.current.getBoundingClientRect();let R=u.left+u.width/2,C=u.top;switch(h){case"bottom":C=u.bottom;break;case"left":R=u.left,C=u.top+u.height/2;break;case"right":R=u.right,C=u.top+u.height/2;break;default:C=u.top;break}T({x:R,y:C}),k(!0)}},t)},U=()=>{g.current&&(clearTimeout(g.current),g.current=null),k(!1)};w.useEffect(()=>()=>{g.current&&clearTimeout(g.current)},[]);const E=ds.cloneElement(o,{onMouseEnter:u=>{B(),o.props?.onMouseEnter&&o.props.onMouseEnter(u)},onMouseLeave:u=>{U(),o.props?.onMouseLeave&&o.props.onMouseLeave(u)}});return e.jsxs(e.Fragment,{children:[E,N&&x&&de.createPortal(e.jsx("div",{className:`simple-tooltip simple-tooltip--${h}`,style:{left:`${H.x}px`,top:`${H.y}px`},children:x}),document.body)]})}const ws=({size:x=22})=>e.jsxs("svg",{width:x,height:x,viewBox:"0 0 24 24",fill:"none",stroke:"#000000",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{display:"block"},children:[e.jsx("rect",{className:"lock-body",x:"5",y:"11",width:"14",height:"10",rx:"2",ry:"2",fill:"#000000"}),e.jsx("path",{className:"lock-shackle",d:"M8 11V7a4 4 0 0 1 8 0v4",stroke:"#000000",strokeWidth:"2.5",fill:"none"}),e.jsx("circle",{cx:"12",cy:"15",r:"1.5",fill:"#ffffff"}),e.jsx("path",{d:"M12 16.5v1.5",stroke:"#ffffff",strokeWidth:"1.5"})]}),Ns=({size:x=22})=>e.jsxs("svg",{width:x,height:x,viewBox:"0 0 24 24",fill:"none",stroke:"#000000",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{display:"block"},children:[e.jsx("rect",{className:"lock-body",x:"5",y:"11",width:"14",height:"10",rx:"2",ry:"2",fill:"#000000"}),e.jsx("path",{className:"lock-shackle",d:"M8 11V7a4 4 0 0 1 8 0v1",stroke:"#000000",strokeWidth:"2.5",fill:"none"}),e.jsx("circle",{cx:"12",cy:"15",r:"1.5",fill:"#ffffff"}),e.jsx("path",{d:"M12 16.5v1.5",stroke:"#ffffff",strokeWidth:"1.5"})]}),Is={392767087:"Health",4244567218:"Melee",1735777505:"Grenade",144602215:"Super",1943323491:"Class",2996146975:"Weapons"},qe=[4043523819,3614673599,2523465841,1240592695,155624089,943549884,4188031367,1345609583,3555269338,2714457168,2715839340,4284893193,3871231066,447667954,2961396640,2837207746,2762071195,209426660,3736848092,3022301683,925767036,1480404414],Ts={4043523819:"impact",1240592695:"range",155624089:"stability",943549884:"handling",4188031367:"reloadSpeed",1345609583:"aimAssist",3555269338:"zoom",2714457168:"airborne",2715839340:"recoilDirection",4284893193:"rpm",3871231066:"magazine",447667954:"drawTime",2961396640:"chargeTime",3614673599:"blastRadius",2523465841:"velocity",2837207746:"swingSpeed",2762071195:"guardEfficiency",209426660:"guardResistance",3736848092:"guardEndurance",3022301683:"chargeRate",925767036:"ammoCapacity"},Ye=[3555269338,4284893193,2715839340,3871231066,447667954,2961396640],le=x=>x?x.split(`
`).map((o,t)=>{const h=o.trim();return h.startsWith("•")?e.jsxs("div",{className:"rich-tooltip-description-bullet",children:[e.jsx("span",{className:"bullet-char",children:"•"}),e.jsx("span",{className:"bullet-content",children:h.substring(1).trim()})]},t):e.jsx("div",{className:"rich-tooltip-description-line",children:o},t)}):null,Ms=w.memo(function({item:o,instance:t,characterStats:h,overrideElement:N,inline:k=!1,followMouse:H=!0,fixedPosition:T,isFocused:g=!1,onTransfer:P,onEquip:B,externalShowTransferMenu:U=!1,onClick:E,hideZoomButtons:u=!1,hideStats:R=!1,clickActionLabel:C,hideSynergizeAction:$=!1,onRightClick:W}){const{isLoaded:O}=Xe(),G=ps(),K=G.pathname.includes("/dim-loadout")||G.pathname.includes("/loadout-viewer")||G.pathname.includes("/loadout/")||G.pathname.includes("/builds")||G.pathname.includes("/saved-builds")||G.pathname.includes("/optimizer"),y=G.pathname.includes("/builder")||G.pathname.includes("/galaxy"),M=w.useRef(null),[z,D]=w.useState(!1),[Q,se]=w.useState(null),[te,xe]=w.useState({position:"fixed",transition:"opacity 0.05s ease-out",opacity:0,minWidth:"320px",pointerEvents:"none",left:"-1000px",top:"-1000px"});w.useEffect(()=>{U&&D(!0)},[U]),w.useEffect(()=>{if(!z)return;const s=a=>{const i=a.target;!i.closest(".transfer-menu-container")&&!i.closest(".rich-tooltip-lock-icon")&&D(!1)},l=setTimeout(()=>{document.addEventListener("click",s)},100);return()=>{clearTimeout(l),document.removeEventListener("click",s)}},[z]);const n=w.useMemo(()=>{if(!O)return;const s=o?.itemHash||o?.hash;return s?b.getItem(s):void 0},[o,O]),Y=w.useMemo(()=>{if(!n)return null;const s=Be.getRichData(n.hash),l={};return t?.sockets&&t.sockets.forEach(a=>{if(a.plugHash){const i=Be.getRichData(a.plugHash);i&&(l[a.plugHash]=i)}}),{itemDesc:s,perkDescs:l}},[n,t]);w.useEffect(()=>{},[g,P,o,n]),w.useEffect(()=>{if(k||!H){xe(T?c=>({...c,position:"fixed",left:`${T.x}px`,top:`${T.y}px`,opacity:1}):k?c=>({...c,position:"relative",left:void 0,top:void 0,opacity:1,zIndex:1}):c=>({...c,position:"relative",opacity:1,zIndex:1}));return}let s=!1;const l=c=>{if(!M.current||!H)return;const r=25,v=-25,V=180,j=M.current.offsetWidth,I=M.current.offsetHeight;let m=c.clientX+r,d=Math.max(V,c.clientY+v);m+j>window.innerWidth-20&&(m=c.clientX-j-r),d+I>window.innerHeight-150&&(d=window.innerHeight-I-150),m=Math.max(10,m),d=Math.max(V,d),M.current&&(M.current.style.left=`${m}px`,M.current.style.top=`${d}px`,M.current.style.opacity="1",M.current.style.pointerEvents=g?"auto":"none",M.current.style.cursor=g&&P?"pointer":"default"),s=!0},a=()=>{if(!M.current||s)return;const c=window.mouseX||window.innerWidth/2,r=window.mouseY||window.innerHeight/2;l(new MouseEvent("mousemove",{clientX:c,clientY:r}))};a(),requestAnimationFrame(a);const i=c=>{window.mouseX=c.clientX,window.mouseY=c.clientY};return window.addEventListener("mousemove",l),window.addEventListener("mousemove",i),()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mousemove",i)}},[T,H,k,g]);const f=n?.itemType===3,ye=n?.itemType===19||n?.itemType===24,A=n?.inventory?.tierType===6?"exotic":n?.inventory?.tierType===5?"legendary":n?.inventory?.tierType===4?"rare":"common",be=w.useMemo(()=>{const s={yellow:{},red:{}};return!n||!f||!t?.sockets||t.sockets.forEach(l=>{const a=b.getItem(l.plugHash);if(!a||!a.investmentStats)return;const i=a.plug?.plugCategoryIdentifier?.toLowerCase()||"",c=a.displayProperties?.name?.toLowerCase()||"",r=i.includes("masterworks")||i.includes("catalyst")||i.includes("exotic_masterwork")||c.includes("masterwork")||c.includes("catalyst");a.investmentStats.forEach(v=>{v.value>0?r&&(s.yellow[v.statTypeHash]=(s.yellow[v.statTypeHash]||0)+v.value):v.value<0&&(s.red[v.statTypeHash]=(s.red[v.statTypeHash]||0)+Math.abs(v.value))})}),s},[n,t,f]),ue=w.useMemo(()=>{const s={yellow:{},blue:{},red:{}};return!n||f||!t?.sockets||(o?.state&&o.state&4&&Object.keys(Is).forEach(a=>{s.yellow[Number(a)]=2}),t.sockets.forEach(a=>{const i=b.getItem(a.plugHash);if(!i||!i.investmentStats)return;const c=i.plug?.plugCategoryIdentifier?.toLowerCase()||"",r=A==="exotic"?[0,1,2,3]:[1,2,3,11],v=c.includes("mod")||r.includes(a.socketIndex),V=A==="exotic"&&(a.socketIndex===10||a.socketIndex===11);i.investmentStats.forEach(j=>{j.value>0?V&&j.value>2?s.yellow[j.statTypeHash]=(s.yellow[j.statTypeHash]||0)+j.value:v&&(s.blue[j.statTypeHash]=(s.blue[j.statTypeHash]||0)+j.value):j.value<0&&(s.red[j.statTypeHash]=(s.red[j.statTypeHash]||0)+Math.abs(j.value))})})),s},[n,t,f,A,o?.state]),Me=w.useMemo(()=>{if(!n)return[];const s=f?n.stats?.stats:t?.stats;if(!s)return[];let l;return f?l=Object.entries(s):l=[{statHash:2996146975,value:s.mobility},{statHash:392767087,value:s.resilience},{statHash:1943323491,value:s.recovery},{statHash:1735777505,value:s.discipline},{statHash:144602215,value:s.intellect},{statHash:4244567218,value:s.strength}],l.map(a=>{let i,c;f?(i=Number(a[0]),c=a[1]):(i=a.statHash,c=a);const r=b.getStat(i),v=n.itemSubType===10||n.itemTypeDisplayName?.toLowerCase().includes("sword");if(!r||!r.name||r.hash===1845991845||r.hash===1480404490||r.hash===3871231033||r.hash===1935470627||r.name.toLowerCase()==="attack"||r.name.toLowerCase()==="power"||v&&(r.name.toLowerCase()==="stability"||r.name.toLowerCase()==="guard efficiency"||r.name.toLowerCase()==="ammo generation"||r.hash===155624089||r.hash===2762071195))return null;let V=c.value;if(t&&f&&t.weaponStats){const p=Ts[i];p&&t.weaponStats[p]!==void 0&&(V=t.weaponStats[p])}const j=f?be.yellow[i]||0:ue.yellow[i]||0,I=f?0:ue.blue[i]||0,m=f?be.red[i]||0:ue.red[i]||0,d=Math.max(0,V-j-I);return{hash:i,name:r.name,value:V,whiteValue:d,yellowValue:j,blueValue:I,redValue:m}}).filter(Boolean).sort((a,i)=>{if(f){const c=qe.indexOf(a.hash),r=qe.indexOf(i.hash);if(c!==-1&&r!==-1)return c-r;if(c!==-1)return-1;if(r!==-1)return 1}else{const c=[2996146975,392767087,1943323491,1735777505,144602215,4244567218];return c.indexOf(a.hash)-c.indexOf(i.hash)}return 0})},[n,t,f,be,ue]),ie=w.useMemo(()=>n?.sockets?.socketEntries?n.sockets.socketEntries.map((s,l)=>{let a=s.singleInitialItemHash;if(t?.sockets){const c=t.sockets.find(r=>r.socketIndex===l);c?.plugHash&&(a=c.plugHash)}if(!a)return null;const i=b.getItem(a);return i?{index:l,hash:a,name:i.displayProperties?.name,icon:i.displayProperties?.icon,description:i.displayProperties?.description,investmentStats:i.investmentStats,plugCategoryIdentifier:i.plug?.plugCategoryIdentifier,isIntrinsic:l===0,isEnhanced:i.plug?.plugCategoryIdentifier?.includes("enhanced")||i.displayProperties?.name?.toLowerCase().includes("enhanced")||i.inventory?.tierType===6}:null}).filter(Boolean):[],[n,t]),Se=w.useMemo(()=>{if(!n||f||!t?.sockets)return[];const s=A==="exotic"?[0,1,2,3]:[1,2,3,11];return t.sockets.filter(l=>s.includes(l.socketIndex)&&l.plugHash).map(l=>{const a=b.getItem(l.plugHash);if(!a)return null;const i=a.plug?.plugCategoryIdentifier?.toLowerCase()||"",c=a.displayProperties?.name||"";return!c||c.toLowerCase().includes("empty")||i.includes("intrinsic")||i.includes("armor_skins")||!(i.includes("mod")||i.includes("enhancements")||a.itemType===19)?null:{socketIndex:l.socketIndex,hash:l.plugHash,name:c,icon:a.displayProperties?.icon,description:a.displayProperties?.description}}).filter(Boolean)},[n,t,f,A]);if(!n)return null;const je=n.plug?.plugCategoryIdentifier||"",Ke=!!(je&&/super|grenade|melee|movement|class_abilities|aspects|fragments|facets|whisper/i.test(je))||n.itemType===20,Qe=n.itemTypeDisplayName||"Unknown";if(n.itemType===16){const s=Fe(n),l=n.displayProperties?.icon?S(n.displayProperties.icon):null,a=n.displayProperties?.name||"Unknown",i=n.itemTypeDisplayName||"Subclass",c=n.displayProperties?.description;let r="",v="";if(t?.sockets){const I=t.sockets.find(m=>m.plugHash?b.getItem(m.plugHash)?.plug?.plugCategoryIdentifier?.toLowerCase().includes("super"):!1);if(I?.plugHash){const m=b.getItem(I.plugHash);r=m?.displayProperties?.name||"",v=m?.displayProperties?.description||""}}const V=[{hash:2996146975,name:"Weapons"},{hash:392767087,name:"Health"},{hash:1943323491,name:"Class"},{hash:1735777505,name:"Grenade"},{hash:144602215,name:"Super"},{hash:4244567218,name:"Melee"}],j=e.jsx("div",{className:"rich-tooltip-container",ref:M,style:te,children:e.jsxs("div",{className:`rich-tooltip-wrapper rich-tooltip-frame ${A} subclass-${s}`,children:[e.jsx("div",{className:"rich-tooltip-header",children:e.jsxs("div",{className:"rich-tooltip-header-top",children:[e.jsxs("div",{className:"subclass-tooltip-header-left",children:[e.jsx("div",{className:"rich-tooltip-name",children:a}),e.jsx("div",{className:"rich-tooltip-subtitle",children:i})]}),l&&e.jsx("img",{src:l,alt:"",className:"subclass-tooltip-icon"})]})}),e.jsxs("div",{className:"rich-tooltip-main",children:[c&&e.jsx("div",{className:"subclass-tooltip-flavor",children:e.jsx("em",{children:c})}),!R&&e.jsx("div",{className:"subclass-tooltip-stats",children:V.map(I=>{const m=h?.[I.name.toLowerCase()]||t?.stats?.[I.name.toLowerCase()]||0;return e.jsxs("div",{className:"subclass-tooltip-stat-row",children:[e.jsx("span",{className:"subclass-tooltip-stat-label",children:I.name}),e.jsx("div",{className:"subclass-tooltip-stat-bar-outer",children:e.jsx("div",{className:"subclass-tooltip-stat-bar-inner",style:{width:`${Math.min(100,m/100*100)}%`}})}),e.jsx("span",{className:"subclass-tooltip-stat-value",children:m})]},I.hash)})}),r&&e.jsxs("div",{className:"subclass-tooltip-super",children:[e.jsx("div",{className:"subclass-tooltip-super-name",children:r}),e.jsx("div",{className:"subclass-tooltip-super-desc",children:v})]})]}),!K&&(!u||C||W&&!$)&&e.jsxs("div",{className:"rich-tooltip-footer",children:[C?e.jsxs("div",{className:"rich-tooltip-control",onClick:I=>{E&&(I.stopPropagation(),I.preventDefault(),E())},style:{pointerEvents:"auto",cursor:"pointer"},children:[e.jsx("img",{src:ve,className:"rich-tooltip-mouse-icon",alt:"L"}),e.jsx("span",{children:C})]}):e.jsxs("div",{className:"rich-tooltip-control",children:[e.jsx("img",{src:ve,alt:"",className:"rich-tooltip-mouse-icon"}),e.jsx("span",{children:"Edit"})]}),W&&!$&&e.jsxs("div",{className:"rich-tooltip-control",onContextMenu:I=>{W&&(I.stopPropagation(),I.preventDefault(),W())},style:{pointerEvents:"auto",cursor:"pointer"},children:[e.jsx("img",{src:Ue,className:"rich-tooltip-mouse-icon",alt:"R"}),e.jsx("span",{children:"Synergize"})]})]})]})});return k?j:de.createPortal(j,document.body)}if(Ke){const s=N||Fe(n),l=n.displayProperties?.icon||"",a=l.startsWith("http")?l:l?S(l):null,i=n.displayProperties?.name||"Unknown",c=n.itemTypeDisplayName||je.replace(/_/g," ").replace(/\b\w/g,d=>d.toUpperCase())||"Ability";let r=n.displayProperties?.description;if(!r&&n.perks?.length&&(r=n.perks.map(d=>d.perkHash?b.getPerk(d.perkHash)?.description:null).filter(Boolean).join(`
`)),!r&&n.sockets?.socketEntries){const d=n.sockets.socketEntries.find(p=>{if(!p.singleInitialItemHash)return!1;const L=b.getItem(p.singleInitialItemHash);return L?.displayProperties?.description&&L.displayProperties.description.length>5});d&&(r=b.getItem(d.singleInitialItemHash)?.displayProperties?.description||"")}r=r||"",r&&(r=r.split(`
`).filter(d=>!/^[\+\-]\d+\s/.test(d.trim())).join(`
`).trim());const v=b.getDamageTypeIcon(s),V=v?v.startsWith("http")?v:S(v):null,I=(n.investmentStats||[]).filter(d=>d.value!==0).map(d=>{const p=b.getStat(d.statTypeHash);if(p?.name==="Fragment Cost")return null;const L=p?.icon?p.icon.startsWith("http")?p.icon:S(p.icon):null;return p?.name?{name:p.name,value:d.value,hash:d.statTypeHash,icon:L}:null}).filter(Boolean),m=e.jsx("div",{className:"rich-tooltip-container",ref:M,style:te,children:e.jsxs("div",{className:`rich-tooltip-wrapper rich-tooltip-frame ability-${s}`,children:[e.jsx("div",{className:"rich-tooltip-header",children:e.jsxs("div",{className:"rich-tooltip-header-top",children:[a&&e.jsx("img",{src:a,alt:"",className:"rich-tooltip-header-ability-icon"}),e.jsxs("div",{children:[e.jsx("div",{className:"rich-tooltip-name",children:i}),e.jsx("div",{className:"rich-tooltip-subtitle",children:e.jsxs("div",{className:"rich-tooltip-subtitle-row",children:[V&&e.jsx("img",{src:V,alt:"",className:"rich-tooltip-element-icon-sm"}),e.jsx("span",{children:c})]})})]})]})}),e.jsxs("div",{className:"rich-tooltip-main",children:[r&&e.jsx("div",{className:"rich-tooltip-ability-description",children:r}),!R&&I.length>0&&e.jsx("div",{className:"rich-tooltip-ability-stats",children:I.map((d,p)=>e.jsxs("div",{className:`rich-tooltip-ability-stat-row ${d.value>0?"positive":"negative"}`,children:[e.jsxs("div",{className:"rich-tooltip-ability-stat-left",children:[d.icon&&e.jsx("img",{src:d.icon,alt:"",className:"rich-tooltip-ability-stat-icon"}),e.jsxs("span",{className:"rich-tooltip-ability-stat-value",children:[d.value>0?"+":"",d.value]})]}),e.jsx("span",{className:"rich-tooltip-ability-stat-name",children:d.name})]},p))})]})]})});return k?m:de.createPortal(m,document.body)}const ke=t?.power||0,Ze=t?.damageType||n?.defaultDamageType||1,Je=Ss(Ze),He=Me.filter(s=>!Ye.includes(s.hash)),Ce=Me.filter(s=>Ye.includes(s.hash)),Ee=t?.gearTier||0,es=ie.find(s=>s.index===0);let Z=null,X=null;const he=s=>s.filter(l=>l&&!l.name?.toLowerCase().includes("empty")&&!l.name?.toLowerCase().includes("deprecated"));f?X=es:A==="exotic"&&(Z=he([ie.find(s=>s.index===11)])[0]);const we=(n.displayProperties?.name||"").toLowerCase().includes("ergo sum"),ss=ie.find(s=>s.index===3),ts=ie.find(s=>s.index===4),_=we?null:he([ss])[0],F=he([ts])[0],Le=we?ie.find(s=>s.index===6)||ie.find(s=>s.index===7):null,ce=we?Le:he([Le])[0],Pe=n.flavorText,me=b.getDamageTypeIcon(Je),$e=t?.objectives?.find(s=>s.objectiveHash===90275515||s.objectiveHash===2579044636||s.objectiveHash===73837075||s.objectiveHash===3387796140),De=t?.objectives?.find(s=>s.objectiveHash===1501870536||s.objectiveHash===2439952408||s.objectiveHash===74070459||s.objectiveHash===890482414||s.objectiveHash===2109364169);let Ae=null;if(f&&t?.sockets){const s=t.sockets.find(l=>l.socketIndex===9);if(s?.plugHash){const l=b.getItem(s.plugHash);if(l?.plug&&l.plug.plugObjectives){const a=l.plug.plugObjectives.find(i=>i.objectiveHash===90275515||i.objectiveHash===1501870536||i.objectiveHash===2579044636||i.objectiveHash===2439952408||i.objectiveHash===373673523);if(a){const i=t?.objectives?.find(c=>c.objectiveHash===a.objectiveHash);i&&(Ae=i)}}}}const Ne=$e||De||Ae||t?.objectives?.find(s=>s.visible||s.objectiveHash===373673523),fe=Ne?Ne.progress?.toLocaleString():null,is=De?"Guardians Defeated":$e?"Combatants Defeated":"Enemies Defeated",_e=!!(o?.state&&o.state&4)||A==="exotic",as=!!(o?.state&&o.state&8),rs=Ee>=2&&Ee<=5,ge=s=>f?s?.isEnhanced||as||rs:A==="exotic"&&s.index===11,ns=_e,os=_e,Re=t?.energy?.energyCapacity||0,We=ke>=200;let Ie=null,Te=null;if(!f){const s=ie.find(l=>l.index===6);s&&s.plugCategoryIdentifier?.includes("archetype")&&(Ie=s.name,s.icon&&(Te=S(s.icon)))}const Ve=e.jsx("div",{className:`rich-tooltip-container ${y?"galaxy-view":""}`,ref:M,style:{...te,pointerEvents:g||E?"auto":"none",cursor:E||g&&P?"pointer":"default"},onMouseDown:s=>{s.stopPropagation()},onClick:s=>{E?(s.stopPropagation(),s.preventDefault(),E()):g&&P&&(s.stopPropagation(),s.preventDefault(),D(!0))},children:e.jsxs("div",{className:`rich-tooltip-wrapper rich-tooltip-frame ${A} ${ye?"mod-grey":""}`,children:[e.jsxs("div",{className:"rich-tooltip-header",children:[ns&&e.jsx("div",{className:"rich-tooltip-masterwork-bar"}),os&&e.jsx("div",{className:"rich-tooltip-header-glow"}),e.jsx("div",{className:"rich-tooltip-header-top",children:e.jsx("div",{className:"rich-tooltip-name",children:n.displayProperties?.name})}),e.jsx("div",{className:"rich-tooltip-subtitle",children:e.jsxs("div",{className:"rich-tooltip-subtitle-row",children:[e.jsx("span",{children:Qe}),e.jsxs("div",{className:"rich-tooltip-subtitle-icons",children:[e.jsx("span",{className:`rich-tooltip-tier-text ${A}`,children:A}),t&&o.itemInstanceId&&e.jsx(ks,{text:t.state&1?"Unlock Item":"Lock Item",delay:300,children:e.jsx("div",{className:`rich-tooltip-lock-icon ${t.state&1?"locked":"unlocked"} ${Q||""}`,style:{pointerEvents:"auto",zIndex:100001,position:"relative"},onClick:async s=>{s.stopPropagation();const a=!((t.state&1)===1);se(a?"locking":"unlocking");const i=o.characterId||pe.getState().selectedCharacterId;if(!i||!o.itemInstanceId){se(null);return}const c=await us.setItemLockState(o.itemInstanceId,i,a);setTimeout(()=>{se(null)},500),c&&(a?t.state|=1:t.state&=-2)},children:t.state&1?e.jsx(ws,{size:14}):e.jsx(Ns,{size:14})})})]})]})})]}),e.jsxs("div",{className:"rich-tooltip-main",children:[ke>0&&e.jsxs("div",{className:"rich-tooltip-power-section",children:[e.jsxs("div",{className:"rich-tooltip-power-left",children:[f&&me&&e.jsx("img",{src:S(me),alt:"",className:"rich-tooltip-damage-type-icon"}),e.jsxs("span",{className:`rich-tooltip-power-value ${We?"power-blue":""}`,children:[ke,We?"+":""]}),e.jsxs("span",{className:"rich-tooltip-power-label",children:[f?"Attack":"Defense",f&&(()=>{const s=n.equippingBlock?.ammoType;let l="",a="",i="";s===1?(l="PRIMARY",a="ammo-primary",i="/common/destiny2_content/icons/99f3733354862047493d8550e46a45ec.png"):s===2?(l="SPECIAL",a="ammo-special",i="/common/destiny2_content/icons/d920203c4fd4571ae7f39eb5249eaecb.png"):s===3&&(l="HEAVY",a="ammo-heavy",i="/common/destiny2_content/icons/78ef0e2b281de7b60c48920223e0f9b1.png");const c=l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rich-tooltip-power-separator",children:"|"}),e.jsxs("div",{className:`rich-tooltip-ammo-pill ${a}`,children:[i&&e.jsx("img",{src:S(i),className:"rich-tooltip-ammo-icon",alt:""}),l]})]}),r=new Map;let v=!1;if((n.displayProperties?.name||"").toLowerCase().includes("slayer's fang")&&(r.set(2,{bId:2,isIntrinsic:!0}),v=!0),n.breakerType||n.breakerTypeHash){const m=n.breakerType||n.breakerTypeHash;r.set(m,{bId:m,isIntrinsic:!0}),v=!0}if(n.sockets?.socketEntries)for(const m of n.sockets.socketEntries){if(m.singleInitialItemHash){const d=b.getItem(m.singleInitialItemHash);if(d?.breakerType||d?.breakerTypeHash){const p=d.breakerType||d.breakerTypeHash;r.set(p,{bId:p,isIntrinsic:!0}),v=!0}if(d?.traitIds&&Array.isArray(d.traitIds))for(const p of d.traitIds){const L=p.toLowerCase();let q=0;L.includes("barrier")?q=1:L.includes("overload")?q=2:L.includes("unstoppable")&&(q=3),q>0&&(r.set(q,{bId:q,isIntrinsic:!0}),v=!0)}}if(m.reusablePlugItems)for(const d of m.reusablePlugItems){const p=b.getItem(d.plugItemHash);if(p?.breakerType||p?.breakerTypeHash){const L=p.breakerType||p.breakerTypeHash;r.set(L,{bId:L,isIntrinsic:!0}),v=!0}if(p?.traitIds&&Array.isArray(p.traitIds))for(const L of p.traitIds){const q=L.toLowerCase();let J=0;q.includes("barrier")?J=1:q.includes("overload")?J=2:q.includes("unstoppable")&&(J=3),J>0&&(r.set(J,{bId:J,isIntrinsic:!0}),v=!0)}}}if(t?.sockets)for(const m of t.sockets){if(!m.plugHash)continue;const d=b.getItem(m.plugHash);if(d?.breakerType||d?.breakerTypeHash){const p=d.breakerType||d.breakerTypeHash;(!r.has(p)||r.get(p)?.isIntrinsic)&&(r.set(p,{bId:p,isIntrinsic:!0}),v=!0)}}if(!v){const m=bs.getAntiChampionMods(),d=(n.itemTypeDisplayName||"").toLowerCase(),p=n.itemCategoryHashes||[],L=6,q=7,J=8,cs=5,ls=54;m.forEach(ae=>{const ne=ae.name.toLowerCase();let re=!1;if(ne.includes("pulse")&&p.includes(q)||ne.includes("hand cannon")&&p.includes(L)||ne.includes("scout")&&p.includes(J)||ne.includes("auto")&&!ne.includes("automatic")&&p.includes(cs)||ne.includes("sword")&&p.includes(ls)?re=!0:re=ae.weaponTypes.some(ee=>{const Ge=ee.toLowerCase();return d.includes(Ge)&&d===Ge}),re){let ee=0;ae.championType==="barrier"?ee=1:ae.championType==="overload"?ee=2:ae.championType==="unstoppable"&&(ee=3),ee>0&&r.set(ee,{bId:ee,icon:ae.icon,name:ae.name,isIntrinsic:!1})}})}const j={1:"/common/destiny2_content/icons/2ee146c19b93b88d2c7857005fc9a8c3.png",2:"/common/destiny2_content/icons/f5b9dd270a544afaf2b9a726b1296501.png"},I=r.size>0?Array.from(r.values()).map(m=>{const d=b.getBreakerType(m.bId);let p;m.icon?p=m.icon:m.isIntrinsic&&j[m.bId]?p=j[m.bId]:p=d?.icon;const L=m.name||d?.name;return p?e.jsx("img",{src:S(p),alt:L,className:"rich-tooltip-champion-icon",title:L},`champ-${m.bId}`):null}):null;return e.jsxs(e.Fragment,{children:[I,c]})})()]})]}),!f&&e.jsx(e.Fragment,{children:Ie?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rich-tooltip-power-separator",children:"|"}),e.jsxs("div",{className:"rich-tooltip-energy-block",children:[Te&&e.jsx("img",{src:Te,className:"rich-tooltip-energy-icon",alt:""}),e.jsx("span",{className:"rich-tooltip-energy-label",style:{fontWeight:700,color:"#fff"},children:Ie})]})]}):Re>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rich-tooltip-power-separator",children:"|"}),e.jsxs("div",{className:"rich-tooltip-energy-block",children:[me&&e.jsx("img",{src:S(me),className:"rich-tooltip-energy-icon",alt:""}),e.jsx("span",{className:"rich-tooltip-energy-value",children:Re}),e.jsx("span",{className:"rich-tooltip-energy-label",children:"Energy"})]})]})})]}),(fe||f&&Ne)&&e.jsxs("div",{className:"rich-tooltip-tracker",children:[e.jsxs("div",{className:"rich-tooltip-tracker-label",children:[e.jsx("img",{src:S("/common/destiny2_content/icons/683fd58d087968494b8e64c29a50123e.png"),className:"rich-tooltip-tracker-icon",alt:""}),e.jsx("span",{children:fe?is:"Kill Tracker"})]}),fe&&e.jsx("span",{className:"rich-tooltip-tracker-value",children:fe})]}),He.length>0&&e.jsx("div",{className:"rich-tooltip-stats",children:He.map(s=>e.jsxs("div",{className:"rich-tooltip-stat-row",children:[e.jsx("span",{className:"rich-tooltip-stat-name",children:s.name}),e.jsxs("div",{className:"rich-tooltip-stat-bar-outer",children:[e.jsx("div",{className:"rich-tooltip-stat-bar-inner",style:{width:`${Math.max(0,Math.min(s.whiteValue*(f?1:2),100))}%`,zIndex:4}}),s.yellowValue>0&&e.jsx("div",{className:"rich-tooltip-stat-bar-bonus-mw",style:{left:`${Math.max(0,Math.min(s.whiteValue*(f?1:2),100))}%`,width:`${Math.max(0,Math.min(s.yellowValue,s.value-s.whiteValue)*(f?1:2))}%`,zIndex:3}}),s.blueValue>0&&e.jsx("div",{className:"rich-tooltip-stat-bar-bonus-mod",style:{left:`${Math.max(0,Math.min((s.whiteValue+Math.min(s.yellowValue,s.value-s.whiteValue))*(f?1:2),100))}%`,width:`${Math.max(0,Math.min(s.blueValue,s.value-(s.whiteValue+Math.min(s.yellowValue,s.value-s.whiteValue)))*(f?1:2))}%`,zIndex:2}}),s.redValue>0&&e.jsx("div",{className:"rich-tooltip-stat-bar-penalty",style:{left:`${Math.max(0,Math.min(s.value*(f?1:2),100))}%`,width:`${Math.min(s.redValue*(f?1:2),100-s.value*(f?1:2))}%`,zIndex:1}}),e.jsx("span",{className:`rich-tooltip-stat-value ${s.yellowValue>0?"masterwork":""} ${s.blueValue>0?"mod":""}`,children:s.value})]})]},s.hash))}),!f&&Se.length>0&&e.jsxs("div",{className:"rich-tooltip-mod-sockets",children:[e.jsx("div",{className:"rich-tooltip-mod-sockets-label",children:"Mods"}),e.jsx("div",{className:"rich-tooltip-mod-sockets-list",children:Se.map(s=>e.jsxs("div",{className:"rich-tooltip-mod-socket-item",children:[s.icon&&e.jsx("img",{src:S(s.icon),alt:s.name,className:"rich-tooltip-mod-socket-icon"}),e.jsx("span",{className:"rich-tooltip-mod-socket-name",children:s.name})]},s.hash))})]}),!f&&Z&&e.jsxs("div",{className:"rich-tooltip-exotic-perk enhanced-trait",style:{marginBottom:"16px"},children:[e.jsxs("div",{className:"rich-tooltip-perk-header",children:[Z.icon&&e.jsx("img",{src:S(Z.icon),className:"rich-tooltip-perk-icon",alt:""}),e.jsx("div",{className:"rich-tooltip-perk-name enhanced",style:{fontSize:"15px"},children:Z.name})]}),e.jsx("div",{className:"rich-tooltip-perk-description",children:Y?.perkDescs[Z.hash]?.description?e.jsx("div",{className:"clarity-description",dangerouslySetInnerHTML:{__html:oe.sanitize(Y.perkDescs[Z.hash].description)}}):le(Z.description)})]}),Ce.length>0&&e.jsx("div",{className:"rich-tooltip-numeric-stats",children:Ce.map(s=>e.jsxs("div",{className:"rich-tooltip-numeric-row",children:[e.jsx("span",{className:"rich-tooltip-numeric-label",children:s.name}),e.jsx("span",{className:"rich-tooltip-numeric-value",children:s.value})]},s.hash))}),f&&X&&e.jsxs("div",{className:`rich-tooltip-exotic-perk ${X.isEnhanced||A==="exotic"?"enhanced-trait":""}`,children:[e.jsxs("div",{className:"rich-tooltip-perk-header",children:[X.icon&&e.jsx("img",{src:S(X.icon),className:"rich-tooltip-perk-icon",alt:""}),e.jsx("div",{className:"rich-tooltip-perk-name",children:X.name})]}),e.jsx("div",{className:"rich-tooltip-perk-description",children:Y?.perkDescs[X.hash]?.description?e.jsx("div",{className:"clarity-description",dangerouslySetInnerHTML:{__html:oe.sanitize(Y.perkDescs[X.hash].description)}}):le(X.description)})]}),A==="legendary"&&f&&(_||F)&&e.jsxs("div",{className:"rich-tooltip-legendary-perks",children:[_&&e.jsxs("div",{className:`rich-tooltip-perk-row ${ge(_)?"enhanced-trait":""}`,children:[_.icon&&e.jsx("img",{src:S(_.icon),className:"rich-tooltip-perk-icon-small",alt:""}),e.jsxs("div",{className:"rich-tooltip-perk-info",children:[e.jsx("div",{className:`rich-tooltip-perk-name-small ${ge(_)?"enhanced":""}`,children:_.name}),e.jsx("div",{className:"rich-tooltip-perk-description-small",children:Y?.perkDescs[_.hash]?.description?e.jsx("div",{className:"clarity-description",dangerouslySetInnerHTML:{__html:oe.sanitize(Y.perkDescs[_.hash].description)}}):le(_.description)})]})]}),F&&e.jsxs("div",{className:`rich-tooltip-perk-row ${ge(F)?"enhanced-trait":""}`,children:[F.icon&&e.jsx("img",{src:S(F.icon),className:"rich-tooltip-perk-icon-small",alt:""}),e.jsxs("div",{className:"rich-tooltip-perk-info",children:[e.jsx("div",{className:`rich-tooltip-perk-name-small ${ge(F)?"enhanced":""}`,children:F.name}),e.jsx("div",{className:"rich-tooltip-perk-description-small",children:Y?.perkDescs[F.hash]?.description?e.jsx("div",{className:"clarity-description",dangerouslySetInnerHTML:{__html:oe.sanitize(Y.perkDescs[F.hash].description)}}):le(F.description)})]})]})]}),A==="exotic"&&f&&_&&e.jsxs("div",{className:"rich-tooltip-exotic-perk enhanced-trait",children:[e.jsxs("div",{className:"rich-tooltip-perk-header",children:[_.icon&&e.jsx("img",{src:S(_.icon),className:"rich-tooltip-perk-icon",alt:""}),e.jsx("div",{className:"rich-tooltip-perk-name",children:_.name})]}),e.jsx("div",{className:"rich-tooltip-perk-description",children:Y?.perkDescs[_.hash]?.description?e.jsx("div",{className:"clarity-description",dangerouslySetInnerHTML:{__html:oe.sanitize(Y.perkDescs[_.hash].description)}}):_.description})]}),ce&&e.jsxs("div",{className:"rich-tooltip-exotic-perk enhanced-trait",style:{borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:"8px"},children:[e.jsxs("div",{className:"rich-tooltip-perk-header",children:[ce.icon&&e.jsx("img",{src:S(ce.icon),className:"rich-tooltip-perk-icon",alt:""}),e.jsx("div",{className:"rich-tooltip-perk-name",children:ce.name})]}),e.jsx("div",{className:"rich-tooltip-perk-description",children:ce.description})]}),ye&&(()=>{let s=n.displayProperties?.description,l=!1;if(!s&&n.perks?.length>0){const a=[];n.perks.forEach(i=>{if(i.perkHash){const c=b.getPerk(i.perkHash);c?.description&&a.push(c.description)}}),a.length>0&&(s=a.join(`

`))}if(!s&&n.investmentStats?.length>0){const a=[],i=[];if(n.investmentStats.forEach(c=>{if(Math.abs(c.value)>=5){const r=b.getStat(c.statTypeHash);if(r?.name&&r?.icon){const v=c.value,V=v>0?"+":"",j=S(r.icon);a.push(`<span style="white-space: nowrap; display: inline-flex; align-items: center;">${V}${v}<img src="${j}" style="width: 16px; height: 16px; display: inline-block; margin-left: 16px; margin-right: 6px;" alt="" />${r.name}</span>`),r.description&&i.push(r.description)}}}),a.length>0){const c=[a.join(" ")];i.length>0&&c.push('<br/><span style="font-style: italic; opacity: 0.8;">'+i.join(" ")+"</span>"),s=c.join(""),l=!0}}return s?l?e.jsx("div",{className:"rich-tooltip-perk-description",style:{marginTop:"12px"},dangerouslySetInnerHTML:{__html:oe.sanitize(s)}}):e.jsx("div",{className:"rich-tooltip-perk-description",style:{marginTop:"12px"},children:le(s)}):null})(),Pe&&!ye&&e.jsx("div",{className:"rich-tooltip-flavor",children:Pe})]}),!K&&(!u||C||A==="exotic"&&y&&W&&!$)&&e.jsxs("div",{className:"rich-tooltip-footer",children:[C?e.jsxs("div",{className:"rich-tooltip-control",onClick:s=>{E&&(s.stopPropagation(),s.preventDefault(),E())},style:{pointerEvents:"auto",cursor:"pointer"},children:[e.jsx("img",{src:ve,className:"rich-tooltip-mouse-icon",alt:"L"}),e.jsx("span",{children:C})]}):e.jsxs("div",{className:"rich-tooltip-control",onClick:s=>{g&&P&&(s.stopPropagation(),s.preventDefault(),D(!0))},style:{pointerEvents:g?"auto":"none",cursor:g&&P?"pointer":"default"},children:[e.jsx("img",{src:ve,className:"rich-tooltip-mouse-icon",alt:"L"}),e.jsx("span",{children:g?f?"Transmat Weapon":"Transmat Armor":"Zoom"})]}),A==="exotic"&&y&&W&&!$&&e.jsxs("div",{className:"rich-tooltip-control",onContextMenu:s=>{W&&(s.stopPropagation(),s.preventDefault(),W())},style:{pointerEvents:"auto",cursor:"pointer"},children:[e.jsx("img",{src:Ue,className:"rich-tooltip-mouse-icon",alt:"R"}),e.jsx("span",{children:"Synergize"})]})]}),z&&g&&P&&e.jsx(js,{targetElement:M.current,onTransfer:s=>{P(s),D(!1)},onEquip:s=>{B&&B(s),D(!1)},onClose:()=>{D(!1)},showVault:o.location!=="vault",itemInstanceId:o.itemInstanceId,itemClass:n?.classType})]})});return k?Ve:de.createPortal(Ve,document.body)});function Ss(x){switch(x){case 1:return"kinetic";case 2:return"arc";case 3:return"solar";case 4:return"void";case 6:return"stasis";case 7:return"strand";default:return"kinetic"}}function Fe(x){const o=(x.plug?.plugCategoryIdentifier||"").toLowerCase();if(/\bvoid\b/.test(o))return"void";if(/\bsolar\b/.test(o)||/\bthermal\b/.test(o))return"solar";if(/\barc\b/.test(o))return"arc";if(/\bstasis\b/.test(o))return"stasis";if(/\bstrand\b/.test(o))return"strand";if(/\bprismatic\b/.test(o)||o.includes("facet"))return"prismatic";if(x.defaultDamageType)switch(x.defaultDamageType){case 2:return"arc";case 3:return"solar";case 4:return"void";case 6:return"stasis";case 7:return"strand";case 8:return"prismatic"}if(x.talentGrid?.hudDamageType)switch(x.talentGrid.hudDamageType){case 2:return"arc";case 3:return"solar";case 4:return"void";case 6:return"stasis";case 7:return"strand";case 8:return"prismatic"}const t=(x.displayProperties?.name||"").toLowerCase();return/\bprismatic\b/.test(t)?"prismatic":/\bsolar\b/.test(t)||/\bdawn\b/.test(t)||/\bgunslinger\b/.test(t)||/\bfire\b/.test(t)?"solar":/\bvoid\b/.test(t)||/\bnight\b/.test(t)||/\bvoidwalker\b/.test(t)||/\bsentinel\b/.test(t)?"void":/\barc\b/.test(t)||/\bstorm\b/.test(t)||/\bstriker\b/.test(t)||/\bstrider\b/.test(t)?"arc":/\bstasis\b/.test(t)||/\bshade\b/.test(t)||/\brevenant\b/.test(t)||/\bbehemoth\b/.test(t)?"stasis":/\bstrand\b/.test(t)||/\bbrood\b/.test(t)||/\bthread\b/.test(t)||/\bberserk\b/.test(t)?"strand":"void"}function Hs({type:x,size:o="normal",label:t,icon:h,status:N="empty",element:k="void",onClick:H,onMouseEnter:T,onMouseLeave:g,onContextMenu:P,style:B,children:U,noBorder:E,itemId:u,itemHash:R}){const C=o==="large"?"subclass-node--large":o==="small"?"subclass-node--small":"",$=u||R?.toString(),{activeTransfers:W,successfulTransfers:O}=pe(),G=$&&W.has($),K=$&&O.has($);return e.jsxs("div",{className:`subclass-node-container ${x} ${C} ${E?"no-border":""} ${G?"transfer-active":""} ${K?"transfer-success":""}`,style:B,"data-item-id":$,"data-item-hash":R,children:[e.jsxs("button",{className:`subclass-node subclass-node--${x} ${C} subclass-node--${N} element-${k} ${E?"subclass-node--no-border":""}`,onClick:H,onMouseEnter:T,onMouseLeave:g,onContextMenu:P,"aria-label":t,children:[e.jsxs("div",{className:"subclass-node__inner",children:[h&&e.jsx("img",{src:h,alt:"",className:"subclass-node__icon"}),U]}),x==="diamond"&&!E&&e.jsx("svg",{className:"subclass-node__border",viewBox:"0 0 100 100",children:e.jsx("path",{d:"M50 0 L100 50 L50 100 L0 50 Z",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]}),t&&e.jsx("span",{className:"subclass-node__label",children:t})]})}const Ds=w.forwardRef(function({children:o,onSubclassClick:t,hoveredSubclass:h,setHoveredSubclass:N,onSubclassDataReady:k},H){const{isLoaded:T}=Xe(),{hideGlobalUI:g}=hs(),{selectedCharacterId:P,characterEquipment:B,itemInstances:U}=pe(),E=B[P||""]||[],u=ms(E,fs.SUBCLASS),R=T&&u?b.getItem(u.itemHash):void 0,C=R?.displayProperties?.icon?S(R.displayProperties.icon):void 0,$=W=>{if(!T)return"void";const O=b.getItem(W);return O?.talentGrid?.hudDamageType===2?"arc":O?.talentGrid?.hudDamageType===3?"solar":O?.talentGrid?.hudDamageType===4?"void":O?.talentGrid?.hudDamageType===6?"stasis":O?.talentGrid?.hudDamageType===7?"strand":(O?.displayProperties?.name?.toLowerCase()||"").includes("prismatic")?"prismatic":"kinetic"};return w.useEffect(()=>{if(u&&k){const W=u.itemInstanceId?U[u.itemInstanceId]:void 0;k(u,W)}},[u?.itemHash,u?.itemInstanceId,k]),e.jsxs("div",{ref:H,className:"builder-container",children:[T&&u&&!g&&e.jsxs("div",{className:"builder-container__subclass-bar",children:[e.jsx("div",{className:`builder-container__subclass-equipped element-${$(u.itemHash)}`,children:e.jsx(Hs,{type:u&&$(u.itemHash)==="prismatic"?"round":"diamond",size:"small",status:"active",element:u?$(u.itemHash):"void",icon:C,noBorder:!0,itemId:u?.itemInstanceId,itemHash:u?.itemHash,onClick:()=>t(u.itemHash,u.itemInstanceId),onMouseEnter:()=>N({item:u,instance:u.itemInstanceId?U[u.itemInstanceId]:void 0}),onMouseLeave:()=>N(null)})}),h&&e.jsx("div",{className:"builder-container__subclass-tooltip",children:e.jsx(Ms,{item:h.item,instance:h.instance,hideStats:!0})})]}),e.jsx("div",{className:"builder-container__content",children:o})]})});export{Ds as B,ve as M,Ms as R,Hs as S,Ue as a};
//# sourceMappingURL=builder-B7mi84rt.js.map
