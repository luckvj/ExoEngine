import{j as e}from"./markdown-DyKRzreE.js";import{h as oe,d as le,r as y}from"./react-vendor-BrsWO7iZ.js";import{F as A,n as C,m as l,g as j,A as re,R as B,C as ce,B as x}from"./galaxy-DVJjGVLR.js";import{L as de}from"./index-BJ86MllY.js";import{S as P,R as me}from"./builder-B7mi84rt.js";import"./utils-Cl4ySqJD.js";const ue={1:"kinetic",2:"arc",3:"solar",4:"void",6:"stasis",7:"strand"},he={0:"Titan",1:"Hunter",2:"Warlock"};function je(){const{encodedData:I}=oe(),L=le(),[g,z]=y.useState(null),[V,M]=y.useState(!0),[w,W]=y.useState(null),[T,$]=y.useState(!1),[_,R]=y.useState(!0),[O,h]=y.useState(null),[G,Y]=y.useState({x:0,y:0}),K=s=>{const{clientX:a,clientY:i}=s,{innerWidth:d,innerHeight:v}=window,m=a/d-.5,u=i/v-.5;Y({x:m,y:u})},[F,H]=y.useState(null),[D,q]=y.useState(null),E=s=>{D&&clearTimeout(D),H(s);const a=setTimeout(()=>H(null),2500);q(a)};y.useEffect(()=>{(async()=>{try{l.isLoaded()||await l.load(),$(!0)}catch(a){C("LoadoutViewerPage","Failed to load manifest:",a),E("Failed to load Destiny 2 database")}})()},[]),y.useEffect(()=>{g&&window.scrollTo({top:0,behavior:"smooth"})},[g]),y.useEffect(()=>{const s=async a=>{const i=document.activeElement;i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.isContentEditable)||(a.key==="Control"&&R(v=>!v),a.key==="Escape"&&L("/agent-wake"),(a.key==="g"||a.key==="G")&&g?.source!=="exoengine"&&U())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[g,L]);const X=async()=>{if(g)try{const s=await A.generateExoEngineLink(g);await navigator.clipboard.writeText(s),E("Link copied to clipboard")}catch(s){C("LoadoutViewerPage","Failed to copy link:",s),E("Failed to copy link")}},U=async()=>{if(g)try{const s=A.generateDIMCompatibleLink(g);navigator.clipboard.writeText(s),E("Link copied to clipboard")}catch(s){C("LoadoutViewerPage","Failed to copy DIM link:",s),E("Failed to copy link")}};if(y.useEffect(()=>{I&&T?(async()=>{try{const s=await A.parseLoadoutLink(`/loadout/${I}`);z(s),M(!1)}catch(s){C("LoadoutViewerPage","Full decode failed:",s),W("This loadout link is invalid or expired"),M(!1)}})():!I&&T&&M(!1)},[I,T]),w)return e.jsx("div",{className:"loadout-viewer-error",children:e.jsxs("div",{className:"error-card glass-panel",children:[e.jsx("h2",{children:"SYSTEM ERROR"}),e.jsx("p",{children:w}),e.jsx("button",{className:"btn btn-primary",onClick:()=>L("/generator"),children:"Return to Tactical Hub"})]})});if(V||!T)return e.jsx(de,{message:"Syncing Tactical Data..."});const t={};g.equipped.forEach(s=>{const a=l.getItem(s.hash);if(!a)return;const i=a.inventory?.bucketTypeHash;i===x.KINETIC_WEAPONS?t.kinetic=s:i===x.ENERGY_WEAPONS?t.energy=s:i===x.POWER_WEAPONS?t.power=s:i===x.HELMET?t.helmet=s:i===x.GAUNTLETS?t.arms=s:i===x.CHEST_ARMOR?t.chest=s:i===x.LEG_ARMOR?t.legs=s:i===x.CLASS_ARMOR?t.classItem=s:i===x.SUBCLASS&&(t.subclass=s)});const n={subclass:(s=>{if(!s)return{icon:"",hash:0};const a=l.getItem(s.hash);return{icon:j(a?.displayProperties?.icon||""),hash:s.hash}})(t.subclass),super:{icon:"",hash:0},abilities:[],aspects:[],fragments:[]},N=t.subclass?l.getItem(t.subclass.hash):null,J=N?.talentGrid?.hudDamageType||3,k=ue[J]||"solar";if(t.subclass?.socketOverrides&&N){const s={},a={457473665:"SUPER",2047681910:"ASPECTS",2140934067:"ASPECTS",3400923910:"ASPECTS",764703411:"ASPECTS",271461480:"FRAGMENTS",1313488945:"FRAGMENTS",2819965312:"FRAGMENTS",193371309:"FRAGMENTS",4112185160:"FRAGMENTS",309722977:"CLASS_ABILITIES",3218807805:"CLASS_ABILITIES",1905270138:"ABILITIES"};N.sockets?.socketCategories&&N.sockets.socketCategories.forEach(i=>{const d=a[i.socketCategoryHash];d&&i.socketIndexes.forEach(v=>{s[v]=d})}),Object.entries(t.subclass.socketOverrides).forEach(([i,d])=>{const v=parseInt(i),m=l.getItem(d);if(!m)return;const p={icon:j(m.displayProperties.icon)||"",hash:d,idx:v},r=s[v],o=(m.plug?.plugCategoryIdentifier||"").toLowerCase(),S=(m.displayProperties?.name||"").toLowerCase();if(r==="SUPER")n.super=p;else if(r==="ASPECTS")n.aspects.some(f=>f.hash===p.hash)||n.aspects.push(p);else if(r==="FRAGMENTS")n.fragments.some(f=>f.hash===p.hash)||n.fragments.push(p);else if(r==="CLASS_ABILITIES"||r==="ABILITIES"||o.includes(".ability.")){let f=10;o.includes("class")||S.includes("rift")||S.includes("dodge")||S.includes("barricade")?f=0:o.includes("movement")||o.includes("jump")?f=1:o.includes("melee")?f=2:o.includes("grenade")&&(f=3),p.priority=f,!n.abilities.some(ne=>ne.hash===p.hash)&&n.super.hash!==p.hash&&n.abilities.push(p)}}),n.abilities.sort((i,d)=>(i.priority??99)-(d.priority??99))}else t.subclass?.socketOverrides&&(Object.entries(t.subclass.socketOverrides).forEach(([s,a])=>{const i=parseInt(s),d=l.getItem(a);if(!d)return;const m={icon:j(d.displayProperties.icon)||"",hash:a,idx:i},u=(d.plug?.plugCategoryIdentifier||"").toLowerCase(),p=(d.itemTypeDisplayName||"").toLowerCase(),r=(d.displayProperties?.name||"").toLowerCase();if(!((u.includes(".super")||i===0)&&((u.includes(".super")||!n.super.hash)&&(n.super=m),u.includes(".super"))))if(u.includes("aspect")||p.includes("aspect"))n.aspects.some(o=>o.hash===m.hash)||n.aspects.push(m);else if(u.includes("fragment")||u.includes("facet")||r.includes("facet of"))n.fragments.some(o=>o.hash===m.hash)||n.fragments.push(m);else{let o=10;u.includes("class")||r.includes("rift")||r.includes("dodge")||r.includes("barricade")?o=0:u.includes("movement")||u.includes("jump")?o=1:u.includes("melee")?o=2:u.includes("grenade")&&(o=3),m.priority=o,!n.abilities.some(S=>S.hash===m.hash)&&n.super.hash!==m.hash&&n.abilities.push(m)}}),n.abilities.sort((s,a)=>(s.priority??99)-(a.priority??99)));const Q=re(g,t),{modGroups:b,armorCosmetics:c}=Q,Z=(s,a=null,i=null)=>{const{mainStat:d,secondaryStat:v,others:m}=ce(s),u=r=>{const o=r?l.getItem(r):null;return o?e.jsx("div",{className:"mod-pod cosmetic-pod",onMouseEnter:()=>h(r),onMouseLeave:()=>h(null),children:e.jsx("img",{src:j(o.displayProperties?.icon||""),alt:""})},r):e.jsx("div",{className:"mod-pod cosmetic-pod placeholder-pod"})},p=r=>{const o=l.getItem(r);return o?e.jsx("div",{className:"mod-pod",onMouseEnter:()=>h(r),onMouseLeave:()=>h(null),children:e.jsx("img",{src:j(o.displayProperties?.icon||""),alt:""})},r):null};return e.jsxs("div",{className:"armor-mods-pod-grid",children:[u(i?.hash),u(a?.hash),d&&p(d),v&&p(v),m.map(r=>p(r))]})},ee={ornament:c.helmet?.ornament?l.getItem(c.helmet.ornament):null,shader:c.helmet?.shader?l.getItem(c.helmet.shader):null},se={ornament:c.arms?.ornament?l.getItem(c.arms.ornament):null,shader:c.arms?.shader?l.getItem(c.arms.shader):null},ae={ornament:c.chest?.ornament?l.getItem(c.chest.ornament):null,shader:c.chest?.shader?l.getItem(c.chest.shader):null},ie={ornament:c.legs?.ornament?l.getItem(c.legs.ornament):null,shader:c.legs?.shader?l.getItem(c.legs.shader):null},te={ornament:c.classItem?.ornament?l.getItem(c.classItem.ornament):null,shader:c.classItem?.shader?l.getItem(c.classItem.shader):null};return e.jsxs("div",{className:`loadout-viewer-page synergy-build-overlay synergy-build-overlay--${k} ${_?"":"ui-hidden"}`,onMouseMove:K,style:{zIndex:2e4,"--parallax-x":G.x,"--parallax-y":G.y},children:[e.jsxs("div",{className:"synergy-build-overlay__bg",children:[e.jsx("div",{className:"synergy-build-overlay__pattern"}),e.jsx("img",{src:j(N?.screenshot||""),alt:"",className:"synergy-build-overlay__screenshot"}),e.jsx("div",{className:"synergy-build-overlay__vignette"})]}),F&&e.jsx("div",{className:"vault-service-alert animate-slide-up",children:e.jsxs("div",{className:"service-alert-content",children:[e.jsx("div",{className:"service-alert-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})})}),e.jsxs("div",{className:"service-alert-text",children:[e.jsx("span",{className:"alert-bold",children:"INFO"}),e.jsx("span",{className:"alert-message",children:F})]})]})}),e.jsx("div",{className:"synergy-build-overlay__header-top-right",children:e.jsxs("div",{className:"synergy-build-overlay__title-area",children:[e.jsx("h1",{className:"synergy-build-overlay__title-large",children:g.name||"TACTICAL CONFIGURATION"}),e.jsxs("div",{className:"synergy-build-overlay__subtitle-caps",children:[he[g.classType].toUpperCase()," // ",N?.displayProperties?.name?.toUpperCase()||"UNKNOWN SUBCLASS"]})]})}),e.jsxs("div",{className:"synergy-build-overlay__content",children:[e.jsx("div",{className:"build-section build-section--super",children:n.super.icon&&e.jsx("div",{className:"super-node-large",children:e.jsx("img",{src:n.super.icon,alt:"Primary Ability",onMouseEnter:()=>h(n.super.hash||null),onMouseLeave:()=>h(null)})})}),e.jsxs("div",{className:"build-section--middle",children:[e.jsxs("div",{className:"build-section--middle__top-row",children:[e.jsxs("div",{className:"node-section section-abilities",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| ABILITIES"}),e.jsx("div",{className:"node-section-content",children:n.abilities.map((s,a)=>e.jsx(P,{type:"square",size:"normal",icon:s.icon,element:k,status:"active",onMouseEnter:()=>h(s.hash),onMouseLeave:()=>h(null)},a))})]}),e.jsxs("div",{className:"node-section section-aspects",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| ASPECTS"}),e.jsx("div",{className:"node-section-content",children:n.aspects.map((s,a)=>e.jsx(P,{type:"square",size:"normal",icon:s.icon,element:k,status:"active",onMouseEnter:()=>h(s.hash),onMouseLeave:()=>h(null)},a))})]})]}),e.jsx("div",{className:"build-section--middle__bottom-row",children:e.jsxs("div",{className:"node-section section-fragments",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| FRAGMENTS"}),e.jsx("div",{className:"synergy-build-overlay__fragments-grid",children:n.fragments.map((s,a)=>e.jsx(P,{type:"square",size:"small",icon:s.icon,element:k,status:"active",onMouseEnter:()=>h(s.hash||null),onMouseLeave:()=>h(null)},a))})]})}),e.jsx("div",{className:"build-section--middle__gear-row",children:e.jsxs("div",{className:"node-section section-gear",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| LOADOUT & GEAR"}),e.jsxs("div",{className:"synergy-build-overlay__gear-horizontal-grid",children:[[{item:t.kinetic,label:"KINETIC"},{item:t.energy,label:"ENERGY"},{item:t.power,label:"POWER"}].map((s,a)=>e.jsx("div",{className:`gear-item-horizontal ${s.item?"":"gear-item--empty"}`,onMouseEnter:()=>s.item&&h(s.item.hash),onMouseLeave:()=>h(null),children:s.item?e.jsxs(e.Fragment,{children:[e.jsx(B,{hash:s.item.hash,instance:s.item}),e.jsx("div",{className:"gear-item-info",children:e.jsx("span",{className:"build-item__label--compact",children:l.getItem(s.item.hash)?.displayProperties?.name})})]}):e.jsxs("div",{className:"gear-placeholder",children:[e.jsx("div",{className:"gear-placeholder__icon"}),e.jsxs("span",{children:[s.label," EMPTY"]})]})},`weapon-${a}`)),[{item:t.helmet,group:b.helmet,cosmetics:ee,label:"HELMET"},{item:t.arms,group:b.arms,cosmetics:se,label:"GAUNTLETS"},{item:t.chest,group:b.chest,cosmetics:ae,label:"CHEST"},{item:t.legs,group:b.legs,cosmetics:ie,label:"LEGS"},{item:t.classItem,group:b.classItem,cosmetics:te,label:"CLASS"}].map((s,a)=>e.jsx("div",{className:`gear-item-horizontal ${s.item?"":"gear-item--empty"}`,onMouseEnter:()=>s.item&&h(s.item.hash),onMouseLeave:()=>h(null),children:s.item?e.jsxs(e.Fragment,{children:[e.jsx(B,{hash:s.item.hash,instance:s.item}),e.jsxs("div",{className:"gear-item-info",children:[e.jsx("span",{className:"build-item__label--compact",children:l.getItem(s.item.hash)?.displayProperties?.name}),Z(s.group,s.cosmetics.ornament,s.cosmetics.shader)]})]}):e.jsxs("div",{className:"gear-placeholder",children:[e.jsx("div",{className:"gear-placeholder__icon"}),e.jsxs("span",{children:[s.label," EMPTY"]})]})},`armor-${a}`))]})]})})]})]}),e.jsxs("div",{className:"synergy-build-overlay__footer-bar",children:[e.jsxs("div",{className:"key-prompt",onClick:()=>R(!_),children:[e.jsx("div",{className:"key-cap",children:"CTRL"}),e.jsxs("div",{className:"key-label",children:[_?"Hide":"Show"," Menu"]})]}),g?.source!=="exoengine"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"key-prompt",onClick:X,children:[e.jsx("div",{className:"key-cap",children:"S"}),e.jsx("div",{className:"key-label",children:"Copy Exo Link"})]}),e.jsxs("div",{className:"key-prompt",onClick:U,children:[e.jsx("div",{className:"key-cap",children:"G"}),e.jsx("div",{className:"key-label",children:"Copy DIM Link"})]})]}),e.jsxs("div",{className:"key-prompt",onClick:()=>L("/agent-wake"),children:[e.jsx("div",{className:"key-cap",children:"ESC"}),e.jsx("div",{className:"key-label",children:"Back"})]})]}),O!==null&&e.jsx("div",{className:"fixed-tooltip-container",children:e.jsx(me,{item:l.getItem(O)})})]})}export{je as LoadoutViewerPage,je as default};
//# sourceMappingURL=LoadoutViewerPage-D0oRs6Ak.js.map
