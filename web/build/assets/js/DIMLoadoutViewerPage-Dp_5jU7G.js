import{j as e}from"./markdown-DyKRzreE.js";import{r as p,d as We,e as Fe}from"./react-vendor-BrsWO7iZ.js";import{m as a,B as x,g as N,A as Ve,R as ye,F as Ke,n as ve,C as Ye}from"./galaxy-DVJjGVLR.js";import{b as $e}from"./build.service-CZ6lIic1.js";import{L as Xe}from"./index-BJ86MllY.js";import{a as Je,M as Qe,S as _,R as Ze}from"./builder-B7mi84rt.js";/* empty css                             */import"./utils-Cl4ySqJD.js";const es=({isOpen:y,title:R="NAME YOUR BUILD",message:n,defaultValue:T="",onConfirm:b,onCancel:E})=>{const[u,D]=p.useState(T),A=p.useRef(null);p.useEffect(()=>{y&&(D(T),setTimeout(()=>{A.current?.focus(),A.current?.select()},100))},[y,T]);const F=()=>{E()},O=o=>{o.preventDefault(),u.trim()&&b(u.trim())};return p.useEffect(()=>{if(!y)return;const o=i=>{i.preventDefault(),u.trim()&&b(u.trim())},w=i=>{i.key==="Enter"&&u.trim()?b(u.trim()):i.key==="Escape"&&E()};return document.addEventListener("contextmenu",o),document.addEventListener("keydown",w),()=>{document.removeEventListener("contextmenu",o),document.removeEventListener("keydown",w)}},[y,u,b,E]),y?e.jsx("div",{className:"d2-confirmation-modal-backdrop",onClick:F,onContextMenu:O,children:e.jsx("div",{className:"d2-confirmation-strip",children:e.jsx("div",{className:"d2-modal-container",children:e.jsxs("div",{className:"d2-modal-main",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"d2-modal-header d2-modal-header--info",children:[e.jsx("div",{className:"d2-info-icon-container",children:e.jsx("div",{className:"info-circle info-circle--info",children:"A"})}),e.jsx("h1",{className:"d2-confirmation-title",children:R})]}),e.jsx("div",{className:"d2-modal-body d2-modal-body--naming",children:e.jsxs("div",{className:"naming-container",children:[e.jsx("p",{className:"d2-confirmation-message",children:n}),e.jsx("input",{ref:A,id:"build-naming-input",name:"build-naming-input",type:"text",className:"d2-naming-input",value:u,onChange:o=>D(o.target.value),placeholder:"Enter build name...",maxLength:40,autoFocus:!0})]})}),e.jsx("div",{className:"d2-modal-footer",children:e.jsxs("div",{className:"d2-confirmation-controls",children:[e.jsxs("div",{className:"control-group",onClick:o=>{o.stopPropagation(),u.trim()&&b(u.trim())},onContextMenu:o=>{o.stopPropagation(),o.preventDefault(),u.trim()&&b(u.trim())},children:[e.jsx("img",{src:Je,className:"mouse-icon-img",alt:"R"}),e.jsx("span",{className:"control-label confirm",children:"SAVE"})]}),e.jsxs("div",{className:"control-group",onClick:o=>{o.stopPropagation(),E()},onContextMenu:o=>{o.stopPropagation(),o.preventDefault(),u.trim()&&b(u.trim())},children:[e.jsx("img",{src:Qe,className:"mouse-icon-img",alt:"L"}),e.jsx("span",{className:"control-label cancel",children:"CANCEL"})]})]})})]})})})}):null},ss={1:"kinetic",2:"arc",3:"solar",4:"void",6:"stasis",7:"strand"},ts={0:"Titan",1:"Hunter",2:"Warlock"},xe=[2946726027,2603483315,3170703816,3893112950];function ms(){const y=We(),[R]=Fe(),[n,T]=p.useState(null),[b,E]=p.useState(!0),[u,D]=p.useState(null),[A,F]=p.useState(!1),[O,o]=p.useState(!0),[w,i]=p.useState(null),[Ne,V]=p.useState(!1),[ie,oe]=p.useState(null),[re,je]=p.useState(null),Ie=p.useRef(null),[le,be]=p.useState({x:.5,y:.5}),ce=s=>{re&&clearTimeout(re),oe(s);const t=setTimeout(()=>oe(null),2500);je(t)};p.useEffect(()=>{(async()=>{try{const t=R.get("url");if(!t){D("No DIM link provided. Please paste a DIM link."),E(!1);return}const d=await Ke.parseLoadoutLink(t);T(d),E(!1)}catch(t){ve("DIMLoadoutViewer","Error:",t),D(t instanceof Error?t.message:"Failed to load DIM loadout"),E(!1)}})()},[R]),p.useEffect(()=>{const s=async t=>{const d=document.activeElement;d&&(d.tagName==="INPUT"||d.tagName==="TEXTAREA"||d.isContentEditable)||((t.key==="a"||t.key==="A")&&F(f=>!f),t.key==="Control"&&o(f=>!f),t.key==="Escape"&&y("/agent-wake"),(t.key==="d"||t.key==="D")&&await de())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[y,n]);const Ee=s=>{const{clientX:t,clientY:d}=s,{innerWidth:m,innerHeight:f}=window,I=t/m-.5,v=d/f-.5;be({x:I,y:v})},de=async()=>{n&&V(!0)},ke=async s=>{if(n){V(!1);try{const t=n.equipped.find(h=>a.getItem(h.hash)?.inventory?.bucketTypeHash===x.SUBCLASS),d=t?a.getItem(t.hash):null,m=d?.talentGrid?.hudDamageType||3;let I={1:"kinetic",2:"arc",3:"solar",4:"void",6:"stasis",7:"strand"}[m]||"kinetic";(xe.includes(t?.hash||0)||d?.plug?.plugCategoryIdentifier?.toLowerCase()?.includes("prismatic")||d?.displayProperties?.name?.toLowerCase().includes("prismatic")||d?.itemTypeDisplayName?.toLowerCase()?.includes("prismatic"))&&(I="prismatic");const v=h=>{if(t?.socketOverrides)return t.socketOverrides[h]},C=[],g=[];t?.socketOverrides&&Object.entries(t.socketOverrides).forEach(([h,c])=>{const S=parseInt(h),W=a.getItem(c);if(!W||S>=0&&S<=4)return;const ae=(W.plug?.plugCategoryIdentifier||"").toLowerCase(),ne=(W.itemTypeDisplayName||"").toLowerCase(),Ge=(W.displayProperties?.name||"").toLowerCase();ae.includes("aspect")||ne.includes("aspect")?C.push(c):(ae.includes("fragment")||ae.includes("facet")||ne.includes("fragment")||ne.includes("facet")||Ge.includes("facet of"))&&g.push(c)});let M={hash:0,name:"None",slot:0},fe={hash:0,name:"None",slot:3};const te=[],ge=h=>{const c=a.getItem(h);if(!c)return!1;const S=(c.plug?.plugCategoryIdentifier||"").toLowerCase();return S.includes("enhancements")||S.includes("armor_stats")||S.includes("armor_mods")};n.parameters?.mods?n.parameters.mods.forEach(h=>{ge(h)&&te.push(h)}):n.parameters?.modsByBucket&&Object.values(n.parameters.modsByBucket).forEach(h=>{Array.isArray(h)&&h.forEach(c=>{ge(c)&&te.push(c)})}),n.equipped.forEach(h=>{const c=a.getItem(h.hash);c&&(c.inventory?.tierType===6||c.tierType===6)&&(c.itemType===3?M={hash:h.hash,name:c.displayProperties?.name||"Unknown",slot:c.inventory?.bucketTypeHash===x.KINETIC_WEAPONS?0:c.inventory?.bucketTypeHash===x.ENERGY_WEAPONS?1:2}:c.itemType===2&&(fe={hash:h.hash,name:c.displayProperties?.name||"Unknown",slot:3}))});const ze={id:`dim-${Date.now()}`,name:s,element:I,guardianClass:n.classType,exoticWeapon:M,exoticArmor:fe,subclassConfig:{subclassHash:t?.hash,superHash:v(0)||0,aspects:C,fragments:g,grenadeHash:v(4),meleeHash:v(3),classAbilityHash:v(2)},playstyle:"DIM Import",difficulty:"intermediate",originalLoadout:n,armorMods:te,source:"dim"};await $e.saveBuild(ze,s),ce(`Build "${s}" saved to Loadout Vault`)}catch(t){ve("DIMLoadoutViewerPage","Failed to save build:",t),ce("Failed to save build")}}};if(b)return e.jsx("div",{className:"dim-loadout-viewer",children:e.jsx(Xe,{})});if(u)return e.jsx("div",{className:"dim-loadout-viewer",children:e.jsxs("div",{className:"dim-error",children:[e.jsx("h2",{children:"Error Loading Loadout"}),e.jsx("p",{style:{whiteSpace:"pre-wrap"},children:u}),e.jsx("button",{onClick:()=>y("/agent-wake"),children:"Back to Agent"})]})});if(!n)return e.jsx("div",{className:"dim-loadout-viewer",children:e.jsxs("div",{className:"dim-error",children:[e.jsx("h2",{children:"No Loadout Found"}),e.jsx("button",{onClick:()=>y("/agent-wake"),children:"Back to Agent"})]})});const L=n.equipped.find(s=>a.getItem(s.hash)?.inventory?.bucketTypeHash===x.SUBCLASS),k=L?a.getItem(L.hash):null,Me=k?.talentGrid?.hudDamageType||3;let j=ss[Me]||"solar";(xe.includes(L?.hash||0)||k?.plug?.plugCategoryIdentifier?.includes("prismatic")||k?.displayProperties?.name?.toLowerCase().includes("prismatic"))&&(j="prismatic");const me=ts[n.classType]||"Titan",H=s=>{if(!L?.socketOverrides)return null;const t=L.socketOverrides[s];return t?a.getItem(t):null},K=H(0),Y=H(1),$=H(2),X=H(3),J=H(4),ue=[],he=[];let Q=null;L?.socketOverrides&&Object.entries(L.socketOverrides).forEach(([s,t])=>{const d=parseInt(s),m=a.getItem(t);if(!m||d>=0&&d<=4)return;const f=(m.plug?.plugCategoryIdentifier||"").toLowerCase(),I=(m.itemTypeDisplayName||"").toLowerCase(),v=(m.displayProperties?.name||"").toLowerCase();if(f.includes("transcendence")||v.includes("transcendence")){Q={icon:N(m.displayProperties?.icon||""),hash:m.hash};return}if(f.includes("aspect")||I.includes("aspect")){ue.push({icon:N(m.displayProperties?.icon||""),hash:m.hash});return}(f.includes("fragment")||f.includes("facet")||I.includes("fragment")||I.includes("facet")||v.includes("facet of"))&&he.push({icon:N(m.displayProperties?.icon||""),hash:m.hash})});const r={super:$?N($.displayProperties?.icon||""):void 0,superHash:$?.hash,jump:Y?N(Y.displayProperties?.icon||""):void 0,jumpHash:Y?.hash,classAbility:K?N(K.displayProperties?.icon||""):void 0,classAbilityHash:K?.hash,melee:X?N(X.displayProperties?.icon||""):void 0,meleeHash:X?.hash,grenade:J?N(J.displayProperties?.icon||""):void 0,grenadeHash:J?.hash,transcendence:Q?.icon,transcendenceHash:Q?.hash,aspects:ue,fragments:he},B=n.equipped.find(s=>a.getItem(s.hash)?.inventory?.bucketTypeHash===x.HELMET),q=n.equipped.find(s=>a.getItem(s.hash)?.inventory?.bucketTypeHash===x.GAUNTLETS),U=n.equipped.find(s=>a.getItem(s.hash)?.inventory?.bucketTypeHash===x.CHEST_ARMOR),z=n.equipped.find(s=>a.getItem(s.hash)?.inventory?.bucketTypeHash===x.LEG_ARMOR),G=n.equipped.find(s=>a.getItem(s.hash)?.inventory?.bucketTypeHash===x.CLASS_ARMOR),Z=n.equipped.find(s=>a.getItem(s.hash)?.inventory?.bucketTypeHash===x.KINETIC_WEAPONS),ee=n.equipped.find(s=>a.getItem(s.hash)?.inventory?.bucketTypeHash===x.ENERGY_WEAPONS),se=n.equipped.find(s=>a.getItem(s.hash)?.inventory?.bucketTypeHash===x.POWER_WEAPONS),Le=B?a.getItem(B.hash):null,_e=q?a.getItem(q.hash):null,Ce=U?a.getItem(U.hash):null,Se=z?a.getItem(z.hash):null,Te=G?a.getItem(G.hash):null,De={helmet:B,arms:q,chest:U,legs:z,classItem:G},{modGroups:P,armorCosmetics:l}=Ve(n,De),Ae=(s,t=null,d=null)=>{const{mainStat:m,secondaryStat:f,others:I}=Ye(s),v=g=>{const M=g?a.getItem(g):null;return M?e.jsx("div",{className:"mod-pod cosmetic-pod",onMouseEnter:()=>i(g),onMouseLeave:()=>i(null),children:e.jsx("img",{src:N(M.displayProperties?.icon||""),alt:""})},g):e.jsx("div",{className:"mod-pod cosmetic-pod placeholder-pod"})},C=g=>{const M=a.getItem(g);return M?e.jsx("div",{className:"mod-pod",onMouseEnter:()=>i(g),onMouseLeave:()=>i(null),children:e.jsx("img",{src:N(M.displayProperties?.icon||""),alt:""})},g):null};return e.jsxs("div",{className:"armor-mods-pod-grid",children:[v(d?.hash),v(t?.hash),m&&C(m),f&&C(f),I.map(g=>C(g))]})},we={ornament:l.helmet?.ornament?a.getItem(l.helmet.ornament):null,shader:l.helmet?.shader?a.getItem(l.helmet.shader):null},He={ornament:l.arms?.ornament?a.getItem(l.arms.ornament):null,shader:l.arms?.shader?a.getItem(l.arms.shader):null},Pe={ornament:l.chest?.ornament?a.getItem(l.chest.ornament):null,shader:l.chest?.shader?a.getItem(l.chest.shader):null},Re={ornament:l.legs?.ornament?a.getItem(l.legs.ornament):null,shader:l.legs?.shader?a.getItem(l.legs.shader):null},Oe={ornament:l.classItem?.ornament?a.getItem(l.classItem.ornament):null,shader:l.classItem?.shader?a.getItem(l.classItem.shader):null},Be=Z?a.getItem(Z.hash):null,qe=ee?a.getItem(ee.hash):null,Ue=se?a.getItem(se.hash):null,pe=k?N(k.screenshot||k.displayProperties?.icon||""):null;return e.jsxs("div",{className:`dim-loadout-viewer synergy-build-overlay context-dim-page ${O?"":"synergy-build-overlay--ui-hidden"}`,"data-element":j,onMouseMove:Ee,style:{"--parallax-x":le.x,"--parallax-y":le.y},children:[ie&&e.jsx("div",{className:"vault-service-alert animate-slide-up",children:e.jsxs("div",{className:"service-alert-content",children:[e.jsx("div",{className:"service-alert-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})})}),e.jsxs("div",{className:"service-alert-text",children:[e.jsx("span",{className:"alert-bold",children:"SERVICE ALERT"}),e.jsx("span",{className:"alert-message",children:ie})]})]})}),pe&&e.jsxs("div",{className:"synergy-build-overlay__bg",ref:Ie,children:[e.jsx("div",{className:"synergy-build-overlay__pattern"}),e.jsx("img",{src:pe,className:"synergy-build-overlay__screenshot",alt:""}),e.jsx("div",{className:"synergy-build-overlay__vignette"})]}),e.jsx("button",{className:"synergy-build-overlay__close-top-left",onClick:()=>y("/agent-wake"),children:"âœ•"}),e.jsx("div",{className:"synergy-build-overlay__header-top-right",children:e.jsxs("div",{className:"synergy-build-overlay__title-area",children:[e.jsx("h1",{className:"synergy-build-overlay__title-large",children:n.name}),e.jsxs("div",{className:"synergy-build-overlay__subtitle-caps",children:[me.toUpperCase()," // ",k?.displayProperties?.name?.toUpperCase()||"UNKNOWN SUBCLASS"]})]})}),e.jsxs("div",{className:"synergy-build-overlay__content",children:[e.jsx("div",{className:"build-section build-section--super",children:r.super&&e.jsx("div",{className:"super-node-large",children:e.jsx("img",{src:r.super,alt:"Super Icon",onMouseEnter:()=>i(r.superHash||null),onMouseLeave:()=>i(null)})})}),e.jsxs("div",{className:"build-section--middle",children:[e.jsxs("div",{className:"build-section--middle__top-row",children:[e.jsxs("div",{className:"node-section section-abilities",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| ABILITIES"}),e.jsxs("div",{className:"node-section-content",children:[r.classAbility&&e.jsx(_,{type:"square",size:"normal",icon:r.classAbility,element:j,status:"active",onMouseEnter:()=>i(r.classAbilityHash||null),onMouseLeave:()=>i(null)}),r.jump&&e.jsx(_,{type:"square",size:"normal",icon:r.jump,element:j,status:"active",onMouseEnter:()=>i(r.jumpHash||null),onMouseLeave:()=>i(null)}),r.melee&&e.jsx(_,{type:"square",size:"normal",icon:r.melee,element:j,status:"active",onMouseEnter:()=>i(r.meleeHash||null),onMouseLeave:()=>i(null)}),r.grenade&&e.jsx(_,{type:"square",size:"normal",icon:r.grenade,element:j,status:"active",onMouseEnter:()=>i(r.grenadeHash||null),onMouseLeave:()=>i(null)})]})]}),e.jsxs("div",{className:"node-section section-aspects",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| ASPECTS"}),e.jsxs("div",{className:"node-section-content",children:[r.aspects.map((s,t)=>e.jsx(_,{type:"square",size:"normal",icon:s.icon,element:j,status:"active",onMouseEnter:()=>i(s.hash||null),onMouseLeave:()=>i(null)},t)),j==="prismatic"&&r.transcendence&&e.jsx(_,{type:"square",size:"normal",icon:r.transcendence,element:j,status:"active",onMouseEnter:()=>i(r.transcendenceHash||null),onMouseLeave:()=>i(null)})]})]})]}),e.jsx("div",{className:"build-section--middle__bottom-row",children:e.jsxs("div",{className:"node-section section-fragments",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| FRAGMENTS"}),e.jsx("div",{className:"synergy-build-overlay__fragments-grid",children:r.fragments.map((s,t)=>e.jsx(_,{type:"square",size:"small",icon:s.icon,element:j,status:"active",onMouseEnter:()=>i(s.hash||null),onMouseLeave:()=>i(null)},t))})]})}),e.jsx("div",{className:"build-section--middle__gear-row",children:e.jsxs("div",{className:"node-section section-gear",children:[e.jsx("div",{className:"node-section-header-prefixed",children:"| LOADOUT & GEAR"}),e.jsxs("div",{className:"synergy-build-overlay__gear-horizontal-grid",children:[[{def:Be,item:Z},{def:qe,item:ee},{def:Ue,item:se}].map((s,t)=>s.def&&e.jsxs("div",{className:"gear-item-horizontal",onMouseEnter:()=>i(s.def?.hash||null),onMouseLeave:()=>i(null),children:[e.jsx(ye,{hash:s.def.hash,instance:s.item}),e.jsx("div",{className:"gear-item-info",children:e.jsx("span",{className:"build-item__label--compact",children:s.def.displayProperties?.name})})]},t)),[{def:Le,group:P.helmet,cosmetics:we,itemData:B},{def:_e,group:P.arms,cosmetics:He,itemData:q},{def:Ce,group:P.chest,cosmetics:Pe,itemData:U},{def:Se,group:P.legs,cosmetics:Re,itemData:z},{def:Te,group:P.classItem,cosmetics:Oe,itemData:G}].map((s,t)=>s.def&&e.jsxs("div",{className:"gear-item-horizontal",onMouseEnter:()=>i(s.def?.hash||null),onMouseLeave:()=>i(null),children:[e.jsx(ye,{hash:s.def.hash,instance:s.itemData}),e.jsxs("div",{className:"gear-item-info",children:[e.jsx("span",{className:"build-item__label--compact",children:s.def.displayProperties?.name}),Ae(s.group,s.cosmetics.ornament,s.cosmetics.shader)]})]},t))]})]})})]})]}),e.jsxs("div",{className:`synergy-build-overlay__lore-panel ${A?"synergy-build-overlay__lore-panel--open":""}`,children:[e.jsxs("div",{className:"lore-panel__header",children:[e.jsx("h2",{className:"lore-panel__title",children:n.name}),e.jsxs("div",{className:"lore-panel__subtitle",children:[me," // ",k?.displayProperties?.name||"Custom Build"]})]}),e.jsx("div",{className:"lore-panel__content",children:n.notes||"This is a DIM loadout. No description provided."})]}),e.jsxs("div",{className:"synergy-build-overlay__footer-bar",children:[e.jsxs("div",{className:"key-prompt",onClick:de,children:[e.jsx("span",{className:"key-cap",children:"D"}),e.jsx("span",{className:"key-label",children:"Save Build"})]}),e.jsxs("div",{className:"key-prompt",onClick:()=>o(!O),children:[e.jsx("span",{className:"key-cap",children:"Ctrl"}),e.jsx("span",{className:"key-label",children:"Hide Menu"})]}),e.jsxs("div",{className:"key-prompt",onClick:()=>y("/agent-wake"),children:[e.jsx("span",{className:"key-cap",children:"Esc"}),e.jsx("span",{className:"key-label",children:"Back to Agent"})]})]}),w&&e.jsx("div",{className:"fixed-tooltip-container",children:e.jsx(Ze,{item:a.getItem(w)})}),e.jsx(es,{isOpen:Ne,message:"Enter a name for this DIM imported configuration:",defaultValue:n?.name||"Custom Build",onConfirm:ke,onCancel:()=>V(!1)})]})}export{ms as DIMLoadoutViewerPage,ms as default};
//# sourceMappingURL=DIMLoadoutViewerPage-Dp_5jU7G.js.map
