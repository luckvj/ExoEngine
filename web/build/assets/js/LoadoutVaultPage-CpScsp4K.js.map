{"version":3,"file":"LoadoutVaultPage-CpScsp4K.js","sources":["../../../../src/components/vault/VaultCard.tsx","../../../../src/pages/LoadoutVaultPage.tsx"],"sourcesContent":["import { useEffect, useState, useMemo } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { manifestService } from '../../services/bungie/manifest.service';\r\nimport { RichItemIcon } from '../common/RichItemIcon';\r\nimport { loadoutLinkService, convertBuildToLoadoutShareData } from '../../services/bungie/loadout-link.service';\r\nimport { useManifestStore, useProfileStore } from '../../store';\r\nimport { getBungieUrl } from '../../utils/url-helper';\r\nimport { distributeLoadoutMods, categorizeMods } from '../../utils/loadout-mods.utils';\r\nimport { BUCKET_HASHES } from '../../config/bungie.config';\r\nimport type { SavedBuild, DestinyItem } from '../../types';\r\nimport { SubclassNode } from '../builder/SubclassNode';\r\nimport { RichTooltip } from '../builder/RichTooltip';\r\nimport { ConfirmationModal } from '../common/ConfirmationModal';\r\nimport { errorLog } from '../../utils/logger';\r\nimport './VaultCard.css';\r\n\r\nimport '../../pages/DIMLoadoutViewerPage.css';\r\n\r\n// Element type mapping from damage type number\r\nconst ELEMENT_NAMES: Record<number, string> = {\r\n    1: 'kinetic',\r\n    2: 'arc',\r\n    3: 'solar',\r\n    4: 'void',\r\n    6: 'stasis',\r\n    7: 'strand',\r\n};\r\n\r\nconst CLASS_NAMES = ['Titan', 'Hunter', 'Warlock'];\r\n\r\ninterface VaultCardProps {\r\n    build: SavedBuild;\r\n    onEquip?: (build: SavedBuild) => void;\r\n    onDelete?: (buildId: string) => void;\r\n    onView?: (build: SavedBuild) => void;\r\n    isEquipping?: boolean;\r\n    equippingProgress?: number;\r\n    equippingStatus?: string;\r\n}\r\n\r\nexport function VaultCard({ build, onEquip, onDelete, isEquipping = false }: VaultCardProps) {\r\n    const [screenshot, setScreenshot] = useState<string | null>(null);\r\n    const [primaryIcon, setPrimaryIcon] = useState<string | null>(null);\r\n    const [isDetailsOpen, setIsDetailsOpen] = useState(false);\r\n    const [isLoreOpen, setIsLoreOpen] = useState(false);\r\n    const [isUiVisible, setIsUiVisible] = useState(true);\r\n    const [hoveredItemHash, setHoveredItemHash] = useState<number | null>(null);\r\n    const [mousePos, setMousePos] = useState({ x: 0, y: 0 });\r\n    const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\r\n    const [missingItems, setMissingItems] = useState<{ hash: number; name: string }[]>([]);\r\n\r\n    // Notification banner state\r\n    const [notification, setNotification] = useState<string | null>(null);\r\n    const [notificationTimeout, setNotificationTimeout] = useState<NodeJS.Timeout | null>(null);\r\n\r\n    const { isLoaded: manifestLoaded } = useManifestStore();\r\n    const template = build.template;\r\n\r\n    // Check if we have originalLoadout data (DIM import with full fidelity)\r\n    const originalLoadout = template?.originalLoadout;\r\n    const hasDIMData = !!originalLoadout;\r\n\r\n    // Show notification banner\r\n    const showNotification = (message: string) => {\r\n        if (notificationTimeout) clearTimeout(notificationTimeout);\r\n        setNotification(message);\r\n        const timeout = setTimeout(() => setNotification(null), 2500);\r\n        setNotificationTimeout(timeout);\r\n    };\r\n\r\n\r\n    // Build icons state for card preview\r\n    const [cardIcons, setCardIcons] = useState<{\r\n        super?: string;\r\n        superHash?: number;\r\n        grenade?: string;\r\n        grenadeHash?: number;\r\n        melee?: string;\r\n        meleeHash?: number;\r\n        classAbility?: string;\r\n        classAbilityHash?: number;\r\n        aspects: { icon: string; hash: number }[];\r\n        fragments: { icon: string; hash: number }[];\r\n        weapons: { icon: string; hash: number; name: string }[];\r\n        armor?: { icon: string; hash: number; name: string };\r\n    }>({ aspects: [], fragments: [], weapons: [] });\r\n\r\n    // DIM-style full loadout data (when originalLoadout exists)\r\n    const dimLoadoutData = useMemo(() => {\r\n        if (!hasDIMData || !manifestLoaded) return null;\r\n\r\n        const loadout = originalLoadout;\r\n\r\n        // Find subclass\r\n        const subclassItem = loadout.equipped?.find((item: any) => {\r\n            const def = manifestService.getItem(item.hash);\r\n            return def?.inventory?.bucketTypeHash === BUCKET_HASHES.SUBCLASS;\r\n        });\r\n\r\n        const subclassDef = subclassItem ? manifestService.getItem(subclassItem.hash) : null;\r\n        const damageType = (subclassDef as any)?.talentGrid?.hudDamageType || 3;\r\n        const elementName = ELEMENT_NAMES[damageType] || template?.element || 'solar';\r\n\r\n        // Extract abilities from socket overrides\r\n        const getSocketItem = (socketIndex: number) => {\r\n            if (!subclassItem?.socketOverrides) return null;\r\n            const hash = subclassItem.socketOverrides[socketIndex];\r\n            return hash ? manifestService.getItem(hash) : null;\r\n        };\r\n\r\n        // Subclass configuration - Exhaustive scan\r\n        const superDef = getSocketItem(0);\r\n        const jumpDef = getSocketItem(1);\r\n        const classAbilityDef = getSocketItem(2);\r\n        const meleeDef = getSocketItem(3);\r\n        const grenadeDef = getSocketItem(4);\r\n\r\n        const allAspects: { icon: string; hash: number }[] = [];\r\n        const allFragments: { icon: string; hash: number }[] = [];\r\n\r\n        if (subclassItem?.socketOverrides) {\r\n            Object.entries(subclassItem.socketOverrides).forEach(([idxStr, hash]) => {\r\n                const idx = parseInt(idxStr);\r\n                const def = manifestService.getItem(hash as number);\r\n                if (!def) return;\r\n\r\n                // Skip common ability slots to avoid duplicates (Super, Class, Jump, Melee, Grenade)\r\n                if (idx >= 0 && idx <= 4) return;\r\n\r\n                const category = (def.plug?.plugCategoryIdentifier || \"\").toLowerCase();\r\n                const typeName = (def.itemTypeDisplayName || \"\").toLowerCase();\r\n                const name = (def.displayProperties?.name || \"\").toLowerCase();\r\n\r\n                // 1. Check for Aspects\r\n                if (category.includes('aspect') || typeName.includes('aspect')) {\r\n                    allAspects.push({\r\n                        icon: getBungieUrl(def.displayProperties?.icon || '') || '',\r\n                        hash: def.hash\r\n                    });\r\n                }\r\n                // 2. Check for Fragments/Facets\r\n                else if (category.includes('fragment') || category.includes('facet') ||\r\n                    typeName.includes('fragment') || typeName.includes('facet') ||\r\n                    name.includes('facet of')) {\r\n                    allFragments.push({\r\n                        icon: getBungieUrl(def.displayProperties?.icon || '') || '',\r\n                        hash: def.hash\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        // Build icons (SWAP: Super icon goes in classAbility position for display)\r\n        const buildIcons = {\r\n            super: classAbilityDef ? getBungieUrl((classAbilityDef as any).displayProperties?.icon || '') : undefined,\r\n            superHash: (classAbilityDef as any)?.hash,\r\n            jump: jumpDef ? getBungieUrl((jumpDef as any).displayProperties?.icon || '') : undefined,\r\n            jumpHash: (jumpDef as any)?.hash,\r\n            classAbility: superDef ? getBungieUrl((superDef as any).displayProperties?.icon || '') : undefined,\r\n            classAbilityHash: (superDef as any)?.hash,\r\n            melee: meleeDef ? getBungieUrl((meleeDef as any).displayProperties?.icon || '') : undefined,\r\n            meleeHash: (meleeDef as any)?.hash,\r\n            grenade: grenadeDef ? getBungieUrl((grenadeDef as any).displayProperties?.icon || '') : undefined,\r\n            grenadeHash: (grenadeDef as any)?.hash,\r\n            aspects: allAspects,\r\n            fragments: allFragments\r\n        };\r\n\r\n        // Armor pieces\r\n        const helmet = loadout.equipped?.find((i: any) => {\r\n            const def = manifestService.getItem(i.hash);\r\n            return def?.inventory?.bucketTypeHash === BUCKET_HASHES.HELMET;\r\n        });\r\n        const gauntlets = loadout.equipped?.find((i: any) => {\r\n            const def = manifestService.getItem(i.hash);\r\n            return def?.inventory?.bucketTypeHash === BUCKET_HASHES.GAUNTLETS;\r\n        });\r\n        const chest = loadout.equipped?.find((i: any) => {\r\n            const def = manifestService.getItem(i.hash);\r\n            return def?.inventory?.bucketTypeHash === BUCKET_HASHES.CHEST_ARMOR;\r\n        });\r\n        const legs = loadout.equipped?.find((i: any) => {\r\n            const def = manifestService.getItem(i.hash);\r\n            return def?.inventory?.bucketTypeHash === BUCKET_HASHES.LEG_ARMOR;\r\n        });\r\n        const classItem = loadout.equipped?.find((i: any) => {\r\n            const def = manifestService.getItem(i.hash);\r\n            return def?.inventory?.bucketTypeHash === BUCKET_HASHES.CLASS_ARMOR;\r\n        });\r\n\r\n        // Weapons\r\n        const kinetic = loadout.equipped?.find((i: any) => {\r\n            const def = manifestService.getItem(i.hash);\r\n            return def?.inventory?.bucketTypeHash === BUCKET_HASHES.KINETIC_WEAPONS;\r\n        });\r\n        const energy = loadout.equipped?.find((i: any) => {\r\n            const def = manifestService.getItem(i.hash);\r\n            return def?.inventory?.bucketTypeHash === BUCKET_HASHES.ENERGY_WEAPONS;\r\n        });\r\n        const power = loadout.equipped?.find((i: any) => {\r\n            const def = manifestService.getItem(i.hash);\r\n            return def?.inventory?.bucketTypeHash === BUCKET_HASHES.POWER_WEAPONS;\r\n        });\r\n\r\n        // Get definitions\r\n        const helmetDef = helmet ? manifestService.getItem(helmet.hash) : null;\r\n        const gauntletsDef = gauntlets ? manifestService.getItem(gauntlets.hash) : null;\r\n        const chestDef = chest ? manifestService.getItem(chest.hash) : null;\r\n        const legsDef = legs ? manifestService.getItem(legs.hash) : null;\r\n        const classItemDef = classItem ? manifestService.getItem(classItem.hash) : null;\r\n        const kineticDef = kinetic ? manifestService.getItem(kinetic.hash) : null;\r\n        const energyDef = energy ? manifestService.getItem(energy.hash) : null;\r\n        const powerDef = power ? manifestService.getItem(power.hash) : null;\r\n\r\n        // Mod distribution\r\n        const armor = { helmet, arms: gauntlets, chest, legs, classItem };\r\n        const { modGroups, armorCosmetics } = distributeLoadoutMods(loadout, armor);\r\n\r\n        // Cosmetics (extracted during distribution)\r\n        const helmetCosmetics = {\r\n            ornament: armorCosmetics.helmet.ornament ? manifestService.getItem(armorCosmetics.helmet.ornament) : null,\r\n            shader: armorCosmetics.helmet.shader ? manifestService.getItem(armorCosmetics.helmet.shader) : null\r\n        };\r\n        const gauntletsCosmetics = {\r\n            ornament: armorCosmetics.arms.ornament ? manifestService.getItem(armorCosmetics.arms.ornament) : null,\r\n            shader: armorCosmetics.arms.shader ? manifestService.getItem(armorCosmetics.arms.shader) : null\r\n        };\r\n        const chestCosmetics = {\r\n            ornament: armorCosmetics.chest.ornament ? manifestService.getItem(armorCosmetics.chest.ornament) : null,\r\n            shader: armorCosmetics.chest.shader ? manifestService.getItem(armorCosmetics.chest.shader) : null\r\n        };\r\n        const legsCosmetics = {\r\n            ornament: armorCosmetics.legs.ornament ? manifestService.getItem(armorCosmetics.legs.ornament) : null,\r\n            shader: armorCosmetics.legs.shader ? manifestService.getItem(armorCosmetics.legs.shader) : null\r\n        };\r\n        const classItemCosmetics = {\r\n            ornament: armorCosmetics.classItem.ornament ? manifestService.getItem(armorCosmetics.classItem.ornament) : null,\r\n            shader: armorCosmetics.classItem.shader ? manifestService.getItem(armorCosmetics.classItem.shader) : null\r\n        };\r\n\r\n        // Background from subclass\r\n        const bgImage = subclassDef ? getBungieUrl((subclassDef as any).screenshot || (subclassDef as any).displayProperties?.icon || '') : null;\r\n\r\n        // MISSING ITEM CHECK (DIM Parity)\r\n        const allInventory = useProfileStore.getState().getAllInventory();\r\n        const missingGear: { hash: number; name: string }[] = [];\r\n\r\n        const checkMissing = (hash: number | undefined, name: string) => {\r\n            if (!hash) return;\r\n            const exists = allInventory.some((i: DestinyItem) => i.itemHash === hash);\r\n            if (!exists) missingGear.push({ hash, name });\r\n        };\r\n\r\n        // Check template exotics\r\n        if (template?.exoticWeapon?.hash) checkMissing(template.exoticWeapon.hash, template.exoticWeapon.name || 'Exotic Weapon');\r\n        if (template?.exoticArmor?.hash) checkMissing(template.exoticArmor.hash, template.exoticArmor.name || 'Exotic Armor');\r\n\r\n        // Check legendary items from template\r\n        template?.items?.forEach(i => checkMissing(i.hash, i.name || 'Legendary Item'));\r\n\r\n        // Check DIM loadout items if present\r\n        loadout.equipped?.forEach((i: any) => {\r\n            const def = manifestService.getItem(i.hash);\r\n            if (def && [2, 3].includes(def.itemType)) { // Gear only\r\n                checkMissing(i.hash, def.displayProperties?.name || 'Item');\r\n            }\r\n        });\r\n\r\n        // Dedup missing items\r\n        const finalMissing = Array.from(new Set(missingGear.map(m => m.hash)))\r\n            .map(hash => missingGear.find(m => m.hash === hash)!);\r\n\r\n        return {\r\n            elementName,\r\n            className: CLASS_NAMES[loadout.classType] || 'Guardian',\r\n            subclassDef,\r\n            buildIcons,\r\n            helmetDef, gauntletsDef, chestDef, legsDef, classItemDef,\r\n            kineticDef, energyDef, powerDef,\r\n            kinetic, energy, power,\r\n            helmet, gauntlets, chest, legs, classItem,\r\n            helmetCosmetics, gauntletsCosmetics, chestCosmetics, legsCosmetics, classItemCosmetics,\r\n            modGroups,\r\n            bgImage,\r\n            missingGear: finalMissing\r\n        };\r\n    }, [hasDIMData, originalLoadout, manifestLoaded, template]);\r\n\r\n    // MISSING ITEM DETECTION (DIM Parity)\r\n    useEffect(() => {\r\n        if (!manifestLoaded || !template) return;\r\n\r\n        const allInventory = useProfileStore.getState().getAllInventory();\r\n        const missingGear: { hash: number; name: string }[] = [];\r\n\r\n        const checkMissing = (hash: number | undefined, name: string) => {\r\n            if (!hash) return;\r\n            const exists = allInventory.some((i: DestinyItem) => i.itemHash === hash);\r\n            if (!exists) {\r\n                // Check if already in list to avoid duplicates\r\n                if (!missingGear.some(m => m.hash === hash)) {\r\n                    missingGear.push({ hash, name });\r\n                }\r\n            }\r\n        };\r\n\r\n        // Check template exotics\r\n        if (template?.exoticWeapon?.hash) checkMissing(template.exoticWeapon.hash, template.exoticWeapon.name || 'Exotic Weapon');\r\n        if (template?.exoticArmor?.hash) checkMissing(template.exoticArmor.hash, template.exoticArmor.name || 'Exotic Armor');\r\n\r\n        // Check legendary items from template\r\n        template?.items?.forEach(i => checkMissing(i.hash, i.name || 'Legendary Item'));\r\n\r\n        // Check DIM loadout items if present\r\n        if (originalLoadout?.equipped) {\r\n            originalLoadout.equipped.forEach((i: any) => {\r\n                const def = manifestService.getItem(i.hash);\r\n                if (def && [2, 3].includes(def.itemType)) { // Gear only\r\n                    checkMissing(i.hash, def.displayProperties?.name || 'Item');\r\n                }\r\n            });\r\n        }\r\n\r\n        // Update state if changed (deep compare)\r\n        if (JSON.stringify(missingGear) !== JSON.stringify(missingItems)) {\r\n            setMissingItems(missingGear);\r\n        }\r\n    }, [manifestLoaded, template, originalLoadout]);\r\n\r\n    // Copy ExoEngine Link (DIM-compatible format)\r\n    const handleCopyExoEngineLink = async () => {\r\n        try {\r\n            let loadoutData;\r\n            if (originalLoadout) {\r\n                loadoutData = originalLoadout;\r\n            } else {\r\n                // Convert template to loadout share data\r\n                loadoutData = convertBuildToLoadoutShareData(template);\r\n            }\r\n\r\n            // Use DIM-compatible format so links work in both ExoEngine and DIM\r\n            const link = await loadoutLinkService.generateExoEngineLink(loadoutData);\r\n            await navigator.clipboard.writeText(link);\r\n            showNotification('Link copied to clipboard');\r\n        } catch (error) {\r\n            errorLog('Vault', 'Copy failed', error);\r\n            showNotification('Failed to copy link');\r\n        }\r\n    };\r\n\r\n    // Copy DIM Link\r\n    const handleCopyDIMLink = async () => {\r\n        try {\r\n            let loadoutData;\r\n            if (originalLoadout) {\r\n                loadoutData = originalLoadout;\r\n            } else {\r\n                loadoutData = convertBuildToLoadoutShareData(template);\r\n            }\r\n\r\n            const dimLink = loadoutLinkService.generateDIMCompatibleLink(loadoutData);\r\n            await navigator.clipboard.writeText(dimLink);\r\n            showNotification('DIM link copied to clipboard');\r\n        } catch (error) {\r\n            errorLog('Vault', 'Copy failed', error);\r\n            showNotification('Failed to copy DIM link');\r\n        }\r\n    };\r\n\r\n    // Keyboard Shortcuts\r\n    useEffect(() => {\r\n        if (!isDetailsOpen) return;\r\n\r\n        const handleKeyDown = async (e: KeyboardEvent) => {\r\n            const activeEl = document.activeElement;\r\n            const isTyping = activeEl && (\r\n                activeEl.tagName === 'INPUT' ||\r\n                activeEl.tagName === 'TEXTAREA' ||\r\n                (activeEl as HTMLElement).isContentEditable\r\n            );\r\n            if (isTyping) return;\r\n\r\n            if (e.key === 'Control') {\r\n                setIsUiVisible(v => !v);\r\n            }\r\n            if (e.key.toLowerCase() === 'a') {\r\n                setIsLoreOpen(v => !v);\r\n            }\r\n            if (e.key.toLowerCase() === 'f') {\r\n                if (!isEquipping) {\r\n                    onEquip?.(build);\r\n                }\r\n            }\r\n            if (e.key.toLowerCase() === 's' && template?.source !== 'exoengine') {\r\n                await handleCopyExoEngineLink();\r\n            }\r\n            if (e.key.toLowerCase() === 'g' && template?.source !== 'exoengine') {\r\n                await handleCopyDIMLink();\r\n            }\r\n            if (e.key === 'Escape') {\r\n                setIsDetailsOpen(false);\r\n            }\r\n            if (e.key === 'Delete') {\r\n                setShowDeleteConfirm(true);\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [isDetailsOpen, isEquipping, build, onEquip, onDelete]);\r\n\r\n    // Load card preview icons\r\n    useEffect(() => {\r\n        if (!manifestLoaded || !template) return;\r\n\r\n        async function loadImages() {\r\n            const newIcons: typeof cardIcons = { aspects: [], fragments: [], weapons: [] };\r\n\r\n            // Get screenshot from exotic weapon or armor\r\n            const mainItemHash = template.exoticWeapon?.hash || template.exoticArmor?.hash;\r\n            if (mainItemHash) {\r\n                const item = manifestService.getItem(mainItemHash);\r\n                if (item?.screenshot) {\r\n                    setScreenshot(item.screenshot);\r\n                }\r\n                setPrimaryIcon(manifestService.getIcon(mainItemHash) || null);\r\n            }\r\n\r\n            // Subclass nodes\r\n            const subclass = template.subclassConfig;\r\n            if (subclass) {\r\n                if (subclass.superHash) {\r\n                    const icon = manifestService.getIcon(subclass.superHash);\r\n                    if (icon) {\r\n                        newIcons.super = icon;\r\n                        newIcons.superHash = subclass.superHash;\r\n                    }\r\n                }\r\n                if (subclass.grenadeHash) {\r\n                    const icon = manifestService.getIcon(subclass.grenadeHash);\r\n                    if (icon) {\r\n                        newIcons.grenade = icon;\r\n                        newIcons.grenadeHash = subclass.grenadeHash;\r\n                    }\r\n                }\r\n                if (subclass.meleeHash) {\r\n                    const icon = manifestService.getIcon(subclass.meleeHash);\r\n                    if (icon) {\r\n                        newIcons.melee = icon;\r\n                        newIcons.meleeHash = subclass.meleeHash;\r\n                    }\r\n                }\r\n                if (subclass.classAbilityHash) {\r\n                    const icon = manifestService.getIcon(subclass.classAbilityHash);\r\n                    if (icon) {\r\n                        newIcons.classAbility = icon;\r\n                        newIcons.classAbilityHash = subclass.classAbilityHash;\r\n                    }\r\n                }\r\n\r\n                subclass.aspects?.forEach(h => {\r\n                    const icon = manifestService.getIcon(h);\r\n                    if (icon) newIcons.aspects.push({ icon, hash: h });\r\n                });\r\n\r\n                subclass.fragments?.forEach(h => {\r\n                    const icon = manifestService.getIcon(h);\r\n                    if (icon) newIcons.fragments.push({ icon, hash: h });\r\n                });\r\n            }\r\n\r\n            if (template.exoticWeapon?.hash) {\r\n                const icon = manifestService.getIcon(template.exoticWeapon.hash);\r\n                if (icon) newIcons.weapons.push({\r\n                    icon,\r\n                    hash: template.exoticWeapon.hash,\r\n                    name: template.exoticWeapon.name\r\n                });\r\n            }\r\n\r\n            if (template.exoticArmor?.hash) {\r\n                const icon = manifestService.getIcon(template.exoticArmor.hash);\r\n                if (icon) newIcons.armor = {\r\n                    icon,\r\n                    hash: template.exoticArmor.hash,\r\n                    name: template.exoticArmor.name\r\n                };\r\n            }\r\n\r\n            setCardIcons(newIcons);\r\n        }\r\n\r\n        loadImages();\r\n    }, [template, manifestLoaded]);\r\n\r\n    const elementName = template?.element?.toLowerCase() || 'void';\r\n    const className = CLASS_NAMES[template?.guardianClass] || 'Guardian';\r\n\r\n    const handleMouseMove = (e: React.MouseEvent) => {\r\n        if (!isDetailsOpen) return;\r\n        const { clientX, clientY } = e;\r\n        const { innerWidth, innerHeight } = window;\r\n        const x = (clientX / innerWidth) - 0.5;\r\n        const y = (clientY / innerHeight) - 0.5;\r\n        setMousePos({ x, y });\r\n    };\r\n\r\n    // Helper to render compact mods for a slot (3x2 or 2x3 grid pods)\r\n    const renderCompactMods = (slotMods: number[], ornament: any = null, shader: any = null) => {\r\n        const { mainStat, secondaryStat, others } = categorizeMods(slotMods);\r\n\r\n        const renderCosmeticPod = (hash: number | null) => {\r\n            const def = hash ? manifestService.getItem(hash) : null;\r\n            if (!def) return <div className=\"mod-pod cosmetic-pod placeholder-pod\" />;\r\n\r\n            return (\r\n                <div key={hash} className=\"mod-pod cosmetic-pod\" onMouseEnter={() => setHoveredItemHash(hash)} onMouseLeave={() => setHoveredItemHash(null)}>\r\n                    <img src={getBungieUrl((def as any).displayProperties?.icon || '')} alt=\"\" />\r\n                </div>\r\n            );\r\n        };\r\n\r\n        const renderModPod = (hash: number) => {\r\n            const def = manifestService.getItem(hash);\r\n            if (!def) return null;\r\n            return (\r\n                <div key={hash} className=\"mod-pod\" onMouseEnter={() => setHoveredItemHash(hash)} onMouseLeave={() => setHoveredItemHash(null)}>\r\n                    <img src={getBungieUrl((def as any).displayProperties?.icon || '')} alt=\"\" />\r\n                </div>\r\n            );\r\n        };\r\n\r\n        return (\r\n            <div className=\"armor-mods-pod-grid\">\r\n                {/* 1. Shader (Required Slot) */}\r\n                {renderCosmeticPod(shader?.hash)}\r\n\r\n                {/* 2. Ornament (Required Slot) */}\r\n                {renderCosmeticPod(ornament?.hash)}\r\n\r\n                {/* 3. Main Stat (Only if present) */}\r\n                {mainStat && renderModPod(mainStat)}\r\n\r\n                {/* 4. Secondary Stat (Only if present) */}\r\n                {secondaryStat && renderModPod(secondaryStat)}\r\n\r\n                {/* 5+. Others */}\r\n                {others.map((h) => renderModPod(h))}\r\n            </div>\r\n        );\r\n    };\r\n\r\n\r\n    return (\r\n        <>\r\n            {/* CARD PREVIEW */}\r\n            <div\r\n                className={`vault-card vault-card--horizontal vault-card--${elementName}`}\r\n                onClick={() => setIsDetailsOpen(true)}\r\n            >\r\n                <div className=\"vault-card__bg\">\r\n                    {screenshot ? (\r\n                        <img src={screenshot} alt=\"\" className=\"vault-card__screenshot\" />\r\n                    ) : (\r\n                        <div className=\"vault-card__pattern\" style={{ backgroundImage: primaryIcon ? `url(${primaryIcon})` : 'none' }} />\r\n                    )}\r\n                    <div className=\"vault-card__vignette\" />\r\n                    <div className=\"vault-card__glow\" />\r\n                </div>\r\n\r\n                <div className=\"vault-card__content\">\r\n                    {cardIcons.super && (\r\n                        <div className=\"vault-card__super-icon\">\r\n                            <img src={cardIcons.super} alt=\"Super\" />\r\n                            <span className={`vault-element-badge element-${elementName}`} />\r\n                        </div>\r\n                    )}\r\n                    <div className=\"vault-card__info\">\r\n                        <h3 className=\"vault-card__title\">{build.name}</h3>\r\n                        <span className=\"vault-card__subtitle\">{className} // {template?.playstyle || 'Custom Build'}</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"vault-card__nodes\">\r\n                    {cardIcons.classAbility && (\r\n                        <SubclassNode type=\"square\" size=\"small\" icon={cardIcons.classAbility} element={elementName as any} status=\"active\" />\r\n                    )}\r\n                    {cardIcons.grenade && (\r\n                        <SubclassNode type=\"square\" size=\"small\" icon={cardIcons.grenade} element={elementName as any} status=\"active\" />\r\n                    )}\r\n                    {cardIcons.melee && (\r\n                        <SubclassNode type=\"square\" size=\"small\" icon={cardIcons.melee} element={elementName as any} status=\"active\" />\r\n                    )}\r\n                    {cardIcons.aspects.slice(0, 2).map((aspect, i) => (\r\n                        <SubclassNode key={i} type=\"square\" size=\"small\" icon={aspect.icon} element={elementName as any} status=\"active\" />\r\n                    ))}\r\n                    <div className=\"fragment-row\">\r\n                        {cardIcons.fragments.slice(0, 4).map((fragment, i) => (\r\n                            <img key={i} src={fragment.icon} className=\"fragment-icon-tiny\" alt=\"\" />\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"vault-card__actions\">\r\n                    <div className=\"vault-card__exotics\">\r\n                        {cardIcons.weapons[0] && <img src={cardIcons.weapons[0].icon} className=\"exotic-icon-preview\" title={cardIcons.weapons[0].name} />}\r\n                        {cardIcons.armor && <img src={cardIcons.armor.icon} className=\"exotic-icon-preview\" title={cardIcons.armor.name} />}\r\n                    </div>\r\n                    {isEquipping && <div className=\"spinner-mini\" />}\r\n                </div>\r\n\r\n                <div className=\"vault-card__timestamp\">\r\n                    {new Date(build.createdAt).toLocaleDateString()}\r\n                </div>\r\n            </div>\r\n            {/* FULL SCREEN DETAILS OVERLAY - DIM STYLE */}\r\n            {isDetailsOpen && createPortal(\r\n                <div\r\n                    className={`dim-loadout-viewer synergy-build-overlay context-vault ${isUiVisible ? '' : 'synergy-build-overlay--ui-hidden'}`}\r\n                    data-element={hasDIMData ? dimLoadoutData?.elementName : elementName}\r\n                    onMouseMove={handleMouseMove}\r\n                    style={{\r\n                        '--parallax-x': mousePos.x,\r\n                        '--parallax-y': mousePos.y\r\n                    } as any}\r\n                >\r\n                    {/* Service Alert Notification */}\r\n                    {notification && (\r\n                        <div className=\"vault-service-alert animate-slide-up\">\r\n                            <div className=\"service-alert-content\">\r\n                                <div className=\"service-alert-icon\">\r\n                                    <svg viewBox=\"0 0 24 24\" width=\"18\" height=\"18\" fill=\"currentColor\">\r\n                                        <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z\" />\r\n                                    </svg>\r\n                                </div>\r\n                                <div className=\"service-alert-text\">\r\n                                    <span className=\"alert-bold\">SERVICE ALERT</span>\r\n                                    <span className=\"alert-message\">{notification}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Missing Items Warning Banner (DIM Style) */}\r\n                    {missingItems.length > 0 && (\r\n                        <div className=\"vault-missing-banner animate-slide-up\">\r\n                            <div className=\"missing-banner-content\">\r\n                                <div className=\"missing-banner-icon\">\r\n                                    <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"currentColor\">\r\n                                        <path d=\"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z\" />\r\n                                    </svg>\r\n                                </div>\r\n                                <div className=\"missing-banner-text\">\r\n                                    <span className=\"missing-bold\">MISSING ITEMS</span>\r\n                                    <span className=\"missing-message\">Some items in this loadout were not found in your inventory: {missingItems.map(i => i.name).join(', ')}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Background Image */}\r\n                    {(hasDIMData ? dimLoadoutData?.bgImage : screenshot) && (\r\n                        <div className=\"synergy-build-overlay__bg\">\r\n                            <div className=\"synergy-build-overlay__pattern\" />\r\n                            <img\r\n                                src={hasDIMData ? dimLoadoutData?.bgImage || '' : screenshot || ''}\r\n                                alt=\"\"\r\n                                className=\"synergy-build-overlay__screenshot\"\r\n                            />\r\n                            <div className=\"synergy-build-overlay__vignette\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Top Header Bar */}\r\n                    <div className=\"synergy-build-overlay__header\">\r\n                        <button className=\"synergy-build-overlay__close\" onClick={() => setIsDetailsOpen(false)}>\r\n                            âœ•\r\n                        </button>\r\n                        <div className=\"synergy-build-overlay__header-top-right\">\r\n                            <div className=\"synergy-build-overlay__title-area\">\r\n                                <h1 className=\"synergy-build-overlay__title-large\">{build.name}</h1>\r\n                                <div className=\"synergy-build-overlay__subtitle-caps\">\r\n                                    {hasDIMData ? dimLoadoutData?.className.toUpperCase() : className.toUpperCase()} // {hasDIMData ? (dimLoadoutData?.subclassDef as any)?.displayProperties?.name?.toUpperCase() || 'UNKNOWN SUBCLASS' : template?.playstyle?.toUpperCase() || 'CUSTOM BUILD'}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Main Content - Full 2-Column Build Layout */}\r\n                    <div className=\"synergy-build-overlay__content\">\r\n                        {/* 1. Super Section (Column 1) */}\r\n                        <div className=\"build-section build-section--super\">\r\n                            {(hasDIMData ? dimLoadoutData?.buildIcons.super : cardIcons.super) && (\r\n                                <div className=\"super-node-large\">\r\n                                    <img\r\n                                        src={(hasDIMData ? dimLoadoutData?.buildIcons.super : cardIcons.super) || ''}\r\n                                        alt=\"Super Icon\"\r\n                                        onMouseEnter={() => setHoveredItemHash((hasDIMData ? dimLoadoutData?.buildIcons.superHash : cardIcons.superHash) || null)}\r\n                                        onMouseLeave={() => setHoveredItemHash(null)}\r\n                                    />\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* 2. Middle Section (Column 2) - Abilities, Aspects, Fragments, Stats, Gear */}\r\n                        <div className=\"build-section--middle\">\r\n                            <div className=\"build-section--middle__top-row\">\r\n                                {/* Abilities Section */}\r\n                                <div className=\"node-section section-abilities\">\r\n                                    <div className=\"node-section-header-prefixed\">| ABILITIES</div>\r\n                                    <div className=\"node-section-content\">\r\n                                        {(hasDIMData ? dimLoadoutData?.buildIcons.classAbility : cardIcons.classAbility) && (\r\n                                            <SubclassNode\r\n                                                type=\"square\"\r\n                                                size=\"normal\"\r\n                                                icon={(hasDIMData ? dimLoadoutData?.buildIcons.classAbility : cardIcons.classAbility) || ''}\r\n                                                element={(hasDIMData ? dimLoadoutData?.elementName : elementName) as any}\r\n                                                status=\"active\"\r\n                                                onMouseEnter={() => setHoveredItemHash((hasDIMData ? dimLoadoutData?.buildIcons.classAbilityHash : cardIcons.classAbilityHash) || null)}\r\n                                                onMouseLeave={() => setHoveredItemHash(null)}\r\n                                            />\r\n                                        )}\r\n                                        {hasDIMData && dimLoadoutData?.buildIcons.jump && (\r\n                                            <SubclassNode\r\n                                                type=\"square\"\r\n                                                size=\"normal\"\r\n                                                icon={dimLoadoutData.buildIcons.jump}\r\n                                                element={dimLoadoutData.elementName as any}\r\n                                                status=\"active\"\r\n                                                onMouseEnter={() => setHoveredItemHash(dimLoadoutData?.buildIcons.jumpHash || null)}\r\n                                                onMouseLeave={() => setHoveredItemHash(null)}\r\n                                            />\r\n                                        )}\r\n                                        {(hasDIMData ? dimLoadoutData?.buildIcons.grenade : cardIcons.grenade) && (\r\n                                            <SubclassNode\r\n                                                type=\"square\"\r\n                                                size=\"normal\"\r\n                                                icon={(hasDIMData ? dimLoadoutData?.buildIcons.grenade : cardIcons.grenade) || ''}\r\n                                                element={(hasDIMData ? dimLoadoutData?.elementName : elementName) as any}\r\n                                                status=\"active\"\r\n                                                onMouseEnter={() => setHoveredItemHash((hasDIMData ? dimLoadoutData?.buildIcons.grenadeHash : cardIcons.grenadeHash) || null)}\r\n                                                onMouseLeave={() => setHoveredItemHash(null)}\r\n                                            />\r\n                                        )}\r\n                                        {(hasDIMData ? dimLoadoutData?.buildIcons.melee : cardIcons.melee) && (\r\n                                            <SubclassNode\r\n                                                type=\"square\"\r\n                                                size=\"normal\"\r\n                                                icon={(hasDIMData ? dimLoadoutData?.buildIcons.melee : cardIcons.melee) || ''}\r\n                                                element={(hasDIMData ? dimLoadoutData?.elementName : elementName) as any}\r\n                                                status=\"active\"\r\n                                                onMouseEnter={() => setHoveredItemHash((hasDIMData ? dimLoadoutData?.buildIcons.meleeHash : cardIcons.meleeHash) || null)}\r\n                                                onMouseLeave={() => setHoveredItemHash(null)}\r\n                                            />\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Aspects Section */}\r\n                                <div className=\"node-section section-aspects\">\r\n                                    <div className=\"node-section-header-prefixed\">| ASPECTS</div>\r\n                                    <div className=\"node-section-content\">\r\n                                        {(hasDIMData ? dimLoadoutData?.buildIcons.aspects : cardIcons.aspects)?.map((aspect, i) => (\r\n                                            <SubclassNode\r\n                                                key={i}\r\n                                                type=\"square\"\r\n                                                size=\"normal\"\r\n                                                icon={aspect.icon}\r\n                                                element={(hasDIMData ? dimLoadoutData?.elementName : elementName) as any}\r\n                                                status=\"active\"\r\n                                                onMouseEnter={() => setHoveredItemHash(aspect.hash || null)}\r\n                                                onMouseLeave={() => setHoveredItemHash(null)}\r\n                                            />\r\n                                        )) || []}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"build-section--middle__bottom-row\">\r\n                                {/* Fragments Section */}\r\n                                <div className=\"node-section section-fragments\">\r\n                                    <div className=\"node-section-header-prefixed\">| FRAGMENTS</div>\r\n                                    <div className=\"synergy-build-overlay__fragments-grid\">\r\n                                        {(hasDIMData ? dimLoadoutData?.buildIcons.fragments : cardIcons.fragments)?.map((fragment, i) => (\r\n                                            <SubclassNode\r\n                                                key={i}\r\n                                                type=\"square\"\r\n                                                size=\"small\"\r\n                                                icon={fragment.icon}\r\n                                                element={(hasDIMData ? dimLoadoutData?.elementName : elementName) as any}\r\n                                                status=\"active\"\r\n                                                onMouseEnter={() => setHoveredItemHash(fragment.hash || null)}\r\n                                                onMouseLeave={() => setHoveredItemHash(null)}\r\n                                            />\r\n                                        )) || []}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Stats Section */}\r\n                            {template?.stats && (\r\n                                <div className=\"node-section section-stats\" style={{ marginTop: '20px' }}>\r\n                                    <div className=\"node-section-header-prefixed\">| STATS</div>\r\n                                    <div className=\"stats-grid\" style={{ display: 'flex', gap: '20px' }}>\r\n                                        <StatItem value={template.stats.mobility} label=\"Mob\" icon=\"mobility\" />\r\n                                        <StatItem value={template.stats.resilience} label=\"Res\" icon=\"resilience\" />\r\n                                        <StatItem value={template.stats.recovery} label=\"Rec\" icon=\"recovery\" />\r\n                                        <StatItem value={template.stats.discipline} label=\"Dis\" icon=\"discipline\" />\r\n                                        <StatItem value={template.stats.intellect} label=\"Int\" icon=\"intellect\" />\r\n                                        <StatItem value={template.stats.strength} label=\"Str\" icon=\"strength\" />\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Loadout & Gear Section */}\r\n                            <div className=\"node-section section-gear\">\r\n                                <div className=\"node-section-header-prefixed\">| LOADOUT & GEAR</div>\r\n                                <div className=\"synergy-build-overlay__gear-horizontal-grid\">\r\n                                    {/* Weapons */}\r\n                                    {hasDIMData ? (\r\n                                        [\r\n                                            { def: dimLoadoutData?.kineticDef, item: dimLoadoutData?.kinetic },\r\n                                            { def: dimLoadoutData?.energyDef, item: dimLoadoutData?.energy },\r\n                                            { def: dimLoadoutData?.powerDef, item: dimLoadoutData?.power }\r\n                                        ].map((w, i) => w.def && (\r\n                                            <div key={i} className=\"gear-item-horizontal\" onMouseEnter={() => setHoveredItemHash(w.def?.hash || null)} onMouseLeave={() => setHoveredItemHash(null)}>\r\n                                                <RichItemIcon hash={w.def.hash} instance={w.item || { state: 4 }} />\r\n                                                <div className=\"gear-item-info\">\r\n                                                    <span className=\"build-item__label--compact\">{w.def.displayProperties?.name}</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        ))\r\n                                    ) : (\r\n                                        cardIcons.weapons.map((w, i) => (\r\n                                            <div key={i} className=\"gear-item-horizontal\" onMouseEnter={() => setHoveredItemHash(w.hash)} onMouseLeave={() => setHoveredItemHash(null)}>\r\n                                                <RichItemIcon hash={w.hash} instance={{ state: 4 }} />\r\n                                                <div className=\"gear-item-info\">\r\n                                                    <span className=\"build-item__label--compact\">{w.name}</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        ))\r\n                                    )}\r\n\r\n                                    {/* Armor */}\r\n                                    {hasDIMData && dimLoadoutData ? (\r\n                                        [\r\n                                            { def: dimLoadoutData.helmetDef, group: dimLoadoutData.modGroups.helmet, cosmetics: dimLoadoutData.helmetCosmetics, itemData: dimLoadoutData.helmet },\r\n                                            { def: dimLoadoutData.gauntletsDef, group: dimLoadoutData.modGroups.arms, cosmetics: dimLoadoutData.gauntletsCosmetics, itemData: dimLoadoutData.gauntlets },\r\n                                            { def: dimLoadoutData.chestDef, group: dimLoadoutData.modGroups.chest, cosmetics: dimLoadoutData.chestCosmetics, itemData: dimLoadoutData.chest },\r\n                                            { def: dimLoadoutData.legsDef, group: dimLoadoutData.modGroups.legs, cosmetics: dimLoadoutData.legsCosmetics, itemData: dimLoadoutData.legs },\r\n                                            { def: dimLoadoutData.classItemDef, group: dimLoadoutData.modGroups.classItem, cosmetics: dimLoadoutData.classItemCosmetics, itemData: dimLoadoutData.classItem }\r\n                                        ].map((item, idx) => item.def && (\r\n                                            <div key={idx} className=\"gear-item-horizontal\" onMouseEnter={() => setHoveredItemHash(item.def?.hash || null)} onMouseLeave={() => setHoveredItemHash(null)}>\r\n                                                <RichItemIcon hash={item.def.hash} instance={item.itemData} />\r\n                                                <div className=\"gear-item-info\">\r\n                                                    <span className=\"build-item__label--compact\">{item.def.displayProperties?.name}</span>\r\n                                                    {renderCompactMods(item.group, item.cosmetics.ornament, item.cosmetics.shader)}\r\n                                                </div>\r\n                                            </div>\r\n                                        ))\r\n                                    ) : (\r\n                                        cardIcons.armor && (\r\n                                            <div className=\"gear-item-horizontal\" onMouseEnter={() => setHoveredItemHash(cardIcons.armor?.hash || null)} onMouseLeave={() => setHoveredItemHash(null)}>\r\n                                                <RichItemIcon hash={cardIcons.armor.hash} instance={{ state: 4 }} />\r\n                                                <div className=\"gear-item-info\">\r\n                                                    <span className=\"build-item__label--compact\">{cardIcons.armor.name}</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        )\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Build Description Panel */}\r\n                    <div className={`synergy-build-overlay__lore-panel ${isLoreOpen ? 'synergy-build-overlay__lore-panel--open' : ''}`}>\r\n                        <div className=\"lore-panel__header\">\r\n                            <h2 className=\"lore-panel__title\">{build.name}</h2>\r\n                            <div className=\"lore-panel__subtitle\">\r\n                                {hasDIMData ? dimLoadoutData?.className : className} // {hasDIMData ? (dimLoadoutData?.subclassDef as any)?.displayProperties?.name : template?.playstyle || 'Custom Build'}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"lore-panel__content\">\r\n                            {build.notes || originalLoadout?.notes || 'No description provided for this build.'}\r\n                        </div>\r\n                        <div className=\"lore-panel__meta\">\r\n                            <div className=\"lore-panel__meta-item\">\r\n                                <span className=\"meta-label\">Saved</span>\r\n                                <span className=\"meta-value\">{new Date(build.createdAt).toLocaleDateString()}</span>\r\n                            </div>\r\n                            {build.tags && build.tags.length > 0 && (\r\n                                <div className=\"lore-panel__meta-item\">\r\n                                    <span className=\"meta-label\">Tags</span>\r\n                                    <span className=\"meta-value\">{build.tags.join(', ')}</span>\r\n                                </div>\r\n                            )}\r\n                            {template?.source && (\r\n                                <div className=\"lore-panel__meta-item\">\r\n                                    <span className=\"meta-label\">Source</span>\r\n                                    <span className=\"meta-value\">{template.source.toUpperCase()}</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Bottom Action Bar */}\r\n                    <div className=\"synergy-build-overlay__footer-bar\">\r\n                        <div className=\"key-prompt\" onClick={() => { onEquip?.(build); setIsDetailsOpen(false); }}>\r\n                            <span className=\"key-cap\">F</span>\r\n                            <span className=\"key-label\">Equip Build</span>\r\n                        </div>\r\n                        {template?.source !== 'exoengine' && (\r\n                            <>\r\n                                <div className=\"key-prompt\" onClick={handleCopyExoEngineLink}>\r\n                                    <span className=\"key-cap\">S</span>\r\n                                    <span className=\"key-label\">Copy ExoEngine Link</span>\r\n                                </div>\r\n                                <div className=\"key-prompt\" onClick={handleCopyDIMLink}>\r\n                                    <span className=\"key-cap\">G</span>\r\n                                    <span className=\"key-label\">Copy DIM Link</span>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                        <div className=\"key-prompt key-prompt--danger\" onClick={() => setShowDeleteConfirm(true)}>\r\n                            <span className=\"key-cap\">Del</span>\r\n                            <span className=\"key-label\">Delete</span>\r\n                        </div>\r\n                        <div className=\"key-prompt\" onClick={() => setIsUiVisible(!isUiVisible)}>\r\n                            <span className=\"key-cap\">Ctrl</span>\r\n                            <span className=\"key-label\">{isUiVisible ? 'Hide Menu' : 'Show Menu'}</span>\r\n                        </div>\r\n                        <div className=\"key-prompt\" onClick={() => setIsDetailsOpen(false)}>\r\n                            <span className=\"key-cap\">Esc</span>\r\n                            <span className=\"key-label\">Close</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Rich Tooltip Portal */}\r\n                    {hoveredItemHash && <RichTooltip item={{ hash: hoveredItemHash }} />}\r\n\r\n                    <ConfirmationModal\r\n                        isOpen={showDeleteConfirm}\r\n                        title=\"DELETE BUILD?\"\r\n                        message=\"Are you sure you want to delete this recorded build? This action cannot be undone.\"\r\n                        confirmText=\"Delete\"\r\n                        cancelText=\"Keep\"\r\n                        onConfirm={() => {\r\n                            setShowDeleteConfirm(false);\r\n                            onDelete?.(build.id);\r\n                            setIsDetailsOpen(false);\r\n                        }}\r\n                        onCancel={() => setShowDeleteConfirm(false)}\r\n                        type=\"danger\"\r\n                    />\r\n                </div>,\r\n                document.body\r\n            )}\r\n        </>\r\n    );\r\n}\r\n\r\nfunction StatItem({ value, label, icon }: { value: number; label: string; icon: string }) {\r\n    const tier = Math.floor(value / 10);\r\n    return (\r\n        <div className=\"stat-item-display\" title={`${label}: ${value}`} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px' }}>\r\n            <div className={`stat-icon stat-icon-${icon}`} style={{ width: '24px', height: '24px', backgroundSize: 'contain', backgroundRepeat: 'no-repeat', filter: 'brightness(1.5)' }} />\r\n            <div style={{ fontSize: '0.8rem', fontWeight: 'bold' }}>T{tier}</div>\r\n            <div style={{ fontSize: '0.6rem', opacity: 0.6, textTransform: 'uppercase' }}>{label}</div>\r\n        </div>\r\n    );\r\n}\r\n","import { useState, useMemo, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { ElementType, GuardianClass, Expansion } from '../types';\r\nimport { VaultCard } from '../components/vault/VaultCard';\r\nimport { QuestSidebar } from '../components/synergy/QuestSidebar';\r\nimport { useSettingsStore, useProfileStore, useSavedBuildsStore } from '../store';\r\nimport { buildService } from '../services/build.service';\r\nimport { useToast } from '../components/common/Toast';\r\nimport { errorLog } from '../utils/logger';\r\nimport { getSubclassElement } from '../utils/character-helpers';\r\nimport './LoadoutVaultPage.css';\r\n\r\n// type FilterElement = ElementType | 'all';\r\ntype FilterClass = GuardianClass | 'all';\r\n\r\nconst LoadoutVaultPage = () => {\r\n  const navigate = useNavigate();\r\n  const [selectedElements, setSelectedElements] = useState<ElementType[]>(Object.values(ElementType));\r\n  const [selectedClass, setSelectedClass] = useState<FilterClass>('all');\r\n  const { ownedExpansions } = useSettingsStore();\r\n  const [selectedExpansions, setSelectedExpansions] = useState<Expansion[]>(ownedExpansions);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [equippingId, setEquippingId] = useState<string | null>(null);\r\n  const [equippingProgress, setEquippingProgress] = useState(0);\r\n  const [equippingStatus, setEquippingStatus] = useState('');\r\n\r\n  const { selectedCharacterId, characterEquipment } = useProfileStore();\r\n  const { builds, isLoading } = useSavedBuildsStore();\r\n  const { success, info, error: showToastError } = useToast();\r\n\r\n  // Load saved builds on mount\r\n  useEffect(() => {\r\n    if (buildService) {\r\n      buildService.loadSavedBuilds();\r\n    }\r\n  }, []);\r\n\r\n  // Dynamic branding based on subclass\r\n  const equipment = characterEquipment[selectedCharacterId || ''] || [];\r\n  const subclassElement = useMemo(() => getSubclassElement(equipment), [equipment]);\r\n\r\n  const elementColors: Record<string, { primary: string, glow: string }> = {\r\n    void: { primary: '#bf84ff', glow: 'rgba(191, 132, 255, 0.5)' },\r\n    solar: { primary: '#ff8c3a', glow: 'rgba(255, 140, 58, 0.5)' },\r\n    arc: { primary: '#7df9ff', glow: 'rgba(125, 249, 255, 0.5)' },\r\n    stasis: { primary: '#4d88ff', glow: 'rgba(77, 136, 255, 0.5)' },\r\n    strand: { primary: '#4aff9b', glow: 'rgba(74, 255, 155, 0.5)' },\r\n    prismatic: { primary: '#ff8df6', glow: 'rgba(255, 141, 246, 0.5)' },\r\n  };\r\n\r\n  const currentTheme = elementColors[subclassElement] || elementColors.void;\r\n\r\n  const toggleElement = (element: ElementType) => {\r\n    setSelectedElements(prev =>\r\n      prev.includes(element)\r\n        ? prev.filter(e => e !== element)\r\n        : [...prev, element]\r\n    );\r\n  };\r\n\r\n  const toggleExpansion = (expansion: Expansion) => {\r\n    if (expansion === Expansion.BaseGame) return;\r\n    setSelectedExpansions(prev =>\r\n      prev.includes(expansion)\r\n        ? prev.filter(e => e !== expansion)\r\n        : [...prev, expansion]\r\n    );\r\n  };\r\n\r\n  // Filter builds\r\n  const filteredBuilds = useMemo(() => {\r\n    return builds.filter((build) => {\r\n      const template = build.template;\r\n      if (!template) return false;\r\n\r\n      // Filter by Class\r\n      if (selectedClass !== 'all' && template.guardianClass !== selectedClass) return false;\r\n\r\n      // Filter by Element\r\n      if (selectedElements.length > 0 && !selectedElements.includes(template.element)) return false;\r\n\r\n      // Filter by expansion\r\n      if (template.requiredExpansion) {\r\n        if (!selectedExpansions.includes(template.requiredExpansion) && template.requiredExpansion !== Expansion.BaseGame) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      // Filter by Search\r\n      if (searchQuery) {\r\n        const query = searchQuery.toLowerCase();\r\n        const nameMatch = build.name.toLowerCase().includes(query);\r\n        const weaponMatch = template.exoticWeapon?.name?.toLowerCase().includes(query);\r\n        const armorMatch = template.exoticArmor?.name?.toLowerCase().includes(query);\r\n        const tagMatch = build.tags?.some((tag) => tag.toLowerCase().includes(query));\r\n        return nameMatch || weaponMatch || armorMatch || tagMatch;\r\n      }\r\n\r\n      return true;\r\n    });\r\n  }, [builds, selectedElements, selectedClass, selectedExpansions, searchQuery]);\r\n\r\n  const handleEquip = async (build: any) => {\r\n    if (equippingId) return;\r\n\r\n    if (!selectedCharacterId) {\r\n      info(\"Please select a character first.\");\r\n      return;\r\n    }\r\n\r\n    setEquippingId(build.id);\r\n    setEquippingProgress(0);\r\n    setEquippingStatus('Initializing...');\r\n    useProfileStore.getState().setEquipping(true);\r\n\r\n    try {\r\n      const result = await buildService.equip(build.template, selectedCharacterId, (step: string, progress: number) => {\r\n        setEquippingStatus(step);\r\n        setEquippingProgress(progress);\r\n\r\n        // Navigate to Galaxy view right before equipping phase (after transfers complete)\r\n        // This lets users see the exotic items flying to the character in real-time\r\n        if (step.includes('Equipping items') || progress >= 35) {\r\n          navigate('/galaxy');\r\n\r\n          // Automatically trigger \"Return to Orbit\" (ESC) after navigation\r\n          // This resets the camera to the default centered view showing equipped items\r\n          setTimeout(() => {\r\n            window.dispatchEvent(new KeyboardEvent('keydown', { key: 'Escape', bubbles: true }));\r\n          }, 100); // Small delay to ensure galaxy view is mounted\r\n        }\r\n      });\r\n\r\n      if (result.success) {\r\n        success(`Successfully equipped ${build.name}!`);\r\n      } else {\r\n        showToastError(result.error || \"Failed to equip build.\");\r\n      }\r\n    } catch (e) {\r\n      errorLog('LoadoutVaultPage', 'Equipment error:', e);\r\n      showToastError(\"An unexpected error occurred during equipment.\");\r\n    } finally {\r\n      setEquippingId(null);\r\n      setEquippingProgress(0);\r\n      setEquippingStatus('');\r\n      useProfileStore.getState().setEquipping(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (buildId: string) => {\r\n    try {\r\n      await buildService.deleteBuild(buildId);\r\n      success(\"Build deleted successfully.\");\r\n    } catch (e) {\r\n      errorLog('LoadoutVaultPage', 'Delete error:', e);\r\n      showToastError(\"Failed to delete build.\");\r\n    }\r\n  };\r\n\r\n  const handleViewBuild = (build: any) => {\r\n    // Navigate to view the build in detail mode\r\n    // If it has a loadout property (DIM format), use DIM viewer\r\n    if (build.loadout) {\r\n      // Store in session and navigate\r\n      sessionStorage.setItem('viewBuild', JSON.stringify(build));\r\n      navigate('/dim-loadout?fromVault=true');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"vault-page\"\r\n      style={{\r\n        '--brand-primary': currentTheme.primary,\r\n        '--brand-glow': currentTheme.glow,\r\n      } as React.CSSProperties}\r\n    >\r\n      {/* LEFT: Sidebar Navigation */}\r\n      <QuestSidebar\r\n        selectedElements={selectedElements}\r\n        onToggleElement={toggleElement}\r\n        selectedClass={selectedClass}\r\n        onSelectClass={setSelectedClass}\r\n        selectedExpansions={selectedExpansions}\r\n        onToggleExpansion={toggleExpansion}\r\n      />\r\n\r\n      {/* RIGHT: Main Content */}\r\n      <main className=\"vault-content\">\r\n        {/* Generate Build Button */}\r\n        <button\r\n          className=\"spin-button\"\r\n          onClick={() => navigate('/generator')}\r\n          style={{\r\n            alignSelf: 'flex-start',\r\n            marginBottom: 'var(--space-md)'\r\n          }}\r\n        >\r\n          <span className=\"spin-button__text\">Generate Build <span style={{ fontSize: '0.75em', opacity: 0.7 }}>(Beta)</span></span>\r\n        </button>\r\n\r\n        {/* Header */}\r\n        <div className=\"section-header\">\r\n          <h2>Saved Builds</h2>\r\n          <div className=\"header-actions\" style={{ display: 'flex', gap: 'var(--space-md)' }}>\r\n            <span className=\"vault-results__count\" style={{ color: '#ffffff' }}>{filteredBuilds.length} builds saved</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Loading State */}\r\n        {isLoading && (\r\n          <div className=\"vault-loading\">\r\n            <div className=\"spinner\" />\r\n            <p>Loading saved builds...</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Empty State */}\r\n        {!isLoading && filteredBuilds.length === 0 && (\r\n          <div className=\"vault-empty\">\r\n            <h3>No Builds Saved</h3>\r\n            <p>Press <span className=\"key-cap\">D</span> while viewing a DIM loadout or ExoEngine build to save it here.</p>\r\n            <button\r\n              className=\"btn btn-secondary\"\r\n              onClick={() => {\r\n                setSelectedElements(Object.values(ElementType));\r\n                setSelectedClass('all');\r\n                setSearchQuery('');\r\n              }}\r\n              style={{\r\n                color: '#ffffff',\r\n                background: '#000000',\r\n                borderColor: '#ffffff'\r\n              }}\r\n            >\r\n              Clear Filters\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Builds Grid */}\r\n        {!isLoading && filteredBuilds.length > 0 && (\r\n          <div className=\"vault-grid\">\r\n            {filteredBuilds.map((build) => (\r\n              <VaultCard\r\n                key={build.id}\r\n                build={build}\r\n                onEquip={handleEquip}\r\n                onDelete={handleDelete}\r\n                onView={handleViewBuild}\r\n                isEquipping={equippingId === build.id}\r\n                equippingProgress={equippingId === build.id ? equippingProgress : undefined}\r\n                equippingStatus={equippingId === build.id ? equippingStatus : undefined}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {/* Footer Padding */}\r\n        <div style={{ height: '100px' }} />\r\n      </main>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LoadoutVaultPage;\r\n"],"names":["ELEMENT_NAMES","CLASS_NAMES","VaultCard","build","onEquip","onDelete","isEquipping","screenshot","setScreenshot","useState","primaryIcon","setPrimaryIcon","isDetailsOpen","setIsDetailsOpen","isLoreOpen","setIsLoreOpen","isUiVisible","setIsUiVisible","hoveredItemHash","setHoveredItemHash","mousePos","setMousePos","showDeleteConfirm","setShowDeleteConfirm","missingItems","setMissingItems","notification","setNotification","notificationTimeout","setNotificationTimeout","manifestLoaded","useManifestStore","template","originalLoadout","hasDIMData","showNotification","message","timeout","cardIcons","setCardIcons","dimLoadoutData","useMemo","loadout","subclassItem","item","manifestService","BUCKET_HASHES","subclassDef","damageType","elementName","getSocketItem","socketIndex","hash","superDef","jumpDef","classAbilityDef","meleeDef","grenadeDef","allAspects","allFragments","idxStr","idx","def","category","typeName","name","getBungieUrl","buildIcons","helmet","i","gauntlets","chest","legs","classItem","kinetic","energy","power","helmetDef","gauntletsDef","chestDef","legsDef","classItemDef","kineticDef","energyDef","powerDef","armor","modGroups","armorCosmetics","distributeLoadoutMods","helmetCosmetics","gauntletsCosmetics","chestCosmetics","legsCosmetics","classItemCosmetics","bgImage","allInventory","useProfileStore","missingGear","checkMissing","finalMissing","m","useEffect","handleCopyExoEngineLink","loadoutData","convertBuildToLoadoutShareData","link","loadoutLinkService","error","errorLog","handleCopyDIMLink","dimLink","handleKeyDown","e","activeEl","v","loadImages","newIcons","mainItemHash","subclass","icon","h","className","handleMouseMove","clientX","clientY","innerWidth","innerHeight","x","y","renderCompactMods","slotMods","ornament","shader","mainStat","secondaryStat","others","categorizeMods","renderCosmeticPod","jsx","renderModPod","jsxs","Fragment","SubclassNode","aspect","fragment","createPortal","StatItem","w","RichItemIcon","RichTooltip","ConfirmationModal","value","label","tier","LoadoutVaultPage","navigate","useNavigate","selectedElements","setSelectedElements","ElementType","selectedClass","setSelectedClass","ownedExpansions","useSettingsStore","selectedExpansions","setSelectedExpansions","searchQuery","setSearchQuery","equippingId","setEquippingId","equippingProgress","setEquippingProgress","equippingStatus","setEquippingStatus","selectedCharacterId","characterEquipment","builds","isLoading","useSavedBuildsStore","success","info","showToastError","useToast","buildService","equipment","subclassElement","getSubclassElement","elementColors","currentTheme","toggleElement","element","prev","toggleExpansion","expansion","Expansion","filteredBuilds","query","nameMatch","weaponMatch","armorMatch","tagMatch","tag","handleEquip","result","step","progress","handleDelete","buildId","handleViewBuild","QuestSidebar"],"mappings":"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"}