const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/galaxy-DVJjGVLR.js","assets/js/markdown-DyKRzreE.js","assets/js/react-vendor-BrsWO7iZ.js","assets/js/builder-B7mi84rt.js","assets/js/utils-Cl4ySqJD.js","assets/builder-BGbmUVAR.css","assets/galaxy-WH4IhYNB.css"])))=>i.map(i=>d[i]);
import{j as e}from"./markdown-DyKRzreE.js";import{r as t,u as Te}from"./react-vendor-BrsWO7iZ.js";import{m as q,l as Pe,a as Ne,E as Q,g as z,u as _e,b as ke,v as Le,x as Me,S as Re,_ as He,p as se,e as Se,t as ne,y as ye,B as X,z as qe}from"./galaxy-DVJjGVLR.js";import{W as be,H as xe,T as Ee}from"./index-BJ86MllY.js";import{b as ge}from"./build.service-CZ6lIic1.js";import{R as ue,S as je,B as De}from"./builder-B7mi84rt.js";import"./utils-Cl4ySqJD.js";const $e=["Health","Melee","Grenade","Super","Class","Weapons"];function Fe({stats:r,subclassElement:b,synergyElement:p}){const[c,x]=t.useState([]),[v,A]=t.useState(null),[o,u]=t.useState(null);t.useEffect(()=>{(()=>{const h=[];$e.forEach(n=>{const _=q.searchStatByName(n);let I=n,w=0,D,R;if(_)switch(R=_.description,D=_.icon?`${Pe.bungieNetOrigin}${_.icon}`:void 0,n){case"Health":w=r.resilience;break;case"Melee":w=r.strength;break;case"Grenade":w=r.discipline;break;case"Super":w=r.intellect;break;case"Class":w=r.recovery;break;case"Weapons":w=r.mobility;break}h.push({key:n,label:I,value:w,icon:D,description:R})}),x(h)})()},[r]);const N={solar:"#f0631e",arc:"#7df9ff",void:"#bf84ff",stasis:"#4d88ff",strand:"#4aff9b",prismatic:"#ff8df6"},g=p||b||null,i=g&&N[g.toLowerCase()]||"#ffffff",S=(d,h)=>{if(!d.description)return;A(d);const n=h.currentTarget.getBoundingClientRect();u({x:n.left+n.width/2,y:n.top-8})},E=()=>{A(null),u(null)};return e.jsxs("div",{className:"stats-panel",children:[c.map(d=>e.jsxs("div",{className:"stats-panel__row",onMouseEnter:h=>S(d,h),onMouseLeave:E,children:[d.icon?e.jsx("img",{src:d.icon,alt:d.label,className:"stats-panel__icon-img"}):e.jsx("div",{className:"stats-panel__icon-placeholder"}),e.jsxs("div",{className:"stats-panel__bar-outer",children:[e.jsx("div",{className:"stats-panel__bar-inner",style:{width:`${Math.min(d.value/200*100,100)}%`,backgroundColor:i,boxShadow:`0 0 8px ${i}80`}}),e.jsx("div",{className:"stats-panel__bar-tier-marker"})]}),e.jsx("span",{className:"stats-panel__value",children:d.value})]},d.key)),v&&o&&v.description&&e.jsx("div",{className:"stats-panel__tooltip",style:{position:"fixed",left:`${o.x}px`,top:`${o.y}px`,transform:"translate(-50%, -100%)",pointerEvents:"none",zIndex:100001},children:e.jsxs("div",{className:"stats-panel__tooltip-wrapper",children:[e.jsx("div",{className:"stats-panel__tooltip-header",children:e.jsxs("div",{className:"stats-panel__tooltip-header-content",children:[v.icon&&e.jsx("img",{src:v.icon,alt:"",className:"stats-panel__tooltip-icon"}),e.jsx("span",{className:"stats-panel__tooltip-name",children:v.label})]})}),e.jsx("div",{className:"stats-panel__tooltip-main",children:e.jsx("div",{className:"stats-panel__tooltip-description",children:v.description})}),e.jsx("div",{className:"stats-panel__tooltip-footer",children:e.jsx("div",{className:"stats-panel__tooltip-stat-value",children:v.value})})]})})]})}function Ue({onSearch:r,selectedElement:b,onSelectElement:p,selectedClass:c,onSelectClass:x,onClose:v}){const[A,o]=t.useState(""),{isLoaded:u}=Ne(),[N,g]=t.useState({}),[i,S]=t.useState({titan:Ee,hunter:xe,warlock:be}),E=["all",Q.Solar,Q.Void,Q.Arc,Q.Stasis,Q.Strand,Q.Prismatic],d=["titan","hunter","warlock"];t.useEffect(()=>{if(!u)return;const n={all:q.getDamageTypeIcon("kinetic")||""};E.forEach(I=>{if(I!=="all"){const w=q.getDamageTypeIcon(I);if(w&&(n[I]=w),I===Q.Prismatic){const R=q.getAllSubclassComponents().find(P=>P.name.toLowerCase().includes("prismatic"));R?.icon&&(n[I]=R.icon)}}}),g(n);const _=(I,w)=>q.searchPresentationNodeByName(I,!0)?.icon||w;S({titan:_("Titan",Ee),hunter:_("Hunter",xe),warlock:_("Warlock",be)})},[u]);const h=n=>{const _=n.target.value;o(_),r(_)};return e.jsxs("div",{className:"vault-search-container",onMouseDown:n=>n.stopPropagation(),onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"vault-search-bar",children:[e.jsx("input",{id:"vault-search-input",name:"vault-search-input",type:"text",placeholder:"Search vault...",value:A,onChange:h,onKeyDown:n=>{n.key==="Escape"&&v?.()},className:"vault-search",autoFocus:!0}),e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})]}),e.jsxs("div",{className:"vault-filters",children:[e.jsx("div",{className:"vault-filter-group",children:d.map(n=>e.jsx("button",{className:`vault-filter-btn ${c===n?"active":""}`,onClick:()=>x(c===n?"all":n),title:n.toUpperCase(),children:e.jsx("img",{src:i[n].startsWith("/")?z(i[n]):i[n],alt:n,className:"vault-filter-icon"})},n))}),e.jsx("div",{className:"vault-filter-divider"}),e.jsx("div",{className:"vault-filter-group",children:E.map(n=>e.jsx("button",{className:`vault-filter-btn element-${n} ${b===n?"active":""}`,onClick:()=>p(b===n?"all":n),title:n.toUpperCase(),children:N[n]&&e.jsx("img",{src:z(N[n]),alt:n,className:"vault-filter-icon"})},n))})]})]})}function Ge({synergyFilter:r}={}){const[b,p]=t.useState(""),[c,x]=t.useState(!1),[v,A]=t.useState(null),[o,u]=t.useState("all"),[N,g]=t.useState("all"),[i,S]=t.useState("all"),[E,d]=t.useState(!1),[h,n]=t.useState(null),[_,I]=t.useState(!1),[w,D]=t.useState(0),[R,P]=t.useState(""),O=t.useRef(null);t.useEffect(()=>{const y=()=>{O.current&&O.current(),se.loadProfile(!0)};return window.addEventListener("galaxy-refresh",y),()=>window.removeEventListener("galaxy-refresh",y)},[]);const{selectedCharacterId:V,characterEquipment:W,itemInstances:H}=_e(),{hideGlobalUI:ce}=ke(),B=Le(),K=t.useRef(null),Z=W[V||""]||[],J=t.useMemo(()=>Me(Z,H),[Z,H]),Y=t.useMemo(()=>{const y=Z.find(l=>[3893112950,4282591831,1616346845,3941205951,2550323932,2453351420,3168997075,2328211300,2932390913,3382391785,2842471112,2842471119,3291545503,873720784,613647804,242419885,3785442599,3948463201].includes(l.itemHash));if(!y)return;const f=y.itemHash;if([3893112950,4282591831,1616346845].includes(f))return"prismatic";if([3941205951,2550323932,2453351420].includes(f))return"solar";if([3168997075,2328211300,2932390913].includes(f))return"arc";if([3382391785,2842471112,2842471119].includes(f))return"void";if([3291545503,873720784,613647804].includes(f))return"stasis";if([242419885,3785442599,3948463201].includes(f))return"strand"},[Z]);t.useEffect(()=>{const f=Y?{solar:"#f0631e",arc:"#7df9ff",void:"#bf84ff",stasis:"#4d88ff",strand:"#4aff9b",prismatic:"#ff8df6"}[Y.toLowerCase()]:void 0;f&&document.documentElement.style.setProperty("--tooltip-element-color",f)},[Y]);const de=async()=>{if(!(_||!h||!V)){I(!0),d(!1),D(y=>y+1),P("Preparing build...");try{const y=await ge.equip(h,V,(f,l)=>{P(`${f} (${Math.round(l)}%)`)});y.success?(B.success(`Successfully equipped ${h.name||"build"}!`),P(""),u("all")):(B.error(y.error||"Failed to equip build"),P(""))}catch{B.error("Failed to equip build. Please try again."),P("")}finally{I(!1)}}};return t.useEffect(()=>{const y=f=>{const l=document.activeElement;l&&(l.tagName==="INPUT"||l.tagName==="TEXTAREA"||l.isContentEditable)||(f.key.toLowerCase()==="i"&&u(j=>j==="inventory-only"?"all":"inventory-only"),f.key.toLowerCase()==="v"&&(f.preventDefault(),x(j=>{const $=!j;return $||(p(""),g("all"),S("all")),$})),f.key.toLowerCase()==="j"&&u(j=>j==="subclass-only"?"all":"subclass-only"),f.key.toLowerCase()==="f"&&E&&de(),f.key==="Escape"&&c&&x(!1),f.key==="Escape"&&o!=="all"&&u("all"))};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[c,o,h,E,_,V]),t.useEffect(()=>{K.current?.focus()},[]),e.jsxs("div",{ref:K,className:"character-screen animate-fade-in",style:{position:"relative"},tabIndex:0,children:[c&&e.jsx(Ue,{onSearch:p,selectedElement:N,onSelectElement:g,selectedClass:i,onSelectClass:S,onClose:()=>x(!1)}),e.jsx(Re,{searchQuery:b,elementFilter:N,classFilter:i,isVaultSearchVisible:c,onSynergyElementChange:A,viewMode:o,synergyFilter:r,onSynergyOverlayChange:(y,f)=>{d(y),n(f)},onResetView:()=>u("all"),forceCloseTrigger:w,resetViewRef:O}),e.jsxs("div",{className:"character-screen__overlay",style:{opacity:ce?0:1,transition:"opacity 0.3s ease-out"},children:[e.jsx("div",{className:"character-screen__left-info",children:e.jsx(Fe,{stats:J,subclassElement:Y,synergyElement:v})}),e.jsx("div",{className:"character-screen__right-info"})]}),e.jsxs("div",{className:"character-screen__footer",children:[e.jsxs("div",{className:"character-screen__footer-left",children:[e.jsxs("div",{className:"character-screen__control-item character-screen__control-item--clickable",onClick:()=>{window.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape",bubbles:!0}))},children:[e.jsx("div",{className:"character-screen__control-key",children:"ESC"}),e.jsx("span",{children:"Back to Orbit"})]}),e.jsxs("div",{className:"character-screen__control-item",style:{marginLeft:"12px"},children:[e.jsxs("div",{style:{display:"flex",gap:"2px"},children:[e.jsx("div",{className:"character-screen__control-key",children:"W"}),e.jsx("div",{className:"character-screen__control-key",children:"A"}),e.jsx("div",{className:"character-screen__control-key",children:"S"}),e.jsx("div",{className:"character-screen__control-key",children:"D"})]}),e.jsx("span",{style:{marginLeft:"8px"},children:"MOVE"})]})]}),e.jsxs("div",{className:"character-screen__footer-right",children:[E&&h&&e.jsxs("div",{className:`character-screen__control-item character-screen__control-item--clickable ${_?"disabled":""}`,onClick:async()=>{if(!(_||!h||!V)){I(!0),P("Preparing build...");try{const{SYNERGY_DEFINITIONS:y}=await He(async()=>{const{SYNERGY_DEFINITIONS:l}=await import("./galaxy-DVJjGVLR.js").then(L=>L.a0);return{SYNERGY_DEFINITIONS:l}},__vite__mapDeps([0,1,2,3,4,5,6]));let f=y.find(l=>l.name===h.buildName);if(!f){const l=h.weapon||h.exoticWeapon,L=h.armor||h.exoticArmor;if(!l&&!L){B.error("Invalid build data: No weapon or armor specified."),I(!1);return}f={id:`dynamic-${Date.now()}`,name:h.buildName||"Custom Build",element:h.element,guardianClass:h.guardianClass,requiredExpansion:"base",exoticArmor:{hash:0,name:L,slot:"chest"},exoticWeapon:{hash:0,name:l},playstyle:"Dynamic Synergy Build",difficulty:"intermediate",tags:[],loopDescription:"Auto-generated synergy build."}}if(f){d(!1),D(L=>L+1);const l=await ge.equip(f,V,(L,j)=>{P(`${L} (${Math.round(j)}%)`)});l.success?(B.success(`Successfully equipped ${f.name}!`),P(""),u("all")):(B.error(l.error||"Failed to equip build"),P(""))}}catch{B.error("Failed to equip build. Please try again."),P("")}finally{I(!1)}}},children:[e.jsx("div",{className:"character-screen__control-key",children:"F"}),e.jsx("span",{children:_?R||"Equipping...":"Equip Build"})]}),e.jsxs("div",{className:"character-screen__control-item character-screen__control-item--clickable",onClick:()=>u(y=>y==="inventory-only"?"all":"inventory-only"),children:[e.jsx("div",{className:`character-screen__control-key ${o==="inventory-only"?"active":""}`,children:"I"}),e.jsxs("span",{children:["Inventory",o==="inventory-only"?" (Active)":""]})]}),e.jsxs("div",{className:"character-screen__control-item character-screen__control-item--clickable",onClick:()=>x(y=>!y),children:[e.jsx("div",{className:`character-screen__control-key ${c?"active":""}`,children:"V"}),e.jsxs("span",{children:["Vault",c?" (Active)":""]})]}),e.jsxs("div",{className:"character-screen__control-item character-screen__control-item--clickable",onClick:()=>u(y=>y==="subclass-only"?"all":"subclass-only"),children:[e.jsx("div",{className:`character-screen__control-key ${o==="subclass-only"?"active":""}`,children:"J"}),e.jsxs("span",{children:["Subclass",o==="subclass-only"?" (Active)":""]})]})]})]})]})}function Be(r){return{itemHash:r,itemInstanceId:void 0,quantity:1,bindStatus:0,location:0,bucketHash:0,transferStatus:0,lockable:!1,state:0}}function Ie({items:r,columns:b,onSelect:p,onClose:c,element:x="void",equippedHash:v,style:A,type:o="square"}){const u=t.useRef(null),[N,g]=t.useState(null);return t.useEffect(()=>{const i=d=>{u.current&&!u.current.contains(d.target)&&c()},S=d=>{d.key==="Escape"&&c()},E=setTimeout(()=>{document.addEventListener("mousedown",i)},50);return document.addEventListener("keydown",S),()=>{clearTimeout(E),document.removeEventListener("mousedown",i),document.removeEventListener("keydown",S)}},[c]),e.jsx("div",{className:`ability-picker element-${x} ability-picker--${o}`,ref:u,style:A,onClick:i=>{i.preventDefault(),i.stopPropagation()},onMouseDown:i=>i.stopPropagation(),children:e.jsx("div",{className:"ability-picker__grid",style:{gridTemplateColumns:`repeat(${b}, 1fr)`},children:r.map((i,S)=>{const E=i.icon?.startsWith("/")?z(i.icon):i.icon,d=i.hash===v,h=N===i.hash;return e.jsxs("div",{className:"ability-picker__cell-wrapper",style:{"--delay":`${S*.02}s`},onMouseEnter:()=>g(i.hash),onMouseLeave:()=>g(null),children:[e.jsx("button",{className:`ability-picker__cell${d?" ability-picker__cell--equipped":""}`,onClick:()=>p(i.hash),children:E&&e.jsx("img",{src:E,alt:i.name,className:"ability-picker__icon"})}),h&&e.jsx(ue,{item:Be(i.hash),hideStats:!0})]},i.hash)})})})}const Oe={0:"TITAN",1:"HUNTER",2:"WARLOCK"};function Ce(r){return{itemHash:r,itemInstanceId:void 0,quantity:1,bindStatus:0,location:0,bucketHash:0,transferStatus:0,lockable:!1,state:0}}function Ve(r,b){if(r?.displayProperties?.icon){const p=r.displayProperties.icon;return p.startsWith("http")?p:z(p)||""}return b?b.startsWith("http")?b:z(b)||"":""}function We(r,b){const p={SUPER:[],GRENADES:[],MELEE:[],CLASS_ABILITIES:[],JUMP:[],ASPECTS:[],FRAGMENTS:[],PRISMATIC_FRAGMENTS:[],TRANSCENDENCE:[]};if(!b?.sockets?.socketCategories)return p;const c={457473665:"SUPER",2047681910:"ASPECTS",2140934067:"ASPECTS",3400923910:"ASPECTS",764703411:"ASPECTS",271461480:"FRAGMENTS",1313488945:"FRAGMENTS",2819965312:"FRAGMENTS",193371309:"FRAGMENTS",4112185160:"FRAGMENTS",309722977:"CLASS_ABILITIES",3218807805:"CLASS_ABILITIES",1905270138:"TRANSCENDENCE"};for(const x of b.sockets.socketCategories){let v=c[x.socketCategoryHash];if(v&&p[v])for(const A of x.socketIndexes){const o=r[A],u=o?.plugHash||0;let N=v;if(v==="CLASS_ABILITIES"&&u){const d=q.getItem(u)?.plug?.plugCategoryIdentifier||"";/grenade/i.test(d)?N="GRENADES":/melee/i.test(d)?N="MELEE":/movement/i.test(d)&&(N="JUMP")}const g=u?q.getItem(u):void 0,i=g?.displayProperties?.name||o?.plugName||(u===0?"Empty Socket":""),S=Ve(g,o?.plugIcon);p[N].push({hash:u,name:i,icon:S,socketIndex:A})}}return p}function we(r,b,p=[]){const c=q.getRawDefinition("DestinyInventoryItemDefinition",r);if(!c?.sockets?.socketEntries)return[];const x=c.sockets.socketEntries[b];if(!x)return[];const v=x.reusablePlugSetHash||x.randomizedPlugSetHash;return v?q.getPlugSet(v).filter(o=>!p.includes(o.hash)).filter(o=>o.name&&o.name!=="Unknown Perk").map(o=>({hash:o.hash,name:o.name,icon:o.icon||""})).sort((o,u)=>{const N=o.name.toLowerCase().includes("empty"),g=u.name.toLowerCase().includes("empty");return N&&!g?-1:!N&&g?1:o.name.localeCompare(u.name)}):[]}function Ke({subclassHash:r,itemInstanceId:b,onBack:p}){const{selectedCharacterId:c,characterEquipment:x,characterInventories:v,itemInstances:A,characters:o,vaultInventory:u}=_e(),{isLoaded:N}=Ne(),g=t.useRef(!1),[i,S]=t.useState(null),[E,d]=t.useState(null),[h,n]=t.useState(!1),[_,I]=t.useState({}),[w,D]=t.useState({x:0,y:0}),[R,P]=t.useState(!0),[O,V]=t.useState(!1),[W,H]=t.useState(null),[ce,B]=t.useState(!1);t.useEffect(()=>{const s=a=>{a.key==="Escape"&&(a.preventDefault(),p()),a.key==="Control"&&(a.preventDefault(),P(T=>!T)),a.key.toLowerCase()==="a"&&(a.preventDefault(),V(T=>!T)),a.key.toLowerCase()==="f"&&(a.preventDefault(),pe())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[p]);const K=t.useCallback(s=>S(a=>a===s?null:s),[]),Z=t.useCallback(s=>{D({x:s.clientX/window.innerWidth-.5,y:s.clientY/window.innerHeight-.5})},[]),J=x[c||""]||[],Y=v[c||""]||[],y=o.find(s=>s.characterId===c)?.classType??2,f=Oe[y]||"GUARDIAN",l=t.useMemo(()=>{if(r){const s=J.find(m=>m.itemHash===r);if(s)return s;const a=Y.find(m=>m.itemHash===r&&(!b||m.itemInstanceId===b));return a||u.find(m=>m.itemHash===r&&(!b||m.itemInstanceId===b))||null}return Se(J,X.SUBCLASS)},[r,b,J,Y,u]);t.useEffect(()=>{(async()=>{if(!l||!c||ce)return;if(u.some(T=>T.itemInstanceId===l.itemInstanceId)&&l.itemInstanceId){B(!0),H({status:"Retrieving subclass from Vault...",percent:0});try{await ne.smartTransfer(l.itemInstanceId,l.itemHash,!1,c,ye([],1)),await se.loadProfile(!0),H({status:"Data retrieved!",percent:100}),setTimeout(()=>H(null),1e3)}catch(T){H({status:`Failed to retrieve: ${T.message}`,percent:0})}finally{B(!1)}}})()},[l?.itemInstanceId,c]);const L=l?.itemHash||0,j=l?q.getItem(l.itemHash):void 0,$=t.useMemo(()=>{if(!j)return"void";let s=j.defaultDamageType;if((!s||s===0)&&(s=j.talentGrid?.hudDamageType),s===2)return"arc";if(s===3)return"solar";if(s===4)return"void";if(s===6)return"stasis";if(s===7)return"strand";const a=j.displayProperties?.name?.toLowerCase()||"";return/\bprismatic\b/.test(a)?"prismatic":/\bsolar\b/.test(a)||/\bdawn\b/.test(a)||/\bgunslinger\b/.test(a)||/\bfire\b/.test(a)?"solar":/\bvoid\b/.test(a)||/\bnight\b/.test(a)||/\bvoidwalker\b/.test(a)||/\bsentinel\b/.test(a)?"void":/\barc\b/.test(a)||/\bstorm\b/.test(a)||/\bstriker\b/.test(a)||/\bstrider\b/.test(a)?"arc":/\bstasis\b/.test(a)||/\bshade\b/.test(a)||/\brevenant\b/.test(a)||/\bbehemoth\b/.test(a)?"stasis":/\bstrand\b/.test(a)||/\bbrood\b/.test(a)||/\bthread\b/.test(a)||/\bberserk\b/.test(a)?"strand":"void"},[j]),he=j?.displayProperties?.name||`${$.toUpperCase()} ${f}`,te=l?.itemInstanceId?A[l.itemInstanceId]?.sockets||[]:[],me=t.useMemo(()=>te.map(s=>{const a=s.socketIndex??te.indexOf(s);return _[a]!==void 0?{...s,plugHash:_[a]}:s}),[te,_]),k=t.useMemo(()=>We(me,j),[me,j]),ie=[...k.FRAGMENTS||[],...k.PRISMATIC_FRAGMENTS||[]],ae=t.useCallback(async(s,a)=>{if(!l?.itemInstanceId||!c||h||g.current)return;g.current=!0,S(null);const m=te.find(C=>C.socketIndex===s)?.plugHash;I(C=>({...C,[s]:a})),n(!0);try{const C=u.find(G=>G.itemHash===(l?.itemHash||0));if(C&&C.itemInstanceId&&c&&(await ne.smartTransfer(C.itemInstanceId,C.itemHash,!1,c,ye([],1)),await se.loadProfile(!0),await new Promise(G=>setTimeout(G,1e3))),!l?.itemInstanceId)throw new Error("Subclass item instance not found.");if(!await ne.insertSocketPlugFree(l.itemInstanceId,a,s,c))throw new Error("Socket plug failed")}catch{I(U=>{const G={...U};return m!==void 0?G[s]=m:delete G[s],G}),await se.loadProfile(!0)}finally{n(!1),g.current=!1}},[l,c,h,u,te]),pe=t.useCallback(async()=>{if(!(!l?.itemInstanceId||!c||h||W))try{n(!0),H({status:"Preparing to equip subclass...",percent:0}),(x[c]||[]).find(m=>m.bucketHash===X.SUBCLASS)?.itemInstanceId!==l.itemInstanceId&&(H({status:"Switching to this subclass...",percent:20}),await ne.equipItem(l.itemInstanceId,c),await new Promise(m=>setTimeout(m,500)),await se.loadProfile(!0));const T={subclassHash:l.itemHash,superHash:k.SUPER[0]?.hash,grenadeHash:k.GRENADES[0]?.hash,meleeHash:k.MELEE[0]?.hash,classAbilityHash:k.CLASS_ABILITIES[0]?.hash,movementHash:k.JUMP[0]?.hash,aspects:k.ASPECTS?.map(m=>m.hash).filter(m=>m!==void 0)||[],fragments:ie?.map(m=>m.hash).filter(m=>m!==void 0)||[]};await ne.applySubclassConfiguration(l,T,c,(m,C)=>H({status:m,percent:40+C*.6})),H({status:"Subclass equipped successfully!",percent:100}),p(),setTimeout(()=>H(null),1e3),await se.loadProfile(!0)}catch(s){H({status:`Error: ${s.message}`,percent:0}),setTimeout(()=>H(null),3e3)}finally{n(!1)}},[l,c,h,W,k,ie,x]),fe=t.useMemo(()=>{if(j?.screenshot)return z(j.screenshot);if(j?.displayProperties?.icon)return z(j.displayProperties.icon);const s=[X.HELMET,X.GAUNTLETS,X.CHEST_ARMOR,X.LEG_ARMOR,X.CLASS_ARMOR];for(const a of s){const T=Se(J,a);if(T){const m=q.getItem(T.itemHash);if(m?.inventory?.tierType===6&&m.screenshot)return z(m.screenshot)}}return null},[j,J,N]),le="SUPER-main",ve=t.useMemo(()=>k.SUPER[0]?.socketIndex!==void 0?we(L,k.SUPER[0].socketIndex):[],[L,k.SUPER[0]?.socketIndex]);return e.jsxs("div",{className:`subclass-screen element-${$} animate-fade-in ${R?"":"ui-hidden"}`,onMouseMove:Z,style:{"--parallax-x":w.x,"--parallax-y":w.y},onMouseDown:()=>S(null),children:[fe&&e.jsx("div",{className:"subclass-screen__exotic-bg",style:{backgroundImage:`url(${fe})`}}),e.jsxs("div",{className:"subclass-screen__header",children:[e.jsx("button",{className:"btn-back",onMouseDown:s=>{s.stopPropagation(),p()},children:"â† Back to Character"}),e.jsxs("div",{className:"subclass-screen__title",children:[e.jsx("h1",{children:he}),e.jsxs("p",{className:"subclass-screen__subtitle",children:[f," SUBCLASS"]})]})]}),e.jsxs("div",{className:"subclass-screen__content",children:[e.jsx("div",{className:"subclass-screen__super-section",children:e.jsxs("div",{className:"subclass-screen__diamond-wrapper",onMouseEnter:()=>d("slot-super"),onMouseLeave:()=>d(null),onMouseDown:s=>{s.stopPropagation(),K(le)},children:[e.jsx(je,{type:"square",size:"large",icon:k.SUPER[0]?.icon,status:"active",element:$}),E==="slot-super"&&i!==le&&k.SUPER[0]&&e.jsx(ue,{item:Ce(k.SUPER[0].hash),overrideElement:$,hideStats:!0}),i===le&&ve.length>0&&e.jsx(Ie,{items:ve,columns:4,equippedHash:k.SUPER[0]?.hash,onSelect:s=>k.SUPER[0]&&ae(k.SUPER[0].socketIndex,s),onClose:()=>S(null),element:$,type:"square"})]})}),e.jsxs("div",{className:"subclass-screen__middle",children:[e.jsxs("div",{className:"subclass-screen__top-row",children:[(k.TRANSCENDENCE?.length||0)>0&&e.jsxs("div",{className:"subclass-group",children:[e.jsx("h3",{className:"section-label",children:"TRANSCENDENCE"}),e.jsx("div",{className:"subclass-group__slots",children:k.TRANSCENDENCE.map((s,a)=>e.jsx(re,{item:s,label:"",categoryId:"TRANSCENDENCE",indexInCat:a,subclassHash:L,subclassElement:$,openPicker:i,togglePicker:K,hoveredSlot:E,setHoveredSlot:d,handleEquip:ae,setOpenPicker:S},`trans-${a}`))})]}),e.jsxs("div",{className:"subclass-group",children:[e.jsx("h3",{className:"section-label",children:"ABILITIES"}),e.jsx("div",{className:"subclass-group__slots",children:["CLASS_ABILITIES","JUMP","MELEE","GRENADES"].map(s=>e.jsx(re,{item:k[s][0],label:"",categoryId:s,subclassHash:L,subclassElement:$,openPicker:i,togglePicker:K,hoveredSlot:E,setHoveredSlot:d,handleEquip:ae,setOpenPicker:S},s))})]}),e.jsxs("div",{className:"subclass-group",children:[e.jsx("h3",{className:"section-label",children:"ASPECTS"}),e.jsx("div",{className:"subclass-group__slots",children:(()=>{const a=[...k.ASPECTS||[]].sort((C,U)=>C.name.toLowerCase().includes("empty")?-1:1),T=[...Array(Math.max(0,2-a.length)).fill(void 0),...a],m=T.map(C=>C?.hash).filter(C=>C!==void 0);return T.slice(0,2).map((C,U)=>e.jsx(re,{item:C,label:"",categoryId:"ASPECTS",indexInCat:U,subclassHash:L,subclassElement:$,openPicker:i,togglePicker:K,hoveredSlot:E,setHoveredSlot:d,handleEquip:ae,setOpenPicker:S,excludedHashes:m.filter(G=>G!==C?.hash)},`aspect-${U}`))})()})]})]}),e.jsx("div",{className:"subclass-screen__bottom-row",children:e.jsxs("div",{className:"subclass-group",children:[e.jsx("h3",{className:"section-label",children:"FRAGMENTS"}),e.jsx("div",{className:"subclass-group__slots",children:(()=>{let s=0;const a={"Feed the Void":2,Hellion:2,"Bleak Watcher":2,Frostpulse:2,"Iceflare Bolts":2,"Glacial Harvest":2,"Weaver's Call":3,"Lightning Surge":3,"Stylish Executioner":2,"On the prowl":3,"On the Prowl":3,"Storm's Keep":2,"Storm's keep":2,"Storm Keep":2,"Storm keep":2,Ascension:2,"Winter's Shroud":2,Shatterdive:2,"Grim Harvest":3,"Touch of Winter":2,"Gunpowder Gamble":3,"Threaded Specter":3,Consecration:2,Knockout:2,Cryoclasm:2,"Tectonic Harvest":2,"Howl of the Storm":2,"Drengr's Lash":3,"Diamond Lance":3,Unbreakable:3};(k.ASPECTS||[]).forEach(M=>{const F=q.getItem(M.hash);let ee=0;if(F?.investmentStats)for(const oe of F.investmentStats){const Ae=q.getStat(oe.statTypeHash);(oe.statTypeHash===2855639344||Ae?.name?.includes("Slots"))&&(ee+=oe.value)}ee===0&&F?.displayProperties?.name&&(ee=a[F.displayProperties.name]??2),s+=ee});const T=ie||[],U=[...[...Array.from(new Map(T.map(M=>[M.socketIndex,M])).values()).sort((M,F)=>M.hash===0&&F.hash===0?M.socketIndex-F.socketIndex:M.hash===0?1:F.hash===0?-1:M.socketIndex-F.socketIndex)]];for(;U.length<s;)U.push({hash:0,name:"Empty Slot",icon:"",socketIndex:-1});const G=U.map(M=>M?.hash).filter(M=>M!==0);return U.slice(0,s).map((M,F)=>e.jsx(re,{item:M,label:"",categoryId:"FRAGMENTS",indexInCat:F,nodeType:"square",subclassHash:L,subclassElement:$,openPicker:i,togglePicker:K,hoveredSlot:E,setHoveredSlot:d,handleEquip:ae,setOpenPicker:S,pickerColumns:8,pickerAlign:"start",size:"small",excludedHashes:G.filter(ee=>ee!==M?.hash)},`frag-${F}`))})()})]})})]}),e.jsx("div",{className:"subclass-screen__right-spacer"})]}),e.jsx("div",{className:"subclass-screen__footer",children:e.jsxs("div",{className:"subclass-screen__controls-right",children:[e.jsxs("div",{className:"d2-control-item",onClick:()=>P(!R),children:[e.jsx("span",{className:"d2-key-btn",children:"Ctrl"}),e.jsx("span",{className:"d2-control-label",children:R?"Hide Menu":"Show Menu"})]}),e.jsxs("div",{className:"d2-control-item",onClick:p,children:[e.jsx("span",{className:"d2-key-btn",children:"Esc"}),e.jsx("span",{className:"d2-control-label",children:"Dismiss"})]}),e.jsxs("div",{className:"d2-control-item",onClick:pe,children:[e.jsx("span",{className:"d2-key-btn",children:"F"}),e.jsx("span",{className:"d2-control-label",children:"Equip Subclass"})]})]})}),W&&e.jsxs("div",{className:"subclass-screen__service-alert animate-slide-up",children:[e.jsxs("div",{className:"service-alert-content",children:[e.jsx("div",{className:"service-alert-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})})}),e.jsxs("div",{className:"service-alert-text",children:[e.jsx("span",{className:"alert-bold",children:"SERVICE ALERT"}),e.jsx("span",{className:"alert-message",children:W.status})]})]}),W.percent>0&&e.jsx("div",{className:"service-alert-progress",children:e.jsx("div",{className:"service-alert-progress-fill",style:{width:`${W.percent}%`}})})]}),O&&e.jsx("div",{className:"subclass-lore-overlay animate-fade-in",onClick:()=>V(!1),children:e.jsxs("div",{className:"subclass-lore-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"lore-header",children:[e.jsx("div",{className:"lore-title",children:he}),e.jsx("div",{className:"lore-subtitle",children:"LORE"})]}),e.jsx("div",{className:"lore-body",children:j?.displayProperties?.description||"No lore found for this subclass."}),e.jsxs("div",{className:"lore-footer",children:[e.jsx("span",{className:"d2-key-btn",children:"Esc"})," Dismiss"]})]})})]})}function re({item:r,label:b,categoryId:p,indexInCat:c=0,nodeType:x="square",customLabel:v,subclassHash:A,subclassElement:o,openPicker:u,togglePicker:N,hoveredSlot:g,setHoveredSlot:i,handleEquip:S,setOpenPicker:E,pickerColumns:d=4,pickerAlign:h="center",excludedHashes:n=[],size:_}){const I=`${p}-${c}`,w=u===I,D=`slot-${p}-${c}`,R=t.useMemo(()=>r?.socketIndex!==void 0?we(A,r.socketIndex,n):[],[A,r?.socketIndex,n]),P=t.useMemo(()=>h==="start"?{"--picker-x":`-${(c||0)*72}px`,left:"0",transform:"none"}:{},[h,c]);return e.jsxs("div",{className:"subclass-slot-col",children:[e.jsx("span",{className:"slot-label",children:v||b}),e.jsxs("div",{className:"subclass-slot",onMouseEnter:()=>i(D),onMouseLeave:()=>i(null),onMouseDown:O=>{O.stopPropagation(),N(I)},children:[e.jsx(je,{type:x,size:_,icon:r?.icon,status:r&&r.hash!==0?"active":"empty",element:o}),g===D&&!w&&r&&r.hash!==0&&e.jsx(ue,{item:Ce(r.hash),overrideElement:o,hideStats:!0}),w&&R.length>0&&e.jsx(Ie,{items:R,columns:d,equippedHash:r?.hash,onSelect:O=>r?.socketIndex!==void 0&&S(r.socketIndex,O),onClose:()=>E(null),element:o,style:P,type:x})]})]})}function ss(){const p=Te().state?.synergyFilter,{builderView:c,builderSubView:x,setBuilderView:v}=ke(),[A,o]=t.useState(null),[u,N]=t.useState(null),g=t.useCallback((S,E)=>{v("subclass",{hash:S,itemInstanceId:E})},[v]),i=t.useCallback((S,E)=>{N({item:S,instance:E})},[]);return e.jsx(qe,{children:c==="character"?e.jsx(De,{onSubclassClick:g,hoveredSubclass:A,setHoveredSubclass:o,onSubclassDataReady:i,children:e.jsx(Ge,{activeSubclass:u,synergyFilter:p})}):e.jsx(Ke,{subclassHash:x?.hash,itemInstanceId:x?.itemInstanceId,onBack:()=>v("character")})})}export{ss as default};
//# sourceMappingURL=BuilderPage-D_PWZaVQ.js.map
